import{r as i,j as e,L as H,V as K,R as U,u as z,a as q,F as Y,b as J,c as Q,d as X,e as G,f as Z,g as ee,h as te,i as re,Q as ne}from"./vendor-react-714aa20b.js";import{al as F,T as se,am as oe,an as ae,ao as ie,ap as ce}from"./vendor-19b22db8.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))d(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&d(l)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function d(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}})();const le="/api/livekit",de=async(r,o)=>{try{return(await F.post(`${le}/token`,{roomName:r,participantName:o})).data.token}catch(t){throw console.error("Error fetching LiveKit token:",t),new Error("Failed to fetch room token")}},ue=({roomName:r,username:o})=>{const[t,d]=i.useState(""),[n,s]=i.useState("");return i.useEffect(()=>{(async()=>{try{if(r&&o){const f=await de(r,o);d(f)}}catch(f){s("Failed to get room token. Please try again."),console.error("Error fetching token:",f)}})()},[r,o]),n?e.jsx("div",{className:"error-message",children:n}):t?e.jsx("div",{className:"video-chat-container",children:e.jsxs(H,{video:!0,audio:!0,token:t,serverUrl:{}.VITE_LIVEKIT_SERVER_URL||"ws://localhost:7880","data-lk-theme":"default",style:{height:"100%",width:"100%"},children:[e.jsx(K,{}),e.jsx(U,{})]})}):e.jsx("div",{children:"Loading..."})},he=()=>{const[r,o]=i.useState(!1),{localParticipant:t}=z(),d=async()=>{if(t)if(r)t.tracks.forEach(n=>{n.track&&n.track.source===se.Source.ScreenShare&&(n.track.stop(),t.unpublishTrack(n.track))}),o(!1);else try{if(!(t!=null&&t.room)){console.error("Room not available");return}const n=await t.room.localParticipant.createScreenShareTrack({audio:!0,resolution:{width:1920,height:1080}});await t.publishTrack(n),o(!0)}catch(n){console.error("Error sharing screen:",n),o(!1)}};return e.jsx("button",{className:`screen-share-button ${r?"active":""}`,onClick:d,"aria-label":"Toggle screen sharing","aria-pressed":r,children:r?"Stop Sharing":"Share Screen"})},fe=r=>{r.editor.defineTheme("customDarkTheme",{base:"vs-dark",inherit:!0,rules:[],colors:{"editor.background":"#1e1e1e","editor.lineHighlightBackground":"#303030","editorCursor.foreground":"#a6a6a6","editor.selectionBackground":"#264f78","editor.inactiveSelectionBackground":"#3a3d41"}});const o={target:r.languages.typescript.ScriptTarget.ES2020,allowNonTsExtensions:!0,moduleResolution:r.languages.typescript.ModuleResolutionKind.NodeJs,module:r.languages.typescript.ModuleKind.ESNext,noEmit:!0,esModuleInterop:!0,jsx:r.languages.typescript.JsxEmit.React,reactNamespace:"React",allowJs:!0,typeRoots:["node_modules/@types"]};r.languages.typescript.javascriptDefaults.setCompilerOptions(o),r.languages.typescript.typescriptDefaults.setCompilerOptions(o);try{r.languages.typescript.javascriptDefaults.addExtraLib(`declare module 'react' {
        export interface Component<P = {}, S = {}> {}
        export function useState<T>(initialState: T | (() => T)): [T, (newState: T) => void];
        export function useEffect(effect: () => void | (() => void), deps?: readonly any[]): void;
        export function useRef<T>(initialValue: T): { current: T };
        export function useCallback<T extends (...args: any[]) => any>(callback: T, deps: readonly any[]): T;
        export function useMemo<T>(factory: () => T, deps: readonly any[]): T;
      }`,"node_modules/@types/react/index.d.ts")}catch(t){console.warn("Failed to load extra libraries for Monaco editor",t)}},pe=({language:r="javascript",value:o="",onChange:t,theme:d="vs-dark",readOnly:n=!1,filename:s="index.js"})=>{const l=i.useRef(null),f=q(),[c,u]=i.useState(!1);i.useEffect(()=>{f&&(fe(f),u(!0))},[f]),i.useEffect(()=>{s&&s.split(".").pop().toLowerCase()},[s]);const x=(y,S)=>{l.current=y,y.addCommand(S.KeyMod.CtrlCmd|S.KeyCode.KeyS,()=>{y.getValue(),console.log("Save triggered")})};return e.jsx("div",{className:"monaco-editor-container",style:{height:"100%",width:"100%"},children:e.jsx(Y,{height:"100%",width:"100%",language:r,value:o,theme:d,onChange:t,onMount:x,options:{readOnly:n,minimap:{enabled:!0},scrollBeyondLastLine:!1,automaticLayout:!0,fontSize:14,lineNumbers:"on",folding:!0,formatOnPaste:!0,formatOnType:!0,suggestOnTriggerCharacters:!0,scrollbar:{verticalScrollbarSize:10,horizontalScrollbarSize:10}}})})},me={}.VITE_API_BASE_URL||"http://localhost:5050/api",B=()=>(console.log("Creating mock terminal session for local development"),{id:"mock-session-id",created:new Date().toISOString(),status:"active"}),ge=async()=>{try{return(await F.post(`${me}/terminal/sessions`)).data}catch(r){return console.warn("Terminal API unavailable, using mock session:",r.message),r.response&&r.response.status===404||console.error("Error creating terminal session:",r),B()}};const xe=({sessionId:r})=>{const o=i.useRef(null),t=i.useRef(null),d=i.useRef(null),n=i.useRef(""),s=i.useRef(null);i.useEffect(()=>{const c=new oe.Terminal({cursorBlink:!0,theme:{background:"#1e1e1e",foreground:"#f0f0f0",cursor:"#ffffff"},fontFamily:'Menlo, Monaco, "Courier New", monospace',fontSize:14,lineHeight:1.2,convertEol:!0});t.current=c;const u=new ae.FitAddon;d.current=u,c.loadAddon(u);const x=new ie.WebLinksAddon;c.loadAddon(x),c.open(o.current),u.fit(),l(),c.writeln("Welcome to PodPlai Studio Terminal"),c.writeln('Type "help" for available commands'),c.write(`\r
$ `),c.onData(S=>{if(S==="\r"){const g=n.current.trim();c.writeln(""),f(g),n.current="",c.write("$ ")}else S===""?n.current.length>0&&(n.current=n.current.substring(0,n.current.length-1),c.write("\b \b")):(n.current+=S,c.write(S))});const y=()=>{d.current&&d.current.fit()};return window.addEventListener("resize",y),()=>{window.removeEventListener("resize",y),c.dispose(),s.current&&s.current.close()}},[r]);const l=c=>{console.log("Simulating terminal WebSocket connection"),s.current={readyState:WebSocket.OPEN,send:u=>{const x=JSON.parse(u);x.type==="command"&&setTimeout(()=>{const y=`Simulated output for: ${x.content}
`;t.current&&t.current.write(y)},100)},close:()=>console.log("Terminal WebSocket disconnected")}},f=async c=>{if(c){if(c==="clear"){t.current.clear();return}if(c==="help"){t.current.writeln("Available commands:"),t.current.writeln("  help     - Show this help message"),t.current.writeln("  clear    - Clear the terminal"),t.current.writeln("  python   - Execute Python code (simulated)"),t.current.writeln("  node     - Execute JavaScript code with Node.js (simulated)"),t.current.writeln("  ls       - List files in current directory (simulated)");return}try{s.current&&s.current.readyState===WebSocket.OPEN?s.current.send(JSON.stringify({type:"command",content:c})):t.current.writeln(`Simulated output for: ${c}`)}catch(u){t.current.writeln(`Error: ${u.message||"Failed to execute command"}`)}}};return e.jsx("div",{className:"terminal-container",ref:o,style:{height:"100%",width:"100%"},"aria-label":"Terminal",role:"region"})},C="/api/files",ye=async()=>{try{return(await F.get(`${C}`)).data.files}catch(r){throw console.error("Error listing files:",r),new Error("Failed to list files")}},we=async r=>{try{return(await F.get(`${C}/content`,{params:{path:r}})).data}catch(o){throw console.error("Error getting file content:",o),new Error("Failed to get file content")}},ve=async(r,o="")=>{try{return(await F.post(`${C}`,{path:r,content:o})).data}catch(t){throw console.error("Error creating file:",t),new Error("Failed to create file")}},Se=async(r,o)=>{try{return(await F.put(`${C}`,{path:r,content:o})).data}catch(t){throw console.error("Error updating file:",t),new Error("Failed to update file")}},je=async r=>{try{return(await F.delete(`${C}`,{params:{path:r}})).data}catch(o){throw console.error("Error deleting file:",o),new Error("Failed to delete file")}},be=async(r,o)=>{try{return(await F.put(`${C}/rename`,{oldPath:r,newPath:o})).data}catch(t){throw console.error("Error renaming file:",t),new Error("Failed to rename file")}},ke=({onFileSelect:r,currentFilePath:o})=>{const[t,d]=i.useState([]),[n,s]=i.useState({}),[l,f]=i.useState(!0),[c,u]=i.useState(""),[x,y]=i.useState(""),[S,g]=i.useState(!1),[T,$]=i.useState(""),[v,N]=i.useState(null),[b,R]=i.useState("");i.useEffect(()=>{E()},[]);const E=async()=>{try{f(!0),u("");const a=await ye();d(a)}catch(a){u("Failed to load files"),console.error("Error loading files:",a)}finally{f(!1)}},M=a=>{s(m=>({...m,[a]:!m[a]}))},W=a=>{a.type==="file"?r(a.path):M(a.path)},P=a=>{$(a),g(!0),y("")},D=a=>{N(a),R(a.name)},I=async()=>{if(x)try{const a=T?`${T}/${x}`:x;await ve(a,""),await E(),g(!1),y("")}catch(a){u("Failed to create file"),console.error("Error creating file:",a)}},_=async a=>{try{await je(a.path),await E()}catch(m){u("Failed to delete file"),console.error("Error deleting file:",m)}},A=async()=>{if(!(!b||!v))try{const m=v.path.substring(0,v.path.lastIndexOf("/")+1)+b;await be(v.path,m),await E(),N(null),R("")}catch(a){u("Failed to rename file"),console.error("Error renaming file:",a)}},O=i.useCallback(()=>{const a=[],m=(L,p)=>{L.forEach(j=>{a.push({...j,level:p}),j.type==="directory"&&n[j.path]&&m(j.children||[],p+1)})};return m(t,0),a},[t,n]),h=({index:a,style:m})=>{const p=O()[a],j=p.level*20,V=o===p.path;return v&&v.path===p.path?e.jsxs("div",{style:{...m,paddingLeft:`${j}px`},className:"file-row editing",children:[e.jsx("input",{type:"text",value:b,onChange:k=>R(k.target.value),onKeyDown:k=>k.key==="Enter"&&A(),autoFocus:!0}),e.jsx("button",{onClick:A,"aria-label":"Save",children:"✓"}),e.jsx("button",{onClick:()=>N(null),"aria-label":"Cancel",children:"✕"})]}):e.jsxs("div",{style:{...m,paddingLeft:`${j}px`},className:`file-row ${V?"selected":""}`,onClick:()=>W(p),children:[p.type==="directory"?n[p.path]?e.jsx(X,{}):e.jsx(G,{}):e.jsx(Z,{}),e.jsx("span",{className:"file-name",children:p.name}),e.jsxs("div",{className:"file-actions",children:[p.type==="directory"&&e.jsx("button",{onClick:k=>{k.stopPropagation(),P(p.path)},"aria-label":"Create new file",children:e.jsx(J,{})}),e.jsx("button",{onClick:k=>{k.stopPropagation(),D(p)},"aria-label":"Rename file",children:e.jsx(ee,{})}),e.jsx("button",{onClick:k=>{k.stopPropagation(),_(p)},"aria-label":"Delete file",children:e.jsx(te,{})})]})]})};if(l)return e.jsx("div",{children:"Loading files..."});if(c)return e.jsx("div",{className:"error-message",children:c});const w=O();return e.jsxs("div",{className:"file-explorer",children:[e.jsxs("div",{className:"file-explorer-header",children:[e.jsx("h3",{children:"Files"}),e.jsxs("button",{onClick:()=>P(""),"aria-label":"Create new file at root",className:"new-file-button",children:[e.jsx(J,{})," New File"]}),e.jsx("button",{onClick:E,"aria-label":"Refresh files",children:"↻"})]}),S&&e.jsxs("div",{className:"new-file-form",children:[e.jsx("input",{type:"text",value:x,onChange:a=>y(a.target.value),placeholder:"Enter file name",onKeyDown:a=>a.key==="Enter"&&I(),autoFocus:!0}),e.jsx("button",{onClick:I,children:"Create"}),e.jsx("button",{onClick:()=>g(!1),children:"Cancel"})]}),e.jsx(Q,{width:300,height:500,rowCount:w.length,rowHeight:30,rowRenderer:h,overscanRowCount:10})]})},Ee=()=>{const r=window.WebSocket,o=3e3,t=5;window.WebSocket=function(d,n){const s=new r(d,n);s.reconnectAttempts=0;const l=()=>{if(s.reconnectAttempts>=t){console.error("Maximum reconnection attempts reached. Giving up.");return}s.reconnectAttempts++,console.log(`Attempting to reconnect (${s.reconnectAttempts}/${t})...`);const c=new r(d,n);c.onopen=s.onopen,c.onclose=s.onclose,c.onmessage=s.onmessage,c.onerror=s.onerror,c.addEventListener("open",()=>{Object.assign(s,c),s.reconnectAttempts=0,console.log("WebSocket reconnected successfully")}),c.addEventListener("close",u=>{u.wasClean||setTimeout(l,o)})},f=s.onclose;return s.addEventListener("close",c=>{f&&f.call(s,c),c.wasClean||setTimeout(l,o)}),s}};const Fe=()=>{const[r,o]=i.useState(""),[t,d]=i.useState(""),[n,s]=i.useState(!1),[l,f]=i.useState(null),[c,u]=i.useState(""),[x,y]=i.useState(""),[S,g]=i.useState("javascript"),[T,$]=i.useState("vs-dark"),[v,N]=i.useState(!0),[b,R]=i.useState(!0),[E,M]=i.useState(300);i.useEffect(()=>((async()=>{try{const w=await ge();return setTerminalSession(w),console.log("Terminal session created:",w),w}catch(w){console.error("Failed to create terminal session:",w);const a={id:"fallback-session-id",created:new Date().toISOString(),status:"fallback"};return setTerminalSession(a),a}})(),Ee(),()=>{}),[]),i.useEffect(()=>{l&&W(l)},[l]);const W=async h=>{try{const w=await we(h);switch(u(w.content),h.split(".").pop().toLowerCase()){case"js":g("javascript");break;case"ts":case"tsx":g("typescript");break;case"py":g("python");break;case"json":g("json");break;case"html":g("html");break;case"css":g("css");break;case"md":g("markdown");break;default:g("javascript")}}catch(w){console.error("Failed to load file content:",w)}},P=h=>{f(h)},D=h=>{u(h)},I=async()=>{if(l)try{await Se(l,c),console.log("File saved successfully")}catch(h){console.error("Failed to save file:",h)}},_=()=>{r&&t&&s(!0)},A=()=>{N(!v)},O=()=>{R(!b)};return e.jsx("div",{className:"app-container",children:n?e.jsxs("div",{className:"workspace",children:[e.jsxs("header",{className:"app-header",children:[e.jsx("h1",{children:"PodPlai Studio"}),e.jsxs("div",{className:"header-controls",children:[e.jsxs("button",{onClick:A,className:"panel-toggle","aria-label":v?"Hide file explorer":"Show file explorer","aria-pressed":v,children:[v?"◀":"▶"," Files"]}),e.jsxs("button",{onClick:O,className:"panel-toggle","aria-label":b?"Hide video chat":"Show video chat","aria-pressed":b,children:["Video ",b?"▶":"◀"]}),e.jsx("button",{onClick:I,disabled:!l,"aria-label":"Save current file",children:"Save"}),e.jsxs("select",{value:T,onChange:h=>$(h.target.value),"aria-label":"Editor theme",children:[e.jsx("option",{value:"vs-dark",children:"Dark"}),e.jsx("option",{value:"vs-light",children:"Light"}),e.jsx("option",{value:"hc-black",children:"High Contrast"})]})]})]}),e.jsxs("div",{className:"main-content",children:[v&&e.jsx("div",{className:"file-explorer-panel",children:e.jsx(ke,{onFileSelect:P,currentFilePath:l})}),e.jsxs("div",{className:"editor-panel",children:[e.jsx("div",{className:"editor-container",children:l?e.jsx(pe,{language:S,value:c,onChange:D,theme:T,filename:l}):e.jsx("div",{className:"no-file-selected",children:e.jsx("p",{children:"Select a file from the explorer to edit"})})}),e.jsxs("div",{className:"terminal-panel",style:{height:`${E}px`},children:[e.jsxs("div",{className:"panel-header",children:[e.jsx("h3",{children:"Terminal"}),e.jsx("div",{className:"drag-handle","aria-hidden":"true",onMouseDown:h=>{const w=h.clientY,a=E,m=p=>{const j=a-(p.clientY-w);j>100&&j<800&&M(j)},L=()=>{document.removeEventListener("mousemove",m),document.removeEventListener("mouseup",L)};document.addEventListener("mousemove",m),document.addEventListener("mouseup",L)}})]}),e.jsx(xe,{sessionId:x})]})]}),b&&e.jsxs("div",{className:"video-chat-panel",children:[e.jsx(ue,{roomName:r,username:t}),e.jsx("div",{className:"screen-share-controls",children:e.jsx(he,{})})]})]})]}):e.jsxs("div",{className:"join-room-form",role:"form","aria-label":"Join video chat room",children:[e.jsx("h2",{children:"Join Video Chat Room"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"room-name",children:"Room Name:"}),e.jsx("input",{id:"room-name",type:"text",value:r,onChange:h=>o(h.target.value),placeholder:"Enter room name","aria-required":"true"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"username",children:"Your Name:"}),e.jsx("input",{id:"username",type:"text",value:t,onChange:h=>d(h.target.value),placeholder:"Enter your name","aria-required":"true"})]}),e.jsx("button",{onClick:_,disabled:!r||!t,"aria-label":"Join room",children:"Join Room"})]})})};const Ce=new ce({defaultOptions:{queries:{staleTime:1e3*60*5,gcTime:1e3*60*10,retry:1,refetchOnWindowFocus:!0,queryFn:async({queryKey:r})=>{const[o,...t]=Array.isArray(r)?r:[r];if(typeof o!="string")throw new Error("Invalid query key");let d=o;t.length>0&&t.length===2&&t[1]==="messages"&&(d=`${o}/${t[0]}/messages`);const n=await fetch(d);if(!n.ok)throw new Error(`Request failed with status ${n.status}`);const s=n.headers.get("content-type");return s!=null&&s.includes("application/json")?n.json():n.text()}}}});function Te(){return e.jsx(i.StrictMode,{children:e.jsx(ne,{client:Ce,children:e.jsx(Fe,{})})})}re(document.getElementById("root")).render(e.jsx(Te,{}));
//# sourceMappingURL=index-31424a51.js.map
