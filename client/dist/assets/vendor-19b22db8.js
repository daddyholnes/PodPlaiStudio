var to=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)};var V=(i,e,t)=>(to(i,e,"read from private field"),t?t.call(i):e.get(i)),de=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},le=(i,e,t,r)=>(to(i,e,"write to private field"),r?r.call(i,t):e.set(i,t),t);var jn=(i,e,t,r)=>({set _(n){le(i,e,n,t)},get _(){return V(i,e,r)}}),Ne=(i,e,t)=>(to(i,e,"access private method"),t);import{r as ls}from"./vendor-react-714aa20b.js";var xd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Od(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Ll={exports:{}},Il={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function e(F,E){var x=F.length;F.push(E);e:for(;0<x;){var A=x-1>>>1,I=F[A];if(0<n(I,E))F[A]=E,F[x]=I,x=A;else break e}}function t(F){return F.length===0?null:F[0]}function r(F){if(F.length===0)return null;var E=F[0],x=F.pop();if(x!==E){F[0]=x;e:for(var A=0,I=F.length,z=I>>>1;A<z;){var Q=2*(A+1)-1,ne=F[Q],se=Q+1,B=F[se];if(0>n(ne,x))se<I&&0>n(B,ne)?(F[A]=B,F[se]=x,A=se):(F[A]=ne,F[Q]=x,A=Q);else if(se<I&&0>n(B,x))F[A]=B,F[se]=x,A=se;else break e}}return E}function n(F,E){var x=F.sortIndex-E.sortIndex;return x!==0?x:F.id-E.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;i.unstable_now=function(){return o.now()}}else{var a=Date,s=a.now();i.unstable_now=function(){return a.now()-s}}var c=[],l=[],u=1,h=null,g=3,_=!1,y=!1,v=!1,f=typeof setTimeout=="function"?setTimeout:null,p=typeof clearTimeout=="function"?clearTimeout:null,d=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function m(F){for(var E=t(l);E!==null;){if(E.callback===null)r(l);else if(E.startTime<=F)r(l),E.sortIndex=E.expirationTime,e(c,E);else break;E=t(l)}}function b(F){if(v=!1,m(F),!y)if(t(c)!==null)y=!0,X(C);else{var E=t(l);E!==null&&Y(b,E.startTime-F)}}function C(F,E){y=!1,v&&(v=!1,p(S),S=-1),_=!0;var x=g;try{for(m(E),h=t(c);h!==null&&(!(h.expirationTime>E)||F&&!L());){var A=h.callback;if(typeof A=="function"){h.callback=null,g=h.priorityLevel;var I=A(h.expirationTime<=E);E=i.unstable_now(),typeof I=="function"?h.callback=I:h===t(c)&&r(c),m(E)}else r(c);h=t(c)}if(h!==null)var z=!0;else{var Q=t(l);Q!==null&&Y(b,Q.startTime-E),z=!1}return z}finally{h=null,g=x,_=!1}}var w=!1,T=null,S=-1,k=5,O=-1;function L(){return!(i.unstable_now()-O<k)}function M(){if(T!==null){var F=i.unstable_now();O=F;var E=!0;try{E=T(!0,F)}finally{E?D():(w=!1,T=null)}}else w=!1}var D;if(typeof d=="function")D=function(){d(M)};else if(typeof MessageChannel<"u"){var U=new MessageChannel,q=U.port2;U.port1.onmessage=M,D=function(){q.postMessage(null)}}else D=function(){f(M,0)};function X(F){T=F,w||(w=!0,D())}function Y(F,E){S=f(function(){F(i.unstable_now())},E)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(F){F.callback=null},i.unstable_continueExecution=function(){y||_||(y=!0,X(C))},i.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<F?Math.floor(1e3/F):5},i.unstable_getCurrentPriorityLevel=function(){return g},i.unstable_getFirstCallbackNode=function(){return t(c)},i.unstable_next=function(F){switch(g){case 1:case 2:case 3:var E=3;break;default:E=g}var x=g;g=E;try{return F()}finally{g=x}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(F,E){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var x=g;g=F;try{return E()}finally{g=x}},i.unstable_scheduleCallback=function(F,E,x){var A=i.unstable_now();switch(typeof x=="object"&&x!==null?(x=x.delay,x=typeof x=="number"&&0<x?A+x:A):x=A,F){case 1:var I=-1;break;case 2:I=250;break;case 5:I=1073741823;break;case 4:I=1e4;break;default:I=5e3}return I=x+I,F={id:u++,callback:E,priorityLevel:F,startTime:x,expirationTime:I,sortIndex:-1},x>A?(F.sortIndex=x,e(l,F),t(c)===null&&F===t(l)&&(v?(p(S),S=-1):v=!0,Y(b,x-A))):(F.sortIndex=I,e(c,F),y||_||(y=!0,X(C))),F},i.unstable_shouldYield=L,i.unstable_wrapCallback=function(F){var E=g;return function(){var x=g;g=E;try{return F.apply(this,arguments)}finally{g=x}}}})(Il);Ll.exports=Il;var Ab=Ll.exports;function Dd(i,e){return e.forEach(function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach(function(r){if(r!=="default"&&!(r in i)){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(i,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}})}),Object.freeze(i)}var Ad=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ld(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Ml={exports:{}};(function(i){(function(e,t){i.exports?i.exports=t():e.log=t()})(Ad,function(){var e=function(){},t="undefined",r=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),n=["trace","debug","info","warn","error"];function o(v,f){var p=v[f];if(typeof p.bind=="function")return p.bind(v);try{return Function.prototype.bind.call(p,v)}catch{return function(){return Function.prototype.apply.apply(p,[v,arguments])}}}function a(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function s(v){return v==="debug"&&(v="log"),typeof console===t?!1:v==="trace"&&r?a:console[v]!==void 0?o(console,v):console.log!==void 0?o(console,"log"):e}function c(v,f){for(var p=0;p<n.length;p++){var d=n[p];this[d]=p<v?e:this.methodFactory(d,v,f)}this.log=this.debug}function l(v,f,p){return function(){typeof console!==t&&(c.call(this,f,p),this[v].apply(this,arguments))}}function u(v,f,p){return s(v)||l.apply(this,arguments)}function h(v,f,p){var d=this,m;f=f??"WARN";var b="loglevel";typeof v=="string"?b+=":"+v:typeof v=="symbol"&&(b=void 0);function C(k){var O=(n[k]||"silent").toUpperCase();if(!(typeof window===t||!b)){try{window.localStorage[b]=O;return}catch{}try{window.document.cookie=encodeURIComponent(b)+"="+O+";"}catch{}}}function w(){var k;if(!(typeof window===t||!b)){try{k=window.localStorage[b]}catch{}if(typeof k===t)try{var O=window.document.cookie,L=O.indexOf(encodeURIComponent(b)+"=");L!==-1&&(k=/^([^;]+)/.exec(O.slice(L))[1])}catch{}return d.levels[k]===void 0&&(k=void 0),k}}function T(){if(!(typeof window===t||!b)){try{window.localStorage.removeItem(b);return}catch{}try{window.document.cookie=encodeURIComponent(b)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}d.name=v,d.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},d.methodFactory=p||u,d.getLevel=function(){return m},d.setLevel=function(k,O){if(typeof k=="string"&&d.levels[k.toUpperCase()]!==void 0&&(k=d.levels[k.toUpperCase()]),typeof k=="number"&&k>=0&&k<=d.levels.SILENT){if(m=k,O!==!1&&C(k),c.call(d,k,v),typeof console===t&&k<d.levels.SILENT)return"No console available for logging"}else throw"log.setLevel() called with invalid level: "+k},d.setDefaultLevel=function(k){f=k,w()||d.setLevel(k,!1)},d.resetLevel=function(){d.setLevel(f,!1),T()},d.enableAll=function(k){d.setLevel(d.levels.TRACE,k)},d.disableAll=function(k){d.setLevel(d.levels.SILENT,k)};var S=w();S==null&&(S=f),d.setLevel(S,!1)}var g=new h,_={};g.getLogger=function(f){if(typeof f!="symbol"&&typeof f!="string"||f==="")throw new TypeError("You must supply a name when creating a logger.");var p=_[f];return p||(p=_[f]=new h(f,g.getLevel(),g.methodFactory)),p};var y=typeof window!==t?window.log:void 0;return g.noConflict=function(){return typeof window!==t&&window.log===g&&(window.log=y),g},g.getLoggers=function(){return _},g.default=g,g})})(Ml);var fa=Ml.exports,wo;(function(i){i[i.trace=0]="trace",i[i.debug=1]="debug",i[i.info=2]="info",i[i.warn=3]="warn",i[i.error=4]="error",i[i.silent=5]="silent"})(wo||(wo={}));var Zt;(function(i){i.Default="livekit",i.Room="livekit-room",i.Participant="livekit-participant",i.Track="livekit-track",i.Publication="livekit-track-publication",i.Engine="livekit-engine",i.Signal="livekit-signal",i.PCManager="livekit-pc-manager",i.PCTransport="livekit-pc-transport",i.E2EE="lk-e2ee"})(Zt||(Zt={}));let he=fa.getLogger("livekit");he.setDefaultLevel(wo.info);function Mi(i){const e=fa.getLogger(i);return e.setDefaultLevel(he.getLevel()),e}fa.getLogger("lk-e2ee");function Ge(i,e){if(!i)throw new Error(e)}const Id=34028234663852886e22,Md=-34028234663852886e22,Bd=4294967295,Nd=2147483647,Fd=-2147483648;function Kn(i){if(typeof i!="number")throw new Error("invalid int 32: "+typeof i);if(!Number.isInteger(i)||i>Nd||i<Fd)throw new Error("invalid int 32: "+i)}function ko(i){if(typeof i!="number")throw new Error("invalid uint 32: "+typeof i);if(!Number.isInteger(i)||i>Bd||i<0)throw new Error("invalid uint 32: "+i)}function Bl(i){if(typeof i!="number")throw new Error("invalid float 32: "+typeof i);if(Number.isFinite(i)&&(i>Id||i<Md))throw new Error("invalid float 32: "+i)}const Nl=Symbol("@bufbuild/protobuf/enum-type");function Ud(i){const e=i[Nl];return Ge(e,"missing enum type on enum object"),e}function Fl(i,e,t,r){i[Nl]=Ul(e,t.map(n=>({no:n.no,name:n.name,localName:i[n.no]})))}function Ul(i,e,t){const r=Object.create(null),n=Object.create(null),o=[];for(const a of e){const s=jl(a);o.push(s),r[a.name]=s,n[a.no]=s}return{typeName:i,values:o,findName(a){return r[a]},findNumber(a){return n[a]}}}function jd(i,e,t){const r={};for(const n of e){const o=jl(n);r[o.localName]=o.no,r[o.no]=o.localName}return Fl(r,i,e),r}function jl(i){return"localName"in i?i:Object.assign(Object.assign({},i),{localName:i.name})}class ie{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const r=this.getType(),n=r.runtime.bin,o=n.makeReadOptions(t);return n.readMessage(this,o.readerFactory(e),e.byteLength,o),this}fromJson(e,t){const r=this.getType(),n=r.runtime.json,o=n.makeReadOptions(t);return n.readMessage(r,e,o,this),this}fromJsonString(e,t){let r;try{r=JSON.parse(e)}catch(n){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(n instanceof Error?n.message:String(n)))}return this.fromJson(r,t)}toBinary(e){const t=this.getType(),r=t.runtime.bin,n=r.makeWriteOptions(e),o=n.writerFactory();return r.writeMessage(this,o,n),o.finish()}toJson(e){const t=this.getType(),r=t.runtime.json,n=r.makeWriteOptions(e);return r.writeMessage(this,n)}toJsonString(e){var t;const r=this.toJson(e);return JSON.stringify(r,null,(t=e==null?void 0:e.prettySpaces)!==null&&t!==void 0?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function Hd(i,e,t,r){var n;const o=(n=r==null?void 0:r.localName)!==null&&n!==void 0?n:e.substring(e.lastIndexOf(".")+1),a={[o]:function(s){i.util.initFields(this),i.util.initPartial(s,this)}}[o];return Object.setPrototypeOf(a.prototype,new ie),Object.assign(a,{runtime:i,typeName:e,fields:i.util.newFieldList(t),fromBinary(s,c){return new a().fromBinary(s,c)},fromJson(s,c){return new a().fromJson(s,c)},fromJsonString(s,c){return new a().fromJsonString(s,c)},equals(s,c){return i.util.equals(a,s,c)}}),a}function Wd(i,e,t,r){return{syntax:i,json:e,bin:t,util:r,makeMessageType(n,o,a){return Hd(this,n,o,a)},makeEnum:jd,makeEnumType:Ul,getEnumType:Ud}}var J;(function(i){i[i.DOUBLE=1]="DOUBLE",i[i.FLOAT=2]="FLOAT",i[i.INT64=3]="INT64",i[i.UINT64=4]="UINT64",i[i.INT32=5]="INT32",i[i.FIXED64=6]="FIXED64",i[i.FIXED32=7]="FIXED32",i[i.BOOL=8]="BOOL",i[i.STRING=9]="STRING",i[i.BYTES=12]="BYTES",i[i.UINT32=13]="UINT32",i[i.SFIXED32=15]="SFIXED32",i[i.SFIXED64=16]="SFIXED64",i[i.SINT32=17]="SINT32",i[i.SINT64=18]="SINT64"})(J||(J={}));var mr;(function(i){i[i.BIGINT=0]="BIGINT",i[i.STRING=1]="STRING"})(mr||(mr={}));function qd(){let i=0,e=0;for(let r=0;r<28;r+=7){let n=this.buf[this.pos++];if(i|=(n&127)<<r,!(n&128))return this.assertBounds(),[i,e]}let t=this.buf[this.pos++];if(i|=(t&15)<<28,e=(t&112)>>4,!(t&128))return this.assertBounds(),[i,e];for(let r=3;r<=31;r+=7){let n=this.buf[this.pos++];if(e|=(n&127)<<r,!(n&128))return this.assertBounds(),[i,e]}throw new Error("invalid varint")}function io(i,e,t){for(let o=0;o<28;o=o+7){const a=i>>>o,s=!(!(a>>>7)&&e==0),c=(s?a|128:a)&255;if(t.push(c),!s)return}const r=i>>>28&15|(e&7)<<4,n=!!(e>>3);if(t.push((n?r|128:r)&255),!!n){for(let o=3;o<31;o=o+7){const a=e>>>o,s=!!(a>>>7),c=(s?a|128:a)&255;if(t.push(c),!s)return}t.push(e>>>31&1)}}const Gn=4294967296;function Ja(i){const e=i[0]==="-";e&&(i=i.slice(1));const t=1e6;let r=0,n=0;function o(a,s){const c=Number(i.slice(a,s));n*=t,r=r*t+c,r>=Gn&&(n=n+(r/Gn|0),r=r%Gn)}return o(-24,-18),o(-18,-12),o(-12,-6),o(-6),e?Wl(r,n):pa(r,n)}function Vd(i,e){let t=pa(i,e);const r=t.hi&2147483648;r&&(t=Wl(t.lo,t.hi));const n=Hl(t.lo,t.hi);return r?"-"+n:n}function Hl(i,e){if({lo:i,hi:e}=Jd(i,e),e<=2097151)return String(Gn*e+i);const t=i&16777215,r=(i>>>24|e<<8)&16777215,n=e>>16&65535;let o=t+r*6777216+n*6710656,a=r+n*8147497,s=n*2;const c=1e7;return o>=c&&(a+=Math.floor(o/c),o%=c),a>=c&&(s+=Math.floor(a/c),a%=c),s.toString()+$a(a)+$a(o)}function Jd(i,e){return{lo:i>>>0,hi:e>>>0}}function pa(i,e){return{lo:i|0,hi:e|0}}function Wl(i,e){return e=~e,i?i=~i+1:e+=1,pa(i,e)}const $a=i=>{const e=String(i);return"0000000".slice(e.length)+e};function za(i,e){if(i>=0){for(;i>127;)e.push(i&127|128),i=i>>>7;e.push(i)}else{for(let t=0;t<9;t++)e.push(i&127|128),i=i>>7;e.push(1)}}function $d(){let i=this.buf[this.pos++],e=i&127;if(!(i&128))return this.assertBounds(),e;if(i=this.buf[this.pos++],e|=(i&127)<<7,!(i&128))return this.assertBounds(),e;if(i=this.buf[this.pos++],e|=(i&127)<<14,!(i&128))return this.assertBounds(),e;if(i=this.buf[this.pos++],e|=(i&127)<<21,!(i&128))return this.assertBounds(),e;i=this.buf[this.pos++],e|=(i&15)<<28;for(let t=5;i&128&&t<10;t++)i=this.buf[this.pos++];if(i&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function zd(){const i=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof i.getBigInt64=="function"&&typeof i.getBigUint64=="function"&&typeof i.setBigInt64=="function"&&typeof i.setBigUint64=="function"&&(typeof process!="object"||typeof process.env!="object"||{}.BUF_BIGINT_DISABLE!=="1")){const n=BigInt("-9223372036854775808"),o=BigInt("9223372036854775807"),a=BigInt("0"),s=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>o||l<n)throw new Error("int64 invalid: ".concat(c));return l},uParse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>s||l<a)throw new Error("uint64 invalid: ".concat(c));return l},enc(c){return i.setBigInt64(0,this.parse(c),!0),{lo:i.getInt32(0,!0),hi:i.getInt32(4,!0)}},uEnc(c){return i.setBigInt64(0,this.uParse(c),!0),{lo:i.getInt32(0,!0),hi:i.getInt32(4,!0)}},dec(c,l){return i.setInt32(0,c,!0),i.setInt32(4,l,!0),i.getBigInt64(0,!0)},uDec(c,l){return i.setInt32(0,c,!0),i.setInt32(4,l,!0),i.getBigUint64(0,!0)}}}const t=n=>Ge(/^-?[0-9]+$/.test(n),"int64 invalid: ".concat(n)),r=n=>Ge(/^[0-9]+$/.test(n),"uint64 invalid: ".concat(n));return{zero:"0",supported:!1,parse(n){return typeof n!="string"&&(n=n.toString()),t(n),n},uParse(n){return typeof n!="string"&&(n=n.toString()),r(n),n},enc(n){return typeof n!="string"&&(n=n.toString()),t(n),Ja(n)},uEnc(n){return typeof n!="string"&&(n=n.toString()),r(n),Ja(n)},dec(n,o){return Vd(n,o)},uDec(n,o){return Hl(n,o)}}}const ce=zd();var ke;(function(i){i[i.Varint=0]="Varint",i[i.Bit64=1]="Bit64",i[i.LengthDelimited=2]="LengthDelimited",i[i.StartGroup=3]="StartGroup",i[i.EndGroup=4]="EndGroup",i[i.Bit32=5]="Bit32"})(ke||(ke={}));class Kd{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let n=0;n<this.chunks.length;n++)e+=this.chunks[n].length;let t=new Uint8Array(e),r=0;for(let n=0;n<this.chunks.length;n++)t.set(this.chunks[n],r),r+=this.chunks[n].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(ko(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return Kn(e),za(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){Bl(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){ko(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){Kn(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return Kn(e),e=(e<<1^e>>31)>>>0,za(e,this.buf),this}sfixed64(e){let t=new Uint8Array(8),r=new DataView(t.buffer),n=ce.enc(e);return r.setInt32(0,n.lo,!0),r.setInt32(4,n.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),r=new DataView(t.buffer),n=ce.uEnc(e);return r.setInt32(0,n.lo,!0),r.setInt32(4,n.hi,!0),this.raw(t)}int64(e){let t=ce.enc(e);return io(t.lo,t.hi,this.buf),this}sint64(e){let t=ce.enc(e),r=t.hi>>31,n=t.lo<<1^r,o=(t.hi<<1|t.lo>>>31)^r;return io(n,o,this.buf),this}uint64(e){let t=ce.uEnc(e);return io(t.lo,t.hi,this.buf),this}}class Gd{constructor(e,t){this.varint64=qd,this.uint32=$d,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=t??new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,r=e&7;if(t<=0||r<0||r>5)throw new Error("illegal tag: field no "+t+" wire type "+r);return[t,r]}skip(e){let t=this.pos;switch(e){case ke.Varint:for(;this.buf[this.pos++]&128;);break;case ke.Bit64:this.pos+=4;case ke.Bit32:this.pos+=4;break;case ke.LengthDelimited:let r=this.uint32();this.pos+=r;break;case ke.StartGroup:let n;for(;(n=this.tag()[1])!==ke.EndGroup;)this.skip(n);break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(t,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return ce.dec(...this.varint64())}uint64(){return ce.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),r=-(e&1);return e=(e>>>1|(t&1)<<31)^r,t=t>>>1^r,ce.dec(e,t)}bool(){let[e,t]=this.varint64();return e!==0||t!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return ce.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return ce.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function To(i,e){return e instanceof ie||!i.fieldWrapper?e:i.fieldWrapper.wrapField(e)}J.DOUBLE,J.FLOAT,J.INT64,J.UINT64,J.INT32,J.UINT32,J.BOOL,J.STRING,J.BYTES;function Hi(i,e,t){if(e===t)return!0;if(i==J.BYTES){if(!(e instanceof Uint8Array)||!(t instanceof Uint8Array)||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}switch(i){case J.UINT64:case J.FIXED64:case J.INT64:case J.SFIXED64:case J.SINT64:return e==t}return!1}function Eo(i,e){switch(i){case J.BOOL:return!1;case J.UINT64:case J.FIXED64:case J.INT64:case J.SFIXED64:case J.SINT64:return e==0?ce.zero:"0";case J.DOUBLE:case J.FLOAT:return 0;case J.BYTES:return new Uint8Array(0);case J.STRING:return"";default:return 0}}function ql(i,e){const t=e===void 0;let r=ke.Varint,n=e===0;switch(i){case J.STRING:n=t||!e.length,r=ke.LengthDelimited;break;case J.BOOL:n=e===!1;break;case J.DOUBLE:r=ke.Bit64;break;case J.FLOAT:r=ke.Bit32;break;case J.INT64:n=t||e==0;break;case J.UINT64:n=t||e==0;break;case J.FIXED64:n=t||e==0,r=ke.Bit64;break;case J.BYTES:n=t||!e.byteLength,r=ke.LengthDelimited;break;case J.FIXED32:r=ke.Bit32;break;case J.SFIXED32:r=ke.Bit32;break;case J.SFIXED64:n=t||e==0,r=ke.Bit64;break;case J.SINT64:n=t||e==0;break}const o=J[i].toLowerCase();return[r,o,t||n]}const kr=Symbol("@bufbuild/protobuf/unknown-fields"),Ka={readUnknownFields:!0,readerFactory:i=>new Gd(i)},Ga={writeUnknownFields:!0,writerFactory:()=>new Kd};function Xd(i){return i?Object.assign(Object.assign({},Ka),i):Ka}function Qd(i){return i?Object.assign(Object.assign({},Ga),i):Ga}function Yd(){return{makeReadOptions:Xd,makeWriteOptions:Qd,listUnknownFields(i){var e;return(e=i[kr])!==null&&e!==void 0?e:[]},discardUnknownFields(i){delete i[kr]},writeUnknownFields(i,e){const r=i[kr];if(r)for(const n of r)e.tag(n.no,n.wireType).raw(n.data)},onUnknownField(i,e,t,r){const n=i;Array.isArray(n[kr])||(n[kr]=[]),n[kr].push({no:e,wireType:t,data:r})},readMessage(i,e,t,r){const n=i.getType(),o=t===void 0?e.len:e.pos+t;for(;e.pos<o;){const[a,s]=e.tag(),c=n.fields.find(a);if(!c){const g=e.skip(s);r.readUnknownFields&&this.onUnknownField(i,a,s,g);continue}let l=i,u=c.repeated,h=c.localName;switch(c.oneof&&(l=l[c.oneof.localName],l.case!=h&&delete l.value,l.case=h,h="value"),c.kind){case"scalar":case"enum":const g=c.kind=="enum"?J.INT32:c.T;let _=hs;if(c.kind=="scalar"&&c.L>0&&(_=ef),u){let p=l[h];if(s==ke.LengthDelimited&&g!=J.STRING&&g!=J.BYTES){let d=e.uint32()+e.pos;for(;e.pos<d;)p.push(_(e,g))}else p.push(_(e,g))}else l[h]=_(e,g);break;case"message":const y=c.T;u?l[h].push(Xn(e,new y,r)):l[h]instanceof ie?Xn(e,l[h],r):(l[h]=Xn(e,new y,r),y.fieldWrapper&&!c.oneof&&!c.repeated&&(l[h]=y.fieldWrapper.unwrapField(l[h])));break;case"map":let[v,f]=Zd(c,e,r);l[h][v]=f;break}}}}}function Xn(i,e,t){return e.getType().runtime.bin.readMessage(e,i,i.uint32(),t),e}function Zd(i,e,t){const r=e.uint32(),n=e.pos+r;let o,a;for(;e.pos<n;){let[s]=e.tag();switch(s){case 1:o=hs(e,i.K);break;case 2:switch(i.V.kind){case"scalar":a=hs(e,i.V.T);break;case"enum":a=e.int32();break;case"message":a=Xn(e,new i.V.T,t);break}break}}if(o===void 0){let s=Eo(i.K,mr.BIGINT);o=i.K==J.BOOL?s.toString():s}if(typeof o!="string"&&typeof o!="number"&&(o=o.toString()),a===void 0)switch(i.V.kind){case"scalar":a=Eo(i.V.T,mr.BIGINT);break;case"enum":a=0;break;case"message":a=new i.V.T;break}return[o,a]}function ef(i,e){const t=hs(i,e);return typeof t=="bigint"?t.toString():t}function hs(i,e){switch(e){case J.STRING:return i.string();case J.BOOL:return i.bool();case J.DOUBLE:return i.double();case J.FLOAT:return i.float();case J.INT32:return i.int32();case J.INT64:return i.int64();case J.UINT64:return i.uint64();case J.FIXED64:return i.fixed64();case J.BYTES:return i.bytes();case J.FIXED32:return i.fixed32();case J.SFIXED32:return i.sfixed32();case J.SFIXED64:return i.sfixed64();case J.SINT64:return i.sint64();case J.UINT32:return i.uint32();case J.SINT32:return i.sint32()}}function tf(i,e,t,r,n){i.tag(t.no,ke.LengthDelimited),i.fork();let o=r;switch(t.K){case J.INT32:case J.FIXED32:case J.UINT32:case J.SFIXED32:case J.SINT32:o=Number.parseInt(r);break;case J.BOOL:Ge(r=="true"||r=="false"),o=r=="true";break}switch(_n(i,t.K,1,o,!0),t.V.kind){case"scalar":_n(i,t.V.T,2,n,!0);break;case"enum":_n(i,J.INT32,2,n,!0);break;case"message":Po(i,e,t.V.T,2,n);break}i.join()}function Po(i,e,t,r,n){if(n!==void 0){const o=To(t,n);i.tag(r,ke.LengthDelimited).bytes(o.toBinary(e))}}function _n(i,e,t,r,n){let[o,a,s]=ql(e,r);(!s||n)&&i.tag(t,o)[a](r)}function rf(i,e,t,r){if(!r.length)return;i.tag(t,ke.LengthDelimited).fork();let[,n]=ql(e);for(let o=0;o<r.length;o++)i[n](r[o]);i.join()}function nf(){return Object.assign(Object.assign({},Yd()),{writeMessage(i,e,t){const r=i.getType();for(const n of r.fields.byNumber()){let o,a=n.repeated,s=n.localName;if(n.oneof){const c=i[n.oneof.localName];if(c.case!==s)continue;o=c.value}else o=i[s];switch(n.kind){case"scalar":case"enum":let c=n.kind=="enum"?J.INT32:n.T;if(a)if(n.packed)rf(e,c,n.no,o);else for(const l of o)_n(e,c,n.no,l,!0);else o!==void 0&&_n(e,c,n.no,o,!!n.oneof||n.opt);break;case"message":if(a)for(const l of o)Po(e,t,n.T,n.no,l);else Po(e,t,n.T,n.no,o);break;case"map":for(const[l,u]of Object.entries(o))tf(e,t,n,l,u);break}}return t.writeUnknownFields&&this.writeUnknownFields(i,e),e}})}let ai="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),Ds=[];for(let i=0;i<ai.length;i++)Ds[ai[i].charCodeAt(0)]=i;Ds["-".charCodeAt(0)]=ai.indexOf("+");Ds["_".charCodeAt(0)]=ai.indexOf("/");const Vl={dec(i){let e=i.length*3/4;i[i.length-2]=="="?e-=2:i[i.length-1]=="="&&(e-=1);let t=new Uint8Array(e),r=0,n=0,o,a=0;for(let s=0;s<i.length;s++){if(o=Ds[i.charCodeAt(s)],o===void 0)switch(i[s]){case"=":n=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(n){case 0:a=o,n=1;break;case 1:t[r++]=a<<2|(o&48)>>4,a=o,n=2;break;case 2:t[r++]=(a&15)<<4|(o&60)>>2,a=o,n=3;break;case 3:t[r++]=(a&3)<<6|o,n=0;break}}if(n==1)throw Error("invalid base64 string.");return t.subarray(0,r)},enc(i){let e="",t=0,r,n=0;for(let o=0;o<i.length;o++)switch(r=i[o],t){case 0:e+=ai[r>>2],n=(r&3)<<4,t=1;break;case 1:e+=ai[n|r>>4],n=(r&15)<<2,t=2;break;case 2:e+=ai[n|r>>6],e+=ai[r&63],t=0;break}return t&&(e+=ai[n],e+="=",t==1&&(e+="=")),e}},Xa={ignoreUnknownFields:!1},Qa={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function sf(i){return i?Object.assign(Object.assign({},Xa),i):Xa}function of(i){return i?Object.assign(Object.assign({},Qa),i):Qa}function af(i){const e=i(cf,Ya);return{makeReadOptions:sf,makeWriteOptions:of,readMessage(t,r,n,o){if(r==null||Array.isArray(r)||typeof r!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat(this.debug(r)));o=o??new t;const a={};for(const[s,c]of Object.entries(r)){const l=t.fields.findJsonName(s);if(!l){if(!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(s,'" is unknown'));continue}let u=l.localName,h=o;if(l.oneof){if(c===null&&l.kind=="scalar")continue;const g=a[l.oneof.localName];if(g)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(l.oneof.name,'" present: "').concat(g,'", "').concat(s,'"'));a[l.oneof.localName]=s,h=h[l.oneof.localName]={case:u},u="value"}if(l.repeated){if(c===null)continue;if(!Array.isArray(c))throw new Error("cannot decode field ".concat(t.typeName,".").concat(l.name," from JSON: ").concat(this.debug(c)));const g=h[u];for(const _ of c){if(_===null)throw new Error("cannot decode field ".concat(t.typeName,".").concat(l.name," from JSON: ").concat(this.debug(_)));let y;switch(l.kind){case"message":y=l.T.fromJson(_,n);break;case"enum":if(y=ro(l.T,_,n.ignoreUnknownFields),y===void 0)continue;break;case"scalar":try{y=cn(l.T,_,l.L)}catch(v){let f="cannot decode field ".concat(t.typeName,".").concat(l.name," from JSON: ").concat(this.debug(_));throw v instanceof Error&&v.message.length>0&&(f+=": ".concat(v.message)),new Error(f)}break}g.push(y)}}else if(l.kind=="map"){if(c===null)continue;if(Array.isArray(c)||typeof c!="object")throw new Error("cannot decode field ".concat(t.typeName,".").concat(l.name," from JSON: ").concat(this.debug(c)));const g=h[u];for(const[_,y]of Object.entries(c)){if(y===null)throw new Error("cannot decode field ".concat(t.typeName,".").concat(l.name," from JSON: map value null"));let v;switch(l.V.kind){case"message":v=l.V.T.fromJson(y,n);break;case"enum":if(v=ro(l.V.T,y,n.ignoreUnknownFields),v===void 0)continue;break;case"scalar":try{v=cn(l.V.T,y,mr.BIGINT)}catch(f){let p="cannot decode map value for field ".concat(t.typeName,".").concat(l.name," from JSON: ").concat(this.debug(c));throw f instanceof Error&&f.message.length>0&&(p+=": ".concat(f.message)),new Error(p)}break}try{g[cn(l.K,l.K==J.BOOL?_=="true"?!0:_=="false"?!1:_:_,mr.BIGINT).toString()]=v}catch(f){let p="cannot decode map key for field ".concat(t.typeName,".").concat(l.name," from JSON: ").concat(this.debug(c));throw f instanceof Error&&f.message.length>0&&(p+=": ".concat(f.message)),new Error(p)}}}else switch(l.kind){case"message":const g=l.T;if(c===null&&g.typeName!="google.protobuf.Value"){if(l.oneof)throw new Error("cannot decode field ".concat(t.typeName,".").concat(l.name,' from JSON: null is invalid for oneof field "').concat(s,'"'));continue}h[u]instanceof ie?h[u].fromJson(c,n):(h[u]=g.fromJson(c,n),g.fieldWrapper&&!l.oneof&&(h[u]=g.fieldWrapper.unwrapField(h[u])));break;case"enum":const _=ro(l.T,c,n.ignoreUnknownFields);_!==void 0&&(h[u]=_);break;case"scalar":try{h[u]=cn(l.T,c,l.L)}catch(y){let v="cannot decode field ".concat(t.typeName,".").concat(l.name," from JSON: ").concat(this.debug(c));throw y instanceof Error&&y.message.length>0&&(v+=": ".concat(y.message)),new Error(v)}break}}return o},writeMessage(t,r){const n=t.getType(),o={};let a;try{for(const s of n.fields.byMember()){let c;if(s.kind=="oneof"){const l=t[s.localName];if(l.value===void 0)continue;if(a=s.findField(l.case),!a)throw"oneof case not found: "+l.case;c=e(a,l.value,r)}else a=s,c=e(a,t[a.localName],r);c!==void 0&&(o[r.useProtoFieldName?a.name:a.jsonName]=c)}}catch(s){const c=a?"cannot encode field ".concat(n.typeName,".").concat(a.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),l=s instanceof Error?s.message:String(s);throw new Error(c+(l.length>0?": ".concat(l):""))}return o},readScalar:cn,writeScalar:Ya,debug:Jl}}function Jl(i){if(i===null)return"null";switch(typeof i){case"object":return Array.isArray(i)?"array":"object";case"string":return i.length>100?"string":'"'.concat(i.split('"').join('\\"'),'"');default:return String(i)}}function cn(i,e,t){switch(i){case J.DOUBLE:case J.FLOAT:if(e===null)return 0;if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const r=Number(e);if(Number.isNaN(r)||!Number.isFinite(r))break;return i==J.FLOAT&&Bl(r),r;case J.INT32:case J.FIXED32:case J.SFIXED32:case J.SINT32:case J.UINT32:if(e===null)return 0;let n;if(typeof e=="number"?n=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(n=Number(e)),n===void 0)break;return i==J.UINT32?ko(n):Kn(n),n;case J.INT64:case J.SFIXED64:case J.SINT64:if(e===null)return ce.zero;if(typeof e!="number"&&typeof e!="string")break;const o=ce.parse(e);return t?o.toString():o;case J.FIXED64:case J.UINT64:if(e===null)return ce.zero;if(typeof e!="number"&&typeof e!="string")break;const a=ce.uParse(e);return t?a.toString():a;case J.BOOL:if(e===null)return!1;if(typeof e!="boolean")break;return e;case J.STRING:if(e===null)return"";if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case J.BYTES:if(e===null||e==="")return new Uint8Array(0);if(typeof e!="string")break;return Vl.dec(e)}throw new Error}function ro(i,e,t){if(e===null)return 0;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const r=i.findName(e);if(r||t)return r==null?void 0:r.no;break}throw new Error("cannot decode enum ".concat(i.typeName," from JSON: ").concat(Jl(e)))}function cf(i,e,t,r){var n;if(e===void 0)return e;if(e===0&&!t)return;if(r)return e;if(i.typeName=="google.protobuf.NullValue")return null;const o=i.findNumber(e);return(n=o==null?void 0:o.name)!==null&&n!==void 0?n:e}function Ya(i,e,t){if(e!==void 0)switch(i){case J.INT32:case J.SFIXED32:case J.SINT32:case J.FIXED32:case J.UINT32:return Ge(typeof e=="number"),e!=0||t?e:void 0;case J.FLOAT:case J.DOUBLE:return Ge(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e!==0||t?e:void 0;case J.STRING:return Ge(typeof e=="string"),e.length>0||t?e:void 0;case J.BOOL:return Ge(typeof e=="boolean"),e||t?e:void 0;case J.UINT64:case J.FIXED64:case J.INT64:case J.SFIXED64:case J.SINT64:return Ge(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),t||e!=0?e.toString(10):void 0;case J.BYTES:return Ge(e instanceof Uint8Array),t||e.byteLength>0?Vl.enc(e):void 0}}function lf(){return af((i,e)=>function(r,n,o){if(r.kind=="map"){const a={};switch(r.V.kind){case"scalar":for(const[c,l]of Object.entries(n)){const u=e(r.V.T,l,!0);Ge(u!==void 0),a[c.toString()]=u}break;case"message":for(const[c,l]of Object.entries(n))a[c.toString()]=l.toJson(o);break;case"enum":const s=r.V.T;for(const[c,l]of Object.entries(n)){Ge(l===void 0||typeof l=="number");const u=i(s,l,!0,o.enumAsInteger);Ge(u!==void 0),a[c.toString()]=u}break}return o.emitDefaultValues||Object.keys(a).length>0?a:void 0}else if(r.repeated){const a=[];switch(r.kind){case"scalar":for(let s=0;s<n.length;s++)a.push(e(r.T,n[s],!0));break;case"enum":for(let s=0;s<n.length;s++)a.push(i(r.T,n[s],!0,o.enumAsInteger));break;case"message":for(let s=0;s<n.length;s++)a.push(To(r.T,n[s]).toJson(o));break}return o.emitDefaultValues||a.length>0?a:void 0}else switch(r.kind){case"scalar":return e(r.T,n,!!r.oneof||r.opt||o.emitDefaultValues);case"enum":return i(r.T,n,!!r.oneof||r.opt||o.emitDefaultValues,o.enumAsInteger);case"message":return n!==void 0?To(r.T,n).toJson(o):void 0}})}function hf(){return{setEnumType:Fl,initPartial(i,e){if(i===void 0)return;const t=e.getType();for(const r of t.fields.byMember()){const n=r.localName,o=e,a=i;if(a[n]!==void 0)switch(r.kind){case"oneof":const s=a[n].case;if(s===void 0)continue;const c=r.findField(s);let l=a[n].value;c&&c.kind=="message"&&!(l instanceof c.T)?l=new c.T(l):c&&c.kind==="scalar"&&c.T===J.BYTES&&(l=ln(l)),o[n]={case:s,value:l};break;case"scalar":case"enum":let u=a[n];r.T===J.BYTES&&(u=r.repeated?u.map(ln):ln(u)),o[n]=u;break;case"map":switch(r.V.kind){case"scalar":case"enum":if(r.V.T===J.BYTES)for(const[_,y]of Object.entries(a[n]))o[n][_]=ln(y);else Object.assign(o[n],a[n]);break;case"message":const g=r.V.T;for(const _ of Object.keys(a[n])){let y=a[n][_];g.fieldWrapper||(y=new g(y)),o[n][_]=y}break}break;case"message":const h=r.T;if(r.repeated)o[n]=a[n].map(g=>g instanceof h?g:new h(g));else if(a[n]!==void 0){const g=a[n];h.fieldWrapper?h.typeName==="google.protobuf.BytesValue"?o[n]=ln(g):o[n]=g:o[n]=g instanceof h?g:new h(g)}break}}},equals(i,e,t){return e===t?!0:!e||!t?!1:i.fields.byMember().every(r=>{const n=e[r.localName],o=t[r.localName];if(r.repeated){if(n.length!==o.length)return!1;switch(r.kind){case"message":return n.every((a,s)=>r.T.equals(a,o[s]));case"scalar":return n.every((a,s)=>Hi(r.T,a,o[s]));case"enum":return n.every((a,s)=>Hi(J.INT32,a,o[s]))}throw new Error("repeated cannot contain ".concat(r.kind))}switch(r.kind){case"message":return r.T.equals(n,o);case"enum":return Hi(J.INT32,n,o);case"scalar":return Hi(r.T,n,o);case"oneof":if(n.case!==o.case)return!1;const a=r.findField(n.case);if(a===void 0)return!0;switch(a.kind){case"message":return a.T.equals(n.value,o.value);case"enum":return Hi(J.INT32,n.value,o.value);case"scalar":return Hi(a.T,n.value,o.value)}throw new Error("oneof cannot contain ".concat(a.kind));case"map":const s=Object.keys(n).concat(Object.keys(o));switch(r.V.kind){case"message":const c=r.V.T;return s.every(u=>c.equals(n[u],o[u]));case"enum":return s.every(u=>Hi(J.INT32,n[u],o[u]));case"scalar":const l=r.V.T;return s.every(u=>Hi(l,n[u],o[u]))}break}})},clone(i){const e=i.getType(),t=new e,r=t;for(const n of e.fields.byMember()){const o=i[n.localName];let a;if(n.repeated)a=o.map(Hn);else if(n.kind=="map"){a=r[n.localName];for(const[s,c]of Object.entries(o))a[s]=Hn(c)}else n.kind=="oneof"?a=n.findField(o.case)?{case:o.case,value:Hn(o.value)}:{case:void 0}:a=Hn(o);r[n.localName]=a}return t}}}function Hn(i){if(i===void 0)return i;if(i instanceof ie)return i.clone();if(i instanceof Uint8Array){const e=new Uint8Array(i.byteLength);return e.set(i),e}return i}function ln(i){return i instanceof Uint8Array?i:new Uint8Array(i)}class uf{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const t={};for(const r of this.list())t[r.jsonName]=t[r.name]=r;this.jsonNames=t}return this.jsonNames[e]}find(e){if(!this.numbers){const t={};for(const r of this.list())t[r.no]=r;this.numbers=t}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,t)=>e.no-t.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const r of this.list())r.oneof?r.oneof!==t&&(t=r.oneof,e.push(t)):e.push(r)}return this.members}}function $l(i,e){const t=zl(i);return e?t:vf(gf(t))}function df(i){return $l(i,!1)}const ff=zl;function zl(i){let e=!1;const t=[];for(let r=0;r<i.length;r++){let n=i.charAt(r);switch(n){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":t.push(n),e=!1;break;default:e&&(e=!1,n=n.toUpperCase()),t.push(n);break}}return t.join("")}const pf=new Set(["constructor","toString","toJSON","valueOf"]),mf=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),Kl=i=>"".concat(i,"$"),gf=i=>mf.has(i)?Kl(i):i,vf=i=>pf.has(i)?Kl(i):i;class _f{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=df(e)}addField(e){Ge(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let t=0;t<this.fields.length;t++)this._lookup[this.fields[t].localName]=this.fields[t]}return this._lookup[e]}}const R=Wd("proto3",lf(),nf(),Object.assign(Object.assign({},hf()),{newFieldList(i){return new uf(i,bf)},initFields(i){for(const e of i.getType().fields.byMember()){if(e.opt)continue;const t=e.localName,r=i;if(e.repeated){r[t]=[];continue}switch(e.kind){case"oneof":r[t]={case:void 0};break;case"enum":r[t]=0;break;case"map":r[t]={};break;case"scalar":r[t]=Eo(e.T,e.L);break}}}}));function bf(i){var e,t,r,n;const o=[];let a;for(const s of typeof i=="function"?i():i){const c=s;if(c.localName=$l(s.name,s.oneof!==void 0),c.jsonName=(e=s.jsonName)!==null&&e!==void 0?e:ff(s.name),c.repeated=(t=s.repeated)!==null&&t!==void 0?t:!1,s.kind=="scalar"&&(c.L=(r=s.L)!==null&&r!==void 0?r:mr.BIGINT),c.packed=(n=s.packed)!==null&&n!==void 0?n:s.kind=="enum"||s.kind=="scalar"&&s.T!=J.BYTES&&s.T!=J.STRING,s.oneof!==void 0){const l=typeof s.oneof=="string"?s.oneof:s.oneof.name;(!a||a.name!=l)&&(a=new _f(l)),c.oneof=a,a.addField(c)}o.push(c)}return o}class Ae extends ie{constructor(e){super(),this.seconds=ce.zero,this.nanos=0,R.util.initPartial(e,this)}fromJson(e,t){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(R.json.debug(e)));const r=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!r)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const n=Date.parse(r[1]+"-"+r[2]+"-"+r[3]+"T"+r[4]+":"+r[5]+":"+r[6]+(r[8]?r[8]:"Z"));if(Number.isNaN(n))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=ce.parse(n/1e3),this.nanos=0,r[7]&&(this.nanos=parseInt("1"+r[7]+"0".repeat(9-r[7].length))-1e9),this}toJson(e){const t=Number(this.seconds)*1e3;if(t<Date.parse("0001-01-01T00:00:00Z")||t>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let r="Z";if(this.nanos>0){const n=(this.nanos+1e9).toString().substring(1);n.substring(3)==="000000"?r="."+n.substring(0,3)+"Z":n.substring(6)==="000"?r="."+n.substring(0,6)+"Z":r="."+n+"Z"}return new Date(t).toISOString().replace(".000Z",r)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return Ae.fromDate(new Date)}static fromDate(e){const t=e.getTime();return new Ae({seconds:ce.parse(Math.floor(t/1e3)),nanos:t%1e3*1e6})}static fromBinary(e,t){return new Ae().fromBinary(e,t)}static fromJson(e,t){return new Ae().fromJson(e,t)}static fromJsonString(e,t){return new Ae().fromJsonString(e,t)}static equals(e,t){return R.util.equals(Ae,e,t)}}Ae.runtime=R;Ae.typeName="google.protobuf.Timestamp";Ae.fields=R.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);var Ro;(function(i){i[i.DEFAULT_AC=0]="DEFAULT_AC",i[i.OPUS=1]="OPUS",i[i.AAC=2]="AAC"})(Ro||(Ro={}));R.util.setEnumType(Ro,"livekit.AudioCodec",[{no:0,name:"DEFAULT_AC"},{no:1,name:"OPUS"},{no:2,name:"AAC"}]);var xo;(function(i){i[i.DEFAULT_VC=0]="DEFAULT_VC",i[i.H264_BASELINE=1]="H264_BASELINE",i[i.H264_MAIN=2]="H264_MAIN",i[i.H264_HIGH=3]="H264_HIGH",i[i.VP8=4]="VP8"})(xo||(xo={}));R.util.setEnumType(xo,"livekit.VideoCodec",[{no:0,name:"DEFAULT_VC"},{no:1,name:"H264_BASELINE"},{no:2,name:"H264_MAIN"},{no:3,name:"H264_HIGH"},{no:4,name:"VP8"}]);var Oo;(function(i){i[i.IC_DEFAULT=0]="IC_DEFAULT",i[i.IC_JPEG=1]="IC_JPEG"})(Oo||(Oo={}));R.util.setEnumType(Oo,"livekit.ImageCodec",[{no:0,name:"IC_DEFAULT"},{no:1,name:"IC_JPEG"}]);var Ue;(function(i){i[i.AUDIO=0]="AUDIO",i[i.VIDEO=1]="VIDEO",i[i.DATA=2]="DATA"})(Ue||(Ue={}));R.util.setEnumType(Ue,"livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]);var Te;(function(i){i[i.UNKNOWN=0]="UNKNOWN",i[i.CAMERA=1]="CAMERA",i[i.MICROPHONE=2]="MICROPHONE",i[i.SCREEN_SHARE=3]="SCREEN_SHARE",i[i.SCREEN_SHARE_AUDIO=4]="SCREEN_SHARE_AUDIO"})(Te||(Te={}));R.util.setEnumType(Te,"livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]);var Oe;(function(i){i[i.LOW=0]="LOW",i[i.MEDIUM=1]="MEDIUM",i[i.HIGH=2]="HIGH",i[i.OFF=3]="OFF"})(Oe||(Oe={}));R.util.setEnumType(Oe,"livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]);var ci;(function(i){i[i.POOR=0]="POOR",i[i.GOOD=1]="GOOD",i[i.EXCELLENT=2]="EXCELLENT",i[i.LOST=3]="LOST"})(ci||(ci={}));R.util.setEnumType(ci,"livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]);var Pt;(function(i){i[i.UNSET=0]="UNSET",i[i.DISABLED=1]="DISABLED",i[i.ENABLED=2]="ENABLED"})(Pt||(Pt={}));R.util.setEnumType(Pt,"livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]);var Ai;(function(i){i[i.UNKNOWN_REASON=0]="UNKNOWN_REASON",i[i.CLIENT_INITIATED=1]="CLIENT_INITIATED",i[i.DUPLICATE_IDENTITY=2]="DUPLICATE_IDENTITY",i[i.SERVER_SHUTDOWN=3]="SERVER_SHUTDOWN",i[i.PARTICIPANT_REMOVED=4]="PARTICIPANT_REMOVED",i[i.ROOM_DELETED=5]="ROOM_DELETED",i[i.STATE_MISMATCH=6]="STATE_MISMATCH",i[i.JOIN_FAILURE=7]="JOIN_FAILURE"})(Ai||(Ai={}));R.util.setEnumType(Ai,"livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"}]);var si;(function(i){i[i.RR_UNKNOWN=0]="RR_UNKNOWN",i[i.RR_SIGNAL_DISCONNECTED=1]="RR_SIGNAL_DISCONNECTED",i[i.RR_PUBLISHER_FAILED=2]="RR_PUBLISHER_FAILED",i[i.RR_SUBSCRIBER_FAILED=3]="RR_SUBSCRIBER_FAILED",i[i.RR_SWITCH_CANDIDATE=4]="RR_SWITCH_CANDIDATE"})(si||(si={}));R.util.setEnumType(si,"livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]);var wn;(function(i){i[i.SE_UNKNOWN=0]="SE_UNKNOWN",i[i.SE_CODEC_UNSUPPORTED=1]="SE_CODEC_UNSUPPORTED",i[i.SE_TRACK_NOTFOUND=2]="SE_TRACK_NOTFOUND"})(wn||(wn={}));R.util.setEnumType(wn,"livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]);let Yr=class mn extends ie{constructor(e){super(),this.sid="",this.name="",this.emptyTimeout=0,this.maxParticipants=0,this.creationTime=ce.zero,this.turnPassword="",this.enabledCodecs=[],this.metadata="",this.numParticipants=0,this.numPublishers=0,this.activeRecording=!1,R.util.initPartial(e,this)}static fromBinary(e,t){return new mn().fromBinary(e,t)}static fromJson(e,t){return new mn().fromJson(e,t)}static fromJsonString(e,t){return new mn().fromJsonString(e,t)}static equals(e,t){return R.util.equals(mn,e,t)}};Yr.runtime=R;Yr.typeName="livekit.Room";Yr.fields=R.util.newFieldList(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:_t,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8}]);class _t extends ie{constructor(e){super(),this.mime="",this.fmtpLine="",R.util.initPartial(e,this)}static fromBinary(e,t){return new _t().fromBinary(e,t)}static fromJson(e,t){return new _t().fromJson(e,t)}static fromJsonString(e,t){return new _t().fromJsonString(e,t)}static equals(e,t){return R.util.equals(_t,e,t)}}_t.runtime=R;_t.typeName="livekit.Codec";_t.fields=R.util.newFieldList(()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]);class Gi extends ie{constructor(e){super(),this.enabled=!1,this.min=0,this.max=0,R.util.initPartial(e,this)}static fromBinary(e,t){return new Gi().fromBinary(e,t)}static fromJson(e,t){return new Gi().fromJson(e,t)}static fromJsonString(e,t){return new Gi().fromJsonString(e,t)}static equals(e,t){return R.util.equals(Gi,e,t)}}Gi.runtime=R;Gi.typeName="livekit.PlayoutDelay";Gi.fields=R.util.newFieldList(()=>[{no:1,name:"enabled",kind:"scalar",T:8},{no:2,name:"min",kind:"scalar",T:13},{no:3,name:"max",kind:"scalar",T:13}]);class li extends ie{constructor(e){super(),this.canSubscribe=!1,this.canPublish=!1,this.canPublishData=!1,this.canPublishSources=[],this.hidden=!1,this.recorder=!1,this.canUpdateMetadata=!1,this.agent=!1,R.util.initPartial(e,this)}static fromBinary(e,t){return new li().fromBinary(e,t)}static fromJson(e,t){return new li().fromJson(e,t)}static fromJsonString(e,t){return new li().fromJsonString(e,t)}static equals(e,t){return R.util.equals(li,e,t)}}li.runtime=R;li.typeName="livekit.ParticipantPermission";li.fields=R.util.newFieldList(()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:R.getEnumType(Te),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8}]);class it extends ie{constructor(e){super(),this.sid="",this.identity="",this.state=gr.JOINING,this.tracks=[],this.metadata="",this.joinedAt=ce.zero,this.name="",this.version=0,this.region="",this.isPublisher=!1,R.util.initPartial(e,this)}static fromBinary(e,t){return new it().fromBinary(e,t)}static fromJson(e,t){return new it().fromJson(e,t)}static fromJsonString(e,t){return new it().fromJsonString(e,t)}static equals(e,t){return R.util.equals(it,e,t)}}it.runtime=R;it.typeName="livekit.ParticipantInfo";it.fields=R.util.newFieldList(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:R.getEnumType(gr)},{no:4,name:"tracks",kind:"message",T:Xe,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:li},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8}]);var gr;(function(i){i[i.JOINING=0]="JOINING",i[i.JOINED=1]="JOINED",i[i.ACTIVE=2]="ACTIVE",i[i.DISCONNECTED=3]="DISCONNECTED"})(gr||(gr={}));R.util.setEnumType(gr,"livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]);class Xi extends ie{constructor(e){super(),R.util.initPartial(e,this)}static fromBinary(e,t){return new Xi().fromBinary(e,t)}static fromJson(e,t){return new Xi().fromJson(e,t)}static fromJsonString(e,t){return new Xi().fromJsonString(e,t)}static equals(e,t){return R.util.equals(Xi,e,t)}}Xi.runtime=R;Xi.typeName="livekit.Encryption";Xi.fields=R.util.newFieldList(()=>[]);var Ie;(function(i){i[i.NONE=0]="NONE",i[i.GCM=1]="GCM",i[i.CUSTOM=2]="CUSTOM"})(Ie||(Ie={}));R.util.setEnumType(Ie,"livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]);class hi extends ie{constructor(e){super(),this.mimeType="",this.mid="",this.cid="",this.layers=[],R.util.initPartial(e,this)}static fromBinary(e,t){return new hi().fromBinary(e,t)}static fromJson(e,t){return new hi().fromJson(e,t)}static fromJsonString(e,t){return new hi().fromJsonString(e,t)}static equals(e,t){return R.util.equals(hi,e,t)}}hi.runtime=R;hi.typeName="livekit.SimulcastCodecInfo";hi.fields=R.util.newFieldList(()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Je,repeated:!0}]);class Xe extends ie{constructor(e){super(),this.sid="",this.type=Ue.AUDIO,this.name="",this.muted=!1,this.width=0,this.height=0,this.simulcast=!1,this.disableDtx=!1,this.source=Te.UNKNOWN,this.layers=[],this.mimeType="",this.mid="",this.codecs=[],this.stereo=!1,this.disableRed=!1,this.encryption=Ie.NONE,this.stream="",R.util.initPartial(e,this)}static fromBinary(e,t){return new Xe().fromBinary(e,t)}static fromJson(e,t){return new Xe().fromJson(e,t)}static fromJsonString(e,t){return new Xe().fromJsonString(e,t)}static equals(e,t){return R.util.equals(Xe,e,t)}}Xe.runtime=R;Xe.typeName="livekit.TrackInfo";Xe.fields=R.util.newFieldList(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:R.getEnumType(Ue)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:R.getEnumType(Te)},{no:10,name:"layers",kind:"message",T:Je,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:hi,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:R.getEnumType(Ie)},{no:17,name:"stream",kind:"scalar",T:9}]);class Je extends ie{constructor(e){super(),this.quality=Oe.LOW,this.width=0,this.height=0,this.bitrate=0,this.ssrc=0,R.util.initPartial(e,this)}static fromBinary(e,t){return new Je().fromBinary(e,t)}static fromJson(e,t){return new Je().fromJson(e,t)}static fromJsonString(e,t){return new Je().fromJsonString(e,t)}static equals(e,t){return R.util.equals(Je,e,t)}}Je.runtime=R;Je.typeName="livekit.VideoLayer";Je.fields=R.util.newFieldList(()=>[{no:1,name:"quality",kind:"enum",T:R.getEnumType(Oe)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13}]);class Bt extends ie{constructor(e){super(),this.kind=Re.RELIABLE,this.value={case:void 0},R.util.initPartial(e,this)}static fromBinary(e,t){return new Bt().fromBinary(e,t)}static fromJson(e,t){return new Bt().fromJson(e,t)}static fromJsonString(e,t){return new Bt().fromJsonString(e,t)}static equals(e,t){return R.util.equals(Bt,e,t)}}Bt.runtime=R;Bt.typeName="livekit.DataPacket";Bt.fields=R.util.newFieldList(()=>[{no:1,name:"kind",kind:"enum",T:R.getEnumType(Re)},{no:2,name:"user",kind:"message",T:Ft,oneof:"value"},{no:3,name:"speaker",kind:"message",T:ui,oneof:"value"}]);var Re;(function(i){i[i.RELIABLE=0]="RELIABLE",i[i.LOSSY=1]="LOSSY"})(Re||(Re={}));R.util.setEnumType(Re,"livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]);class ui extends ie{constructor(e){super(),this.speakers=[],R.util.initPartial(e,this)}static fromBinary(e,t){return new ui().fromBinary(e,t)}static fromJson(e,t){return new ui().fromJson(e,t)}static fromJsonString(e,t){return new ui().fromJsonString(e,t)}static equals(e,t){return R.util.equals(ui,e,t)}}ui.runtime=R;ui.typeName="livekit.ActiveSpeakerUpdate";ui.fields=R.util.newFieldList(()=>[{no:1,name:"speakers",kind:"message",T:Nt,repeated:!0}]);class Nt extends ie{constructor(e){super(),this.sid="",this.level=0,this.active=!1,R.util.initPartial(e,this)}static fromBinary(e,t){return new Nt().fromBinary(e,t)}static fromJson(e,t){return new Nt().fromJson(e,t)}static fromJsonString(e,t){return new Nt().fromJsonString(e,t)}static equals(e,t){return R.util.equals(Nt,e,t)}}Nt.runtime=R;Nt.typeName="livekit.SpeakerInfo";Nt.fields=R.util.newFieldList(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]);class Ft extends ie{constructor(e){super(),this.participantSid="",this.participantIdentity="",this.payload=new Uint8Array(0),this.destinationSids=[],this.destinationIdentities=[],R.util.initPartial(e,this)}static fromBinary(e,t){return new Ft().fromBinary(e,t)}static fromJson(e,t){return new Ft().fromJson(e,t)}static fromJsonString(e,t){return new Ft().fromJsonString(e,t)}static equals(e,t){return R.util.equals(Ft,e,t)}}Ft.runtime=R;Ft.typeName="livekit.UserPacket";Ft.fields=R.util.newFieldList(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0}]);class Ut extends ie{constructor(e){super(),this.participantSid="",this.trackSids=[],R.util.initPartial(e,this)}static fromBinary(e,t){return new Ut().fromBinary(e,t)}static fromJson(e,t){return new Ut().fromJson(e,t)}static fromJsonString(e,t){return new Ut().fromJsonString(e,t)}static equals(e,t){return R.util.equals(Ut,e,t)}}Ut.runtime=R;Ut.typeName="livekit.ParticipantTracks";Ut.fields=R.util.newFieldList(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]);class di extends ie{constructor(e){super(),this.edition=Vr.Standard,this.version="",this.protocol=0,this.region="",this.nodeId="",this.debugInfo="",R.util.initPartial(e,this)}static fromBinary(e,t){return new di().fromBinary(e,t)}static fromJson(e,t){return new di().fromJson(e,t)}static fromJsonString(e,t){return new di().fromJsonString(e,t)}static equals(e,t){return R.util.equals(di,e,t)}}di.runtime=R;di.typeName="livekit.ServerInfo";di.fields=R.util.newFieldList(()=>[{no:1,name:"edition",kind:"enum",T:R.getEnumType(Vr)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9}]);var Vr;(function(i){i[i.Standard=0]="Standard",i[i.Cloud=1]="Cloud"})(Vr||(Vr={}));R.util.setEnumType(Vr,"livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]);class fi extends ie{constructor(e){super(),this.sdk=Jr.UNKNOWN,this.version="",this.protocol=0,this.os="",this.osVersion="",this.deviceModel="",this.browser="",this.browserVersion="",this.address="",this.network="",R.util.initPartial(e,this)}static fromBinary(e,t){return new fi().fromBinary(e,t)}static fromJson(e,t){return new fi().fromJson(e,t)}static fromJsonString(e,t){return new fi().fromJsonString(e,t)}static equals(e,t){return R.util.equals(fi,e,t)}}fi.runtime=R;fi.typeName="livekit.ClientInfo";fi.fields=R.util.newFieldList(()=>[{no:1,name:"sdk",kind:"enum",T:R.getEnumType(Jr)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9}]);var Jr;(function(i){i[i.UNKNOWN=0]="UNKNOWN",i[i.JS=1]="JS",i[i.SWIFT=2]="SWIFT",i[i.ANDROID=3]="ANDROID",i[i.FLUTTER=4]="FLUTTER",i[i.GO=5]="GO",i[i.UNITY=6]="UNITY",i[i.REACT_NATIVE=7]="REACT_NATIVE",i[i.RUST=8]="RUST",i[i.PYTHON=9]="PYTHON",i[i.CPP=10]="CPP"})(Jr||(Jr={}));R.util.setEnumType(Jr,"livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"}]);class jt extends ie{constructor(e){super(),this.resumeConnection=Pt.UNSET,this.forceRelay=Pt.UNSET,R.util.initPartial(e,this)}static fromBinary(e,t){return new jt().fromBinary(e,t)}static fromJson(e,t){return new jt().fromJson(e,t)}static fromJsonString(e,t){return new jt().fromJsonString(e,t)}static equals(e,t){return R.util.equals(jt,e,t)}}jt.runtime=R;jt.typeName="livekit.ClientConfiguration";jt.fields=R.util.newFieldList(()=>[{no:1,name:"video",kind:"message",T:Ht},{no:2,name:"screen",kind:"message",T:Ht},{no:3,name:"resume_connection",kind:"enum",T:R.getEnumType(Pt)},{no:4,name:"disabled_codecs",kind:"message",T:pi},{no:5,name:"force_relay",kind:"enum",T:R.getEnumType(Pt)}]);class Ht extends ie{constructor(e){super(),this.hardwareEncoder=Pt.UNSET,R.util.initPartial(e,this)}static fromBinary(e,t){return new Ht().fromBinary(e,t)}static fromJson(e,t){return new Ht().fromJson(e,t)}static fromJsonString(e,t){return new Ht().fromJsonString(e,t)}static equals(e,t){return R.util.equals(Ht,e,t)}}Ht.runtime=R;Ht.typeName="livekit.VideoConfiguration";Ht.fields=R.util.newFieldList(()=>[{no:1,name:"hardware_encoder",kind:"enum",T:R.getEnumType(Pt)}]);class pi extends ie{constructor(e){super(),this.codecs=[],this.publish=[],R.util.initPartial(e,this)}static fromBinary(e,t){return new pi().fromBinary(e,t)}static fromJson(e,t){return new pi().fromJson(e,t)}static fromJsonString(e,t){return new pi().fromJsonString(e,t)}static equals(e,t){return R.util.equals(pi,e,t)}}pi.runtime=R;pi.typeName="livekit.DisabledCodecs";pi.fields=R.util.newFieldList(()=>[{no:1,name:"codecs",kind:"message",T:_t,repeated:!0},{no:2,name:"publish",kind:"message",T:_t,repeated:!0}]);class Wt extends ie{constructor(e){super(),this.duration=0,this.startTimestamp=ce.zero,this.endTimestamp=ce.zero,this.rtpClockTicks=ce.zero,this.driftSamples=ce.zero,this.driftMs=0,this.clockRate=0,R.util.initPartial(e,this)}static fromBinary(e,t){return new Wt().fromBinary(e,t)}static fromJson(e,t){return new Wt().fromJson(e,t)}static fromJsonString(e,t){return new Wt().fromJsonString(e,t)}static equals(e,t){return R.util.equals(Wt,e,t)}}Wt.runtime=R;Wt.typeName="livekit.RTPDrift";Wt.fields=R.util.newFieldList(()=>[{no:1,name:"start_time",kind:"message",T:Ae},{no:2,name:"end_time",kind:"message",T:Ae},{no:3,name:"duration",kind:"scalar",T:1},{no:4,name:"start_timestamp",kind:"scalar",T:4},{no:5,name:"end_timestamp",kind:"scalar",T:4},{no:6,name:"rtp_clock_ticks",kind:"scalar",T:4},{no:7,name:"drift_samples",kind:"scalar",T:3},{no:8,name:"drift_ms",kind:"scalar",T:1},{no:9,name:"clock_rate",kind:"scalar",T:1}]);class Qi extends ie{constructor(e){super(),this.duration=0,this.packets=0,this.packetRate=0,this.bytes=ce.zero,this.headerBytes=ce.zero,this.bitrate=0,this.packetsLost=0,this.packetLossRate=0,this.packetLossPercentage=0,this.packetsDuplicate=0,this.packetDuplicateRate=0,this.bytesDuplicate=ce.zero,this.headerBytesDuplicate=ce.zero,this.bitrateDuplicate=0,this.packetsPadding=0,this.packetPaddingRate=0,this.bytesPadding=ce.zero,this.headerBytesPadding=ce.zero,this.bitratePadding=0,this.packetsOutOfOrder=0,this.frames=0,this.frameRate=0,this.jitterCurrent=0,this.jitterMax=0,this.gapHistogram={},this.nacks=0,this.nackAcks=0,this.nackMisses=0,this.nackRepeated=0,this.plis=0,this.firs=0,this.rttCurrent=0,this.rttMax=0,this.keyFrames=0,this.layerLockPlis=0,R.util.initPartial(e,this)}static fromBinary(e,t){return new Qi().fromBinary(e,t)}static fromJson(e,t){return new Qi().fromJson(e,t)}static fromJsonString(e,t){return new Qi().fromJsonString(e,t)}static equals(e,t){return R.util.equals(Qi,e,t)}}Qi.runtime=R;Qi.typeName="livekit.RTPStats";Qi.fields=R.util.newFieldList(()=>[{no:1,name:"start_time",kind:"message",T:Ae},{no:2,name:"end_time",kind:"message",T:Ae},{no:3,name:"duration",kind:"scalar",T:1},{no:4,name:"packets",kind:"scalar",T:13},{no:5,name:"packet_rate",kind:"scalar",T:1},{no:6,name:"bytes",kind:"scalar",T:4},{no:39,name:"header_bytes",kind:"scalar",T:4},{no:7,name:"bitrate",kind:"scalar",T:1},{no:8,name:"packets_lost",kind:"scalar",T:13},{no:9,name:"packet_loss_rate",kind:"scalar",T:1},{no:10,name:"packet_loss_percentage",kind:"scalar",T:2},{no:11,name:"packets_duplicate",kind:"scalar",T:13},{no:12,name:"packet_duplicate_rate",kind:"scalar",T:1},{no:13,name:"bytes_duplicate",kind:"scalar",T:4},{no:40,name:"header_bytes_duplicate",kind:"scalar",T:4},{no:14,name:"bitrate_duplicate",kind:"scalar",T:1},{no:15,name:"packets_padding",kind:"scalar",T:13},{no:16,name:"packet_padding_rate",kind:"scalar",T:1},{no:17,name:"bytes_padding",kind:"scalar",T:4},{no:41,name:"header_bytes_padding",kind:"scalar",T:4},{no:18,name:"bitrate_padding",kind:"scalar",T:1},{no:19,name:"packets_out_of_order",kind:"scalar",T:13},{no:20,name:"frames",kind:"scalar",T:13},{no:21,name:"frame_rate",kind:"scalar",T:1},{no:22,name:"jitter_current",kind:"scalar",T:1},{no:23,name:"jitter_max",kind:"scalar",T:1},{no:24,name:"gap_histogram",kind:"map",K:5,V:{kind:"scalar",T:13}},{no:25,name:"nacks",kind:"scalar",T:13},{no:37,name:"nack_acks",kind:"scalar",T:13},{no:26,name:"nack_misses",kind:"scalar",T:13},{no:38,name:"nack_repeated",kind:"scalar",T:13},{no:27,name:"plis",kind:"scalar",T:13},{no:28,name:"last_pli",kind:"message",T:Ae},{no:29,name:"firs",kind:"scalar",T:13},{no:30,name:"last_fir",kind:"message",T:Ae},{no:31,name:"rtt_current",kind:"scalar",T:13},{no:32,name:"rtt_max",kind:"scalar",T:13},{no:33,name:"key_frames",kind:"scalar",T:13},{no:34,name:"last_key_frame",kind:"message",T:Ae},{no:35,name:"layer_lock_plis",kind:"scalar",T:13},{no:36,name:"last_layer_lock_pli",kind:"message",T:Ae},{no:44,name:"packet_drift",kind:"message",T:Wt},{no:45,name:"report_drift",kind:"message",T:Wt}]);class Yi extends ie{constructor(e){super(),this.unixMicro=ce.zero,this.ticks=0,R.util.initPartial(e,this)}static fromBinary(e,t){return new Yi().fromBinary(e,t)}static fromJson(e,t){return new Yi().fromJson(e,t)}static fromJsonString(e,t){return new Yi().fromJsonString(e,t)}static equals(e,t){return R.util.equals(Yi,e,t)}}Yi.runtime=R;Yi.typeName="livekit.TimedVersion";Yi.fields=R.util.newFieldList(()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]);const hn=7e3,yf=[0,300,2*2*300,3*3*300,4*4*300,hn,hn,hn,hn,hn];class Sf{constructor(e){this._retryDelays=e!==void 0?[...e]:yf}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const t=this._retryDelays[e.retryCount];return e.retryCount<=1?t:t+Math.random()*1e3}}function N(i,e,t,r){function n(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function s(u){try{l(r.next(u))}catch(h){a(h)}}function c(u){try{l(r.throw(u))}catch(h){a(h)}}function l(u){u.done?o(u.value):n(u.value).then(s,c)}l((r=r.apply(i,e||[])).next())})}function Za(i){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&i[e],r=0;if(t)return t.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&r>=i.length&&(i=void 0),{value:i&&i[r++],done:!i}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Er(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=i[Symbol.asyncIterator],t;return e?e.call(i):(i=typeof Za=="function"?Za(i):i[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(o){t[o]=i[o]&&function(a){return new Promise(function(s,c){a=i[o](a),n(s,c,a.done,a.value)})}}function n(o,a,s,c){Promise.resolve(c).then(function(l){o({value:l,done:s})},a)}}var ma={exports:{}},Rr=typeof Reflect=="object"?Reflect:null,ec=Rr&&typeof Rr.apply=="function"?Rr.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)},Qn;Rr&&typeof Rr.ownKeys=="function"?Qn=Rr.ownKeys:Object.getOwnPropertySymbols?Qn=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Qn=function(e){return Object.getOwnPropertyNames(e)};function Cf(i){console&&console.warn&&console.warn(i)}var Gl=Number.isNaN||function(e){return e!==e};function me(){me.init.call(this)}ma.exports=me;ma.exports.once=Ef;me.EventEmitter=me;me.prototype._events=void 0;me.prototype._eventsCount=0;me.prototype._maxListeners=void 0;var tc=10;function As(i){if(typeof i!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i)}Object.defineProperty(me,"defaultMaxListeners",{enumerable:!0,get:function(){return tc},set:function(i){if(typeof i!="number"||i<0||Gl(i))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+i+".");tc=i}});me.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};me.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Gl(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Xl(i){return i._maxListeners===void 0?me.defaultMaxListeners:i._maxListeners}me.prototype.getMaxListeners=function(){return Xl(this)};me.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n=e==="error",o=this._events;if(o!==void 0)n=n&&o.error===void 0;else if(!n)return!1;if(n){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var c=o[e];if(c===void 0)return!1;if(typeof c=="function")ec(c,this,t);else for(var l=c.length,u=th(c,l),r=0;r<l;++r)ec(u[r],this,t);return!0};function Ql(i,e,t,r){var n,o,a;if(As(t),o=i._events,o===void 0?(o=i._events=Object.create(null),i._eventsCount=0):(o.newListener!==void 0&&(i.emit("newListener",e,t.listener?t.listener:t),o=i._events),a=o[e]),a===void 0)a=o[e]=t,++i._eventsCount;else if(typeof a=="function"?a=o[e]=r?[t,a]:[a,t]:r?a.unshift(t):a.push(t),n=Xl(i),n>0&&a.length>n&&!a.warned){a.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=i,s.type=e,s.count=a.length,Cf(s)}return i}me.prototype.addListener=function(e,t){return Ql(this,e,t,!1)};me.prototype.on=me.prototype.addListener;me.prototype.prependListener=function(e,t){return Ql(this,e,t,!0)};function wf(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Yl(i,e,t){var r={fired:!1,wrapFn:void 0,target:i,type:e,listener:t},n=wf.bind(r);return n.listener=t,r.wrapFn=n,n}me.prototype.once=function(e,t){return As(t),this.on(e,Yl(this,e,t)),this};me.prototype.prependOnceListener=function(e,t){return As(t),this.prependListener(e,Yl(this,e,t)),this};me.prototype.removeListener=function(e,t){var r,n,o,a,s;if(As(t),n=this._events,n===void 0)return this;if(r=n[e],r===void 0)return this;if(r===t||r.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if(typeof r!="function"){for(o=-1,a=r.length-1;a>=0;a--)if(r[a]===t||r[a].listener===t){s=r[a].listener,o=a;break}if(o<0)return this;o===0?r.shift():kf(r,o),r.length===1&&(n[e]=r[0]),n.removeListener!==void 0&&this.emit("removeListener",e,s||t)}return this};me.prototype.off=me.prototype.removeListener;me.prototype.removeAllListeners=function(e){var t,r,n;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var o=Object.keys(r),a;for(n=0;n<o.length;++n)a=o[n],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=r[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this};function Zl(i,e,t){var r=i._events;if(r===void 0)return[];var n=r[e];return n===void 0?[]:typeof n=="function"?t?[n.listener||n]:[n]:t?Tf(n):th(n,n.length)}me.prototype.listeners=function(e){return Zl(this,e,!0)};me.prototype.rawListeners=function(e){return Zl(this,e,!1)};me.listenerCount=function(i,e){return typeof i.listenerCount=="function"?i.listenerCount(e):eh.call(i,e)};me.prototype.listenerCount=eh;function eh(i){var e=this._events;if(e!==void 0){var t=e[i];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}me.prototype.eventNames=function(){return this._eventsCount>0?Qn(this._events):[]};function th(i,e){for(var t=new Array(e),r=0;r<e;++r)t[r]=i[r];return t}function kf(i,e){for(;e+1<i.length;e++)i[e]=i[e+1];i.pop()}function Tf(i){for(var e=new Array(i.length),t=0;t<e.length;++t)e[t]=i[t].listener||i[t];return e}function Ef(i,e){return new Promise(function(t,r){function n(a){i.removeListener(e,o),r(a)}function o(){typeof i.removeListener=="function"&&i.removeListener("error",n),t([].slice.call(arguments))}ih(i,e,o,{once:!0}),e!=="error"&&Pf(i,n,{once:!0})})}function Pf(i,e,t){typeof i.on=="function"&&ih(i,"error",e,t)}function ih(i,e,t,r){if(typeof i.on=="function")r.once?i.once(e,t):i.on(e,t);else if(typeof i.addEventListener=="function")i.addEventListener(e,function n(o){r.once&&i.removeEventListener(e,n),t(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof i)}var ii=ma.exports;let rh=!0,nh=!0;function Yn(i,e,t){const r=i.match(e);return r&&r.length>=t&&parseInt(r[t],10)}function wr(i,e,t){if(!i.RTCPeerConnection)return;const r=i.RTCPeerConnection.prototype,n=r.addEventListener;r.addEventListener=function(a,s){if(a!==e)return n.apply(this,arguments);const c=l=>{const u=t(l);u&&(s.handleEvent?s.handleEvent(u):s(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(s,c),n.apply(this,[a,c])};const o=r.removeEventListener;r.removeEventListener=function(a,s){if(a!==e||!this._eventMap||!this._eventMap[e])return o.apply(this,arguments);if(!this._eventMap[e].has(s))return o.apply(this,arguments);const c=this._eventMap[e].get(s);return this._eventMap[e].delete(s),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[a,c])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(a){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),a&&this.addEventListener(e,this["_on"+e]=a)},enumerable:!0,configurable:!0})}function Rf(i){return typeof i!="boolean"?new Error("Argument type: "+typeof i+". Please use a boolean."):(rh=i,i?"adapter.js logging disabled":"adapter.js logging enabled")}function xf(i){return typeof i!="boolean"?new Error("Argument type: "+typeof i+". Please use a boolean."):(nh=!i,"adapter.js deprecation warnings "+(i?"disabled":"enabled"))}function sh(){if(typeof window=="object"){if(rh)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function ga(i,e){nh&&console.warn(i+" is deprecated, please use "+e+" instead.")}function Of(i){const e={browser:null,version:null};if(typeof i>"u"||!i.navigator||!i.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:t}=i;if(t.mozGetUserMedia)e.browser="firefox",e.version=Yn(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||i.isSecureContext===!1&&i.webkitRTCPeerConnection)e.browser="chrome",e.version=Yn(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(i.RTCPeerConnection&&t.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=Yn(t.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=i.RTCRtpTransceiver&&"currentDirection"in i.RTCRtpTransceiver.prototype;else return e.browser="Not a supported browser.",e;return e}function ic(i){return Object.prototype.toString.call(i)==="[object Object]"}function oh(i){return ic(i)?Object.keys(i).reduce(function(e,t){const r=ic(i[t]),n=r?oh(i[t]):i[t],o=r&&!Object.keys(n).length;return n===void 0||o?e:Object.assign(e,{[t]:n})},{}):i}function Do(i,e,t){!e||t.has(e.id)||(t.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?Do(i,i.get(e[r]),t):r.endsWith("Ids")&&e[r].forEach(n=>{Do(i,i.get(n),t)})}))}function rc(i,e,t){const r=t?"outbound-rtp":"inbound-rtp",n=new Map;if(e===null)return n;const o=[];return i.forEach(a=>{a.type==="track"&&a.trackIdentifier===e.id&&o.push(a)}),o.forEach(a=>{i.forEach(s=>{s.type===r&&s.trackId===a.id&&Do(i,s,n)})}),n}const nc=sh;function ah(i,e){const t=i&&i.navigator;if(!t.mediaDevices)return;const r=function(s){if(typeof s!="object"||s.mandatory||s.optional)return s;const c={};return Object.keys(s).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const u=typeof s[l]=="object"?s[l]:{ideal:s[l]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const h=function(g,_){return g?g+_.charAt(0).toUpperCase()+_.slice(1):_==="deviceId"?"sourceId":_};if(u.ideal!==void 0){c.optional=c.optional||[];let g={};typeof u.ideal=="number"?(g[h("min",l)]=u.ideal,c.optional.push(g),g={},g[h("max",l)]=u.ideal,c.optional.push(g)):(g[h("",l)]=u.ideal,c.optional.push(g))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[h("",l)]=u.exact):["min","max"].forEach(g=>{u[g]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[h(g,l)]=u[g])})}),s.advanced&&(c.optional=(c.optional||[]).concat(s.advanced)),c},n=function(s,c){if(e.version>=61)return c(s);if(s=JSON.parse(JSON.stringify(s)),s&&typeof s.audio=="object"){const l=function(u,h,g){h in u&&!(g in u)&&(u[g]=u[h],delete u[h])};s=JSON.parse(JSON.stringify(s)),l(s.audio,"autoGainControl","googAutoGainControl"),l(s.audio,"noiseSuppression","googNoiseSuppression"),s.audio=r(s.audio)}if(s&&typeof s.video=="object"){let l=s.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const u=e.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete s.video.facingMode;let h;if(l.exact==="environment"||l.ideal==="environment"?h=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(h=["front"]),h)return t.mediaDevices.enumerateDevices().then(g=>{g=g.filter(y=>y.kind==="videoinput");let _=g.find(y=>h.some(v=>y.label.toLowerCase().includes(v)));return!_&&g.length&&h.includes("back")&&(_=g[g.length-1]),_&&(s.video.deviceId=l.exact?{exact:_.deviceId}:{ideal:_.deviceId}),s.video=r(s.video),nc("chrome: "+JSON.stringify(s)),c(s)})}s.video=r(s.video)}return nc("chrome: "+JSON.stringify(s)),c(s)},o=function(s){return e.version>=64?s:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[s.name]||s.name,message:s.message,constraint:s.constraint||s.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},a=function(s,c,l){n(s,u=>{t.webkitGetUserMedia(u,c,h=>{l&&l(o(h))})})};if(t.getUserMedia=a.bind(t),t.mediaDevices.getUserMedia){const s=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(c){return n(c,l=>s(l).then(u=>{if(l.audio&&!u.getAudioTracks().length||l.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(h=>{h.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(o(u))))}}}function Df(i,e){if(!(i.navigator.mediaDevices&&"getDisplayMedia"in i.navigator.mediaDevices)&&i.navigator.mediaDevices){if(typeof e!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}i.navigator.mediaDevices.getDisplayMedia=function(r){return e(r).then(n=>{const o=r.video&&r.video.width,a=r.video&&r.video.height,s=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n,maxFrameRate:s||3}},o&&(r.video.mandatory.maxWidth=o),a&&(r.video.mandatory.maxHeight=a),i.navigator.mediaDevices.getUserMedia(r)})}}}function ch(i){i.MediaStream=i.MediaStream||i.webkitMediaStream}function lh(i){if(typeof i=="object"&&i.RTCPeerConnection&&!("ontrack"in i.RTCPeerConnection.prototype)){Object.defineProperty(i.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const e=i.RTCPeerConnection.prototype.setRemoteDescription;i.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",n=>{let o;i.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(s=>s.track&&s.track.id===n.track.id):o={track:n.track};const a=new Event("track");a.track=n.track,a.receiver=o,a.transceiver={receiver:o},a.streams=[r.stream],this.dispatchEvent(a)}),r.stream.getTracks().forEach(n=>{let o;i.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(s=>s.track&&s.track.id===n.id):o={track:n};const a=new Event("track");a.track=n,a.receiver=o,a.transceiver={receiver:o},a.streams=[r.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else wr(i,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function hh(i){if(typeof i=="object"&&i.RTCPeerConnection&&!("getSenders"in i.RTCPeerConnection.prototype)&&"createDTMFSender"in i.RTCPeerConnection.prototype){const e=function(n,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=n.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:n}};if(!i.RTCPeerConnection.prototype.getSenders){i.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=i.RTCPeerConnection.prototype.addTrack;i.RTCPeerConnection.prototype.addTrack=function(s,c){let l=n.apply(this,arguments);return l||(l=e(this,s),this._senders.push(l)),l};const o=i.RTCPeerConnection.prototype.removeTrack;i.RTCPeerConnection.prototype.removeTrack=function(s){o.apply(this,arguments);const c=this._senders.indexOf(s);c!==-1&&this._senders.splice(c,1)}}const t=i.RTCPeerConnection.prototype.addStream;i.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],t.apply(this,[o]),o.getTracks().forEach(a=>{this._senders.push(e(this,a))})};const r=i.RTCPeerConnection.prototype.removeStream;i.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],r.apply(this,[o]),o.getTracks().forEach(a=>{const s=this._senders.find(c=>c.track===a);s&&this._senders.splice(this._senders.indexOf(s),1)})}}else if(typeof i=="object"&&i.RTCPeerConnection&&"getSenders"in i.RTCPeerConnection.prototype&&"createDTMFSender"in i.RTCPeerConnection.prototype&&i.RTCRtpSender&&!("dtmf"in i.RTCRtpSender.prototype)){const e=i.RTCPeerConnection.prototype.getSenders;i.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(n=>n._pc=this),r},Object.defineProperty(i.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function uh(i){if(!i.RTCPeerConnection)return;const e=i.RTCPeerConnection.prototype.getStats;i.RTCPeerConnection.prototype.getStats=function(){const[r,n,o]=arguments;if(arguments.length>0&&typeof r=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof r!="function"))return e.apply(this,[]);const a=function(c){const l={};return c.result().forEach(h=>{const g={id:h.id,timestamp:h.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[h.type]||h.type};h.names().forEach(_=>{g[_]=h.stat(_)}),l[g.id]=g}),l},s=function(c){return new Map(Object.keys(c).map(l=>[l,c[l]]))};if(arguments.length>=2){const c=function(l){n(s(a(l)))};return e.apply(this,[c,r])}return new Promise((c,l)=>{e.apply(this,[function(u){c(s(a(u)))},l])}).then(n,o)}}function dh(i){if(!(typeof i=="object"&&i.RTCPeerConnection&&i.RTCRtpSender&&i.RTCRtpReceiver))return;if(!("getStats"in i.RTCRtpSender.prototype)){const t=i.RTCPeerConnection.prototype.getSenders;t&&(i.RTCPeerConnection.prototype.getSenders=function(){const o=t.apply(this,[]);return o.forEach(a=>a._pc=this),o});const r=i.RTCPeerConnection.prototype.addTrack;r&&(i.RTCPeerConnection.prototype.addTrack=function(){const o=r.apply(this,arguments);return o._pc=this,o}),i.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then(a=>rc(a,o.track,!0))}}if(!("getStats"in i.RTCRtpReceiver.prototype)){const t=i.RTCPeerConnection.prototype.getReceivers;t&&(i.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach(o=>o._pc=this),n}),wr(i,"track",r=>(r.receiver._pc=r.srcElement,r)),i.RTCRtpReceiver.prototype.getStats=function(){const n=this;return this._pc.getStats().then(o=>rc(o,n.track,!1))}}if(!("getStats"in i.RTCRtpSender.prototype&&"getStats"in i.RTCRtpReceiver.prototype))return;const e=i.RTCPeerConnection.prototype.getStats;i.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof i.MediaStreamTrack){const r=arguments[0];let n,o,a;return this.getSenders().forEach(s=>{s.track===r&&(n?a=!0:n=s)}),this.getReceivers().forEach(s=>(s.track===r&&(o?a=!0:o=s),s.track===r)),a||n&&o?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():o?o.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function fh(i){i.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const e=i.RTCPeerConnection.prototype.addTrack;i.RTCPeerConnection.prototype.addTrack=function(a,s){if(!s)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[s.id]?this._shimmedLocalStreams[s.id].indexOf(c)===-1&&this._shimmedLocalStreams[s.id].push(c):this._shimmedLocalStreams[s.id]=[s,c],c};const t=i.RTCPeerConnection.prototype.addStream;i.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(l=>{if(this.getSenders().find(h=>h.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const s=this.getSenders();t.apply(this,arguments);const c=this.getSenders().filter(l=>s.indexOf(l)===-1);this._shimmedLocalStreams[a.id]=[a].concat(c)};const r=i.RTCPeerConnection.prototype.removeStream;i.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],r.apply(this,arguments)};const n=i.RTCPeerConnection.prototype.removeTrack;i.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(s=>{const c=this._shimmedLocalStreams[s].indexOf(a);c!==-1&&this._shimmedLocalStreams[s].splice(c,1),this._shimmedLocalStreams[s].length===1&&delete this._shimmedLocalStreams[s]}),n.apply(this,arguments)}}function ph(i,e){if(!i.RTCPeerConnection)return;if(i.RTCPeerConnection.prototype.addTrack&&e.version>=65)return fh(i);const t=i.RTCPeerConnection.prototype.getLocalStreams;i.RTCPeerConnection.prototype.getLocalStreams=function(){const u=t.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(h=>this._reverseStreams[h.id])};const r=i.RTCPeerConnection.prototype.addStream;i.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(h=>{if(this.getSenders().find(_=>_.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const h=new i.MediaStream(u.getTracks());this._streams[u.id]=h,this._reverseStreams[h.id]=u,u=h}r.apply(this,[u])};const n=i.RTCPeerConnection.prototype.removeStream;i.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},i.RTCPeerConnection.prototype.addTrack=function(u,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const g=[].slice.call(arguments,1);if(g.length!==1||!g[0].getTracks().find(v=>v===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(v=>v.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const y=this._streams[h.id];if(y)y.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const v=new i.MediaStream([u]);this._streams[h.id]=v,this._reverseStreams[v.id]=h,this.addStream(v)}return this.getSenders().find(v=>v.track===u)};function o(l,u){let h=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(g=>{const _=l._reverseStreams[g],y=l._streams[_.id];h=h.replace(new RegExp(y.id,"g"),_.id)}),new RTCSessionDescription({type:u.type,sdp:h})}function a(l,u){let h=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(g=>{const _=l._reverseStreams[g],y=l._streams[_.id];h=h.replace(new RegExp(_.id,"g"),y.id)}),new RTCSessionDescription({type:u.type,sdp:h})}["createOffer","createAnswer"].forEach(function(l){const u=i.RTCPeerConnection.prototype[l],h={[l](){const g=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[y=>{const v=o(this,y);g[0].apply(null,[v])},y=>{g[1]&&g[1].apply(null,y)},arguments[2]]):u.apply(this,arguments).then(y=>o(this,y))}};i.RTCPeerConnection.prototype[l]=h[l]});const s=i.RTCPeerConnection.prototype.setLocalDescription;i.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?s.apply(this,arguments):(arguments[0]=a(this,arguments[0]),s.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(i.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(i.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:o(this,l)}}),i.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let g;Object.keys(this._streams).forEach(_=>{this._streams[_].getTracks().find(v=>u.track===v)&&(g=this._streams[_])}),g&&(g.getTracks().length===1?this.removeStream(this._reverseStreams[g.id]):g.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Ao(i,e){!i.RTCPeerConnection&&i.webkitRTCPeerConnection&&(i.RTCPeerConnection=i.webkitRTCPeerConnection),i.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const r=i.RTCPeerConnection.prototype[t],n={[t](){return arguments[0]=new(t==="addIceCandidate"?i.RTCIceCandidate:i.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};i.RTCPeerConnection.prototype[t]=n[t]})}function mh(i,e){wr(i,"negotiationneeded",t=>{const r=t.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return t})}var sc=Object.freeze({__proto__:null,fixNegotiationNeeded:mh,shimAddTrackRemoveTrack:ph,shimAddTrackRemoveTrackWithNative:fh,shimGetDisplayMedia:Df,shimGetSendersWithDtmf:hh,shimGetStats:uh,shimGetUserMedia:ah,shimMediaStream:ch,shimOnTrack:lh,shimPeerConnection:Ao,shimSenderReceiverGetStats:dh});function gh(i,e){const t=i&&i.navigator,r=i&&i.MediaStreamTrack;if(t.getUserMedia=function(n,o,a){ga("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(n).then(o,a)},!(e.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){const n=function(a,s,c){s in a&&!(c in a)&&(a[c]=a[s],delete a[s])},o=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(a){return typeof a=="object"&&typeof a.audio=="object"&&(a=JSON.parse(JSON.stringify(a)),n(a.audio,"autoGainControl","mozAutoGainControl"),n(a.audio,"noiseSuppression","mozNoiseSuppression")),o(a)},r&&r.prototype.getSettings){const a=r.prototype.getSettings;r.prototype.getSettings=function(){const s=a.apply(this,arguments);return n(s,"mozAutoGainControl","autoGainControl"),n(s,"mozNoiseSuppression","noiseSuppression"),s}}if(r&&r.prototype.applyConstraints){const a=r.prototype.applyConstraints;r.prototype.applyConstraints=function(s){return this.kind==="audio"&&typeof s=="object"&&(s=JSON.parse(JSON.stringify(s)),n(s,"autoGainControl","mozAutoGainControl"),n(s,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[s])}}}}function Af(i,e){i.navigator.mediaDevices&&"getDisplayMedia"in i.navigator.mediaDevices||i.navigator.mediaDevices&&(i.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,i.navigator.mediaDevices.getUserMedia(r)})}function vh(i){typeof i=="object"&&i.RTCTrackEvent&&"receiver"in i.RTCTrackEvent.prototype&&!("transceiver"in i.RTCTrackEvent.prototype)&&Object.defineProperty(i.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Lo(i,e){if(typeof i!="object"||!(i.RTCPeerConnection||i.mozRTCPeerConnection))return;!i.RTCPeerConnection&&i.mozRTCPeerConnection&&(i.RTCPeerConnection=i.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const o=i.RTCPeerConnection.prototype[n],a={[n](){return arguments[0]=new(n==="addIceCandidate"?i.RTCIceCandidate:i.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};i.RTCPeerConnection.prototype[n]=a[n]});const t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=i.RTCPeerConnection.prototype.getStats;i.RTCPeerConnection.prototype.getStats=function(){const[o,a,s]=arguments;return r.apply(this,[o||null]).then(c=>{if(e.version<53&&!a)try{c.forEach(l=>{l.type=t[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach((u,h)=>{c.set(h,Object.assign({},u,{type:t[u.type]||u.type}))})}return c}).then(a,s)}}function _h(i){if(!(typeof i=="object"&&i.RTCPeerConnection&&i.RTCRtpSender)||i.RTCRtpSender&&"getStats"in i.RTCRtpSender.prototype)return;const e=i.RTCPeerConnection.prototype.getSenders;e&&(i.RTCPeerConnection.prototype.getSenders=function(){const n=e.apply(this,[]);return n.forEach(o=>o._pc=this),n});const t=i.RTCPeerConnection.prototype.addTrack;t&&(i.RTCPeerConnection.prototype.addTrack=function(){const n=t.apply(this,arguments);return n._pc=this,n}),i.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function bh(i){if(!(typeof i=="object"&&i.RTCPeerConnection&&i.RTCRtpSender)||i.RTCRtpSender&&"getStats"in i.RTCRtpReceiver.prototype)return;const e=i.RTCPeerConnection.prototype.getReceivers;e&&(i.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(n=>n._pc=this),r}),wr(i,"track",t=>(t.receiver._pc=t.srcElement,t)),i.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function yh(i){!i.RTCPeerConnection||"removeStream"in i.RTCPeerConnection.prototype||(i.RTCPeerConnection.prototype.removeStream=function(t){ga("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&t.getTracks().includes(r.track)&&this.removeTrack(r)})})}function Sh(i){i.DataChannel&&!i.RTCDataChannel&&(i.RTCDataChannel=i.DataChannel)}function Ch(i){if(!(typeof i=="object"&&i.RTCPeerConnection))return;const e=i.RTCPeerConnection.prototype.addTransceiver;e&&(i.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const n=r.length>0;n&&r.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const o=e.apply(this,arguments);if(n){const{sender:a}=o,s=a.getParameters();(!("encodings"in s)||s.encodings.length===1&&Object.keys(s.encodings[0]).length===0)&&(s.encodings=r,a.sendEncodings=r,this.setParametersPromises.push(a.setParameters(s).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return o})}function wh(i){if(!(typeof i=="object"&&i.RTCRtpSender))return;const e=i.RTCRtpSender.prototype.getParameters;e&&(i.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function kh(i){if(!(typeof i=="object"&&i.RTCPeerConnection))return;const e=i.RTCPeerConnection.prototype.createOffer;i.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function Th(i){if(!(typeof i=="object"&&i.RTCPeerConnection))return;const e=i.RTCPeerConnection.prototype.createAnswer;i.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var oc=Object.freeze({__proto__:null,shimAddTransceiver:Ch,shimCreateAnswer:Th,shimCreateOffer:kh,shimGetDisplayMedia:Af,shimGetParameters:wh,shimGetUserMedia:gh,shimOnTrack:vh,shimPeerConnection:Lo,shimRTCDataChannel:Sh,shimReceiverGetStats:bh,shimRemoveStream:yh,shimSenderGetStats:_h});function Eh(i){if(!(typeof i!="object"||!i.RTCPeerConnection)){if("getLocalStreams"in i.RTCPeerConnection.prototype||(i.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in i.RTCPeerConnection.prototype)){const e=i.RTCPeerConnection.prototype.addTrack;i.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(n=>e.call(this,n,r)),r.getVideoTracks().forEach(n=>e.call(this,n,r))},i.RTCPeerConnection.prototype.addTrack=function(r){for(var n=arguments.length,o=new Array(n>1?n-1:0),a=1;a<n;a++)o[a-1]=arguments[a];return o&&o.forEach(s=>{this._localStreams?this._localStreams.includes(s)||this._localStreams.push(s):this._localStreams=[s]}),e.apply(this,arguments)}}"removeStream"in i.RTCPeerConnection.prototype||(i.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(t);if(r===-1)return;this._localStreams.splice(r,1);const n=t.getTracks();this.getSenders().forEach(o=>{n.includes(o.track)&&this.removeTrack(o)})})}}function Ph(i){if(!(typeof i!="object"||!i.RTCPeerConnection)&&("getRemoteStreams"in i.RTCPeerConnection.prototype||(i.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in i.RTCPeerConnection.prototype))){Object.defineProperty(i.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(n=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(n))return;this._remoteStreams.push(n);const o=new Event("addstream");o.stream=n,this.dispatchEvent(o)})})}});const e=i.RTCPeerConnection.prototype.setRemoteDescription;i.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(n){n.streams.forEach(o=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(o)>=0)return;r._remoteStreams.push(o);const a=new Event("addstream");a.stream=o,r.dispatchEvent(a)})}),e.apply(r,arguments)}}}function Rh(i){if(typeof i!="object"||!i.RTCPeerConnection)return;const e=i.RTCPeerConnection.prototype,t=e.createOffer,r=e.createAnswer,n=e.setLocalDescription,o=e.setRemoteDescription,a=e.addIceCandidate;e.createOffer=function(l,u){const h=arguments.length>=2?arguments[2]:arguments[0],g=t.apply(this,[h]);return u?(g.then(l,u),Promise.resolve()):g},e.createAnswer=function(l,u){const h=arguments.length>=2?arguments[2]:arguments[0],g=r.apply(this,[h]);return u?(g.then(l,u),Promise.resolve()):g};let s=function(c,l,u){const h=n.apply(this,[c]);return u?(h.then(l,u),Promise.resolve()):h};e.setLocalDescription=s,s=function(c,l,u){const h=o.apply(this,[c]);return u?(h.then(l,u),Promise.resolve()):h},e.setRemoteDescription=s,s=function(c,l,u){const h=a.apply(this,[c]);return u?(h.then(l,u),Promise.resolve()):h},e.addIceCandidate=s}function xh(i){const e=i&&i.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const t=e.mediaDevices,r=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=n=>r(Oh(n))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,n,o){e.mediaDevices.getUserMedia(r).then(n,o)}).bind(e))}function Oh(i){return i&&i.video!==void 0?Object.assign({},i,{video:oh(i.video)}):i}function Dh(i){if(!i.RTCPeerConnection)return;const e=i.RTCPeerConnection;i.RTCPeerConnection=function(r,n){if(r&&r.iceServers){const o=[];for(let a=0;a<r.iceServers.length;a++){let s=r.iceServers[a];s.urls===void 0&&s.url?(ga("RTCIceServer.url","RTCIceServer.urls"),s=JSON.parse(JSON.stringify(s)),s.urls=s.url,delete s.url,o.push(s)):o.push(r.iceServers[a])}r.iceServers=o}return new e(r,n)},i.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(i.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function Ah(i){typeof i=="object"&&i.RTCTrackEvent&&"receiver"in i.RTCTrackEvent.prototype&&!("transceiver"in i.RTCTrackEvent.prototype)&&Object.defineProperty(i.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Lh(i){const e=i.RTCPeerConnection.prototype.createOffer;i.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const n=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&n?n.direction==="sendrecv"?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":n.direction==="recvonly"&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):r.offerToReceiveAudio===!0&&!n&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const o=this.getTransceivers().find(a=>a.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):r.offerToReceiveVideo===!0&&!o&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function Ih(i){typeof i!="object"||i.AudioContext||(i.AudioContext=i.webkitAudioContext)}var ac=Object.freeze({__proto__:null,shimAudioContext:Ih,shimCallbacksAPI:Rh,shimConstraints:Oh,shimCreateOfferLegacy:Lh,shimGetUserMedia:xh,shimLocalStreamsAPI:Eh,shimRTCIceServerUrls:Dh,shimRemoteStreamsAPI:Ph,shimTrackEventTransceiver:Ah}),Mh={exports:{}};(function(i){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(t){return t.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(t){return t.split(`
m=`).map((n,o)=>(o>0?"m="+n:n).trim()+`\r
`)},e.getDescription=function(t){const r=e.splitSections(t);return r&&r[0]},e.getMediaSections=function(t){const r=e.splitSections(t);return r.shift(),r},e.matchPrefix=function(t,r){return e.splitLines(t).filter(n=>n.indexOf(r)===0)},e.parseCandidate=function(t){let r;t.indexOf("a=candidate:")===0?r=t.substring(12).split(" "):r=t.substring(10).split(" ");const n={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let o=8;o<r.length;o+=2)switch(r[o]){case"raddr":n.relatedAddress=r[o+1];break;case"rport":n.relatedPort=parseInt(r[o+1],10);break;case"tcptype":n.tcpType=r[o+1];break;case"ufrag":n.ufrag=r[o+1],n.usernameFragment=r[o+1];break;default:n[r[o]]===void 0&&(n[r[o]]=r[o+1]);break}return n},e.writeCandidate=function(t){const r=[];r.push(t.foundation);const n=t.component;n==="rtp"?r.push(1):n==="rtcp"?r.push(2):r.push(n),r.push(t.protocol.toUpperCase()),r.push(t.priority),r.push(t.address||t.ip),r.push(t.port);const o=t.type;return r.push("typ"),r.push(o),o!=="host"&&t.relatedAddress&&t.relatedPort&&(r.push("raddr"),r.push(t.relatedAddress),r.push("rport"),r.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(r.push("ufrag"),r.push(t.usernameFragment||t.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(t){return t.substring(14).split(" ")},e.parseRtpMap=function(t){let r=t.substring(9).split(" ");const n={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),n.name=r[0],n.clockRate=parseInt(r[1],10),n.channels=r.length===3?parseInt(r[2],10):1,n.numChannels=n.channels,n},e.writeRtpMap=function(t){let r=t.payloadType;t.preferredPayloadType!==void 0&&(r=t.preferredPayloadType);const n=t.channels||t.numChannels||1;return"a=rtpmap:"+r+" "+t.name+"/"+t.clockRate+(n!==1?"/"+n:"")+`\r
`},e.parseExtmap=function(t){const r=t.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+(t.attributes?" "+t.attributes:"")+`\r
`},e.parseFmtp=function(t){const r={};let n;const o=t.substring(t.indexOf(" ")+1).split(";");for(let a=0;a<o.length;a++)n=o[a].trim().split("="),r[n[0].trim()]=n[1];return r},e.writeFmtp=function(t){let r="",n=t.payloadType;if(t.preferredPayloadType!==void 0&&(n=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){const o=[];Object.keys(t.parameters).forEach(a=>{t.parameters[a]!==void 0?o.push(a+"="+t.parameters[a]):o.push(a)}),r+="a=fmtp:"+n+" "+o.join(";")+`\r
`}return r},e.parseRtcpFb=function(t){const r=t.substring(t.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(t){let r="",n=t.payloadType;return t.preferredPayloadType!==void 0&&(n=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(o=>{r+="a=rtcp-fb:"+n+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(t){const r=t.indexOf(" "),n={ssrc:parseInt(t.substring(7,r),10)},o=t.indexOf(":",r);return o>-1?(n.attribute=t.substring(r+1,o),n.value=t.substring(o+1)):n.attribute=t.substring(r+1),n},e.parseSsrcGroup=function(t){const r=t.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(n=>parseInt(n,10))}},e.getMid=function(t){const r=e.matchPrefix(t,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(t){const r=t.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(t,r){return{role:"auto",fingerprints:e.matchPrefix(t+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,r){let n="a=setup:"+r+`\r
`;return t.fingerprints.forEach(o=>{n+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`}),n},e.parseCryptoLine=function(t){const r=t.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;const r=t.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},e.getCryptoParameters=function(t,r){return e.matchPrefix(t+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(t,r){const n=e.matchPrefix(t+r,"a=ice-ufrag:")[0],o=e.matchPrefix(t+r,"a=ice-pwd:")[0];return n&&o?{usernameFragment:n.substring(12),password:o.substring(10)}:null},e.writeIceParameters=function(t){let r="a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`;return t.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(t){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=e.splitLines(t)[0].split(" ");r.profile=o[2];for(let s=3;s<o.length;s++){const c=o[s],l=e.matchPrefix(t,"a=rtpmap:"+c+" ")[0];if(l){const u=e.parseRtpMap(l),h=e.matchPrefix(t,"a=fmtp:"+c+" ");switch(u.parameters=h.length?e.parseFmtp(h[0]):{},u.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),r.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(t,"a=extmap:").forEach(s=>{r.headerExtensions.push(e.parseExtmap(s))});const a=e.matchPrefix(t,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(s=>{a.forEach(c=>{s.rtcpFeedback.find(u=>u.type===c.type&&u.parameter===c.parameter)||s.rtcpFeedback.push(c)})}),r},e.writeRtpDescription=function(t,r){let n="";n+="m="+t+" ",n+=r.codecs.length>0?"9":"0",n+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",n+=r.codecs.map(a=>a.preferredPayloadType!==void 0?a.preferredPayloadType:a.payloadType).join(" ")+`\r
`,n+=`c=IN IP4 0.0.0.0\r
`,n+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(a=>{n+=e.writeRtpMap(a),n+=e.writeFmtp(a),n+=e.writeRtcpFb(a)});let o=0;return r.codecs.forEach(a=>{a.maxptime>o&&(o=a.maxptime)}),o>0&&(n+="a=maxptime:"+o+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(a=>{n+=e.writeExtmap(a)}),n},e.parseRtpEncodingParameters=function(t){const r=[],n=e.parseRtpParameters(t),o=n.fecMechanisms.indexOf("RED")!==-1,a=n.fecMechanisms.indexOf("ULPFEC")!==-1,s=e.matchPrefix(t,"a=ssrc:").map(g=>e.parseSsrcMedia(g)).filter(g=>g.attribute==="cname"),c=s.length>0&&s[0].ssrc;let l;const u=e.matchPrefix(t,"a=ssrc-group:FID").map(g=>g.substring(17).split(" ").map(y=>parseInt(y,10)));u.length>0&&u[0].length>1&&u[0][0]===c&&(l=u[0][1]),n.codecs.forEach(g=>{if(g.name.toUpperCase()==="RTX"&&g.parameters.apt){let _={ssrc:c,codecPayloadType:parseInt(g.parameters.apt,10)};c&&l&&(_.rtx={ssrc:l}),r.push(_),o&&(_=JSON.parse(JSON.stringify(_)),_.fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},r.push(_))}}),r.length===0&&c&&r.push({ssrc:c});let h=e.matchPrefix(t,"b=");return h.length&&(h[0].indexOf("b=TIAS:")===0?h=parseInt(h[0].substring(7),10):h[0].indexOf("b=AS:")===0?h=parseInt(h[0].substring(5),10)*1e3*.95-50*40*8:h=void 0,r.forEach(g=>{g.maxBitrate=h})),r},e.parseRtcpParameters=function(t){const r={},n=e.matchPrefix(t,"a=ssrc:").map(s=>e.parseSsrcMedia(s)).filter(s=>s.attribute==="cname")[0];n&&(r.cname=n.value,r.ssrc=n.ssrc);const o=e.matchPrefix(t,"a=rtcp-rsize");r.reducedSize=o.length>0,r.compound=o.length===0;const a=e.matchPrefix(t,"a=rtcp-mux");return r.mux=a.length>0,r},e.writeRtcpParameters=function(t){let r="";return t.reducedSize&&(r+=`a=rtcp-rsize\r
`),t.mux&&(r+=`a=rtcp-mux\r
`),t.ssrc!==void 0&&t.cname&&(r+="a=ssrc:"+t.ssrc+" cname:"+t.cname+`\r
`),r},e.parseMsid=function(t){let r;const n=e.matchPrefix(t,"a=msid:");if(n.length===1)return r=n[0].substring(7).split(" "),{stream:r[0],track:r[1]};const o=e.matchPrefix(t,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="msid");if(o.length>0)return r=o[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(t){const r=e.parseMLine(t),n=e.matchPrefix(t,"a=max-message-size:");let o;n.length>0&&(o=parseInt(n[0].substring(19),10)),isNaN(o)&&(o=65536);const a=e.matchPrefix(t,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:r.fmt,maxMessageSize:o};const s=e.matchPrefix(t,"a=sctpmap:");if(s.length>0){const c=s[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:o}}},e.writeSctpDescription=function(t,r){let n=[];return t.protocol!=="DTLS/SCTP"?n=["m="+t.kind+" 9 "+t.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:n=["m="+t.kind+" 9 "+t.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&n.push("a=max-message-size:"+r.maxMessageSize+`\r
`),n.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(t,r,n){let o;const a=r!==void 0?r:2;return t?o=t:o=e.generateSessionId(),`v=0\r
o=`+(n||"thisisadapterortc")+" "+o+" "+a+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(t,r){const n=e.splitLines(t);for(let o=0;o<n.length;o++)switch(n[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[o].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(t){return e.splitLines(t)[0].split(" ")[0].substring(2)},e.isRejected=function(t){return t.split(" ",2)[1]==="0"},e.parseMLine=function(t){const n=e.splitLines(t)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},e.parseOLine=function(t){const n=e.matchPrefix(t,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},e.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;const r=e.splitLines(t);for(let n=0;n<r.length;n++)if(r[n].length<2||r[n].charAt(1)!=="=")return!1;return!0},i.exports=e})(Mh);var Bh=Mh.exports,xr=Ld(Bh),Lf=Dd({__proto__:null,default:xr},[Bh]);function Zn(i){if(!i.RTCIceCandidate||i.RTCIceCandidate&&"foundation"in i.RTCIceCandidate.prototype)return;const e=i.RTCIceCandidate;i.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const n=new e(r),o=xr.parseCandidate(r.candidate);for(const a in o)a in n||Object.defineProperty(n,a,{value:o[a]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new e(r)},i.RTCIceCandidate.prototype=e.prototype,wr(i,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new i.RTCIceCandidate(t.candidate),writable:"false"}),t))}function Io(i){!i.RTCIceCandidate||i.RTCIceCandidate&&"relayProtocol"in i.RTCIceCandidate.prototype||wr(i,"icecandidate",e=>{if(e.candidate){const t=xr.parseCandidate(e.candidate.candidate);t.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function es(i,e){if(!i.RTCPeerConnection)return;"sctp"in i.RTCPeerConnection.prototype||Object.defineProperty(i.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const t=function(s){if(!s||!s.sdp)return!1;const c=xr.splitSections(s.sdp);return c.shift(),c.some(l=>{const u=xr.parseMLine(l);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},r=function(s){const c=s.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const l=parseInt(c[1],10);return l!==l?-1:l},n=function(s){let c=65536;return e.browser==="firefox"&&(e.version<57?s===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},o=function(s,c){let l=65536;e.browser==="firefox"&&e.version===57&&(l=65535);const u=xr.matchPrefix(s.sdp,"a=max-message-size:");return u.length>0?l=parseInt(u[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(l=2147483637),l},a=i.RTCPeerConnection.prototype.setRemoteDescription;i.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){const c=r(arguments[0]),l=n(c),u=o(arguments[0],c);let h;l===0&&u===0?h=Number.POSITIVE_INFINITY:l===0||u===0?h=Math.max(l,u):h=Math.min(l,u);const g={};Object.defineProperty(g,"maxMessageSize",{get(){return h}}),this._sctp=g}return a.apply(this,arguments)}}function ts(i){if(!(i.RTCPeerConnection&&"createDataChannel"in i.RTCPeerConnection.prototype))return;function e(r,n){const o=r.send;r.send=function(){const s=arguments[0],c=s.length||s.size||s.byteLength;if(r.readyState==="open"&&n.sctp&&c>n.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+n.sctp.maxMessageSize+" bytes)");return o.apply(r,arguments)}}const t=i.RTCPeerConnection.prototype.createDataChannel;i.RTCPeerConnection.prototype.createDataChannel=function(){const n=t.apply(this,arguments);return e(n,this),n},wr(i,"datachannel",r=>(e(r.channel,r.target),r))}function Mo(i){if(!i.RTCPeerConnection||"connectionState"in i.RTCPeerConnection.prototype)return;const e=i.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{const r=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=n=>{const o=n.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;const a=new Event("connectionstatechange",n);o.dispatchEvent(a)}return n},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function Bo(i,e){if(!i.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const t=i.RTCPeerConnection.prototype.setRemoteDescription;i.RTCPeerConnection.prototype.setRemoteDescription=function(n){if(n&&n.sdp&&n.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const o=n.sdp.split(`
`).filter(a=>a.trim()!=="a=extmap-allow-mixed").join(`
`);i.RTCSessionDescription&&n instanceof i.RTCSessionDescription?arguments[0]=new i.RTCSessionDescription({type:n.type,sdp:o}):n.sdp=o}return t.apply(this,arguments)}}function is(i,e){if(!(i.RTCPeerConnection&&i.RTCPeerConnection.prototype))return;const t=i.RTCPeerConnection.prototype.addIceCandidate;!t||t.length===0||(i.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function rs(i,e){if(!(i.RTCPeerConnection&&i.RTCPeerConnection.prototype))return;const t=i.RTCPeerConnection.prototype.setLocalDescription;!t||t.length===0||(i.RTCPeerConnection.prototype.setLocalDescription=function(){let n=arguments[0]||{};if(typeof n!="object"||n.type&&n.sdp)return t.apply(this,arguments);if(n={type:n.type,sdp:n.sdp},!n.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":n.type="offer";break;default:n.type="answer";break}return n.sdp||n.type!=="offer"&&n.type!=="answer"?t.apply(this,[n]):(n.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(a=>t.apply(this,[a]))})}var If=Object.freeze({__proto__:null,removeExtmapAllowMixed:Bo,shimAddIceCandidateNullOrEmpty:is,shimConnectionState:Mo,shimMaxMessageSize:es,shimParameterlessSetLocalDescription:rs,shimRTCIceCandidate:Zn,shimRTCIceCandidateRelayProtocol:Io,shimSendThrowTypeError:ts});function Mf(){let{window:i}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const t=sh,r=Of(i),n={browserDetails:r,commonShim:If,extractVersion:Yn,disableLog:Rf,disableWarnings:xf,sdp:Lf};switch(r.browser){case"chrome":if(!sc||!Ao||!e.shimChrome)return t("Chrome shim is not included in this adapter release."),n;if(r.version===null)return t("Chrome shim can not determine version, not shimming."),n;t("adapter.js shimming chrome."),n.browserShim=sc,is(i,r),rs(i),ah(i,r),ch(i),Ao(i,r),lh(i),ph(i,r),hh(i),uh(i),dh(i),mh(i,r),Zn(i),Io(i),Mo(i),es(i,r),ts(i),Bo(i,r);break;case"firefox":if(!oc||!Lo||!e.shimFirefox)return t("Firefox shim is not included in this adapter release."),n;t("adapter.js shimming firefox."),n.browserShim=oc,is(i,r),rs(i),gh(i,r),Lo(i,r),vh(i),yh(i),_h(i),bh(i),Sh(i),Ch(i),wh(i),kh(i),Th(i),Zn(i),Mo(i),es(i,r),ts(i);break;case"safari":if(!ac||!e.shimSafari)return t("Safari shim is not included in this adapter release."),n;t("adapter.js shimming safari."),n.browserShim=ac,is(i,r),rs(i),Dh(i),Lh(i),Rh(i),Eh(i),Ph(i),Ah(i),xh(i),Ih(i),Zn(i),Io(i),es(i,r),ts(i),Bo(i,r);break;default:t("Unsupported browser!");break}return n}Mf({window:typeof window>"u"?void 0:window});const Bf=10,Wn="lk_e2ee",Nf="LKFrameEncryptionKey",Ff={sharedKey:!1,ratchetSalt:Nf,ratchetWindowSize:8,failureTolerance:Bf};var tr;(function(i){i.SetKey="setKey",i.RatchetRequest="ratchetRequest",i.KeyRatcheted="keyRatcheted"})(tr||(tr={}));var cc;(function(i){i.KeyRatcheted="keyRatcheted"})(cc||(cc={}));var Zi;(function(i){i.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",i.EncryptionError="encryptionError"})(Zi||(Zi={}));var lc;(function(i){i.Error="cryptorError"})(lc||(lc={}));function Uf(){return jf()||No()}function No(){return typeof window.RTCRtpScriptTransform<"u"}function jf(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}class Lb extends ii.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(t,r)=>{he.debug("key ratcheted event received",{material:t,keyIndex:r})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},Ff),e),this.on(tr.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,t,r){const n={key:e,participantIdentity:t,keyIndex:r};this.keyInfoMap.set("".concat(t??"shared","-").concat(r??0),n),this.emit(tr.SetKey,n)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,t){this.emit(tr.RatchetRequest,e,t)}}class Zr extends Error{constructor(e,t){super(t||"an error has occured"),this.code=e}}class ge extends Zr{constructor(e,t,r){super(1,e),this.status=r,this.reason=t}}class va extends Zr{constructor(e){super(21,e??"device is unsupported")}}class Mt extends Zr{constructor(e){super(20,e??"track is invalid")}}class Hf extends Zr{constructor(e){super(10,e??"unsupported server")}}class Pe extends Zr{constructor(e){super(12,e??"unexpected connection state")}}class Fo extends Zr{constructor(e){super(13,e??"unable to negotiate")}}var us;(function(i){i.PermissionDenied="PermissionDenied",i.NotFound="NotFound",i.DeviceInUse="DeviceInUse",i.Other="Other"})(us||(us={}));(function(i){function e(t){if(t&&"name"in t)return t.name==="NotFoundError"||t.name==="DevicesNotFoundError"?i.NotFound:t.name==="NotAllowedError"||t.name==="PermissionDeniedError"?i.PermissionDenied:t.name==="NotReadableError"||t.name==="TrackStartError"?i.DeviceInUse:i.Other}i.getFailure=e})(us||(us={}));var $;(function(i){i.Connected="connected",i.Reconnecting="reconnecting",i.Reconnected="reconnected",i.Disconnected="disconnected",i.ConnectionStateChanged="connectionStateChanged",i.StateChanged="connectionStateChanged",i.MediaDevicesChanged="mediaDevicesChanged",i.ParticipantConnected="participantConnected",i.ParticipantDisconnected="participantDisconnected",i.TrackPublished="trackPublished",i.TrackSubscribed="trackSubscribed",i.TrackSubscriptionFailed="trackSubscriptionFailed",i.TrackUnpublished="trackUnpublished",i.TrackUnsubscribed="trackUnsubscribed",i.TrackMuted="trackMuted",i.TrackUnmuted="trackUnmuted",i.LocalTrackPublished="localTrackPublished",i.LocalTrackUnpublished="localTrackUnpublished",i.LocalAudioSilenceDetected="localAudioSilenceDetected",i.ActiveSpeakersChanged="activeSpeakersChanged",i.ParticipantMetadataChanged="participantMetadataChanged",i.ParticipantNameChanged="participantNameChanged",i.RoomMetadataChanged="roomMetadataChanged",i.DataReceived="dataReceived",i.ConnectionQualityChanged="connectionQualityChanged",i.TrackStreamStateChanged="trackStreamStateChanged",i.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",i.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",i.AudioPlaybackStatusChanged="audioPlaybackChanged",i.VideoPlaybackStatusChanged="videoPlaybackChanged",i.MediaDevicesError="mediaDevicesError",i.ParticipantPermissionsChanged="participantPermissionsChanged",i.SignalConnected="signalConnected",i.RecordingStatusChanged="recordingStatusChanged",i.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",i.EncryptionError="encryptionError",i.DCBufferStatusChanged="dcBufferStatusChanged",i.ActiveDeviceChanged="activeDeviceChanged"})($||($={}));var G;(function(i){i.TrackPublished="trackPublished",i.TrackSubscribed="trackSubscribed",i.TrackSubscriptionFailed="trackSubscriptionFailed",i.TrackUnpublished="trackUnpublished",i.TrackUnsubscribed="trackUnsubscribed",i.TrackMuted="trackMuted",i.TrackUnmuted="trackUnmuted",i.LocalTrackPublished="localTrackPublished",i.LocalTrackUnpublished="localTrackUnpublished",i.ParticipantMetadataChanged="participantMetadataChanged",i.ParticipantNameChanged="participantNameChanged",i.DataReceived="dataReceived",i.IsSpeakingChanged="isSpeakingChanged",i.ConnectionQualityChanged="connectionQualityChanged",i.TrackStreamStateChanged="trackStreamStateChanged",i.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",i.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",i.MediaDevicesError="mediaDevicesError",i.AudioStreamAcquired="audioStreamAcquired",i.ParticipantPermissionsChanged="participantPermissionsChanged",i.PCTrackAdded="pcTrackAdded"})(G||(G={}));var re;(function(i){i.TransportsCreated="transportsCreated",i.Connected="connected",i.Disconnected="disconnected",i.Resuming="resuming",i.Resumed="resumed",i.Restarting="restarting",i.Restarted="restarted",i.SignalResumed="signalResumed",i.SignalRestarted="signalRestarted",i.Closing="closing",i.MediaTrackAdded="mediaTrackAdded",i.ActiveSpeakersUpdate="activeSpeakersUpdate",i.DataPacketReceived="dataPacketReceived",i.RTPVideoMapUpdate="rtpVideoMapUpdate",i.DCBufferStatusChanged="dcBufferStatusChanged",i.ParticipantUpdate="participantUpdate",i.RoomUpdate="roomUpdate",i.SpeakersChanged="speakersChanged",i.StreamStateChanged="streamStateChanged",i.ConnectionQualityUpdate="connectionQualityUpdate",i.SubscriptionError="subscriptionError",i.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",i.RemoteMute="remoteMute",i.SubscribedQualityUpdate="subscribedQualityUpdate",i.LocalTrackUnpublished="localTrackUnpublished"})(re||(re={}));var ee;(function(i){i.Message="message",i.Muted="muted",i.Unmuted="unmuted",i.Restarted="restarted",i.Ended="ended",i.Subscribed="subscribed",i.Unsubscribed="unsubscribed",i.UpdateSettings="updateSettings",i.UpdateSubscription="updateSubscription",i.AudioPlaybackStarted="audioPlaybackStarted",i.AudioPlaybackFailed="audioPlaybackFailed",i.AudioSilenceDetected="audioSilenceDetected",i.VisibilityChanged="visibilityChanged",i.VideoDimensionsChanged="videoDimensionsChanged",i.VideoPlaybackStarted="videoPlaybackStarted",i.VideoPlaybackFailed="videoPlaybackFailed",i.ElementAttached="elementAttached",i.ElementDetached="elementDetached",i.UpstreamPaused="upstreamPaused",i.UpstreamResumed="upstreamResumed",i.SubscriptionPermissionChanged="subscriptionPermissionChanged",i.SubscriptionStatusChanged="subscriptionStatusChanged",i.SubscriptionFailed="subscriptionFailed"})(ee||(ee={}));function _a(i,e,t){var r,n,o;e===void 0&&(e=50),t===void 0&&(t={});var a=(r=t.isImmediate)!=null&&r,s=(n=t.callback)!=null&&n,c=t.maxWait,l=Date.now(),u=[];function h(){if(c!==void 0){var _=Date.now()-l;if(_+e>=c)return c-_}return e}var g=function(){var _=[].slice.call(arguments),y=this;return new Promise(function(v,f){var p=a&&o===void 0;if(o!==void 0&&clearTimeout(o),o=setTimeout(function(){if(o=void 0,l=Date.now(),!a){var m=i.apply(y,_);s&&s(m),u.forEach(function(b){return(0,b.resolve)(m)}),u=[]}},h()),p){var d=i.apply(y,_);return s&&s(d),v(d)}u.push({resolve:v,reject:f})})};return g.cancel=function(_){o!==void 0&&clearTimeout(o),u.forEach(function(y){return(0,y.reject)(_)}),u=[]},g}const Wf=/version\/(\d+(\.?_?\d+)+)/i;let no;function Bi(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof i>"u"&&typeof navigator>"u")return;const t=(i??navigator.userAgent).toLowerCase();if(no===void 0||e){const r=qf.find(n=>{let{test:o}=n;return o.test(t)});no=r==null?void 0:r.describe(t)}return no}const qf=[{test:/firefox|iceweasel|fxios/i,describe(i){return{name:"Firefox",version:so(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,i),os:i.toLowerCase().includes("fxios")?"iOS":void 0}}},{test:/chrom|crios|crmo/i,describe(i){return{name:"Chrome",version:so(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,i),os:i.toLowerCase().includes("crios")?"iOS":void 0}}},{test:/safari|applewebkit/i,describe(i){return{name:"Safari",version:so(Wf,i),os:i.includes("mobile/")?"iOS":"macOS"}}}];function so(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const r=e.match(i);return r&&r.length>=t&&r[t]||""}var Vf="1.15.13";const Jf=Vf,$f=11;class Me{}Me.setTimeout=function(){return setTimeout(...arguments)};Me.setInterval=function(){return setInterval(...arguments)};Me.clearTimeout=function(){return clearTimeout(...arguments)};Me.clearInterval=function(){return clearInterval(...arguments)};class pe{constructor(e,t,r,n,o){this.width=e,this.height=t,this.encoding={maxBitrate:r,maxFramerate:n,priority:o}}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.width/this.height}}}const zf=["vp8","h264"],Nh=["vp8","h264","vp9","av1"];function Kf(i){return!!zf.find(e=>e===i)}var ds;(function(i){i.telephone={maxBitrate:12e3},i.speech={maxBitrate:2e4},i.music={maxBitrate:32e3},i.musicStereo={maxBitrate:48e3},i.musicHighQuality={maxBitrate:64e3},i.musicHighQualityStereo={maxBitrate:96e3}})(ds||(ds={}));const kn={h90:new pe(160,90,9e4,20),h180:new pe(320,180,16e4,20),h216:new pe(384,216,18e4,20),h360:new pe(640,360,45e4,20),h540:new pe(960,540,8e5,25),h720:new pe(1280,720,17e5,30),h1080:new pe(1920,1080,3e6,30),h1440:new pe(2560,1440,5e6,30),h2160:new pe(3840,2160,8e6,30)},Uo={h120:new pe(160,120,7e4,20),h180:new pe(240,180,125e3,20),h240:new pe(320,240,14e4,20),h360:new pe(480,360,33e4,20),h480:new pe(640,480,5e5,20),h540:new pe(720,540,6e5,25),h720:new pe(960,720,13e5,30),h1080:new pe(1440,1080,23e5,30),h1440:new pe(1920,1440,38e5,30)},ba={h360fps3:new pe(640,360,2e5,3,"medium"),h360fps15:new pe(640,360,4e5,15,"medium"),h720fps5:new pe(1280,720,8e5,5,"medium"),h720fps15:new pe(1280,720,15e5,15,"medium"),h720fps30:new pe(1280,720,2e6,30,"medium"),h1080fps15:new pe(1920,1080,25e5,15,"medium"),h1080fps30:new pe(1920,1080,5e6,30,"medium"),original:new pe(0,0,7e6,30,"medium")};var je;(function(i){i[i.PUBLISHER=0]="PUBLISHER",i[i.SUBSCRIBER=1]="SUBSCRIBER"})(je||(je={}));R.util.setEnumType(je,"livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]);var vr;(function(i){i[i.ACTIVE=0]="ACTIVE",i[i.PAUSED=1]="PAUSED"})(vr||(vr={}));R.util.setEnumType(vr,"livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]);var fs;(function(i){i[i.UDP=0]="UDP",i[i.TCP=1]="TCP",i[i.TLS=2]="TLS"})(fs||(fs={}));R.util.setEnumType(fs,"livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]);class mi extends ie{constructor(e){super(),this.message={case:void 0},R.util.initPartial(e,this)}static fromBinary(e,t){return new mi().fromBinary(e,t)}static fromJson(e,t){return new mi().fromJson(e,t)}static fromJsonString(e,t){return new mi().fromJsonString(e,t)}static equals(e,t){return R.util.equals(mi,e,t)}}mi.runtime=R;mi.typeName="livekit.SignalRequest";mi.fields=R.util.newFieldList(()=>[{no:1,name:"offer",kind:"message",T:$e,oneof:"message"},{no:2,name:"answer",kind:"message",T:$e,oneof:"message"},{no:3,name:"trickle",kind:"message",T:St,oneof:"message"},{no:4,name:"add_track",kind:"message",T:yt,oneof:"message"},{no:5,name:"mute",kind:"message",T:Ct,oneof:"message"},{no:6,name:"subscription",kind:"message",T:lt,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:Vt,oneof:"message"},{no:8,name:"leave",kind:"message",T:ht,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:Jt,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:Gt,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:Xt,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Le,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:$t,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:Yt,oneof:"message"}]);class qt extends ie{constructor(e){super(),this.message={case:void 0},R.util.initPartial(e,this)}static fromBinary(e,t){return new qt().fromBinary(e,t)}static fromJson(e,t){return new qt().fromJson(e,t)}static fromJsonString(e,t){return new qt().fromJsonString(e,t)}static equals(e,t){return R.util.equals(qt,e,t)}}qt.runtime=R;qt.typeName="livekit.SignalResponse";qt.fields=R.util.newFieldList(()=>[{no:1,name:"join",kind:"message",T:gi,oneof:"message"},{no:2,name:"answer",kind:"message",T:$e,oneof:"message"},{no:3,name:"offer",kind:"message",T:$e,oneof:"message"},{no:4,name:"trickle",kind:"message",T:St,oneof:"message"},{no:5,name:"update",kind:"message",T:bi,oneof:"message"},{no:6,name:"track_published",kind:"message",T:wt,oneof:"message"},{no:8,name:"leave",kind:"message",T:ht,oneof:"message"},{no:9,name:"mute",kind:"message",T:Ct,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:yi,oneof:"message"},{no:11,name:"room_update",kind:"message",T:Si,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:wi,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:Ti,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:Pi,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:Ri,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:_i,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:vi,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:xi,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:Di,oneof:"message"}]);class bt extends ie{constructor(e){super(),this.codec="",this.cid="",R.util.initPartial(e,this)}static fromBinary(e,t){return new bt().fromBinary(e,t)}static fromJson(e,t){return new bt().fromJson(e,t)}static fromJsonString(e,t){return new bt().fromJsonString(e,t)}static equals(e,t){return R.util.equals(bt,e,t)}}bt.runtime=R;bt.typeName="livekit.SimulcastCodec";bt.fields=R.util.newFieldList(()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9}]);class yt extends ie{constructor(e){super(),this.cid="",this.name="",this.type=Ue.AUDIO,this.width=0,this.height=0,this.muted=!1,this.disableDtx=!1,this.source=Te.UNKNOWN,this.layers=[],this.simulcastCodecs=[],this.sid="",this.stereo=!1,this.disableRed=!1,this.encryption=Ie.NONE,this.stream="",R.util.initPartial(e,this)}static fromBinary(e,t){return new yt().fromBinary(e,t)}static fromJson(e,t){return new yt().fromJson(e,t)}static fromJsonString(e,t){return new yt().fromJsonString(e,t)}static equals(e,t){return R.util.equals(yt,e,t)}}yt.runtime=R;yt.typeName="livekit.AddTrackRequest";yt.fields=R.util.newFieldList(()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:R.getEnumType(Ue)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:R.getEnumType(Te)},{no:9,name:"layers",kind:"message",T:Je,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:bt,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:R.getEnumType(Ie)},{no:15,name:"stream",kind:"scalar",T:9}]);class St extends ie{constructor(e){super(),this.candidateInit="",this.target=je.PUBLISHER,R.util.initPartial(e,this)}static fromBinary(e,t){return new St().fromBinary(e,t)}static fromJson(e,t){return new St().fromJson(e,t)}static fromJsonString(e,t){return new St().fromJsonString(e,t)}static equals(e,t){return R.util.equals(St,e,t)}}St.runtime=R;St.typeName="livekit.TrickleRequest";St.fields=R.util.newFieldList(()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:R.getEnumType(je)}]);class Ct extends ie{constructor(e){super(),this.sid="",this.muted=!1,R.util.initPartial(e,this)}static fromBinary(e,t){return new Ct().fromBinary(e,t)}static fromJson(e,t){return new Ct().fromJson(e,t)}static fromJsonString(e,t){return new Ct().fromJsonString(e,t)}static equals(e,t){return R.util.equals(Ct,e,t)}}Ct.runtime=R;Ct.typeName="livekit.MuteTrackRequest";Ct.fields=R.util.newFieldList(()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]);class gi extends ie{constructor(e){super(),this.otherParticipants=[],this.serverVersion="",this.iceServers=[],this.subscriberPrimary=!1,this.alternativeUrl="",this.serverRegion="",this.pingTimeout=0,this.pingInterval=0,this.sifTrailer=new Uint8Array(0),R.util.initPartial(e,this)}static fromBinary(e,t){return new gi().fromBinary(e,t)}static fromJson(e,t){return new gi().fromJson(e,t)}static fromJsonString(e,t){return new gi().fromJsonString(e,t)}static equals(e,t){return R.util.equals(gi,e,t)}}gi.runtime=R;gi.typeName="livekit.JoinResponse";gi.fields=R.util.newFieldList(()=>[{no:1,name:"room",kind:"message",T:Yr},{no:2,name:"participant",kind:"message",T:it},{no:3,name:"other_participants",kind:"message",T:it,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:zt,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:jt},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:di},{no:13,name:"sif_trailer",kind:"scalar",T:12}]);class vi extends ie{constructor(e){super(),this.iceServers=[],R.util.initPartial(e,this)}static fromBinary(e,t){return new vi().fromBinary(e,t)}static fromJson(e,t){return new vi().fromJson(e,t)}static fromJsonString(e,t){return new vi().fromJsonString(e,t)}static equals(e,t){return R.util.equals(vi,e,t)}}vi.runtime=R;vi.typeName="livekit.ReconnectResponse";vi.fields=R.util.newFieldList(()=>[{no:1,name:"ice_servers",kind:"message",T:zt,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:jt}]);class wt extends ie{constructor(e){super(),this.cid="",R.util.initPartial(e,this)}static fromBinary(e,t){return new wt().fromBinary(e,t)}static fromJson(e,t){return new wt().fromJson(e,t)}static fromJsonString(e,t){return new wt().fromJsonString(e,t)}static equals(e,t){return R.util.equals(wt,e,t)}}wt.runtime=R;wt.typeName="livekit.TrackPublishedResponse";wt.fields=R.util.newFieldList(()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:Xe}]);class _i extends ie{constructor(e){super(),this.trackSid="",R.util.initPartial(e,this)}static fromBinary(e,t){return new _i().fromBinary(e,t)}static fromJson(e,t){return new _i().fromJson(e,t)}static fromJsonString(e,t){return new _i().fromJsonString(e,t)}static equals(e,t){return R.util.equals(_i,e,t)}}_i.runtime=R;_i.typeName="livekit.TrackUnpublishedResponse";_i.fields=R.util.newFieldList(()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]);class $e extends ie{constructor(e){super(),this.type="",this.sdp="",R.util.initPartial(e,this)}static fromBinary(e,t){return new $e().fromBinary(e,t)}static fromJson(e,t){return new $e().fromJson(e,t)}static fromJsonString(e,t){return new $e().fromJsonString(e,t)}static equals(e,t){return R.util.equals($e,e,t)}}$e.runtime=R;$e.typeName="livekit.SessionDescription";$e.fields=R.util.newFieldList(()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9}]);class bi extends ie{constructor(e){super(),this.participants=[],R.util.initPartial(e,this)}static fromBinary(e,t){return new bi().fromBinary(e,t)}static fromJson(e,t){return new bi().fromJson(e,t)}static fromJsonString(e,t){return new bi().fromJsonString(e,t)}static equals(e,t){return R.util.equals(bi,e,t)}}bi.runtime=R;bi.typeName="livekit.ParticipantUpdate";bi.fields=R.util.newFieldList(()=>[{no:1,name:"participants",kind:"message",T:it,repeated:!0}]);class lt extends ie{constructor(e){super(),this.trackSids=[],this.subscribe=!1,this.participantTracks=[],R.util.initPartial(e,this)}static fromBinary(e,t){return new lt().fromBinary(e,t)}static fromJson(e,t){return new lt().fromJson(e,t)}static fromJsonString(e,t){return new lt().fromJsonString(e,t)}static equals(e,t){return R.util.equals(lt,e,t)}}lt.runtime=R;lt.typeName="livekit.UpdateSubscription";lt.fields=R.util.newFieldList(()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:Ut,repeated:!0}]);class Vt extends ie{constructor(e){super(),this.trackSids=[],this.disabled=!1,this.quality=Oe.LOW,this.width=0,this.height=0,this.fps=0,this.priority=0,R.util.initPartial(e,this)}static fromBinary(e,t){return new Vt().fromBinary(e,t)}static fromJson(e,t){return new Vt().fromJson(e,t)}static fromJsonString(e,t){return new Vt().fromJsonString(e,t)}static equals(e,t){return R.util.equals(Vt,e,t)}}Vt.runtime=R;Vt.typeName="livekit.UpdateTrackSettings";Vt.fields=R.util.newFieldList(()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:R.getEnumType(Oe)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]);class ht extends ie{constructor(e){super(),this.canReconnect=!1,this.reason=Ai.UNKNOWN_REASON,R.util.initPartial(e,this)}static fromBinary(e,t){return new ht().fromBinary(e,t)}static fromJson(e,t){return new ht().fromJson(e,t)}static fromJsonString(e,t){return new ht().fromJsonString(e,t)}static equals(e,t){return R.util.equals(ht,e,t)}}ht.runtime=R;ht.typeName="livekit.LeaveRequest";ht.fields=R.util.newFieldList(()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:R.getEnumType(Ai)}]);class Jt extends ie{constructor(e){super(),this.trackSid="",this.layers=[],R.util.initPartial(e,this)}static fromBinary(e,t){return new Jt().fromBinary(e,t)}static fromJson(e,t){return new Jt().fromJson(e,t)}static fromJsonString(e,t){return new Jt().fromJsonString(e,t)}static equals(e,t){return R.util.equals(Jt,e,t)}}Jt.runtime=R;Jt.typeName="livekit.UpdateVideoLayers";Jt.fields=R.util.newFieldList(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:Je,repeated:!0}]);class $t extends ie{constructor(e){super(),this.metadata="",this.name="",R.util.initPartial(e,this)}static fromBinary(e,t){return new $t().fromBinary(e,t)}static fromJson(e,t){return new $t().fromJson(e,t)}static fromJsonString(e,t){return new $t().fromJsonString(e,t)}static equals(e,t){return R.util.equals($t,e,t)}}$t.runtime=R;$t.typeName="livekit.UpdateParticipantMetadata";$t.fields=R.util.newFieldList(()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9}]);class zt extends ie{constructor(e){super(),this.urls=[],this.username="",this.credential="",R.util.initPartial(e,this)}static fromBinary(e,t){return new zt().fromBinary(e,t)}static fromJson(e,t){return new zt().fromJson(e,t)}static fromJsonString(e,t){return new zt().fromJsonString(e,t)}static equals(e,t){return R.util.equals(zt,e,t)}}zt.runtime=R;zt.typeName="livekit.ICEServer";zt.fields=R.util.newFieldList(()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]);class yi extends ie{constructor(e){super(),this.speakers=[],R.util.initPartial(e,this)}static fromBinary(e,t){return new yi().fromBinary(e,t)}static fromJson(e,t){return new yi().fromJson(e,t)}static fromJsonString(e,t){return new yi().fromJsonString(e,t)}static equals(e,t){return R.util.equals(yi,e,t)}}yi.runtime=R;yi.typeName="livekit.SpeakersChanged";yi.fields=R.util.newFieldList(()=>[{no:1,name:"speakers",kind:"message",T:Nt,repeated:!0}]);class Si extends ie{constructor(e){super(),R.util.initPartial(e,this)}static fromBinary(e,t){return new Si().fromBinary(e,t)}static fromJson(e,t){return new Si().fromJson(e,t)}static fromJsonString(e,t){return new Si().fromJsonString(e,t)}static equals(e,t){return R.util.equals(Si,e,t)}}Si.runtime=R;Si.typeName="livekit.RoomUpdate";Si.fields=R.util.newFieldList(()=>[{no:1,name:"room",kind:"message",T:Yr}]);class Ci extends ie{constructor(e){super(),this.participantSid="",this.quality=ci.POOR,this.score=0,R.util.initPartial(e,this)}static fromBinary(e,t){return new Ci().fromBinary(e,t)}static fromJson(e,t){return new Ci().fromJson(e,t)}static fromJsonString(e,t){return new Ci().fromJsonString(e,t)}static equals(e,t){return R.util.equals(Ci,e,t)}}Ci.runtime=R;Ci.typeName="livekit.ConnectionQualityInfo";Ci.fields=R.util.newFieldList(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:R.getEnumType(ci)},{no:3,name:"score",kind:"scalar",T:2}]);class wi extends ie{constructor(e){super(),this.updates=[],R.util.initPartial(e,this)}static fromBinary(e,t){return new wi().fromBinary(e,t)}static fromJson(e,t){return new wi().fromJson(e,t)}static fromJsonString(e,t){return new wi().fromJsonString(e,t)}static equals(e,t){return R.util.equals(wi,e,t)}}wi.runtime=R;wi.typeName="livekit.ConnectionQualityUpdate";wi.fields=R.util.newFieldList(()=>[{no:1,name:"updates",kind:"message",T:Ci,repeated:!0}]);class ki extends ie{constructor(e){super(),this.participantSid="",this.trackSid="",this.state=vr.ACTIVE,R.util.initPartial(e,this)}static fromBinary(e,t){return new ki().fromBinary(e,t)}static fromJson(e,t){return new ki().fromJson(e,t)}static fromJsonString(e,t){return new ki().fromJsonString(e,t)}static equals(e,t){return R.util.equals(ki,e,t)}}ki.runtime=R;ki.typeName="livekit.StreamStateInfo";ki.fields=R.util.newFieldList(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:R.getEnumType(vr)}]);class Ti extends ie{constructor(e){super(),this.streamStates=[],R.util.initPartial(e,this)}static fromBinary(e,t){return new Ti().fromBinary(e,t)}static fromJson(e,t){return new Ti().fromJson(e,t)}static fromJsonString(e,t){return new Ti().fromJsonString(e,t)}static equals(e,t){return R.util.equals(Ti,e,t)}}Ti.runtime=R;Ti.typeName="livekit.StreamStateUpdate";Ti.fields=R.util.newFieldList(()=>[{no:1,name:"stream_states",kind:"message",T:ki,repeated:!0}]);class kt extends ie{constructor(e){super(),this.quality=Oe.LOW,this.enabled=!1,R.util.initPartial(e,this)}static fromBinary(e,t){return new kt().fromBinary(e,t)}static fromJson(e,t){return new kt().fromJson(e,t)}static fromJsonString(e,t){return new kt().fromJsonString(e,t)}static equals(e,t){return R.util.equals(kt,e,t)}}kt.runtime=R;kt.typeName="livekit.SubscribedQuality";kt.fields=R.util.newFieldList(()=>[{no:1,name:"quality",kind:"enum",T:R.getEnumType(Oe)},{no:2,name:"enabled",kind:"scalar",T:8}]);class Ei extends ie{constructor(e){super(),this.codec="",this.qualities=[],R.util.initPartial(e,this)}static fromBinary(e,t){return new Ei().fromBinary(e,t)}static fromJson(e,t){return new Ei().fromJson(e,t)}static fromJsonString(e,t){return new Ei().fromJsonString(e,t)}static equals(e,t){return R.util.equals(Ei,e,t)}}Ei.runtime=R;Ei.typeName="livekit.SubscribedCodec";Ei.fields=R.util.newFieldList(()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:kt,repeated:!0}]);class Pi extends ie{constructor(e){super(),this.trackSid="",this.subscribedQualities=[],this.subscribedCodecs=[],R.util.initPartial(e,this)}static fromBinary(e,t){return new Pi().fromBinary(e,t)}static fromJson(e,t){return new Pi().fromJson(e,t)}static fromJsonString(e,t){return new Pi().fromJsonString(e,t)}static equals(e,t){return R.util.equals(Pi,e,t)}}Pi.runtime=R;Pi.typeName="livekit.SubscribedQualityUpdate";Pi.fields=R.util.newFieldList(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:kt,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:Ei,repeated:!0}]);class Kt extends ie{constructor(e){super(),this.participantSid="",this.allTracks=!1,this.trackSids=[],this.participantIdentity="",R.util.initPartial(e,this)}static fromBinary(e,t){return new Kt().fromBinary(e,t)}static fromJson(e,t){return new Kt().fromJson(e,t)}static fromJsonString(e,t){return new Kt().fromJsonString(e,t)}static equals(e,t){return R.util.equals(Kt,e,t)}}Kt.runtime=R;Kt.typeName="livekit.TrackPermission";Kt.fields=R.util.newFieldList(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]);class Gt extends ie{constructor(e){super(),this.allParticipants=!1,this.trackPermissions=[],R.util.initPartial(e,this)}static fromBinary(e,t){return new Gt().fromBinary(e,t)}static fromJson(e,t){return new Gt().fromJson(e,t)}static fromJsonString(e,t){return new Gt().fromJsonString(e,t)}static equals(e,t){return R.util.equals(Gt,e,t)}}Gt.runtime=R;Gt.typeName="livekit.SubscriptionPermission";Gt.fields=R.util.newFieldList(()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:Kt,repeated:!0}]);class Ri extends ie{constructor(e){super(),this.participantSid="",this.trackSid="",this.allowed=!1,R.util.initPartial(e,this)}static fromBinary(e,t){return new Ri().fromBinary(e,t)}static fromJson(e,t){return new Ri().fromJson(e,t)}static fromJsonString(e,t){return new Ri().fromJsonString(e,t)}static equals(e,t){return R.util.equals(Ri,e,t)}}Ri.runtime=R;Ri.typeName="livekit.SubscriptionPermissionUpdate";Ri.fields=R.util.newFieldList(()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]);class Xt extends ie{constructor(e){super(),this.publishTracks=[],this.dataChannels=[],R.util.initPartial(e,this)}static fromBinary(e,t){return new Xt().fromBinary(e,t)}static fromJson(e,t){return new Xt().fromJson(e,t)}static fromJsonString(e,t){return new Xt().fromJsonString(e,t)}static equals(e,t){return R.util.equals(Xt,e,t)}}Xt.runtime=R;Xt.typeName="livekit.SyncState";Xt.fields=R.util.newFieldList(()=>[{no:1,name:"answer",kind:"message",T:$e},{no:2,name:"subscription",kind:"message",T:lt},{no:3,name:"publish_tracks",kind:"message",T:wt,repeated:!0},{no:4,name:"data_channels",kind:"message",T:Qt,repeated:!0},{no:5,name:"offer",kind:"message",T:$e}]);class Qt extends ie{constructor(e){super(),this.label="",this.id=0,this.target=je.PUBLISHER,R.util.initPartial(e,this)}static fromBinary(e,t){return new Qt().fromBinary(e,t)}static fromJson(e,t){return new Qt().fromJson(e,t)}static fromJsonString(e,t){return new Qt().fromJsonString(e,t)}static equals(e,t){return R.util.equals(Qt,e,t)}}Qt.runtime=R;Qt.typeName="livekit.DataChannelInfo";Qt.fields=R.util.newFieldList(()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:R.getEnumType(je)}]);class Le extends ie{constructor(e){super(),this.scenario={case:void 0},R.util.initPartial(e,this)}static fromBinary(e,t){return new Le().fromBinary(e,t)}static fromJson(e,t){return new Le().fromJson(e,t)}static fromJsonString(e,t){return new Le().fromJsonString(e,t)}static equals(e,t){return R.util.equals(Le,e,t)}}Le.runtime=R;Le.typeName="livekit.SimulateScenario";Le.fields=R.util.newFieldList(()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:R.getEnumType(fs),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"}]);class Yt extends ie{constructor(e){super(),this.timestamp=ce.zero,this.rtt=ce.zero,R.util.initPartial(e,this)}static fromBinary(e,t){return new Yt().fromBinary(e,t)}static fromJson(e,t){return new Yt().fromJson(e,t)}static fromJsonString(e,t){return new Yt().fromJsonString(e,t)}static equals(e,t){return R.util.equals(Yt,e,t)}}Yt.runtime=R;Yt.typeName="livekit.Ping";Yt.fields=R.util.newFieldList(()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]);class xi extends ie{constructor(e){super(),this.lastPingTimestamp=ce.zero,this.timestamp=ce.zero,R.util.initPartial(e,this)}static fromBinary(e,t){return new xi().fromBinary(e,t)}static fromJson(e,t){return new xi().fromJson(e,t)}static fromJsonString(e,t){return new xi().fromJsonString(e,t)}static equals(e,t){return R.util.equals(xi,e,t)}}xi.runtime=R;xi.typeName="livekit.Pong";xi.fields=R.util.newFieldList(()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]);class er extends ie{constructor(e){super(),this.regions=[],R.util.initPartial(e,this)}static fromBinary(e,t){return new er().fromBinary(e,t)}static fromJson(e,t){return new er().fromJson(e,t)}static fromJsonString(e,t){return new er().fromJsonString(e,t)}static equals(e,t){return R.util.equals(er,e,t)}}er.runtime=R;er.typeName="livekit.RegionSettings";er.fields=R.util.newFieldList(()=>[{no:1,name:"regions",kind:"message",T:Oi,repeated:!0}]);class Oi extends ie{constructor(e){super(),this.region="",this.url="",this.distance=ce.zero,R.util.initPartial(e,this)}static fromBinary(e,t){return new Oi().fromBinary(e,t)}static fromJson(e,t){return new Oi().fromJson(e,t)}static fromJsonString(e,t){return new Oi().fromJsonString(e,t)}static equals(e,t){return R.util.equals(Oi,e,t)}}Oi.runtime=R;Oi.typeName="livekit.RegionInfo";Oi.fields=R.util.newFieldList(()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]);class Di extends ie{constructor(e){super(),this.trackSid="",this.err=wn.SE_UNKNOWN,R.util.initPartial(e,this)}static fromBinary(e,t){return new Di().fromBinary(e,t)}static fromJson(e,t){return new Di().fromJson(e,t)}static fromJsonString(e,t){return new Di().fromJsonString(e,t)}static equals(e,t){return R.util.equals(Di,e,t)}}Di.runtime=R;Di.typeName="livekit.SubscriptionResponse";Di.fields=R.util.newFieldList(()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:R.getEnumType(wn)}]);function Gf(i){if(!(typeof i>"u"))return typeof structuredClone=="function"?structuredClone(i):JSON.parse(JSON.stringify(i))}const Xf=5e3,un=[];class W extends ii.EventEmitter{constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var n;super(),this.attachedElements=[],this.isMuted=!1,this.streamState=W.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=he,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),Xf):this.handleAppVisibilityChanged()},this.log=Mi((n=r.loggerName)!==null&&n!==void 0?n:Zt.Track),this.loggerContextCb=r.loggerContextCb,this.setMaxListeners(100),this.kind=t,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=W.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),_e(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let t="audio";this.kind===W.Kind.Video&&(t="video"),this.attachedElements.length===0&&W.Kind.Video&&this.addAppVisibilityListener(),e||(t==="audio"&&(un.forEach(o=>{o.parentElement===null&&!e&&(e=o)}),e&&un.splice(un.indexOf(e),1)),e||(e=document.createElement(t))),this.attachedElements.includes(e)||this.attachedElements.push(e),Pr(this.mediaStreamTrack,e);const r=e.srcObject.getTracks(),n=r.some(o=>o.kind==="audio");return e.play().then(()=>{this.emit(n?ee.AudioPlaybackStarted:ee.VideoPlaybackStarted)}).catch(o=>{o.name==="NotAllowedError"?this.emit(n?ee.AudioPlaybackFailed:ee.VideoPlaybackFailed,o):o.name==="AbortError"?he.debug("".concat(n?"audio":"video"," playback aborted, likely due to new play request")):he.warn("could not playback ".concat(n?"audio":"video"),o),n&&e&&r.some(a=>a.kind==="video")&&o.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(ee.ElementAttached,e),e}detach(e){try{if(e){Or(this.mediaStreamTrack,e);const r=this.attachedElements.indexOf(e);return r>=0&&(this.attachedElements.splice(r,1),this.recycleElement(e),this.emit(ee.ElementDetached,e)),e}const t=[];return this.attachedElements.forEach(r=>{Or(this.mediaStreamTrack,r),t.push(r),this.recycleElement(r),this.emit(ee.ElementDetached,r)}),this.attachedElements=[],t}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval)}updateLoggerOptions(e){e.loggerName&&(this.log=Mi(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let t=!0;e.pause(),un.forEach(r=>{r.parentElement||(t=!1)}),t&&un.push(e)}}handleAppVisibilityChanged(){return N(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden"})}addAppVisibilityListener(){Ye()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){Ye()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function Pr(i,e){let t;e.srcObject instanceof MediaStream?t=e.srcObject:t=new MediaStream;let r;i.kind==="audio"?r=t.getAudioTracks():r=t.getVideoTracks(),r.includes(i)||(r.forEach(n=>{t.removeTrack(n)}),t.addTrack(i)),(!_r()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=t.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==t&&(e.srcObject=t,(_r()||$r())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=t,e.play().catch(()=>{})},0))}function Or(i,e){if(e.srcObject instanceof MediaStream){const t=e.srcObject;t.removeTrack(i),t.getTracks().length>0?e.srcObject=t:e.srcObject=null}}(function(i){let e;(function(l){l.Audio="audio",l.Video="video",l.Unknown="unknown"})(e=i.Kind||(i.Kind={}));let t;(function(l){l.Camera="camera",l.Microphone="microphone",l.ScreenShare="screen_share",l.ScreenShareAudio="screen_share_audio",l.Unknown="unknown"})(t=i.Source||(i.Source={}));let r;(function(l){l.Active="active",l.Paused="paused",l.Unknown="unknown"})(r=i.StreamState||(i.StreamState={}));function n(l){switch(l){case e.Audio:return Ue.AUDIO;case e.Video:return Ue.VIDEO;default:return Ue.DATA}}i.kindToProto=n;function o(l){switch(l){case Ue.AUDIO:return e.Audio;case Ue.VIDEO:return e.Video;default:return e.Unknown}}i.kindFromProto=o;function a(l){switch(l){case t.Camera:return Te.CAMERA;case t.Microphone:return Te.MICROPHONE;case t.ScreenShare:return Te.SCREEN_SHARE;case t.ScreenShareAudio:return Te.SCREEN_SHARE_AUDIO;default:return Te.UNKNOWN}}i.sourceToProto=a;function s(l){switch(l){case Te.CAMERA:return t.Camera;case Te.MICROPHONE:return t.Microphone;case Te.SCREEN_SHARE:return t.ScreenShare;case Te.SCREEN_SHARE_AUDIO:return t.ScreenShareAudio;default:return t.Unknown}}i.sourceFromProto=s;function c(l){switch(l){case vr.ACTIVE:return r.Active;case vr.PAUSED:return r.Paused;default:return r.Unknown}}i.streamStateFromProto=c})(W||(W={}));function Fh(i,e,t){var r;const n=(r=Gf(i))!==null&&r!==void 0?r:{};return n.audio===!0&&(n.audio={}),n.video===!0&&(n.video={}),n.audio&&jo(n.audio,e),n.video&&jo(n.video,t),n}function jo(i,e){return Object.keys(e).forEach(t=>{i[t]===void 0&&(i[t]=e[t])}),i}function Ls(i){const e={};if(i.video)if(typeof i.video=="object"){const t={},r=t,n=i.video;Object.keys(n).forEach(o=>{switch(o){case"resolution":jo(r,n.resolution);break;default:r[o]=n[o]}}),e.video=t}else e.video=i.video;else e.video=!1;return i.audio?typeof i.audio=="object"?e.audio=i.audio:e.audio=!0:e.audio=!1,e}function Qf(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return N(this,void 0,void 0,function*(){const t=Uh();if(t){const r=t.createAnalyser();r.fftSize=2048;const n=r.frequencyBinCount,o=new Uint8Array(n);t.createMediaStreamSource(new MediaStream([i.mediaStreamTrack])).connect(r),yield Li(e),r.getByteTimeDomainData(o);const s=o.some(c=>c!==128&&c!==0);return t.close(),!s}return!1})}function Uh(){const i=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(i)return new i({latencyHint:"interactive"})}function Yf(i){return i===W.Source.Microphone?"audioinput":i===W.Source.Camera?"videoinput":void 0}function Zf(i){var e,t;let r=(e=i.video)!==null&&e!==void 0?e:!0;return i.resolution&&i.resolution.width>0&&i.resolution.height>0&&(r=typeof r=="boolean"?{}:r,_r()?r=Object.assign(Object.assign({},r),{width:{max:i.resolution.width},height:{max:i.resolution.height},frameRate:i.resolution.frameRate}):r=Object.assign(Object.assign({},r),{width:{ideal:i.resolution.width},height:{ideal:i.resolution.height},frameRate:i.resolution.frameRate})),{audio:(t=i.audio)!==null&&t!==void 0?t:!1,video:r,controller:i.controller,selfBrowserSurface:i.selfBrowserSurface,surfaceSwitching:i.surfaceSwitching,systemAudio:i.systemAudio}}function jh(i){const e=i.split("/")[1].toLowerCase();if(!Nh.includes(e))throw Error("Video codec not supported: ".concat(e));return e}function ep(i){const e=[];return i.forEach(t=>{t.track!==void 0&&e.push(new wt({cid:t.track.mediaStreamID,track:t.trackInfo}))}),e}function _e(i){return i instanceof W?{trackSid:i.sid,trackSource:i.source,trackMuted:i.isMuted,trackEnabled:i.mediaStreamTrack.enabled,trackKind:i.kind}:{trackSid:i.trackSid,trackName:i.trackName,track:i.track?_e(i.track):void 0,trackEnabled:i.isEnabled,trackEncrypted:i.isEncrypted,trackMimeType:i.mimeType}}const tp="|",hc="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function ip(i){const e=i.split(tp);return e.length>1?[e[0],i.substr(e[0].length+1)]:[i,""]}function Li(i){return N(this,void 0,void 0,function*(){return new Promise(e=>Me.setTimeout(e,i))})}function uc(){return"addTransceiver"in RTCPeerConnection.prototype}function dc(){return"addTrack"in RTCPeerConnection.prototype}function rp(){if(!("getCapabilities"in RTCRtpSender)||_r())return!1;const i=RTCRtpSender.getCapabilities("video");let e=!1;if(i){for(const t of i.codecs)if(t.mimeType==="video/AV1"){e=!0;break}}return e}function np(){if(!("getCapabilities"in RTCRtpSender)||$r())return!1;if(_r()){const t=Bi();if(t!=null&&t.version&&ya(t.version,"16")<0)return!1}const i=RTCRtpSender.getCapabilities("video");let e=!1;if(i){for(const t of i.codecs)if(t.mimeType==="video/VP9"){e=!0;break}}return e}function bn(i){return i==="av1"||i==="vp9"}function Ho(i){return document?(i||(i=document.createElement("audio")),"setSinkId"in i):!1}const sp={Chrome:"100",Safari:"15",Firefox:"100"};function op(i){if(!Ye()||!("setCodecPreferences"in i))return!1;const e=Bi();if(!(e!=null&&e.name)||!e.version)return!1;const t=sp[e.name];return t?ya(e.version,t)>=0:!1}function $r(){var i;return((i=Bi())===null||i===void 0?void 0:i.name)==="Firefox"}function ap(){var i;return((i=Bi())===null||i===void 0?void 0:i.name)==="Chrome"}function _r(){var i;return((i=Bi())===null||i===void 0?void 0:i.name)==="Safari"}function cp(){const i=Bi();return(i==null?void 0:i.name)==="Safari"&&i.version.startsWith("17.")}function Hh(){return Ye()?/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function Ye(){return typeof document<"u"}function br(){return navigator.product=="ReactNative"}function Wo(i){return i.hostname.endsWith(".livekit.cloud")||i.hostname.endsWith(".livekit.run")}function Wh(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function qh(){if(!br())return;let i=Wh();if(i)return i.platform}function fc(){if(Ye())return window.devicePixelRatio;if(br()){let i=Wh();if(i)return i.devicePixelRatio}return 1}function ya(i,e){const t=i.split("."),r=e.split("."),n=Math.min(t.length,r.length);for(let o=0;o<n;++o){const a=parseInt(t[o],10),s=parseInt(r[o],10);if(a>s)return 1;if(a<s)return-1;if(o===n-1&&a===s)return 0}return i===""&&e!==""?-1:e===""?1:t.length==r.length?0:t.length<r.length?-1:1}function lp(i){for(const e of i)e.target.handleResize(e)}function hp(i){for(const e of i)e.target.handleVisibilityChanged(e)}let oo=null;const pc=()=>(oo||(oo=new ResizeObserver(lp)),oo);let ao=null;const mc=()=>(ao||(ao=new IntersectionObserver(hp,{root:null,rootMargin:"0px"})),ao);function up(){var i;const e=new fi({sdk:Jr.JS,protocol:$f,version:Jf});return br()&&(e.os=(i=qh())!==null&&i!==void 0?i:""),e}function gc(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const n=document.createElement("canvas");n.width=i,n.height=e;const o=n.getContext("2d");o==null||o.fillRect(0,0,n.width,n.height),r&&o&&(o.beginPath(),o.arc(i/2,e/2,50,0,Math.PI*2,!0),o.closePath(),o.fillStyle="grey",o.fill());const a=n.captureStream(),[s]=a.getTracks();if(!s)throw Error("Could not get empty media stream video track");return s.enabled=t,s}let dn;function co(){if(!dn){const i=new AudioContext,e=i.createOscillator(),t=i.createGain();t.gain.setValueAtTime(0,0);const r=i.createMediaStreamDestination();if(e.connect(t),t.connect(r),e.start(),[dn]=r.stream.getAudioTracks(),!dn)throw Error("Could not get empty media stream audio track");dn.enabled=!1}return dn.clone()}class Vh{constructor(e,t){this.onFinally=t,this.promise=new Promise((r,n)=>N(this,void 0,void 0,function*(){this.resolve=r,this.reject=n,e&&(yield e(r,n))})).finally(()=>{var r;return(r=this.onFinally)===null||r===void 0?void 0:r.call(this)})}}class Tt{constructor(){this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const t=new Promise(n=>e=()=>{this._locks-=1,n()}),r=this._locking.then(()=>e);return this._locking=this._locking.then(()=>t),r}}function dp(i){return Nh.includes(i)}function pr(i){if(typeof i=="string")return i;if(Array.isArray(i))return i[0];if(i.exact)return Array.isArray(i.exact)?i.exact[0]:i.exact;if(i.ideal)return Array.isArray(i.ideal)?i.ideal[0]:i.ideal;throw Error("could not unwrap constraint")}function fp(i){return i.startsWith("http")?i.replace(/^(http)/,"ws"):i}function vc(i){return i.startsWith("ws")?i.replace(/^(ws)/,"http"):i}const _c="default";class qe{static getInstance(){return this.instance===void 0&&(this.instance=new qe),this.instance}getDevices(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;var r;return N(this,void 0,void 0,function*(){if(((r=qe.userMediaPromiseMap)===null||r===void 0?void 0:r.size)>0){he.debug("awaiting getUserMedia promise");try{e?yield qe.userMediaPromiseMap.get(e):yield Promise.all(qe.userMediaPromiseMap.values())}catch{he.warn("error waiting for media permissons")}}let n=yield navigator.mediaDevices.enumerateDevices();if(t&&!(_r()&&this.hasDeviceInUse(e))&&(n.length===0||n.some(a=>{const s=a.label==="",c=e?a.kind===e:!0;return s&&c}))){const a={video:e!=="audioinput"&&e!=="audiooutput",audio:e!=="videoinput"},s=yield navigator.mediaDevices.getUserMedia(a);n=yield navigator.mediaDevices.enumerateDevices(),s.getTracks().forEach(c=>{c.stop()})}return e&&(n=n.filter(o=>o.kind===e)),n})}normalizeDeviceId(e,t,r){return N(this,void 0,void 0,function*(){if(t!==_c)return t;const o=(yield this.getDevices(e)).find(a=>a.groupId===r&&a.deviceId!==_c);return o==null?void 0:o.deviceId})}hasDeviceInUse(e){return e?qe.userMediaPromiseMap.has(e):qe.userMediaPromiseMap.size>0}}qe.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];qe.userMediaPromiseMap=new Map;const pp=1e3;class zr extends W{get constraints(){return this._constraints}constructor(e,t,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=arguments.length>4?arguments[4]:void 0;super(e,t,o),this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=_a(()=>N(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>N(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(ee.Ended,this)},this.reacquireTrack=!1,this.providedByUser=n,this.muteLock=new Tt,this.pauseUpstreamLock=new Tt,this.processorLock=new Tt,this.setMediaStreamTrack(e,!0),this._constraints=e.getConstraints(),r&&(this._constraints=r)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==W.Kind.Video)return;const{width:e,height:t}=this._mediaStreamTrack.getSettings();if(e&&t)return{width:e,height:t}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,t;return(t=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&t!==void 0?t:this._mediaStreamTrack}setMediaStreamTrack(e,t){return N(this,void 0,void 0,function*(){if(e===this._mediaStreamTrack&&!t)return;this._mediaStreamTrack&&(this.attachedElements.forEach(n=>{Or(this._mediaStreamTrack,n)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let r;if(this.processor&&e&&this.processorElement){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");Pr(e,this.processorElement),this.processorElement.muted=!0,yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),r=this.processor.processedTrack}this.sender&&(yield this.sender.replaceTrack(r??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(n=>{Pr(r??e,n)}))})}waitForDimensions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:pp;var t;return N(this,void 0,void 0,function*(){if(this.kind===W.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((t=Bi())===null||t===void 0?void 0:t.os)==="iOS"&&(yield Li(10));const r=Date.now();for(;Date.now()-r<e;){const n=this.dimensions;if(n)return n;yield Li(50)}throw new Mt("unable to get track dimensions after timeout")})}getDeviceId(){return N(this,void 0,void 0,function*(){if(this.source===W.Source.ScreenShare)return;const{deviceId:e,groupId:t}=this._mediaStreamTrack.getSettings(),r=this.kind===W.Kind.Audio?"audioinput":"videoinput";return qe.getInstance().normalizeDeviceId(r,e,t)})}mute(){return N(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return N(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return N(this,void 0,void 0,function*(){if(!this.sender)throw new Mt("unable to replace an unpublished track");return this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),this.providedByUser=t,this.processor&&(yield this.stopProcessor()),this})}restart(e){return N(this,void 0,void 0,function*(){e||(e=this._constraints),this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const t={audio:!1,video:!1};this.kind===W.Kind.Video?t.video=e:t.audio=e,this.attachedElements.forEach(o=>{Or(this.mediaStreamTrack,o)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const n=(yield navigator.mediaDevices.getUserMedia(t)).getTracks()[0];return n.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(n),this._constraints=e,this.emit(ee.Restarted,this),this})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?ee.Muted:ee.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return N(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),Hh()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return N(this,void 0,void 0,function*(){const e=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(ee.UpstreamPaused,this);const t=Bi();if((t==null?void 0:t.name)==="Safari"&&ya(t.version,"12.0")<0)throw new va("pauseUpstream is not supported on Safari < 12.");yield this.sender.replaceTrack(null)}finally{e()}})}resumeUpstream(){return N(this,void 0,void 0,function*(){const e=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(ee.UpstreamResumed,this),yield this.sender.replaceTrack(this._mediaStreamTrack)}finally{e()}})}getRTCStatsReport(){var e;return N(this,void 0,void 0,function*(){return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;var r,n;return N(this,void 0,void 0,function*(){const o=yield this.processorLock.lock();try{if(this.log.debug("setting up processor",this.logContext),this.processor&&(yield this.stopProcessor()),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement=(r=this.processorElement)!==null&&r!==void 0?r:document.createElement(this.kind),Pr(this._mediaStreamTrack,this.processorElement),this.processorElement.muted=!0,this.processorElement.play().catch(s=>this.log.error("failed to play processor element",Object.assign(Object.assign({},this.logContext),{error:s})));const a={kind:this.kind,track:this._mediaStreamTrack,element:this.processorElement};if(yield e.init(a),this.processor=e,this.processor.processedTrack){for(const s of this.attachedElements)s!==this.processorElement&&t&&(Or(this._mediaStreamTrack,s),Pr(this.processor.processedTrack,s));yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack)}}finally{o()}})}getProcessor(){return this.processor}stopProcessor(){var e,t;return N(this,void 0,void 0,function*(){this.processor&&(this.log.debug("stopping processor",this.logContext),(e=this.processor.processedTrack)===null||e===void 0||e.stop(),yield this.processor.destroy(),this.processor=void 0,(t=this.processorElement)===null||t===void 0||t.remove(),this.processorElement=void 0,yield this.restart())})}}class mp extends ii.EventEmitter{constructor(e){super(),this.onWorkerMessage=t=>{var r,n;const{kind:o,data:a}=t.data;switch(o){case"error":he.error(a.error.message),this.emit(Zi.EncryptionError,a.error);break;case"initAck":a.enabled&&this.keyProvider.getKeys().forEach(s=>{this.postKey(s)});break;case"enable":if(this.encryptionEnabled!==a.enabled&&a.participantIdentity===((r=this.room)===null||r===void 0?void 0:r.localParticipant.identity))this.emit(Zi.ParticipantEncryptionStatusChanged,a.enabled,this.room.localParticipant),this.encryptionEnabled=a.enabled;else if(a.participantIdentity){const s=(n=this.room)===null||n===void 0?void 0:n.getParticipantByIdentity(a.participantIdentity);if(!s)throw TypeError("couldn't set encryption status, participant not found".concat(a.participantIdentity));this.emit(Zi.ParticipantEncryptionStatusChanged,a.enabled,s)}this.encryptionEnabled&&this.keyProvider.getKeys().forEach(s=>{this.postKey(s)});break;case"ratchetKey":this.keyProvider.emit(tr.KeyRatcheted,a.material,a.keyIndex);break}},this.onWorkerError=t=>{he.error("e2ee worker encountered an error:",{error:t.error}),this.emit(Zi.EncryptionError,t.error)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1}setup(e){if(!Uf())throw new va("tried to setup end-to-end encryption on an unsupported browser");if(he.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const t={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions()}};this.worker&&(he.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(t))}}setParticipantCryptorEnabled(e,t){he.debug("set e2ee to ".concat(e," for participant ").concat(t)),this.postEnable(e,t)}setSifTrailer(e){!e||e.length===0?he.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(re.RTPVideoMapUpdate,t=>{this.postRTPMap(t)})}setupEventListeners(e,t){e.on($.TrackPublished,(r,n)=>this.setParticipantCryptorEnabled(r.trackInfo.encryption!==Ie.NONE,n.identity)),e.on($.ConnectionStateChanged,r=>{r===fe.Connected&&e.participants.forEach(n=>{n.tracks.forEach(o=>{this.setParticipantCryptorEnabled(o.trackInfo.encryption!==Ie.NONE,n.identity)})})}).on($.TrackUnsubscribed,(r,n,o)=>{var a;const s={kind:"removeTransform",data:{participantIdentity:o.identity,trackId:r.mediaStreamID}};(a=this.worker)===null||a===void 0||a.postMessage(s)}).on($.TrackSubscribed,(r,n,o)=>{this.setupE2EEReceiver(r,o.identity,n.trackInfo)}).on($.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity),t.getKeys().forEach(r=>{this.postKey(r)})}),e.localParticipant.on(G.LocalTrackPublished,r=>N(this,void 0,void 0,function*(){this.setupE2EESender(r.track,r.track.sender)})),t.on(tr.SetKey,r=>this.postKey(r)).on(tr.RatchetRequest,(r,n)=>this.postRatchetRequest(r,n))}postRatchetRequest(e,t){if(!this.worker)throw Error("could not ratchet key, worker is missing");const r={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:t}};this.worker.postMessage(r)}postKey(e){let{key:t,participantIdentity:r,keyIndex:n}=e;var o;if(!this.worker)throw Error("could not set key, worker is missing");const a={kind:"setKey",data:{participantIdentity:r,isPublisher:r===((o=this.room)===null||o===void 0?void 0:o.localParticipant.identity),key:t,keyIndex:n}};this.worker.postMessage(a)}postEnable(e,t){if(this.worker){const r={kind:"enable",data:{enabled:e,participantIdentity:t}};this.worker.postMessage(r)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var t;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((t=this.room)===null||t===void 0)&&t.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const r={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(r)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const t={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(t)}setupE2EEReceiver(e,t,r){if(e.receiver){if(!(r!=null&&r.mimeType)||r.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,t,e.kind==="video"?jh(r.mimeType):void 0)}}setupE2EESender(e,t){if(!(e instanceof zr)||!t){t||he.warn("early return because sender is not ready");return}this.handleSender(t,e.mediaStreamID,void 0)}handleReceiver(e,t,r,n){return N(this,void 0,void 0,function*(){if(this.worker){if(No()){const o={kind:"decode",participantIdentity:r,trackId:t,codec:n};e.transform=new RTCRtpScriptTransform(this.worker,o)}else{if(Wn in e&&n){const c={kind:"updateCodec",data:{trackId:t,codec:n,participantIdentity:r}};this.worker.postMessage(c);return}let o=e.writableStream,a=e.readableStream;if(!o||!a){const c=e.createEncodedStreams();e.writableStream=c.writable,o=c.writable,e.readableStream=c.readable,a=c.readable}const s={kind:"decode",data:{readableStream:a,writableStream:o,trackId:t,codec:n,participantIdentity:r}};this.worker.postMessage(s,[a,o])}e[Wn]=!0}})}handleSender(e,t,r){var n;if(!(Wn in e||!this.worker)){if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(No()){he.info("initialize script transform");const o={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:t,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,o)}else{he.info("initialize encoded streams");const o=e.createEncodedStreams(),a={kind:"encode",data:{readableStream:o.readable,writableStream:o.writable,codec:r,trackId:t,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(a,[o.readable,o.writable])}e[Wn]=!0}}}var yn;(function(i){i[i.WAITING=0]="WAITING",i[i.RUNNING=1]="RUNNING",i[i.COMPLETED=2]="COMPLETED"})(yn||(yn={}));class gp{constructor(){this.pendingTasks=new Map,this.taskMutex=new Tt,this.nextTaskIndex=0}run(e){return N(this,void 0,void 0,function*(){const t={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:yn.WAITING};this.pendingTasks.set(t.id,t);const r=yield this.taskMutex.lock();try{return t.executedAt=Date.now(),t.status=yn.RUNNING,yield e()}finally{t.status=yn.COMPLETED,this.pendingTasks.delete(t.id),r()}})}flush(){return N(this,void 0,void 0,function*(){return this.run(()=>N(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}const vp=["syncState","trickle","offer","answer","simulate","leave"];function _p(i){const e=vp.indexOf(i.case)>=0;return he.trace("request allowed to bypass queue:",{canPass:e,req:i}),e}var we;(function(i){i[i.CONNECTING=0]="CONNECTING",i[i.CONNECTED=1]="CONNECTED",i[i.RECONNECTING=2]="RECONNECTING",i[i.DISCONNECTING=3]="DISCONNECTING",i[i.DISCONNECTED=4]="DISCONNECTED"})(we||(we={}));class Sa{get currentState(){return this.state}get isDisconnected(){return this.state===we.DISCONNECTING||this.state===we.DISCONNECTED}get isEstablishingConnection(){return this.state===we.CONNECTING||this.state===we.RECONNECTING}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var r;this.rtt=0,this.state=we.DISCONNECTED,this.log=he,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=Mi((r=t.loggerName)!==null&&r!==void 0?r:Zt.Signal),this.loggerContextCb=t.loggerContextCb,this.useJSON=e,this.requestQueue=new gp,this.queuedRequests=[],this.closingLock=new Tt,this.connectionLock=new Tt,this.state=we.DISCONNECTED}get logContext(){var e,t;return(t=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&t!==void 0?t:{}}join(e,t,r,n){return N(this,void 0,void 0,function*(){return this.state=we.CONNECTING,this.options=r,yield this.connect(e,t,r,n)})}reconnect(e,t,r,n){return N(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=we.RECONNECTING,this.clearPingInterval(),yield this.connect(e,t,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:r,reconnectReason:n}))})}connect(e,t,r,n){this.connectOptions=r,e=fp(e),e=e.replace(/\/$/,""),e+="/rtc";const o=up(),a=bp(t,o,r);return new Promise((s,c)=>N(this,void 0,void 0,function*(){const l=yield this.connectionLock.lock();try{const u=()=>N(this,void 0,void 0,function*(){this.close(),clearTimeout(h),c(new ge("room connection has been cancelled (signal)"))}),h=setTimeout(()=>{this.close(),c(new ge("room connection has timed out (signal)"))},r.websocketTimeout);n!=null&&n.aborted&&u(),n==null||n.addEventListener("abort",u),this.log.debug("connecting to ".concat(e+a),this.logContext),this.ws&&(yield this.close(!1)),this.ws=new WebSocket(e+a),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(h)},this.ws.onerror=g=>N(this,void 0,void 0,function*(){if(this.state!==we.CONNECTED){clearTimeout(h);try{const _=yield fetch("http".concat(e.substring(2),"/validate").concat(a));if(_.status.toFixed(0).startsWith("4")){const y=yield _.text();c(new ge(y,0,_.status))}else c(new ge("Internal error",2,_.status))}catch{c(new ge("server was not reachable",1))}return}this.handleWSError(g)}),this.ws.onmessage=g=>N(this,void 0,void 0,function*(){var _,y,v,f;let p;if(typeof g.data=="string"){const d=JSON.parse(g.data);p=qt.fromJson(d)}else if(g.data instanceof ArrayBuffer)p=qt.fromBinary(new Uint8Array(g.data));else{this.log.error("could not decode websocket message: ".concat(typeof g.data),this.logContext);return}if(this.state!==we.CONNECTED){let d=!1;if(((_=p.message)===null||_===void 0?void 0:_.case)==="join"?(this.state=we.CONNECTED,n==null||n.removeEventListener("abort",u),this.pingTimeoutDuration=p.message.value.pingTimeout,this.pingIntervalDuration=p.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),s(p.message.value)):this.state===we.RECONNECTING&&p.message.case!=="leave"?(this.state=we.CONNECTED,n==null||n.removeEventListener("abort",u),this.startPingInterval(),((y=p.message)===null||y===void 0?void 0:y.case)==="reconnect"?s((v=p.message)===null||v===void 0?void 0:v.value):(s(),d=!0)):this.isEstablishingConnection&&p.message.case==="leave"?c(new ge("Received leave request while trying to (re)connect",4)):r.reconnect||c(new ge("did not receive join response, got ".concat((f=p.message)===null||f===void 0?void 0:f.case," instead"))),!d)return}this.signalLatency&&(yield Li(this.signalLatency)),this.handleSignalResponse(p)}),this.ws.onclose=g=>{this.isEstablishingConnection&&c(new ge("Websocket got closed during a (re)connection attempt")),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:g.reason,state:this.state})),this.handleOnClose(g.reason)}}finally{l()}}))}close(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return N(this,void 0,void 0,function*(){const t=yield this.closingLock.lock();try{if(e&&(this.state=we.DISCONNECTING),this.ws){this.ws.onmessage=null,this.ws.onopen=null,this.ws.onclose=null;const r=new Promise(n=>{this.ws?this.ws.onclose=()=>{n()}:n()});this.ws.readyState<this.ws.CLOSING&&(this.ws.close(),yield Promise.race([r,Li(250)])),this.ws=void 0}}finally{e&&(this.state=we.DISCONNECTED),this.clearPingInterval(),t()}})}sendOffer(e){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:ps(e)})}sendAnswer(e){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:ps(e)})}sendIceCandidate(e,t){return this.log.trace("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new St({candidateInit:JSON.stringify(e),target:t})})}sendMuteTrack(e,t){return this.sendRequest({case:"mute",value:new Ct({sid:e,muted:t})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,t){return this.sendRequest({case:"updateMetadata",value:new $t({metadata:e,name:t})})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,t){return this.sendRequest({case:"updateLayers",value:new Jt({trackSid:e,layers:t})})}sendUpdateSubscriptionPermissions(e,t){return this.sendRequest({case:"subscriptionPermission",value:new Gt({allParticipants:e,trackPermissions:t})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:ce.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new Yt({timestamp:ce.parse(Date.now()),rtt:ce.parse(this.rtt)})})])}sendLeave(){return this.sendRequest({case:"leave",value:new ht({canReconnect:!1,reason:Ai.CLIENT_INITIATED})})}sendRequest(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return N(this,void 0,void 0,function*(){if(!t&&!_p(e)&&this.state===we.RECONNECTING){this.queuedRequests.push(()=>N(this,void 0,void 0,function*(){yield this.sendRequest(e,!0)}));return}if(t||(yield this.requestQueue.flush()),this.signalLatency&&(yield Li(this.signalLatency)),!this.ws||this.ws.readyState!==this.ws.OPEN){this.log.error("cannot send signal request before connected, type: ".concat(e==null?void 0:e.case),this.logContext);return}const n=new mi({message:e});try{this.useJSON?this.ws.send(n.toJsonString()):this.ws.send(n.toBinary())}catch(o){this.log.error("error sending signal message",Object.assign(Object.assign({},this.logContext),{error:o}))}})}handleSignalResponse(e){var t,r;const n=e.message;if(n==null){this.log.debug("received unsupported message",this.logContext);return}let o=!1;if(n.case==="answer"){const a=bc(n.value);this.onAnswer&&this.onAnswer(a)}else if(n.case==="offer"){const a=bc(n.value);this.onOffer&&this.onOffer(a)}else if(n.case==="trickle"){const a=JSON.parse(n.value.candidateInit);this.onTrickle&&this.onTrickle(a,n.value.target)}else n.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((t=n.value.participants)!==null&&t!==void 0?t:[]):n.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(n.value):n.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((r=n.value.speakers)!==null&&r!==void 0?r:[]):n.case==="leave"?this.onLeave&&this.onLeave(n.value):n.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(n.value.sid,n.value.muted):n.case==="roomUpdate"?this.onRoomUpdate&&n.value.room&&this.onRoomUpdate(n.value.room):n.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(n.value):n.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(n.value):n.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(n.value):n.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(n.value):n.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(n.value):n.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(n.value):n.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(n.value):n.case==="pong"||(n.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(n.value.lastPingTimestamp.toString()),this.resetPingTimeout(),o=!0):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:n.case})));o||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return N(this,void 0,void 0,function*(){if(this.state===we.DISCONNECTED)return;const t=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),t&&t(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=Me.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&Me.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=Me.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Me.clearInterval(this.pingInterval)}}function bc(i){const e={type:"offer",sdp:i.sdp};switch(i.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=i.type;break}return e}function ps(i){return new $e({sdp:i.sdp,type:i.type})}function bp(i,e,t){var r;const n=new URLSearchParams;return n.set("access_token",i),t.reconnect&&(n.set("reconnect","1"),t.sid&&n.set("sid",t.sid)),n.set("auto_subscribe",t.autoSubscribe?"1":"0"),n.set("sdk",br()?"reactnative":"js"),n.set("version",e.version),n.set("protocol",e.protocol.toString()),e.deviceModel&&n.set("device_model",e.deviceModel),e.os&&n.set("os",e.os),e.osVersion&&n.set("os_version",e.osVersion),e.browser&&n.set("browser",e.browser),e.browserVersion&&n.set("browser_version",e.browserVersion),t.publishOnly!==void 0&&n.set("publish",t.publishOnly),t.adaptiveStream&&n.set("adaptive_stream","1"),t.reconnectReason&&n.set("reconnect_reason",t.reconnectReason.toString()),!((r=navigator.connection)===null||r===void 0)&&r.type&&n.set("network",navigator.connection.type),"?".concat(n.toString())}var Jh={},$h={exports:{}},yc=$h.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(i){return i.encoding?"rtpmap:%d %s/%s/%s":i.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(i){return i.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(i){return i.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(i){return"extmap:%d"+(i.direction?"/%s":"%v")+(i["encrypt-uri"]?" %s":"%v")+" %s"+(i.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(i){return i.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(i){var e="candidate:%s %d %s %d %s %d typ %s";return e+=i.raddr!=null?" raddr %s rport %d":"%v%v",e+=i.tcptype!=null?" tcptype %s":"%v",i.generation!=null&&(e+=" generation %d"),e+=i["network-id"]!=null?" network-id %d":"%v",e+=i["network-cost"]!=null?" network-cost %d":"%v",e}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(i){var e="ssrc:%d";return i.attribute!=null&&(e+=" %s",i.value!=null&&(e+=":%s")),e}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(i){return i.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(i){return i.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(i){return"imageattr:%s %s %s"+(i.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(i){return"simulcast:%s %s"+(i.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(i){return"ts-refclk:%s"+(i.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(i){var e="mediaclk:";return e+=i.id!=null?"id=%s %s":"%v%s",e+=i.mediaClockValue!=null?"=%s":"",e+=i.rateNumerator!=null?" rate=%s":"",e+=i.rateDenominator!=null?"/%s":"",e}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(yc).forEach(function(i){var e=yc[i];e.forEach(function(t){t.reg||(t.reg=/(.*)/),t.format||(t.format="%s")})});var zh=$h.exports;(function(i){var e=function(s){return String(Number(s))===s?Number(s):s},t=function(s,c,l,u){if(u&&!l)c[u]=e(s[1]);else for(var h=0;h<l.length;h+=1)s[h+1]!=null&&(c[l[h]]=e(s[h+1]))},r=function(s,c,l){var u=s.name&&s.names;s.push&&!c[s.push]?c[s.push]=[]:u&&!c[s.name]&&(c[s.name]={});var h=s.push?{}:u?c[s.name]:c;t(l.match(s.reg),h,s.names,s.name),s.push&&c[s.push].push(h)},n=zh,o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);i.parse=function(s){var c={},l=[],u=c;return s.split(/(\r\n|\r|\n)/).filter(o).forEach(function(h){var g=h[0],_=h.slice(2);g==="m"&&(l.push({rtp:[],fmtp:[]}),u=l[l.length-1]);for(var y=0;y<(n[g]||[]).length;y+=1){var v=n[g][y];if(v.reg.test(_))return r(v,u,_)}}),c.media=l,c};var a=function(s,c){var l=c.split(/=(.+)/,2);return l.length===2?s[l[0]]=e(l[1]):l.length===1&&c.length>1&&(s[l[0]]=void 0),s};i.parseParams=function(s){return s.split(/;\s?/).reduce(a,{})},i.parseFmtpConfig=i.parseParams,i.parsePayloads=function(s){return s.toString().split(" ").map(Number)},i.parseRemoteCandidates=function(s){for(var c=[],l=s.split(" ").map(e),u=0;u<l.length;u+=3)c.push({component:l[u],ip:l[u+1],port:l[u+2]});return c},i.parseImageAttributes=function(s){return s.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(a,{})})},i.parseSimulcastStreamList=function(s){return s.split(";").map(function(c){return c.split(",").map(function(l){var u,h=!1;return l[0]!=="~"?u=e(l):(u=e(l.substring(1,l.length)),h=!0),{scid:u,paused:h}})})}})(Jh);var lo=zh,yp=/%[sdv%]/g,Sp=function(i){var e=1,t=arguments,r=t.length;return i.replace(yp,function(n){if(e>=r)return n;var o=t[e];switch(e+=1,n){case"%%":return"%";case"%s":return String(o);case"%d":return Number(o);case"%v":return""}})},fn=function(i,e,t){var r=e.format instanceof Function?e.format(e.push?t:t[e.name]):e.format,n=[i+"="+r];if(e.names)for(var o=0;o<e.names.length;o+=1){var a=e.names[o];e.name?n.push(t[e.name][a]):n.push(t[e.names[o]])}else n.push(t[e.name]);return Sp.apply(null,n)},Cp=["v","o","s","i","u","e","p","c","b","t","r","z","a"],wp=["i","c","b","a"],kp=function(i,e){e=e||{},i.version==null&&(i.version=0),i.name==null&&(i.name=" "),i.media.forEach(function(o){o.payloads==null&&(o.payloads="")});var t=e.outerOrder||Cp,r=e.innerOrder||wp,n=[];return t.forEach(function(o){lo[o].forEach(function(a){a.name in i&&i[a.name]!=null?n.push(fn(o,a,i)):a.push in i&&i[a.push]!=null&&i[a.push].forEach(function(s){n.push(fn(o,a,s))})})}),i.media.forEach(function(o){n.push(fn("m",lo.m[0],o)),r.forEach(function(a){lo[a].forEach(function(s){s.name in o&&o[s.name]!=null?n.push(fn(a,s,o)):s.push in o&&o[s.push]!=null&&o[s.push].forEach(function(c){n.push(fn(a,s,c))})})})}),n.join(`\r
`)+`\r
`},Tp=Jh,Ep=kp,ho=Ep,gn=Tp.parse;const Sc=.7,Dr={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class Cc extends ii.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var n;super(),this.log=he,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=_a(o=>N(this,void 0,void 0,function*(){this.emit(Dr.NegotiationStarted);try{yield this.createAndSendOffer()}catch(a){if(o)o(a);else throw a}}),100),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=Mi((n=r.loggerName)!==null&&n!==void 0?n:Zt.PCTransport),this.loggerOptions=r,this.config=e,this.mediaConstraints=t,this._pc=this.createPC()}createPC(){const e=ap()?new RTCPeerConnection(this.config,this.mediaConstraints):new RTCPeerConnection(this.config);return e.onicecandidate=t=>{var r;t.candidate&&((r=this.onIceCandidate)===null||r===void 0||r.call(this,t.candidate))},e.onicecandidateerror=t=>{var r;(r=this.onIceCandidateError)===null||r===void 0||r.call(this,t)},e.oniceconnectionstatechange=()=>{var t;(t=this.onIceConnectionStateChange)===null||t===void 0||t.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var t;(t=this.onSignalingStatechange)===null||t===void 0||t.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,e.connectionState)},e.ondatachannel=t=>{var r;(r=this.onDataChannel)===null||r===void 0||r.call(this,t)},e.ontrack=t=>{var r;(r=this.onTrack)===null||r===void 0||r.call(this,t)},e}get logContext(){var e,t;return Object.assign({},(t=(e=this.loggerOptions).loggerContextCb)===null||t===void 0?void 0:t.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return N(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e){var t;return N(this,void 0,void 0,function*(){let r;if(e.type==="offer"){let{stereoMids:n,nackMids:o}=Rp(e);this.remoteStereoMids=n,this.remoteNackMids=o}else if(e.type==="answer"){const n=gn((t=e.sdp)!==null&&t!==void 0?t:"");n.media.forEach(o=>{o.type==="audio"&&this.trackBitrates.some(a=>{if(!a.transceiver||o.mid!=a.transceiver.mid)return!1;let s=0;if(o.rtp.some(l=>l.codec.toUpperCase()===a.codec.toUpperCase()?(s=l.payload,!0):!1),s===0)return!0;let c=!1;for(const l of o.fmtp)if(l.payload===s){l.config=l.config.split(";").filter(u=>!u.includes("maxaveragebitrate")).join(";"),a.maxbr>0&&(l.config+=";maxaveragebitrate=".concat(a.maxbr*1e3)),c=!0;break}return c||a.maxbr>0&&o.fmtp.push({payload:s,config:"maxaveragebitrate=".concat(a.maxbr*1e3)}),!0})}),r=ho(n)}yield this.setMungedSDP(e,r,!0),this.pendingCandidates.forEach(n=>{this.pc.addIceCandidate(n)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(Dr.NegotiationComplete),e.sdp&&gn(e.sdp).media.forEach(o=>{o.type==="video"&&this.emit(Dr.RTPVideoPayloadTypes,o.rtp)}))})}createAndSendOffer(e){var t;return N(this,void 0,void 0,function*(){if(this.onOffer===void 0)return;if(e!=null&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const o=this._pc.remoteDescription;if(e!=null&&e.iceRestart&&o)yield this._pc.setRemoteDescription(o);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const r=yield this.pc.createOffer(e),n=gn((t=r.sdp)!==null&&t!==void 0?t:"");n.media.forEach(o=>{o.type==="audio"?wc(o,[],[]):o.type==="video"&&(Pp(o),this.trackBitrates.some(a=>{if(!o.msid||!a.cid||!o.msid.includes(a.cid))return!1;let s=0;if(o.rtp.some(l=>l.codec.toUpperCase()===a.codec.toUpperCase()?(s=l.payload,!0):!1),s===0)return!0;let c=!1;for(const l of o.fmtp)if(l.payload===s){l.config.includes("x-google-start-bitrate")||(l.config+=";x-google-start-bitrate=".concat(Math.round(a.maxbr*Sc))),l.config.includes("x-google-max-bitrate")||(l.config+=";x-google-max-bitrate=".concat(a.maxbr)),c=!0;break}return c||o.fmtp.push({payload:s,config:"x-google-start-bitrate=".concat(Math.round(a.maxbr*Sc),";x-google-max-bitrate=").concat(a.maxbr)}),!0}))}),yield this.setMungedSDP(r,ho(n)),this.onOffer(r)})}createAndSetAnswer(){var e;return N(this,void 0,void 0,function*(){const t=yield this.pc.createAnswer(),r=gn((e=t.sdp)!==null&&e!==void 0?e:"");return r.media.forEach(n=>{n.type==="audio"&&wc(n,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(t,ho(r)),t})}createDataChannel(e,t){return this.pc.createDataChannel(e,t)}addTransceiver(e,t){return this.pc.addTransceiver(e,t)}addTrack(e){if(!this._pc)throw new Pe("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var t;if(!this._pc)throw new Pe("PC closed, cannot configure");return(t=this._pc)===null||t===void 0?void 0:t.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var t;return(t=this._pc)===null||t===void 0?void 0:t.removeTrack(e)}getConnectionState(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&t!==void 0?t:"closed"}getICEConnectionState(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&t!==void 0?t:"closed"}getSignallingState(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&t!==void 0?t:"closed"}getTransceivers(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&t!==void 0?t:[]}getSenders(){var e,t;return(t=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&t!==void 0?t:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){var e;return N(this,void 0,void 0,function*(){if(!this._pc)return;let t="";const r=new Map,n=new Map;if((yield this._pc.getStats()).forEach(s=>{switch(s.type){case"transport":t=s.selectedCandidatePairId;break;case"candidate-pair":t===""&&s.selected&&(t=s.id),r.set(s.id,s);break;case"remote-candidate":n.set(s.id,"".concat(s.address,":").concat(s.port));break}}),t==="")return;const a=(e=r.get(t))===null||e===void 0?void 0:e.remoteCandidateId;if(a!==void 0)return n.get(a)})}setMungedSDP(e,t,r){return N(this,void 0,void 0,function*(){if(t){const n=e.sdp;e.sdp=t;try{this.log.debug("setting munged ".concat(r?"remote":"local"," description"),this.logContext),r?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(o){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:o,sdp:t})),e.sdp=n}}try{r?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(n){let o="unknown error";n instanceof Error?o=n.message:typeof n=="string"&&(o=n);const a={error:o,sdp:e.sdp};throw!r&&this.pc.remoteDescription&&(a.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:a})),new Fo(o)}})}}function wc(i,e,t){let r=0;i.rtp.some(n=>n.codec==="opus"?(r=n.payload,!0):!1),r>0&&(i.rtcpFb||(i.rtcpFb=[]),t.includes(i.mid)&&!i.rtcpFb.some(n=>n.payload===r&&n.type==="nack")&&i.rtcpFb.push({payload:r,type:"nack"}),e.includes(i.mid)&&i.fmtp.some(n=>n.payload===r?(n.config.includes("stereo=1")||(n.config+=";stereo=1"),!0):!1))}function Pp(i){var e,t,r,n;const o=(t=(e=i.rtp[0])===null||e===void 0?void 0:e.codec)===null||t===void 0?void 0:t.toLowerCase();if(!bn(o))return;let a=0;((r=i.ext)===null||r===void 0?void 0:r.some(c=>c.uri===hc?!0:(c.value>a&&(a=c.value),!1)))||(n=i.ext)===null||n===void 0||n.push({value:a+1,uri:hc})}function Rp(i){var e;const t=[],r=[],n=gn((e=i.sdp)!==null&&e!==void 0?e:"");let o=0;return n.media.forEach(a=>{var s;a.type==="audio"&&(a.rtp.some(c=>c.codec==="opus"?(o=c.payload,!0):!1),!((s=a.rtcpFb)===null||s===void 0)&&s.some(c=>c.payload===o&&c.type==="nack")&&r.push(a.mid),a.fmtp.some(c=>c.payload===o?(c.config.includes("sprop-stereo=1")&&t.push(a.mid),!0):!1))}),{stereoMids:t,nackMids:r}}const qo="vp8",xp={audioBitrate:ds.music.maxBitrate,audioPreset:ds.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:ba.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:qo,backupCodec:!0},Kh={autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0},Gh={resolution:kn.h720.resolution},Op={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new Sf,disconnectOnPageLeave:!0,expWebAudioMix:!1},Ca={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var xe;(function(i){i[i.NEW=0]="NEW",i[i.CONNECTING=1]="CONNECTING",i[i.CONNECTED=2]="CONNECTED",i[i.FAILED=3]="FAILED",i[i.CLOSING=4]="CLOSING",i[i.CLOSED=5]="CLOSED"})(xe||(xe={}));class Dp{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,t,r){var n;this.peerConnectionTimeout=Ca.peerConnectionTimeout,this.log=he,this.updateState=()=>{var a;const s=this.state,c=this.requiredTransports.map(l=>l.getConnectionState());c.every(l=>l==="connected")?this.state=xe.CONNECTED:c.some(l=>l==="failed")?this.state=xe.FAILED:c.some(l=>l==="connecting")?this.state=xe.CONNECTING:c.every(l=>l==="closed")?this.state=xe.CLOSED:c.some(l=>l==="closed")?this.state=xe.CLOSING:c.every(l=>l==="new")&&(this.state=xe.NEW),s!==this.state&&(this.log.debug("pc state change: from ".concat(xe[s]," to ").concat(xe[this.state]),this.logContext),(a=this.onStateChange)===null||a===void 0||a.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=Mi((n=r.loggerName)!==null&&n!==void 0?n:Zt.PCManager),this.loggerOptions=r,this.isPublisherConnectionRequired=!t,this.isSubscriberConnectionRequired=t;const o={optional:[{googDscp:!0}]};this.publisher=new Cc(e,o,r),this.subscriber=new Cc(e,void 0,r),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=a=>{var s;(s=this.onIceCandidate)===null||s===void 0||s.call(this,a,je.PUBLISHER)},this.subscriber.onIceCandidate=a=>{var s;(s=this.onIceCandidate)===null||s===void 0||s.call(this,a,je.SUBSCRIBER)},this.subscriber.onDataChannel=a=>{var s;(s=this.onDataChannel)===null||s===void 0||s.call(this,a)},this.subscriber.onTrack=a=>{var s;(s=this.onTrack)===null||s===void 0||s.call(this,a)},this.publisher.onOffer=a=>{var s;(s=this.onPublisherOffer)===null||s===void 0||s.call(this,a)},this.state=xe.NEW,this.connectionLock=new Tt}get logContext(){var e,t;return Object.assign({},(t=(e=this.loggerOptions).loggerContextCb)===null||t===void 0?void 0:t.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}requireSubscriber(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isSubscriberConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e){return this.publisher.setRemoteDescription(e)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return N(this,void 0,void 0,function*(){if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const e=this.publisher;for(const t of e.getSenders())try{e.canRemoveTrack()&&e.removeTrack(t)}catch(r){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:r}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()})}triggerIceRestart(){return N(this,void 0,void 0,function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,t){return N(this,void 0,void 0,function*(){t===je.PUBLISHER?yield this.publisher.addIceCandidate(e):yield this.subscriber.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e){return N(this,void 0,void 0,function*(){return this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:this.subscriber.getSignallingState().toString()})),yield this.subscriber.setRemoteDescription(e),yield this.subscriber.createAndSetAnswer()})}updateConfiguration(e,t){this.publisher.setConfiguration(e),this.subscriber.setConfiguration(e),t&&this.triggerIceRestart()}ensurePCTransportConnection(e,t){var r;return N(this,void 0,void 0,function*(){const n=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((r=this.requiredTransports)===null||r===void 0?void 0:r.map(o=>this.ensureTransportConnected(o,e,t)))}finally{n()}})}negotiate(e){return N(this,void 0,void 0,function*(){return new Promise((t,r)=>N(this,void 0,void 0,function*(){const n=setTimeout(()=>{r("negotiation timed out")},this.peerConnectionTimeout),o=()=>{clearTimeout(n),r("negotiation aborted")};e.signal.addEventListener("abort",o),this.publisher.once(Dr.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(Dr.NegotiationComplete,()=>{clearTimeout(n),t()})}),yield this.publisher.negotiate(a=>{clearTimeout(n),r(a)})}))})}addPublisherTransceiver(e,t){return this.publisher.addTransceiver(e,t)}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,t){return this.publisher.createDataChannel(e,t)}getConnectedAddress(e){return e===je.PUBLISHER?this.publisher.getConnectedAddress():e===je.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&e.push(this.subscriber),e}ensureTransportConnected(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return N(this,void 0,void 0,function*(){if(e.getConnectionState()!=="connected")return new Promise((o,a)=>N(this,void 0,void 0,function*(){const s=()=>{this.log.warn("abort transport connection",this.logContext),Me.clearTimeout(c),a(new ge("room connection has been cancelled",3))};t!=null&&t.signal.aborted&&s(),t==null||t.signal.addEventListener("abort",s);const c=Me.setTimeout(()=>{t==null||t.signal.removeEventListener("abort",s),a(new ge("could not establish pc connection"))},r);for(;this.state!==xe.CONNECTED;)if(yield Li(50),t!=null&&t.signal.aborted){a(new ge("room connection has been cancelled",3));return}Me.clearTimeout(c),t==null||t.signal.removeEventListener("abort",s),o()}))})}}const kc="_lossy",Tc="_reliable",Ap=2*1e3,Ec="leave-reconnect";var pt;(function(i){i[i.New=0]="New",i[i.Connected=1]="Connected",i[i.Disconnected=2]="Disconnected",i[i.Reconnecting=3]="Reconnecting",i[i.Closed=4]="Closed"})(pt||(pt={}));class Lp extends ii.EventEmitter{get isClosed(){return this._isClosed}constructor(e){var t;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=Ca.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.subscriberPrimary=!1,this.pcState=pt.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=he,this.handleDataChannel=r=>{let{channel:n}=r;return N(this,void 0,void 0,function*(){if(n){if(n.label===Tc)this.reliableDCSub=n;else if(n.label===kc)this.lossyDCSub=n;else return;this.log.debug("on data channel ".concat(n.id,", ").concat(n.label),this.logContext),n.onmessage=this.handleDataMessage}})},this.handleDataMessage=r=>N(this,void 0,void 0,function*(){var n,o;const a=yield this.dataProcessLock.lock();try{let s;if(r.data instanceof ArrayBuffer)s=r.data;else if(r.data instanceof Blob)s=yield r.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:r.data}));return}const c=Bt.fromBinary(new Uint8Array(s));((n=c.value)===null||n===void 0?void 0:n.case)==="speaker"?this.emit(re.ActiveSpeakersUpdate,c.value.value.speakers):((o=c.value)===null||o===void 0?void 0:o.case)==="user"&&this.emit(re.DataPacketReceived,c.value.value,c.kind)}finally{a()}}),this.handleDataError=r=>{const o=r.currentTarget.maxRetransmits===0?"lossy":"reliable";if(r instanceof ErrorEvent&&r.error){const{error:a}=r.error;this.log.error("DataChannel error on ".concat(o,": ").concat(r.message),Object.assign(Object.assign({},this.logContext),{error:a}))}else this.log.error("Unknown DataChannel error on ".concat(o),Object.assign(Object.assign({},this.logContext),{event:r}))},this.handleBufferedAmountLow=r=>{const o=r.currentTarget.maxRetransmits===0?Re.LOSSY:Re.RELIABLE;this.updateAndEmitDCBufferStatus(o)},this.handleDisconnect=(r,n)=>{if(this._isClosed)return;this.log.warn("".concat(r," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const o=c=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(c,"ms. giving up"),this.logContext),this.emit(re.Disconnected),this.close()},a=Date.now()-this.reconnectStart;let s=this.getNextRetryDelay({elapsedMs:a,retryCount:this.reconnectAttempts});if(s===null){o(a);return}r===Ec&&(s=0),this.log.debug("reconnecting in ".concat(s,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Me.setTimeout(()=>this.attemptReconnect(n),s)},this.waitForRestarted=()=>new Promise((r,n)=>{this.pcState===pt.Connected&&r();const o=()=>{this.off(re.Disconnected,a),r()},a=()=>{this.off(re.Restarted,o),n()};this.once(re.Restarted,o),this.once(re.Disconnected,a)}),this.updateAndEmitDCBufferStatus=r=>{const n=this.isBufferStatusLow(r);typeof n<"u"&&n!==this.dcBufferStatus.get(r)&&(this.dcBufferStatus.set(r,n),this.emit(re.DCBufferStatusChanged,n,r))},this.isBufferStatusLow=r=>{const n=this.dataChannelForKind(r);if(n)return n.bufferedAmount<=n.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===we.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(si.RR_SIGNAL_DISCONNECTED))},this.log=Mi((t=e.loggerName)!==null&&t!==void 0?t:Zt.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new Sa(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.registerOnLineListener(),this.closingLock=new Tt,this.dataProcessLock=new Tt,this.dcBufferStatus=new Map([[Re.LOSSY,!0],[Re.RELIABLE,!0]]),this.client.onParticipantUpdate=r=>this.emit(re.ParticipantUpdate,r),this.client.onConnectionQuality=r=>this.emit(re.ConnectionQualityUpdate,r),this.client.onRoomUpdate=r=>this.emit(re.RoomUpdate,r),this.client.onSubscriptionError=r=>this.emit(re.SubscriptionError,r),this.client.onSubscriptionPermissionUpdate=r=>this.emit(re.SubscriptionPermissionUpdate,r),this.client.onSpeakersChanged=r=>this.emit(re.SpeakersChanged,r),this.client.onStreamStateUpdate=r=>this.emit(re.StreamStateChanged,r)}get logContext(){var e,t,r,n,o,a;return{room:(t=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||t===void 0?void 0:t.name,roomSid:(n=(r=this.latestJoinResponse)===null||r===void 0?void 0:r.room)===null||n===void 0?void 0:n.sid,identity:(a=(o=this.latestJoinResponse)===null||o===void 0?void 0:o.participant)===null||a===void 0?void 0:a.identity}}join(e,t,r,n){return N(this,void 0,void 0,function*(){this.url=e,this.token=t,this.signalOpts=r,this.maxJoinAttempts=r.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const o=yield this.client.join(e,t,r,n);return this._isClosed=!1,this.latestJoinResponse=o,this.subscriberPrimary=o.subscriberPrimary,this.pcManager||(yield this.configure(o)),this.subscriberPrimary||this.negotiate(),this.clientConfiguration=o.clientConfiguration,o}catch(o){if(o instanceof ge&&o.reason===1&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,t,r,n);throw o}})}close(){return N(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.emit(re.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){var e;return N(this,void 0,void 0,function*(){yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const t=r=>{r&&(r.close(),r.onbufferedamountlow=null,r.onclose=null,r.onclosing=null,r.onerror=null,r.onmessage=null,r.onopen=null)};t(this.lossyDC),t(this.lossyDCSub),t(this.reliableDC),t(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0})}cleanupClient(){return N(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new Mt("a track with the same ID has already been published");return new Promise((t,r)=>{const n=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],r(new ge("publication of local track timed out, no response from server"))},1e4);this.pendingTrackResolvers[e.cid]={resolve:o=>{clearTimeout(n),t(o)},reject:()=>{clearTimeout(n),r(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:t}=this.pendingTrackResolvers[e.track.id];t&&t(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(t){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:t}))}return!1}updateMuteStatus(e,t){this.client.sendMuteTrack(e,t)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){var e;return N(this,void 0,void 0,function*(){return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){var t;return N(this,void 0,void 0,function*(){if(this.pcManager&&this.pcManager.currentState!==xe.NEW)return;this.participantSid=(t=e.participant)===null||t===void 0?void 0:t.sid;const r=this.makeRTCConfiguration(e);this.pcManager=new Dp(r,e.subscriberPrimary,this.loggerOptions),this.emit(re.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(n,o)=>{this.client.sendIceCandidate(n,o)},this.pcManager.onPublisherOffer=n=>{this.client.sendOffer(n)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(n,o,a)=>N(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(n),this.logContext),n===xe.CONNECTED){const s=this.pcState===pt.New;this.pcState=pt.Connected,s&&this.emit(re.Connected,e)}else n===xe.FAILED&&this.pcState===pt.Connected&&(this.pcState=pt.Disconnected,this.handleDisconnect("peerconnection failed",a==="failed"?si.RR_SUBSCRIBER_FAILED:si.RR_PUBLISHER_FAILED))}),this.pcManager.onTrack=n=>{this.emit(re.MediaTrackAdded,n.track,n.streams[0],n.receiver)},this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=e=>N(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type})),yield this.pcManager.setPublisherAnswer(e))}),this.client.onTrickle=(e,t)=>{this.pcManager&&(this.log.trace("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:t})),this.pcManager.addIceCandidate(e,t))},this.client.onOffer=e=>N(this,void 0,void 0,function*(){if(!this.pcManager)return;const t=yield this.pcManager.createSubscriberAnswerFromOffer(e);this.client.sendAnswer(t)}),this.client.onLocalTrackPublished=e=>{var t;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(t=e.track)===null||t===void 0?void 0:t.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:r}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],r(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(re.LocalTrackUnpublished,e)},this.client.onTokenRefresh=e=>{this.token=e},this.client.onRemoteMuteChanged=(e,t)=>{this.emit(re.RemoteMute,e,t)},this.client.onSubscribedQualityUpdate=e=>{this.emit(re.SubscribedQualityUpdate,e)},this.client.onClose=()=>{this.handleDisconnect("signal",si.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{e!=null&&e.canReconnect?(this.fullReconnectOnNext=!0,this.handleDisconnect(Ec)):(this.emit(re.Disconnected,e==null?void 0:e.reason),this.close()),this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e==null?void 0:e.reason}))}}makeRTCConfiguration(e){var t;const r=Object.assign({},this.rtcConfig);if(!((t=this.signalOpts)===null||t===void 0)&&t.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),r.encodedInsertableStreams=!0),e.iceServers&&!r.iceServers){const n=[];e.iceServers.forEach(o=>{const a={urls:o.urls};o.username&&(a.username=o.username),o.credential&&(a.credential=o.credential),n.push(a)}),r.iceServers=n}return e.clientConfiguration&&e.clientConfiguration.forceRelay===Pt.ENABLED&&(r.iceTransportPolicy="relay"),r.sdpSemantics="unified-plan",r.continualGatheringPolicy="gather_continually",r}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(kc,{ordered:!0,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(Tc,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}setPreferredCodec(e,t,r){if(!("getCapabilities"in RTCRtpReceiver))return;const n=RTCRtpReceiver.getCapabilities(t);if(!n)return;this.log.debug("get receiver capabilities",Object.assign(Object.assign({},this.logContext),{cap:n}));const o=[],a=[],s=[];n.codecs.forEach(c=>{const l=c.mimeType.toLowerCase();if(l==="audio/opus"){o.push(c);return}if(!(l==="video/".concat(r))){s.push(c);return}if(r==="h264"){c.sdpFmtpLine&&c.sdpFmtpLine.includes("profile-level-id=42e01f")?o.push(c):a.push(c);return}o.push(c)}),op(e)&&e.setCodecPreferences(o.concat(a,s))}createSender(e,t,r){return N(this,void 0,void 0,function*(){if(uc())return yield this.createTransceiverRTCRtpSender(e,t,r);if(dc())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new Pe("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,t,r,n){return N(this,void 0,void 0,function*(){if(uc())return this.createSimulcastTransceiverSender(e,t,r,n);if(dc())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new Pe("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,t,r){return N(this,void 0,void 0,function*(){if(!this.pcManager)throw new Pe("publisher is closed");const n=[];e.mediaStream&&n.push(e.mediaStream);const o={direction:"sendonly",streams:n};r&&(o.sendEncodings=r);const a=yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,o);return e.kind===W.Kind.Video&&t.videoCodec&&(this.setPreferredCodec(a,e.kind,t.videoCodec),e.codec=t.videoCodec),a.sender})}createSimulcastTransceiverSender(e,t,r,n){return N(this,void 0,void 0,function*(){if(!this.pcManager)throw new Pe("publisher is closed");const o={direction:"sendonly"};n&&(o.sendEncodings=n);const a=yield this.pcManager.addPublisherTransceiver(t.mediaStreamTrack,o);if(r.videoCodec)return this.setPreferredCodec(a,e.kind,r.videoCodec),e.setSimulcastTrackSender(r.videoCodec,a.sender),a.sender})}createRTCRtpSender(e){return N(this,void 0,void 0,function*(){if(!this.pcManager)throw new Pe("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){var t,r,n;return N(this,void 0,void 0,function*(){if(!this._isClosed){if(this.attemptingReconnect){he.warn("already attempting reconnect, returning early",this.logContext);return}(((t=this.clientConfiguration)===null||t===void 0?void 0:t.resumeConnection)===Pt.DISABLED||((n=(r=this.pcManager)===null||r===void 0?void 0:r.currentState)!==null&&n!==void 0?n:xe.NEW)===xe.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(o){this.reconnectAttempts+=1;let a=!0;o instanceof Pe?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:o})),a=!1):o instanceof Tr||(this.fullReconnectOnNext=!0),a?this.handleDisconnect("reconnect",si.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(re.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(t){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:t}))}return null}restartConnection(e){var t,r,n;return N(this,void 0,void 0,function*(){try{if(!this.url||!this.token)throw new Pe("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(re.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let o;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new Tr;o=yield this.join(e??this.url,this.token,this.signalOpts)}catch(a){throw a instanceof ge&&a.reason===0?new Pe("could not reconnect, token might be expired"):new Tr}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(re.SignalRestarted,o),yield this.waitForPCReconnected(),this.client.currentState!==we.CONNECTED)throw new Tr("Signal connection got severed during reconnect");(t=this.regionUrlProvider)===null||t===void 0||t.resetAttempts(),this.emit(re.Restarted)}catch(o){const a=yield(r=this.regionUrlProvider)===null||r===void 0?void 0:r.getNextBestRegionUrl();if(a){yield this.restartConnection(a);return}else throw(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),o}})}resumeConnection(e){var t;return N(this,void 0,void 0,function*(){if(!this.url||!this.token)throw new Pe("could not reconnect, url or token not saved");if(!this.pcManager)throw new Pe("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(re.Resuming);try{this.setupSignalClientCallbacks();const r=yield this.client.reconnect(this.url,this.token,this.participantSid,e);if(r){const n=this.makeRTCConfiguration(r);this.pcManager.updateConfiguration(n)}}catch(r){let n="";throw r instanceof Error&&(n=r.message,this.log.error(r.message,Object.assign(Object.assign({},this.logContext),{error:r}))),r instanceof ge&&r.reason===0?new Pe("could not reconnect, token might be expired"):r instanceof ge&&r.reason===4?r:new Tr(n)}if(this.emit(re.SignalResumed),this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==we.CONNECTED)throw new Tr("Signal connection got severed during reconnect");this.client.setReconnected(),((t=this.reliableDC)===null||t===void 0?void 0:t.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),this.emit(re.Resumed)})}waitForPCInitialConnection(e,t){return N(this,void 0,void 0,function*(){if(!this.pcManager)throw new Pe("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(t,e)})}waitForPCReconnected(){return N(this,void 0,void 0,function*(){this.pcState=pt.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield Li(Ap),!this.pcManager)throw new Pe("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=pt.Connected}catch(e){throw this.pcState=pt.Disconnected,new ge("could not establish PC connection, ".concat(e.message))}})}sendDataPacket(e,t){return N(this,void 0,void 0,function*(){const r=e.toBinary();yield this.ensurePublisherConnected(t);const n=this.dataChannelForKind(t);n&&n.send(r),this.updateAndEmitDCBufferStatus(t)})}ensureDataTransportConnected(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;var r;return N(this,void 0,void 0,function*(){if(!this.pcManager)throw new Pe("PC manager is closed");const n=t?this.pcManager.subscriber:this.pcManager.publisher,o=t?"Subscriber":"Publisher";if(!n)throw new ge("".concat(o," connection not set"));!t&&!this.pcManager.publisher.isICEConnected&&this.pcManager.publisher.getICEConnectionState()!=="checking"&&this.negotiate();const a=this.dataChannelForKind(e,t);if((a==null?void 0:a.readyState)==="open")return;const s=new Date().getTime()+this.peerConnectionTimeout;for(;new Date().getTime()<s;){if(n.isICEConnected&&((r=this.dataChannelForKind(e,t))===null||r===void 0?void 0:r.readyState)==="open")return;yield Li(50)}throw new ge("could not establish ".concat(o," connection, state: ").concat(n.getICEConnectionState()))})}ensurePublisherConnected(e){return N(this,void 0,void 0,function*(){yield this.ensureDataTransportConnected(e,!1)})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==xe.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return N(this,void 0,void 0,function*(){return new Promise((e,t)=>N(this,void 0,void 0,function*(){if(!this.pcManager){t(new Fo("PC manager is closed"));return}this.pcManager.requirePublisher();const r=new AbortController,n=()=>{r.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&t("cannot negotiate on closed engine"),this.on(re.Closing,n),this.pcManager.publisher.once(Dr.RTPVideoPayloadTypes,o=>{const a=new Map;o.forEach(s=>{const c=s.codec.toLowerCase();dp(c)&&a.set(s.payload,c)}),this.emit(re.RTPVideoMapUpdate,a)});try{yield this.pcManager.negotiate(r),e()}catch(o){o instanceof Fo&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",si.RR_UNKNOWN),t(o)}finally{this.off(re.Closing,n)}}))})}dataChannelForKind(e,t){if(t){if(e===Re.LOSSY)return this.lossyDCSub;if(e===Re.RELIABLE)return this.reliableDCSub}else{if(e===Re.LOSSY)return this.lossyDC;if(e===Re.RELIABLE)return this.reliableDC}}sendSyncState(e,t){var r,n;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const o=this.pcManager.subscriber.getLocalDescription(),a=this.pcManager.subscriber.getRemoteDescription(),s=(n=(r=this.signalOpts)===null||r===void 0?void 0:r.autoSubscribe)!==null&&n!==void 0?n:!0,c=new Array;e.forEach(l=>{l.isDesired!==s&&c.push(l.trackSid)}),this.client.sendSyncState(new Xt({answer:o?ps({sdp:o.sdp,type:o.type}):void 0,offer:a?ps({sdp:a.sdp,type:a.type}):void 0,subscription:new lt({trackSids:c,subscribe:!s,participantTracks:[]}),publishTracks:ep(t),dataChannels:this.dataChannelsInfo()}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],t=(r,n)=>{(r==null?void 0:r.id)!==void 0&&r.id!==null&&e.push(new Qt({label:r.label,id:r.id,target:n}))};return t(this.dataChannelForKind(Re.LOSSY),je.PUBLISHER),t(this.dataChannelForKind(Re.RELIABLE),je.PUBLISHER),t(this.dataChannelForKind(Re.LOSSY,!0),je.SUBSCRIBER),t(this.dataChannelForKind(Re.RELIABLE,!0),je.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&Me.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){Ye()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){Ye()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class Tr extends Error{}class Pc{constructor(e,t){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=t}updateToken(e){this.token=e}isCloud(){return Wo(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(e){return N(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(e));const t=this.regionSettings.regions.filter(r=>!this.attemptedRegions.find(n=>n.url===r.url));if(t.length>0){const r=t[0];return this.attemptedRegions.push(r),he.debug("next region: ".concat(r.region)),r.url}else return null})}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(e){return N(this,void 0,void 0,function*(){const t=yield fetch("".concat(Ip(this.serverUrl),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:e});if(t.ok){const r=yield t.json();return this.lastUpdateAt=Date.now(),r}else throw new ge("Could not fetch region settings: ".concat(t.statusText),t.status===401?0:void 0,t.status)})}}function Ip(i){return"".concat(i.protocol.replace("ws","http"),"//").concat(i.host,"/settings")}const wa=2e3;function Is(i,e){if(!e)return 0;let t,r;return"bytesReceived"in i?(t=i.bytesReceived,r=e.bytesReceived):"bytesSent"in i&&(t=i.bytesSent,r=e.bytesSent),t===void 0||r===void 0||i.timestamp===void 0||e.timestamp===void 0?0:(t-r)*8*1e3/(i.timestamp-e.timestamp)}class tt extends zr{constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;super(e,W.Kind.Audio,t,r,o),this.stopOnMute=!1,this.monitorSender=()=>N(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let a;try{a=yield this.getSenderStats()}catch(s){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:s}));return}a&&this.prevStats&&(this._currentBitrate=Is(a,this.prevStats)),this.prevStats=a}),this.audioContext=n,this.checkForSilence()}setDeviceId(e){return N(this,void 0,void 0,function*(){return this._constraints.deviceId===e?!0:(this._constraints.deviceId=e,this.isMuted||(yield this.restartTrack()),this.isMuted||pr(e)===this.mediaStreamTrack.getSettings().deviceId)})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return N(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.source===W.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this}finally{t()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return N(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{const r=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==pr(this._constraints.deviceId);return this.source===W.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||r)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{t()}})}restartTrack(e){return N(this,void 0,void 0,function*(){let t;if(e){const r=Ls({audio:e});typeof r.audio!="boolean"&&(t=r.audio)}yield this.restart(t)})}restart(e){const t=Object.create(null,{restart:{get:()=>super.restart}});return N(this,void 0,void 0,function*(){const r=yield t.restart.call(this,e);return this.checkForSilence(),r})}startMonitor(){Ye()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},wa)))}setProcessor(e){var t;return N(this,void 0,void 0,function*(){const r=yield this.processorLock.lock();try{if(!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");if(this.processor&&(yield this.stopProcessor()),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");const n={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(n),this.processor=e,this.processor.processedTrack&&(yield(t=this.sender)===null||t===void 0?void 0:t.replaceTrack(this.processor.processedTrack))}finally{r()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){var e;return N(this,void 0,void 0,function*(){if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const t=yield this.sender.getStats();let r;return t.forEach(n=>{n.type==="outbound-rtp"&&(r={type:"audio",streamId:n.id,packetsSent:n.packetsSent,packetsLost:n.packetsLost,bytesSent:n.bytesSent,timestamp:n.timestamp,roundTripTime:n.roundTripTime,jitter:n.jitter})}),r})}checkForSilence(){return N(this,void 0,void 0,function*(){const e=yield Qf(this);return e&&(this.isMuted||this.log.warn("silence detected on local audio track",this.logContext),this.emit(ee.AudioSilenceDetected)),e})}}function Xh(i,e,t){switch(i.kind){case"audio":return new tt(i,e,!1,void 0,t);case"video":return new at(i,e,!1,t);default:throw new Mt("unsupported track type: ".concat(i.kind))}}const Mp=Object.values(kn),Bp=Object.values(Uo),Np=Object.values(ba),Fp=[kn.h180,kn.h360],Up=[Uo.h180,Uo.h360],jp=i=>[{scaleResolutionDownBy:2,fps:i.encoding.maxFramerate}].map(t=>{var r,n;return new pe(Math.floor(i.width/t.scaleResolutionDownBy),Math.floor(i.height/t.scaleResolutionDownBy),Math.max(15e4,Math.floor(i.encoding.maxBitrate/(Math.pow(t.scaleResolutionDownBy,2)*(((r=i.encoding.maxFramerate)!==null&&r!==void 0?r:30)/((n=t.fps)!==null&&n!==void 0?n:30))))),t.fps,i.encoding.priority)}),Vo=["q","h","f"];function Jo(i,e,t,r){var n,o;let a=r==null?void 0:r.videoEncoding;i&&(a=r==null?void 0:r.screenShareEncoding);const s=r==null?void 0:r.simulcast,c=r==null?void 0:r.scalabilityMode,l=r==null?void 0:r.videoCodec;if(!a&&!s&&!c||!e||!t)return[{}];a||(a=Wp(i,e,t,l),he.debug("using video encoding",a));const u=new pe(e,t,a.maxBitrate,a.maxFramerate,a.priority);if(c&&bn(l)){he.debug("using svc with scalabilityMode ".concat(c));const _=new Qh(c),y=[];if(_.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));for(let v=0;v<_.spatial;v+=1)y.push({rid:Vo[2-v],maxBitrate:a.maxBitrate/Math.pow(3,v),maxFramerate:u.encoding.maxFramerate});return y[0].scalabilityMode=c,he.debug("encodings",y),y}if(!s)return[a];let h=[];i?h=(n=xc(r==null?void 0:r.screenShareSimulcastLayers))!==null&&n!==void 0?n:Rc(i,u):h=(o=xc(r==null?void 0:r.videoSimulcastLayers))!==null&&o!==void 0?o:Rc(i,u);let g;if(h.length>0){const _=h[0];h.length>1&&([,g]=h);const y=Math.max(e,t);if(y>=960&&g)return uo(e,t,[_,g,u]);if(y>=480)return uo(e,t,[_,u])}return uo(e,t,[u])}function Hp(i,e,t){var r,n,o,a;if(!t.backupCodec||t.backupCodec===!0||t.backupCodec.codec===t.videoCodec)return;e!==t.backupCodec.codec&&he.warn("requested a different codec than specified as backup",{serverRequested:e,backup:t.backupCodec.codec}),t.videoCodec=e,t.videoEncoding=t.backupCodec.encoding;const s=i.mediaStreamTrack.getSettings(),c=(r=s.width)!==null&&r!==void 0?r:(n=i.dimensions)===null||n===void 0?void 0:n.width,l=(o=s.height)!==null&&o!==void 0?o:(a=i.dimensions)===null||a===void 0?void 0:a.height;return Jo(i.source===W.Source.ScreenShare,c,l,t)}function Wp(i,e,t,r){const n=qp(i,e,t);let{encoding:o}=n[0];const a=Math.max(e,t);for(let s=0;s<n.length;s+=1){const c=n[s];if(o=c.encoding,c.width>=a)break}if(r)switch(r){case"av1":o=Object.assign({},o),o.maxBitrate=o.maxBitrate*.7;break;case"vp9":o=Object.assign({},o),o.maxBitrate=o.maxBitrate*.85;break}return o}function qp(i,e,t){if(i)return Np;const r=e>t?e/t:t/e;return Math.abs(r-16/9)<Math.abs(r-4/3)?Mp:Bp}function Rc(i,e){if(i)return jp(e);const{width:t,height:r}=e,n=t>r?t/r:r/t;return Math.abs(n-16/9)<Math.abs(n-4/3)?Fp:Up}function uo(i,e,t){const r=[];if(t.forEach((n,o)=>{if(o>=Vo.length)return;const a=Math.min(i,e),c={rid:Vo[o],scaleResolutionDownBy:Math.max(1,a/Math.min(n.width,n.height)),maxBitrate:n.encoding.maxBitrate};n.encoding.maxFramerate&&(c.maxFramerate=n.encoding.maxFramerate);const l=$r()||o===0;n.encoding.priority&&l&&(c.priority=n.encoding.priority,c.networkPriority=n.encoding.priority),r.push(c)}),br()&&qh()==="ios"){let n;r.forEach(a=>{n?a.maxFramerate&&a.maxFramerate>n&&(n=a.maxFramerate):n=a.maxFramerate});let o=!0;r.forEach(a=>{var s;a.maxFramerate!=n&&(o&&(o=!1,he.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),he.info('Setting framerate of encoding "'.concat((s=a.rid)!==null&&s!==void 0?s:"",'" to ').concat(n)),a.maxFramerate=n)})}return r}function xc(i){if(i)return i.sort((e,t)=>{const{encoding:r}=e,{encoding:n}=t;return r.maxBitrate>n.maxBitrate?1:r.maxBitrate<n.maxBitrate?-1:r.maxBitrate===n.maxBitrate&&r.maxFramerate&&n.maxFramerate?r.maxFramerate>n.maxFramerate?1:-1:0})}class Qh{constructor(e){const t=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!t)throw new Error("invalid scalability mode");if(this.spatial=parseInt(t[1]),this.temporal=parseInt(t[2]),t.length>3)switch(t[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=t[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}const Vp=5e3;class at extends zr{constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=arguments.length>3?arguments[3]:void 0;super(e,W.Kind.Video,t,r,n),this.simulcastCodecs=new Map,this.monitorSender=()=>N(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let o;try{o=yield this.getSenderStats()}catch(s){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:s}));return}const a=new Map(o.map(s=>[s.rid,s]));if(this.prevStats){let s=0;a.forEach((c,l)=>{var u;const h=(u=this.prevStats)===null||u===void 0?void 0:u.get(l);s+=Is(c,h)}),this._currentBitrate=s}this.prevStats=a}),this.senderLock=new Tt}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var t;if(this.signalClient=e,!Ye())return;const r=(t=this.sender)===null||t===void 0?void 0:t.getParameters();r&&(this.encodings=r.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},wa))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});var t,r,n,o,a;return N(this,void 0,void 0,function*(){yield e.pauseUpstream.call(this);try{for(var s=!0,c=Er(this.simulcastCodecs.values()),l;l=yield c.next(),t=l.done,!t;s=!0)o=l.value,s=!1,yield(a=o.sender)===null||a===void 0?void 0:a.replaceTrack(null)}catch(u){r={error:u}}finally{try{!s&&!t&&(n=c.return)&&(yield n.call(c))}finally{if(r)throw r.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});var t,r,n,o,a;return N(this,void 0,void 0,function*(){yield e.resumeUpstream.call(this);try{for(var s=!0,c=Er(this.simulcastCodecs.values()),l;l=yield c.next(),t=l.done,!t;s=!0){o=l.value,s=!1;const u=o;yield(a=u.sender)===null||a===void 0?void 0:a.replaceTrack(u.mediaStreamTrack)}}catch(u){r={error:u}}finally{try{!s&&!t&&(n=c.return)&&(yield n.call(c))}finally{if(r)throw r.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return N(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.source===W.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this}finally{t()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return N(this,void 0,void 0,function*(){const t=yield this.muteLock.lock();try{return this.source===W.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{t()}})}setTrackMuted(e){super.setTrackMuted(e);for(const t of this.simulcastCodecs.values())t.mediaStreamTrack.enabled=!e}getSenderStats(){var e;return N(this,void 0,void 0,function*(){if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const t=[],r=yield this.sender.getStats();return r.forEach(n=>{var o;if(n.type==="outbound-rtp"){const a={type:"video",streamId:n.id,frameHeight:n.frameHeight,frameWidth:n.frameWidth,firCount:n.firCount,pliCount:n.pliCount,nackCount:n.nackCount,packetsSent:n.packetsSent,bytesSent:n.bytesSent,framesSent:n.framesSent,timestamp:n.timestamp,rid:(o=n.rid)!==null&&o!==void 0?o:n.id,retransmittedPacketsSent:n.retransmittedPacketsSent,qualityLimitationReason:n.qualityLimitationReason,qualityLimitationResolutionChanges:n.qualityLimitationResolutionChanges},s=r.get(n.remoteId);s&&(a.jitter=s.jitter,a.packetsLost=s.packetsLost,a.roundTripTime=s.roundTripTime),t.push(a)}}),t})}setPublishingQuality(e){const t=[];for(let r=Oe.LOW;r<=Oe.HIGH;r+=1)t.push(new kt({quality:r,enabled:r<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(t)}setDeviceId(e){return N(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===pr(e)?!0:(this._constraints.deviceId=e,this.isMuted||(yield this.restartTrack()),this.isMuted||pr(e)===this._mediaStreamTrack.getSettings().deviceId)})}restartTrack(e){var t,r,n,o;return N(this,void 0,void 0,function*(){let a;if(e){const u=Ls({video:e});typeof u.video!="boolean"&&(a=u.video)}yield this.restart(a);try{for(var s=!0,c=Er(this.simulcastCodecs.values()),l;l=yield c.next(),t=l.done,!t;s=!0){o=l.value,s=!1;const u=o;u.sender&&(u.mediaStreamTrack=this.mediaStreamTrack.clone(),yield u.sender.replaceTrack(u.mediaStreamTrack))}}catch(u){r={error:u}}finally{try{!s&&!t&&(n=c.return)&&(yield n.call(c))}finally{if(r)throw r.error}}})}setProcessor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;const r=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});var n,o,a,s,c,l;return N(this,void 0,void 0,function*(){if(yield r.setProcessor.call(this,e,t),!((c=this.processor)===null||c===void 0)&&c.processedTrack)try{for(var u=!0,h=Er(this.simulcastCodecs.values()),g;g=yield h.next(),n=g.done,!n;u=!0)s=g.value,u=!1,yield(l=s.sender)===null||l===void 0?void 0:l.replaceTrack(this.processor.processedTrack)}catch(_){o={error:_}}finally{try{!u&&!n&&(a=h.return)&&(yield a.call(h))}finally{if(o)throw o.error}}})}addSimulcastTrack(e,t){if(this.simulcastCodecs.has(e))throw new Error("".concat(e," already added"));const r={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:t};return this.simulcastCodecs.set(e,r),r}setSimulcastTrackSender(e,t){const r=this.simulcastCodecs.get(e);r&&(r.sender=t,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},Vp))}setPublishingCodecs(e){var t,r,n,o,a,s,c;return N(this,void 0,void 0,function*(){if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(e[0].qualities),[];this.subscribedCodecs=e;const l=[];try{for(t=!0,r=Er(e);n=yield r.next(),o=n.done,!o;t=!0){c=n.value,t=!1;const u=c;if(!this.codec||this.codec===u.codec)yield this.setPublishingLayers(u.qualities);else{const h=this.simulcastCodecs.get(u.codec);if(this.log.debug("try setPublishingCodec for ".concat(u.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:h})),!h||!h.sender){for(const g of u.qualities)if(g.enabled){l.push(u.codec);break}}else h.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(u.codec),this.logContext),yield Oc(h.sender,h.encodings,u.qualities,this.senderLock,this.log,this.logContext))}}}catch(u){a={error:u}}finally{try{!t&&!o&&(s=r.return)&&(yield s.call(r))}finally{if(a)throw a.error}}return l})}setPublishingLayers(e){return N(this,void 0,void 0,function*(){this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:e})),!(!this.sender||!this.encodings)&&(yield Oc(this.sender,this.encodings,e,this.senderLock,this.log,this.logContext))})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return N(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),Hh()&&this.isInBackground&&this.source===W.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function Oc(i,e,t,r,n,o){return N(this,void 0,void 0,function*(){const a=yield r.lock();n.debug("setPublishingLayersForSender",Object.assign(Object.assign({},o),{sender:i,qualities:t,senderEncodings:e}));try{const s=i.getParameters(),{encodings:c}=s;if(!c)return;if(c.length!==e.length){n.warn("cannot set publishing layers, encodings mismatch");return}let l=!1;!1&&c[0].scalabilityMode||c.forEach((h,g)=>{var _;let y=(_=h.rid)!==null&&_!==void 0?_:"";y===""&&(y="q");const v=Yh(y),f=t.find(p=>p.quality===v);f&&h.active!==f.enabled&&(l=!0,h.active=f.enabled,n.debug("setting layer ".concat(f.quality," to ").concat(h.active?"enabled":"disabled"),o),$r()&&(f.enabled?(h.scaleResolutionDownBy=e[g].scaleResolutionDownBy,h.maxBitrate=e[g].maxBitrate,h.maxFrameRate=e[g].maxFrameRate):(h.scaleResolutionDownBy=4,h.maxBitrate=10,h.maxFrameRate=2)))}),l&&(s.encodings=c,n.debug("setting encodings",Object.assign(Object.assign({},o),{encodings:s.encodings})),yield i.setParameters(s))}finally{a()}})}function Yh(i){switch(i){case"f":return Oe.HIGH;case"h":return Oe.MEDIUM;case"q":return Oe.LOW;default:return Oe.HIGH}}function Dc(i,e,t,r){if(!t)return[new Je({quality:Oe.HIGH,width:i,height:e,bitrate:0,ssrc:0})];if(r){const n=t[0].scalabilityMode,o=new Qh(n),a=[];for(let s=0;s<o.spatial;s+=1)a.push(new Je({quality:Oe.HIGH-s,width:Math.ceil(i/Math.pow(2,s)),height:Math.ceil(e/Math.pow(2,s)),bitrate:t[0].maxBitrate?Math.ceil(t[0].maxBitrate/Math.pow(3,s)):0,ssrc:0}));return a}return t.map(n=>{var o,a,s;const c=(o=n.scaleResolutionDownBy)!==null&&o!==void 0?o:1;let l=Yh((a=n.rid)!==null&&a!==void 0?a:"");return new Je({quality:l,width:Math.ceil(i/c),height:Math.ceil(e/c),bitrate:(s=n.maxBitrate)!==null&&s!==void 0?s:0,ssrc:0})})}class Zh extends W{constructor(e,t,r,n,o){super(e,r,o),this.sid=t,this.receiver=n}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?ee.Muted:ee.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const t=r=>{r.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",t),this.receiver=void 0,this._currentBitrate=0,this.emit(ee.Ended,this))};e.addEventListener("removetrack",t)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){var e;return N(this,void 0,void 0,function*(){return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),wa))}}class Sn extends Zh{constructor(e,t,r,n,o,a){super(e,t,W.Kind.Audio,r,a),this.monitorReceiver=()=>N(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const s=yield this.getReceiverStats();s&&this.prevStats&&this.receiver&&(this._currentBitrate=Is(s,this.prevStats)),this.prevStats=s}),this.audioContext=n,this.webAudioPluginNodes=[],o&&(this.sinkId=o.deviceId)}setVolume(e){var t;for(const r of this.attachedElements)this.audioContext?(t=this.gainNode)===null||t===void 0||t.gain.setTargetAtTime(e,0,.1):r.volume=e;br()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(br())return 1;let e=0;return this.attachedElements.forEach(t=>{t.volume>e&&(e=t.volume)}),e}setSinkId(e){return N(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(t=>{if(Ho(t))return t.setSinkId(e)}))})}attach(e){const t=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&Ho(e)&&e.setSinkId(this.sinkId),this.audioContext&&t&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let t;return e?(t=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(t=super.detach(),this.disconnectWebAudio()),t}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,t){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(t.srcObject);let r=this.sourceNode;this.webAudioPluginNodes.forEach(n=>{r.connect(n),r=n}),this.gainNode=e.createGain(),r.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(ee.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(n=>{this.emit(ee.AudioPlaybackFailed,n)})}disconnectWebAudio(){var e,t;(e=this.gainNode)===null||e===void 0||e.disconnect(),(t=this.sourceNode)===null||t===void 0||t.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return N(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let t;return e.forEach(r=>{r.type==="inbound-rtp"&&(t={type:"audio",timestamp:r.timestamp,jitter:r.jitter,bytesReceived:r.bytesReceived,concealedSamples:r.concealedSamples,concealmentEvents:r.concealmentEvents,silentConcealedSamples:r.silentConcealedSamples,silentConcealmentEvents:r.silentConcealmentEvents,totalAudioEnergy:r.totalAudioEnergy,totalSamplesDuration:r.totalSamplesDuration})}),t})}}const fo=100;class Cn extends Zh{constructor(e,t,r,n,o){super(e,t,W.Kind.Video,r,o),this.elementInfos=[],this.monitorReceiver=()=>N(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const a=yield this.getReceiverStats();a&&this.prevStats&&this.receiver&&(this._currentBitrate=Is(a,this.prevStats)),this.prevStats=a}),this.debouncedHandleResize=_a(()=>{this.updateDimensions()},fo),this.adaptiveStreamSettings=n}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(t=>{e?Or(this._mediaStreamTrack,t):Pr(this._mediaStreamTrack,t)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(t=>t.element===e)===void 0){const t=new Jp(e);this.observeElementInfo(t)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(t=>t===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const t=this.elementInfos.filter(r=>r===e);for(const r of t)r.stopObserving();this.elementInfos=this.elementInfos.filter(r=>r!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let t=[];if(e)return this.stopObservingElement(e),super.detach(e);t=super.detach();for(const r of t)this.stopObservingElement(r);return t}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return N(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let t,r="",n=new Map;return e.forEach(o=>{o.type==="inbound-rtp"?(r=o.codecId,t={type:"video",framesDecoded:o.framesDecoded,framesDropped:o.framesDropped,framesReceived:o.framesReceived,packetsReceived:o.packetsReceived,packetsLost:o.packetsLost,frameWidth:o.frameWidth,frameHeight:o.frameHeight,pliCount:o.pliCount,firCount:o.firCount,nackCount:o.nackCount,jitter:o.jitter,timestamp:o.timestamp,bytesReceived:o.bytesReceived,decoderImplementation:o.decoderImplementation}):o.type==="codec"&&n.set(o.id,o)}),t&&r!==""&&n.get(r)&&(t.mimeType=n.get(r).mimeType),t})}stopObservingElement(e){const t=this.elementInfos.filter(r=>r.element===e);for(const r of t)this.stopObservingElementInfo(r)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return N(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(){var e,t;const r=this.elementInfos.reduce((s,c)=>Math.max(s,c.visibilityChangedAt||0),0),n=!((t=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pauseVideoInBackground)!==null&&t!==void 0)||t?this.isInBackground:!1,o=this.elementInfos.some(s=>s.pictureInPicture),a=this.elementInfos.some(s=>s.visible)&&!n||o;if(this.lastVisible!==a){if(!a&&Date.now()-r<fo){Me.setTimeout(()=>{this.updateVisibility()},fo);return}this.lastVisible=a,this.emit(ee.VisibilityChanged,a,this)}}updateDimensions(){var e,t;let r=0,n=0;const o=this.getPixelDensity();for(const a of this.elementInfos){const s=a.width()*o,c=a.height()*o;s+c>r+n&&(r=s,n=c)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===r&&((t=this.lastDimensions)===null||t===void 0?void 0:t.height)===n||(this.lastDimensions={width:r,height:n},this.emit(ee.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const t=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return t==="screen"?fc():t||(fc()>2?2:1)}}class Jp{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,t){this.onVisibilityChanged=r=>{var n;const{target:o,isIntersecting:a}=r;o===this.element&&(this.isIntersecting=a,this.visibilityChangedAt=Date.now(),(n=this.handleVisibilityChanged)===null||n===void 0||n.call(this))},this.onEnterPiP=()=>{var r;this.isPiP=!0,(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this)},this.onLeavePiP=()=>{var r;this.isPiP=!1,(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this)},this.element=e,this.isIntersecting=t??Ac(e),this.isPiP=Ye()&&document.pictureInPictureElement===e,this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){this.isIntersecting=Ac(this.element),this.isPiP=document.pictureInPictureElement===this.element,this.element.handleResize=()=>{var e;(e=this.handleResize)===null||e===void 0||e.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,mc().observe(this.element),pc().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP)}stopObserving(){var e,t;(e=mc())===null||e===void 0||e.unobserve(this.element),(t=pc())===null||t===void 0||t.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP)}}function Ac(i){let e=i.offsetTop,t=i.offsetLeft;const r=i.offsetWidth,n=i.offsetHeight,{hidden:o}=i,{opacity:a,display:s}=getComputedStyle(i);for(;i.offsetParent;)i=i.offsetParent,e+=i.offsetTop,t+=i.offsetLeft;return e<window.pageYOffset+window.innerHeight&&t<window.pageXOffset+window.innerWidth&&e+n>window.pageYOffset&&t+r>window.pageXOffset&&!o&&(a!==""?parseFloat(a)>0:!0)&&s!=="none"}class oi extends ii.EventEmitter{constructor(e,t,r,n){var o;super(),this.metadataMuted=!1,this.encryption=Ie.NONE,this.log=he,this.handleMuted=()=>{this.emit(ee.Muted)},this.handleUnmuted=()=>{this.emit(ee.Unmuted)},this.log=Mi((o=n==null?void 0:n.loggerName)!==null&&o!==void 0?o:Zt.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=t,this.trackName=r,this.source=W.Source.Unknown}setTrack(e){this.track&&(this.track.off(ee.Muted,this.handleMuted),this.track.off(ee.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(ee.Muted,this.handleMuted),e.on(ee.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),_e(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==Ie.NONE}get audioTrack(){if(this.track instanceof tt||this.track instanceof Sn)return this.track}get videoTrack(){if(this.track instanceof at||this.track instanceof Cn)return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=W.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===W.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(i){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(i.SubscriptionStatus||(i.SubscriptionStatus={})),function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"}(i.PermissionStatus||(i.PermissionStatus={}))})(oi||(oi={}));class ms extends oi{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,t,r,n){super(e,t.sid,t.name,n),this.track=void 0,this.handleTrackEnded=()=>{this.emit(ee.Ended)},this.updateInfo(t),this.setTrack(r)}setTrack(e){this.track&&this.track.off(ee.Ended,this.handleTrackEnded),super.setTrack(e),e&&e.on(ee.Ended,this.handleTrackEnded)}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}mute(){var e;return N(this,void 0,void 0,function*(){return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){var e;return N(this,void 0,void 0,function*(){return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){var e;return N(this,void 0,void 0,function*(){yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){var e;return N(this,void 0,void 0,function*(){yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}}var qi;(function(i){i.Excellent="excellent",i.Good="good",i.Poor="poor",i.Lost="lost",i.Unknown="unknown"})(qi||(qi={}));function $p(i){switch(i){case ci.EXCELLENT:return qi.Excellent;case ci.GOOD:return qi.Good;case ci.POOR:return qi.Poor;case ci.LOST:return qi.Lost;default:return qi.Unknown}}class eu extends ii.EventEmitter{get logContext(){var e,t;return Object.assign(Object.assign({},(t=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||t===void 0?void 0:t.call(e)),{participantSid:this.sid,participantId:this.identity})}get isEncrypted(){return this.tracks.size>0&&Array.from(this.tracks.values()).every(e=>e.isEncrypted)}get isAgent(){var e,t;return(t=(e=this.permissions)===null||e===void 0?void 0:e.agent)!==null&&t!==void 0?t:!1}constructor(e,t,r,n,o){var a;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=qi.Unknown,this.log=he,this.log=Mi((a=o==null?void 0:o.loggerName)!==null&&a!==void 0?a:Zt.Participant),this.loggerOptions=o,this.setMaxListeners(100),this.sid=e,this.identity=t,this.name=r,this.metadata=n,this.audioTracks=new Map,this.videoTracks=new Map,this.tracks=new Map}getTracks(){return Array.from(this.tracks.values())}getTrack(e){for(const[,t]of this.tracks)if(t.source===e)return t}getTrackByName(e){for(const[,t]of this.tracks)if(t.trackName===e)return t}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const t=this.getTrack(W.Source.Camera);return!(!((e=t==null?void 0:t.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const t=this.getTrack(W.Source.Microphone);return!(!((e=t==null?void 0:t.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrack(W.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,this.log.trace("update participant info",Object.assign(Object.assign({},this.logContext),{info:e})),!0)}_setMetadata(e){const t=this.metadata!==e,r=this.metadata;this.metadata=e,t&&this.emit(G.ParticipantMetadataChanged,r)}_setName(e){const t=this.name!==e;this.name=e,t&&this.emit(G.ParticipantNameChanged,e)}setPermissions(e){var t,r,n,o,a;const s=this.permissions,c=e.canPublish!==((t=this.permissions)===null||t===void 0?void 0:t.canPublish)||e.canSubscribe!==((r=this.permissions)===null||r===void 0?void 0:r.canSubscribe)||e.canPublishData!==((n=this.permissions)===null||n===void 0?void 0:n.canPublishData)||e.hidden!==((o=this.permissions)===null||o===void 0?void 0:o.hidden)||e.recorder!==((a=this.permissions)===null||a===void 0?void 0:a.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((l,u)=>{var h;return l!==((h=this.permissions)===null||h===void 0?void 0:h.canPublishSources[u])});return this.permissions=e,c&&this.emit(G.ParticipantPermissionsChanged,s),c}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(G.IsSpeakingChanged,e))}setConnectionQuality(e){const t=this._connectionQuality;this._connectionQuality=$p(e),t!==this._connectionQuality&&this.emit(G.ConnectionQualityChanged,this._connectionQuality)}setAudioContext(e){this.audioContext=e,this.audioTracks.forEach(t=>(t.track instanceof Sn||t.track instanceof tt)&&t.track.setAudioContext(e))}addTrackPublication(e){e.on(ee.Muted,()=>{this.emit(G.TrackMuted,e)}),e.on(ee.Unmuted,()=>{this.emit(G.TrackUnmuted,e)});const t=e;switch(t.track&&(t.track.sid=e.trackSid),this.tracks.set(e.trackSid,e),e.kind){case W.Kind.Audio:this.audioTracks.set(e.trackSid,e);break;case W.Kind.Video:this.videoTracks.set(e.trackSid,e);break}}}function zp(i){var e,t,r;if(!i.participantSid&&!i.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new Kt({participantIdentity:(e=i.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(t=i.participantSid)!==null&&t!==void 0?t:"",allTracks:(r=i.allowAll)!==null&&r!==void 0?r:!1,trackSids:i.allowedTrackSids||[]})}class tu extends oi{constructor(e,t,r,n){super(e,t.sid,t.name,n),this.track=void 0,this.allowed=!0,this.disabled=!1,this.currentVideoQuality=Oe.HIGH,this.handleEnded=o=>{this.setTrack(void 0),this.emit(ee.Ended,o)},this.handleVisibilityChange=o=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(o),this.logContext),this.disabled=!o,this.emitTrackUpdate()},this.handleVideoDimensionsChange=o=>{this.log.debug("adaptivestream video dimensions ".concat(o.width,"x").concat(o.height),this.logContext),this.videoDimensions=o,this.emitTrackUpdate()},this.subscribed=r,this.updateInfo(t)}setSubscribed(e){const t=this.subscriptionStatus,r=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const n=new lt({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new Ut({participantSid:"",trackSids:[this.trackSid]})]});this.emit(ee.UpdateSubscription,n),this.emitSubscriptionUpdateIfChanged(t),this.emitPermissionUpdateIfChanged(r)}get subscriptionStatus(){return this.subscribed===!1?oi.SubscriptionStatus.Unsubscribed:super.isSubscribed?oi.SubscriptionStatus.Subscribed:oi.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?oi.PermissionStatus.Allowed:oi.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return!this.disabled}setEnabled(e){!this.isManualOperationAllowed()||this.disabled===!e||(this.disabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.currentVideoQuality===e||(this.currentVideoQuality=e,this.videoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var t,r;this.isManualOperationAllowed()&&(((t=this.videoDimensions)===null||t===void 0?void 0:t.width)===e.width&&((r=this.videoDimensions)===null||r===void 0?void 0:r.height)===e.height||(this.track instanceof Cn&&(this.videoDimensions=e),this.currentVideoQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&this.track instanceof Cn&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){return this.currentVideoQuality}setTrack(e){const t=this.subscriptionStatus,r=this.permissionStatus,n=this.track;n!==e&&(n&&(n.off(ee.VideoDimensionsChanged,this.handleVideoDimensionsChange),n.off(ee.VisibilityChanged,this.handleVisibilityChange),n.off(ee.Ended,this.handleEnded),n.detach(),n.stopMonitor(),this.emit(ee.Unsubscribed,n)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(ee.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(ee.VisibilityChanged,this.handleVisibilityChange),e.on(ee.Ended,this.handleEnded),this.emit(ee.Subscribed,e)),this.emitPermissionUpdateIfChanged(r),this.emitSubscriptionUpdateIfChanged(t))}setAllowed(e){const t=this.subscriptionStatus,r=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(r),this.emitSubscriptionUpdateIfChanged(t)}setSubscriptionError(e){this.emit(ee.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const t=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):t!==e.muted&&this.emit(e.muted?ee.Muted:ee.Unmuted)}emitSubscriptionUpdateIfChanged(e){const t=this.subscriptionStatus;e!==t&&this.emit(ee.SubscriptionStatusChanged,t,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(ee.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.kind===W.Kind.Video&&this.isAdaptiveStream?(this.log.warn("adaptive stream is enabled, cannot change video track settings",this.logContext),!1):this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return this.track instanceof Cn&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new Vt({trackSids:[this.trackSid],disabled:this.disabled,fps:this.fps});this.videoDimensions?(e.width=Math.ceil(this.videoDimensions.width),e.height=Math.ceil(this.videoDimensions.height)):this.currentVideoQuality!==void 0?e.quality=this.currentVideoQuality:e.quality=Oe.HIGH,this.emit(ee.UpdateSettings,e)}}class Tn extends eu{static fromParticipantInfo(e,t){return new Tn(e,t.sid,t.identity,t.name,t.metadata)}constructor(e,t,r,n,o,a){super(t,r||"",n,o,a),this.signalClient=e,this.tracks=new Map,this.audioTracks=new Map,this.videoTracks=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(ee.UpdateSettings,t=>{this.log.debug("send update settings",Object.assign(Object.assign({},this.logContext),_e(e))),this.signalClient.sendUpdateTrackSettings(t)}),e.on(ee.UpdateSubscription,t=>{t.participantTracks.forEach(r=>{r.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(t)}),e.on(ee.SubscriptionPermissionChanged,t=>{this.emit(G.TrackSubscriptionPermissionChanged,e,t)}),e.on(ee.SubscriptionStatusChanged,t=>{this.emit(G.TrackSubscriptionStatusChanged,e,t)}),e.on(ee.Subscribed,t=>{this.emit(G.TrackSubscribed,t,e)}),e.on(ee.Unsubscribed,t=>{this.emit(G.TrackUnsubscribed,t,e)}),e.on(ee.SubscriptionFailed,t=>{this.emit(G.TrackSubscriptionFailed,e.trackSid,t)})}getTrack(e){const t=super.getTrack(e);if(t)return t}getTrackByName(e){const t=super.getTrackByName(e);if(t)return t}setVolume(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:W.Source.Microphone;this.volumeMap.set(t,e);const r=this.getTrack(t);r&&r.track&&r.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:W.Source.Microphone;const t=this.getTrack(e);return t&&t.track?t.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,t,r,n,o,a){let s=this.getTrackPublication(t);if(s||t.startsWith("TR")||this.tracks.forEach(u=>{!s&&e.kind===u.kind.toString()&&(s=u)}),!s){if(a===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:t})),this.emit(G.TrackSubscriptionFailed,t);return}a===void 0&&(a=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,t,r,n,o,a-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),_e(s))),this.emit(G.TrackSubscriptionFailed,t);return}const c=e.kind==="video";let l;return c?l=new Cn(e,t,n,o):l=new Sn(e,t,n,this.audioContext,this.audioOutput),l.source=s.source,l.isMuted=s.isMuted,l.setMediaStream(r),l.start(),s.setTrack(l),this.volumeMap.has(s.source)&&l instanceof Sn&&l.setVolume(this.volumeMap.get(s.source)),s}get hasMetadata(){return!!this.participantInfo}getTrackPublication(e){return this.tracks.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const t=new Map,r=new Map;return e.tracks.forEach(n=>{var o,a;let s=this.getTrackPublication(n.sid);if(s)s.updateInfo(n);else{const c=W.kindFromProto(n.type);if(!c)return;s=new tu(c,n,(o=this.signalClient.connectOptions)===null||o===void 0?void 0:o.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(a=this.loggerOptions)===null||a===void 0?void 0:a.loggerName}),s.updateInfo(n),r.set(n.sid,s);const l=Array.from(this.tracks.values()).find(u=>u.source===(s==null?void 0:s.source));l&&s.source!==W.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(s.source),Object.assign(Object.assign({},this.logContext),{oldTrack:_e(l),newTrack:_e(s)})),this.addTrackPublication(s)}t.set(n.sid,s)}),this.tracks.forEach(n=>{t.has(n.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),_e(n))),this.unpublishTrack(n.trackSid,!0))}),r.forEach(n=>{this.emit(G.TrackPublished,n)}),!0}unpublishTrack(e,t){const r=this.tracks.get(e);if(!r)return;const{track:n}=r;switch(n&&(n.stop(),r.setTrack(void 0)),this.tracks.delete(e),r.kind){case W.Kind.Audio:this.audioTracks.delete(e);break;case W.Kind.Video:this.videoTracks.delete(e);break}t&&this.emit(G.TrackUnpublished,r)}setAudioOutput(e){return N(this,void 0,void 0,function*(){this.audioOutput=e;const t=[];this.audioTracks.forEach(r=>{var n;r.track instanceof Sn&&t.push(r.track.setSinkId((n=e.deviceId)!==null&&n!==void 0?n:"default"))}),yield Promise.all(t)})}emit(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:r})),super.emit(e,...r)}}class gs extends eu{constructor(e,t,r,n){super(e,t,void 0,void 0,{loggerName:n.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=Ie.NONE,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Vh)},this.handleReconnected=()=>{var o,a;(a=(o=this.reconnectFuture)===null||o===void 0?void 0:o.resolve)===null||a===void 0||a.call(o),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleDisconnected=()=>{var o,a;this.reconnectFuture&&(this.reconnectFuture.promise.catch(s=>this.log.warn(s.message,this.logContext)),(a=(o=this.reconnectFuture)===null||o===void 0?void 0:o.reject)===null||a===void 0||a.call(o,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0)},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(o=>zp(o)))},this.onTrackUnmuted=o=>{this.onTrackMuted(o,o.isUpstreamPaused)},this.onTrackMuted=(o,a)=>{if(a===void 0&&(a=!0),!o.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),_e(o)));return}this.engine.updateMuteStatus(o.sid,a)},this.onTrackUpstreamPaused=o=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),_e(o))),this.onTrackMuted(o,!0)},this.onTrackUpstreamResumed=o=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),_e(o))),this.onTrackMuted(o,o.isMuted)},this.handleSubscribedQualityUpdate=o=>N(this,void 0,void 0,function*(){var a,s,c,l,u,h;if(!(!((u=this.roomOptions)===null||u===void 0)&&u.dynacast))return;const g=this.videoTracks.get(o.trackSid);if(!g){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:o.trackSid}));return}if(o.subscribedCodecs.length>0){if(!g.videoTrack)return;const f=yield g.videoTrack.setPublishingCodecs(o.subscribedCodecs);try{for(var _=!0,y=Er(f),v;v=yield y.next(),a=v.done,!a;_=!0){l=v.value,_=!1;const p=l;Kf(p)&&(this.log.debug("publish ".concat(p," for ").concat(g.videoTrack.sid),Object.assign(Object.assign({},this.logContext),_e(g))),yield this.publishAdditionalCodecForTrack(g.videoTrack,p,g.options))}}catch(p){s={error:p}}finally{try{!_&&!a&&(c=y.return)&&(yield c.call(y))}finally{if(s)throw s.error}}}else o.subscribedQualities.length>0&&(yield(h=g.videoTrack)===null||h===void 0?void 0:h.setPublishingLayers(o.subscribedQualities))}),this.handleLocalTrackUnpublished=o=>{const a=this.tracks.get(o.trackSid);if(!a){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:o.trackSid}));return}this.unpublishTrack(a.track)},this.handleTrackEnded=o=>N(this,void 0,void 0,function*(){if(o.source===W.Source.ScreenShare||o.source===W.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),_e(o))),this.unpublishTrack(o);else if(o.isUserProvided)yield o.mute();else if(o instanceof tt||o instanceof at)try{if(Ye())try{const a=yield navigator==null?void 0:navigator.permissions.query({name:o.source===W.Source.Camera?"camera":"microphone"});if(a&&a.state==="denied")throw this.log.warn("user has revoked access to ".concat(o.source),Object.assign(Object.assign({},this.logContext),_e(o))),a.onchange=()=>{a.state!=="denied"&&(o.isMuted||o.restartTrack(),a.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}o.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),_e(o))),yield o.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),_e(o))),yield o.mute()}}),this.audioTracks=new Map,this.videoTracks=new Map,this.tracks=new Map,this.engine=r,this.roomOptions=n,this.setupEngine(r),this.activeDeviceMap=new Map}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==Ie.NONE}getTrack(e){const t=super.getTrack(e);if(t)return t}getTrackByName(e){const t=super.getTrackByName(e);if(t)return t}setupEngine(e){this.engine=e,this.engine.on(re.RemoteMute,(t,r)=>{const n=this.tracks.get(t);!n||!n.track||(r?n.mute():n.unmute())}),this.engine.on(re.Connected,this.handleReconnected).on(re.SignalRestarted,this.handleReconnected).on(re.SignalResumed,this.handleReconnected).on(re.Restarting,this.handleReconnecting).on(re.Resuming,this.handleReconnecting).on(re.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(re.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(re.Disconnected,this.handleDisconnected)}setMetadata(e){var t;this.engine.client.sendUpdateLocalMetadata(e,(t=this.name)!==null&&t!==void 0?t:"")}setName(e){var t;this.engine.client.sendUpdateLocalMetadata((t=this.metadata)!==null&&t!==void 0?t:"",e)}setCameraEnabled(e,t,r){return this.setTrackEnabled(W.Source.Camera,e,t,r)}setMicrophoneEnabled(e,t,r){return this.setTrackEnabled(W.Source.Microphone,e,t,r)}setScreenShareEnabled(e,t,r){return this.setTrackEnabled(W.Source.ScreenShare,e,t,r)}setPermissions(e){const t=this.permissions,r=super.setPermissions(e);return r&&t&&this.emit(G.ParticipantPermissionsChanged,t),r}setE2EEEnabled(e){return N(this,void 0,void 0,function*(){this.encryptionType=e?Ie.GCM:Ie.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,t,r,n){var o,a;return N(this,void 0,void 0,function*(){this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:t}));let s=this.getTrack(e);if(t)if(s)yield s.unmute();else{let c;if(this.pendingPublishing.has(e)){this.log.info("skipping duplicate published source",Object.assign(Object.assign({},this.logContext),{source:e}));return}this.pendingPublishing.add(e);try{switch(e){case W.Source.Camera:c=yield this.createTracks({video:(o=r)!==null&&o!==void 0?o:!0});break;case W.Source.Microphone:c=yield this.createTracks({audio:(a=r)!==null&&a!==void 0?a:!0});break;case W.Source.ScreenShare:c=yield this.createScreenTracks(Object.assign({},r));break;default:throw new Mt(e)}const l=[];for(const h of c)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),_e(h))),l.push(this.publishTrack(h,n));[s]=yield Promise.all(l)}catch(l){throw c==null||c.forEach(u=>{u.stop()}),l instanceof Error&&!(l instanceof Mt)&&this.emit(G.MediaDevicesError,l),l}finally{this.pendingPublishing.delete(e)}}else if(s&&s.track)if(e===W.Source.ScreenShare){s=yield this.unpublishTrack(s.track);const c=this.getTrack(W.Source.ScreenShareAudio);c&&c.track&&this.unpublishTrack(c.track)}else yield s.mute();return s})}enableCameraAndMicrophone(){return N(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(W.Source.Camera)||this.pendingPublishing.has(W.Source.Microphone))){this.pendingPublishing.add(W.Source.Camera),this.pendingPublishing.add(W.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(t=>this.publishTrack(t)))}finally{this.pendingPublishing.delete(W.Source.Camera),this.pendingPublishing.delete(W.Source.Microphone)}}})}createTracks(e){var t,r;return N(this,void 0,void 0,function*(){const n=Fh(e,(t=this.roomOptions)===null||t===void 0?void 0:t.audioCaptureDefaults,(r=this.roomOptions)===null||r===void 0?void 0:r.videoCaptureDefaults),o=Ls(n);let a;try{a=yield navigator.mediaDevices.getUserMedia(o)}catch(s){throw s instanceof Error&&(o.audio&&(this.microphoneError=s),o.video&&(this.cameraError=s)),s}return o.audio&&(this.microphoneError=void 0,this.emit(G.AudioStreamAcquired)),o.video&&(this.cameraError=void 0),a.getTracks().map(s=>{const c=s.kind==="audio";c?e.audio:e.video;let l;const u=c?o.audio:o.video;typeof u!="boolean"&&(l=u);const h=Xh(s,l,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});return h.kind===W.Kind.Video?h.source=W.Source.Camera:h.kind===W.Kind.Audio&&(h.source=W.Source.Microphone),h.mediaStream=a,h})})}createScreenTracks(e){return N(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new va("getDisplayMedia not supported");e.resolution===void 0&&!cp()&&(e.resolution=ba.h1080fps30.resolution);const t=Zf(e),r=yield navigator.mediaDevices.getDisplayMedia(t),n=r.getVideoTracks();if(n.length===0)throw new Mt("no video track found");const o=new at(n[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});o.source=W.Source.ScreenShare,e.contentHint&&(o.mediaStreamTrack.contentHint=e.contentHint);const a=[o];if(r.getAudioTracks().length>0){this.emit(G.AudioStreamAcquired);const s=new tt(r.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});s.source=W.Source.ScreenShareAudio,a.push(s)}return a})}publishTrack(e,t){var r,n,o,a;return N(this,void 0,void 0,function*(){yield(r=this.reconnectFuture)===null||r===void 0?void 0:r.promise,e instanceof zr&&this.pendingPublishPromises.has(e)&&(yield this.pendingPublishPromises.get(e));let s;if(e instanceof MediaStreamTrack)s=e.getConstraints();else{s=e.constraints;let _;switch(e.source){case W.Source.Microphone:_="audioinput";break;case W.Source.Camera:_="videoinput"}_&&this.activeDeviceMap.has(_)&&(s=Object.assign(Object.assign({},s),{deviceId:this.activeDeviceMap.get(_)}))}if(e instanceof MediaStreamTrack)switch(e.kind){case"audio":e=new tt(e,s,!0,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});break;case"video":e=new at(e,s,!0,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});break;default:throw new Mt("unsupported MediaStreamTrack kind ".concat(e.kind))}else e.updateLoggerOptions({loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});e instanceof tt&&e.setAudioContext(this.audioContext);let c;if(this.tracks.forEach(_=>{_.track&&_.track===e&&(c=_)}),c)return this.log.warn("track has already been published, skipping",Object.assign(Object.assign({},this.logContext),_e(c))),c;const l="channelCount"in e.mediaStreamTrack.getSettings()&&e.mediaStreamTrack.getSettings().channelCount===2||e.mediaStreamTrack.getConstraints().channelCount===2,u=(n=t==null?void 0:t.forceStereo)!==null&&n!==void 0?n:l;u&&(t||(t={}),t.dtx===void 0&&this.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},this.logContext),_e(e))),t.red===void 0&&this.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(o=t.dtx)!==null&&o!==void 0||(t.dtx=!1),(a=t.red)!==null&&a!==void 0||(t.red=!1));const h=Object.assign(Object.assign({},this.roomOptions.publishDefaults),t);_r()&&this.roomOptions.e2ee&&(this.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari",Object.assign({},this.logContext)),h.simulcast=!1),h.source&&(e.source=h.source);const g=this.publish(e,h,u);this.pendingPublishPromises.set(e,g);try{return yield g}catch(_){throw _}finally{this.pendingPublishPromises.delete(e)}})}publish(e,t,r){var n,o,a,s,c,l,u,h,g,_,y,v,f;return N(this,void 0,void 0,function*(){Array.from(this.tracks.values()).find(S=>e instanceof zr&&S.source===e.source)&&e.source!==W.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),_e(e))),t.stopMicTrackOnMute&&e instanceof tt&&(e.stopOnMute=!0),e.source===W.Source.ScreenShare&&$r()&&(t.simulcast=!1),t.videoCodec==="av1"&&!rp()&&(t.videoCodec=void 0),t.videoCodec==="vp9"&&!np()&&(t.videoCodec=void 0),t.videoCodec===void 0&&(t.videoCodec=qo);const d=t.videoCodec;e.on(ee.Muted,this.onTrackMuted),e.on(ee.Unmuted,this.onTrackUnmuted),e.on(ee.Ended,this.handleTrackEnded),e.on(ee.UpstreamPaused,this.onTrackUpstreamPaused),e.on(ee.UpstreamResumed,this.onTrackUpstreamResumed);const m=new yt({cid:e.mediaStreamTrack.id,name:t.name,type:W.kindToProto(e.kind),muted:e.isMuted,source:W.sourceToProto(e.source),disableDtx:!(!((n=t.dtx)!==null&&n!==void 0)||n),encryption:this.encryptionType,stereo:r,disableRed:this.isE2EEEnabled||!(!((o=t.red)!==null&&o!==void 0)||o),stream:t==null?void 0:t.stream});let b;if(e.kind===W.Kind.Video){let S={width:0,height:0};try{S=yield e.waitForDimensions()}catch{const O=(s=(a=this.roomOptions.videoCaptureDefaults)===null||a===void 0?void 0:a.resolution)!==null&&s!==void 0?s:kn.h720.resolution;S={width:O.width,height:O.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),_e(e)),{dims:S}))}m.width=S.width,m.height=S.height,e instanceof at&&(bn(d)&&(e.source===W.Source.ScreenShare&&d==="vp9"&&(t.scalabilityMode="L1T3"),t.scalabilityMode=(c=t.scalabilityMode)!==null&&c!==void 0?c:"L3T3_KEY"),m.simulcastCodecs=[new bt({codec:d,cid:e.mediaStreamTrack.id})],t.backupCodec===!0&&(t.backupCodec={codec:qo}),t.backupCodec&&d!==t.backupCodec.codec&&m.encryption===Ie.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),m.simulcastCodecs.push(new bt({codec:t.backupCodec.codec,cid:""})))),b=Jo(e.source===W.Source.ScreenShare,m.width,m.height,t),m.layers=Dc(m.width,m.height,b,bn(t.videoCodec))}else e.kind===W.Kind.Audio&&(b=[{maxBitrate:(u=(l=t.audioPreset)===null||l===void 0?void 0:l.maxBitrate)!==null&&u!==void 0?u:t.audioBitrate,priority:(g=(h=t.audioPreset)===null||h===void 0?void 0:h.priority)!==null&&g!==void 0?g:"high",networkPriority:(y=(_=t.audioPreset)===null||_===void 0?void 0:_.priority)!==null&&y!==void 0?y:"high"}]);if(!this.engine||this.engine.isClosed)throw new Pe("cannot publish track when not connected");const C=yield this.engine.addTrack(m);let w;if(C.codecs.forEach(S=>{w===void 0&&(w=S.mimeType)}),w&&e.kind===W.Kind.Video){const S=jh(w);S!==d&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),_e(e)),{codec:S})),t.videoCodec=S,b=Jo(e.source===W.Source.ScreenShare,m.width,m.height,t))}const T=new ms(e.kind,C,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(T.options=t,e.sid=C.sid,!this.engine.pcManager)throw new Pe("pcManager is not ready");if(this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:b,trackInfo:C})),e.sender=yield this.engine.createSender(e,t,b),b)if($r()&&e.kind===W.Kind.Audio){let S;for(const k of this.engine.pcManager.publisher.getTransceivers())if(k.sender===e.sender){S=k;break}S&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:S,codec:"opus",maxbr:!((v=b[0])===null||v===void 0)&&v.maxBitrate?b[0].maxBitrate/1e3:0})}else e.codec&&bn(e.codec)&&(!((f=b[0])===null||f===void 0)&&f.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:m.cid,codec:e.codec,maxbr:b[0].maxBitrate/1e3});return yield this.engine.negotiate(),e instanceof at?e.startMonitor(this.engine.client):e instanceof tt&&e.startMonitor(),this.addTrackPublication(T),this.emit(G.LocalTrackPublished,T),T})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,t,r){var n;return N(this,void 0,void 0,function*(){if(this.encryptionType!==Ie.NONE)return;let o;if(this.tracks.forEach(h=>{h.track&&h.track===e&&(o=h)}),!o)throw new Mt("track is not published");if(!(e instanceof at))throw new Mt("track is not a video track");const a=Object.assign(Object.assign({},(n=this.roomOptions)===null||n===void 0?void 0:n.publishDefaults),r),s=Hp(e,t,a);if(!s){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),_e(e)));return}const c=e.addSimulcastTrack(t,s),l=new yt({cid:c.mediaStreamTrack.id,type:W.kindToProto(e.kind),muted:e.isMuted,source:W.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:a.videoCodec,cid:c.mediaStreamTrack.id}]});if(l.layers=Dc(l.width,l.height,s),!this.engine||this.engine.isClosed)throw new Pe("cannot publish track when not connected");const u=yield this.engine.addTrack(l);yield this.engine.createSimulcastSender(e,c,a,s),yield this.engine.negotiate(),this.log.debug("published ".concat(t," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:s,trackInfo:u}))})}unpublishTrack(e,t){var r,n;return N(this,void 0,void 0,function*(){const o=this.getPublicationForTrack(e),a=o?_e(o):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),a)),!o||!o.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),a));return}e=o.track,e.off(ee.Muted,this.onTrackMuted),e.off(ee.Unmuted,this.onTrackUnmuted),e.off(ee.Ended,this.handleTrackEnded),e.off(ee.UpstreamPaused,this.onTrackUpstreamPaused),e.off(ee.UpstreamResumed,this.onTrackUpstreamResumed),t===void 0&&(t=(n=(r=this.roomOptions)===null||r===void 0?void 0:r.stopLocalTrackOnUnpublish)!==null&&n!==void 0?n:!0),t&&e.stop();let s=!1;const c=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<xe.FAILED&&c)try{for(const l of this.engine.pcManager.publisher.getTransceivers())l.sender===c&&(l.direction="inactive",s=!0);if(this.engine.removeTrack(c)&&(s=!0),e instanceof at){for(const[,l]of e.simulcastCodecs)l.sender&&(this.engine.removeTrack(l.sender)&&(s=!0),l.sender=void 0);e.simulcastCodecs.clear()}}catch(l){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),a),{error:l}))}switch(this.tracks.delete(o.trackSid),o.kind){case W.Kind.Audio:this.audioTracks.delete(o.trackSid);break;case W.Kind.Video:this.videoTracks.delete(o.trackSid);break}return this.emit(G.LocalTrackUnpublished,o),o.setTrack(void 0),s&&(yield this.engine.negotiate()),o})}unpublishTracks(e){return N(this,void 0,void 0,function*(){return(yield Promise.all(e.map(r=>this.unpublishTrack(r)))).filter(r=>r instanceof ms)})}republishAllTracks(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return N(this,void 0,void 0,function*(){const r=[];this.tracks.forEach(n=>{n.track&&(e&&(n.options=Object.assign(Object.assign({},n.options),e)),r.push(n))}),yield Promise.all(r.map(n=>N(this,void 0,void 0,function*(){const o=n.track;yield this.unpublishTrack(o,!1),t&&!o.isMuted&&o.source!==W.Source.ScreenShare&&o.source!==W.Source.ScreenShareAudio&&(o instanceof tt||o instanceof at)&&!o.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:n.trackSid})),yield o.restartTrack()),yield this.publishTrack(o,n.options)})))})}publishData(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return N(this,void 0,void 0,function*(){const n=Array.isArray(r)?r:r==null?void 0:r.destination,o=[],a=Array.isArray(r)?void 0:r.topic;n!==void 0&&n.forEach(c=>{c instanceof Tn?o.push(c.sid):o.push(c)});const s=new Bt({kind:t,value:{case:"user",value:new Ft({participantSid:this.sid,payload:e,destinationSids:o,topic:a})}});yield this.engine.sendDataPacket(s,t)})}setTrackSubscriptionPermissions(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=t,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}updateInfo(e){return e.sid!==this.sid||!super.updateInfo(e)?!1:(e.tracks.forEach(t=>{var r,n;const o=this.tracks.get(t.sid);if(o){const a=o.isMuted||((n=(r=o.track)===null||r===void 0?void 0:r.isUpstreamPaused)!==null&&n!==void 0?n:!1);a!==t.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),_e(o)),{mutedOnServer:a})),this.engine.client.sendMuteTrack(t.sid,a))}}),!0)}getPublicationForTrack(e){let t;return this.tracks.forEach(r=>{const n=r.track;n&&(e instanceof MediaStreamTrack?(n instanceof tt||n instanceof at)&&n.mediaStreamTrack===e&&(t=r):e===n&&(t=r))}),t}}var fe;(function(i){i.Disconnected="disconnected",i.Connecting="connecting",i.Connected="connected",i.Reconnecting="reconnecting"})(fe||(fe={}));const Kp=2*1e3;class $o extends ii.EventEmitter{constructor(e){var t,r,n;super(),t=this,this.state=fe.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=he,this.bufferedEvents=[],this.connect=(o,a,s)=>N(this,void 0,void 0,function*(){var c;const l=yield this.disconnectLock.lock();if(this.state===fe.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),l(),Promise.resolve();if(this.connectFuture)return l(),this.connectFuture.promise;this.setAndEmitConnectionState(fe.Connecting),((c=this.regionUrlProvider)===null||c===void 0?void 0:c.getServerUrl().toString())!==o&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),Wo(new URL(o))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new Pc(o,a):this.regionUrlProvider.updateToken(a),this.regionUrlProvider.fetchRegionSettings().catch(g=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:g}))}));const u=(g,_,y)=>N(this,void 0,void 0,function*(){var v;this.abortController&&this.abortController.abort();const f=new AbortController;this.abortController=f,l==null||l();try{yield this.attemptConnection(y??o,a,s,f),this.abortController=void 0,g()}catch(p){if(this.regionUrlProvider&&p instanceof ge&&p.reason!==3&&p.reason!==0){let d=null;try{d=yield this.regionUrlProvider.getNextBestRegionUrl((v=this.abortController)===null||v===void 0?void 0:v.signal)}catch(m){if(m instanceof ge&&(m.status===401||m.reason===3)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),_(m);return}}d?(this.log.info("Initial connection failed with ConnectionError: ".concat(p.message,". Retrying with another region: ").concat(d),this.logContext),yield u(g,_,d)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),_(p))}else this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),_(p)}}),h=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Vh((g,_)=>{u(g,_,h)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(o,a,s,c,l,u)=>N(this,void 0,void 0,function*(){var h,g,_;const y=yield s.join(o,a,{autoSubscribe:c.autoSubscribe,publishOnly:c.publishOnly,adaptiveStream:typeof l.adaptiveStream=="object"?!0:l.adaptiveStream,maxRetries:c.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:c.websocketTimeout},u.signal);let v=y.serverInfo;if(v||(v={version:y.serverVersion,region:y.serverRegion}),this.log.debug("connected to Livekit Server ".concat(Object.entries(v).map(f=>{let[p,d]=f;return"".concat(p,": ").concat(d)}).join(", ")),{room:(h=y.room)===null||h===void 0?void 0:h.name,roomSid:(g=y.room)===null||g===void 0?void 0:g.sid,identity:(_=y.participant)===null||_===void 0?void 0:_.identity}),!y.serverVersion)throw new Hf("unknown server version");return y.serverVersion==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),l.dynacast=!1),y}),this.applyJoinResponse=o=>{const a=o.participant;this.localParticipant.sid=a.sid,this.localParticipant.identity=a.identity,this.handleParticipantUpdates([a,...o.otherParticipants]),o.room&&this.handleRoomUpdate(o.room),this.options.e2ee&&this.e2eeManager&&this.e2eeManager.setSifTrailer(o.sifTrailer)},this.attemptConnection=(o,a,s,c)=>N(this,void 0,void 0,function*(){var l,u;this.state===fe.Reconnecting?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((l=this.regionUrlProvider)===null||l===void 0)&&l.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},Ca),s),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const h=yield this.connectSignal(o,a,this.engine,this.connOptions,this.options,c);this.applyJoinResponse(h),this.setupLocalParticipantEvents(),this.emit($.SignalConnected)}catch(h){yield this.engine.close(),this.recreateEngine();const g=new ge("could not establish signal connection");throw h instanceof Error&&(g.message="".concat(g.message,": ").concat(h.message)),h instanceof ge&&(g.reason=h.reason,g.status=h.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:h})),g}if(c.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new ge("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,c)}catch(h){throw yield this.engine.close(),this.recreateEngine(),h}Ye()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),Ye()&&(document.addEventListener("freeze",this.onPageLeave),(u=navigator.mediaDevices)===null||u===void 0||u.addEventListener("devicechange",this.handleDeviceChange)),this.setAndEmitConnectionState(fe.Connected),this.emit($.Connected),this.registerConnectionReconcile()}),this.disconnect=function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return N(t,void 0,void 0,function*(){var a,s,c,l;const u=yield this.disconnectLock.lock();try{if(this.state===fe.Disconnected){this.log.debug("already disconnected",this.logContext);return}this.log.info("disconnect from room",Object.assign({},this.logContext)),(this.state===fe.Connecting||this.state===fe.Reconnecting)&&(this.log.warn("abort connection attempt",this.logContext),(a=this.abortController)===null||a===void 0||a.abort(),(c=(s=this.connectFuture)===null||s===void 0?void 0:s.reject)===null||c===void 0||c.call(s,new ge("Client initiated disconnect")),this.connectFuture=void 0),!((l=this.engine)===null||l===void 0)&&l.client.isDisconnected||(yield this.engine.client.sendLeave()),this.engine&&(yield this.engine.close()),this.handleDisconnect(o,Ai.CLIENT_INITIATED),this.engine=void 0}finally{u()}})},this.onPageLeave=()=>N(this,void 0,void 0,function*(){yield this.disconnect()}),this.startAudio=()=>N(this,void 0,void 0,function*(){const o=[],a=Bi();if(a&&a.os==="iOS"){const s="livekit-dummy-audio-el";let c=document.getElementById(s);if(!c){c=document.createElement("audio"),c.id=s,c.autoplay=!0,c.hidden=!0;const l=co();l.enabled=!0;const u=new MediaStream([l]);c.srcObject=u,document.addEventListener("visibilitychange",()=>{c&&(c.srcObject=document.hidden?null:u,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(c),this.once($.Disconnected,()=>{c==null||c.remove(),c=null})}o.push(c)}this.participants.forEach(s=>{s.audioTracks.forEach(c=>{c.track&&c.track.attachedElements.forEach(l=>{o.push(l)})})});try{yield Promise.all([this.acquireAudioContext(),...o.map(s=>(s.muted=!1,s.play()))]),this.handleAudioPlaybackStarted()}catch(s){throw this.handleAudioPlaybackFailed(s),s}}),this.startVideo=()=>N(this,void 0,void 0,function*(){const o=[];for(const a of this.participants.values())a.videoTracks.forEach(s=>{var c;(c=s.track)===null||c===void 0||c.attachedElements.forEach(l=>{o.includes(l)||o.push(l)})});yield Promise.all(o.map(a=>a.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(a=>{a.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile();for(const o of this.participants.values())this.handleParticipantDisconnected(o.sid,o);this.setAndEmitConnectionState(fe.Reconnecting)&&this.emit($.Reconnecting)},this.handleSignalRestarted=o=>N(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(o.serverRegion),Object.assign(Object.assign({},this.logContext),{region:o.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(o);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(a){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:a}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:o.serverRegion}))}catch{return}this.setAndEmitConnectionState(fe.Connected),this.emit($.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=o=>{o.forEach(a=>{if(a.identity===this.localParticipant.identity){this.localParticipant.updateInfo(a);return}const s=this.identityToSid.get(a.identity);s&&s!==a.sid&&this.handleParticipantDisconnected(s,this.participants.get(s));let c=this.participants.get(a.sid);const l=!c;a.state===gr.DISCONNECTED?this.handleParticipantDisconnected(a.sid,c):(c=this.getOrCreateParticipant(a.sid,a),l||c.updateInfo(a))})},this.handleActiveSpeakersUpdate=o=>{const a=[],s={};o.forEach(c=>{if(s[c.sid]=!0,c.sid===this.localParticipant.sid)this.localParticipant.audioLevel=c.level,this.localParticipant.setIsSpeaking(!0),a.push(this.localParticipant);else{const l=this.participants.get(c.sid);l&&(l.audioLevel=c.level,l.setIsSpeaking(!0),a.push(l))}}),s[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.participants.forEach(c=>{s[c.sid]||(c.audioLevel=0,c.setIsSpeaking(!1))}),this.activeSpeakers=a,this.emitWhenConnected($.ActiveSpeakersChanged,a)},this.handleSpeakersChanged=o=>{const a=new Map;this.activeSpeakers.forEach(c=>{a.set(c.sid,c)}),o.forEach(c=>{let l=this.participants.get(c.sid);c.sid===this.localParticipant.sid&&(l=this.localParticipant),l&&(l.audioLevel=c.level,l.setIsSpeaking(c.active),c.active?a.set(c.sid,l):a.delete(c.sid))});const s=Array.from(a.values());s.sort((c,l)=>l.audioLevel-c.audioLevel),this.activeSpeakers=s,this.emitWhenConnected($.ActiveSpeakersChanged,s)},this.handleStreamStateUpdate=o=>{o.streamStates.forEach(a=>{const s=this.participants.get(a.participantSid);if(!s)return;const c=s.getTrackPublication(a.trackSid);!c||!c.track||(c.track.streamState=W.streamStateFromProto(a.state),s.emit(G.TrackStreamStateChanged,c,c.track.streamState),this.emitWhenConnected($.TrackStreamStateChanged,c,c.track.streamState,s))})},this.handleSubscriptionPermissionUpdate=o=>{const a=this.participants.get(o.participantSid);if(!a)return;const s=a.getTrackPublication(o.trackSid);s&&s.setAllowed(o.allowed)},this.handleSubscriptionError=o=>{const a=Array.from(this.participants.values()).find(c=>c.tracks.has(o.trackSid));if(!a)return;const s=a.getTrackPublication(o.trackSid);s&&s.setSubscriptionError(o.err)},this.handleDataPacket=(o,a)=>{const s=this.participants.get(o.participantSid);this.emit($.DataReceived,o.payload,s,a,o.topic),s==null||s.emit(G.DataReceived,o.payload,a)},this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit($.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=o=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:o})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit($.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit($.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit($.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>N(this,void 0,void 0,function*(){this.emit($.MediaDevicesChanged)}),this.handleRoomUpdate=o=>{const a=this.roomInfo;this.roomInfo=o,a&&a.metadata!==o.metadata&&this.emitWhenConnected($.RoomMetadataChanged,o.metadata),(a==null?void 0:a.activeRecording)!==o.activeRecording&&this.emitWhenConnected($.RecordingStatusChanged,o.activeRecording)},this.handleConnectionQualityUpdate=o=>{o.updates.forEach(a=>{if(a.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(a.quality);return}const s=this.participants.get(a.participantSid);s&&s.setConnectionQuality(a.quality)})},this.onLocalParticipantMetadataChanged=o=>{this.emit($.ParticipantMetadataChanged,o,this.localParticipant)},this.onLocalParticipantNameChanged=o=>{this.emit($.ParticipantNameChanged,o,this.localParticipant)},this.onLocalTrackMuted=o=>{this.emit($.TrackMuted,o,this.localParticipant)},this.onLocalTrackUnmuted=o=>{this.emit($.TrackUnmuted,o,this.localParticipant)},this.onLocalTrackPublished=o=>N(this,void 0,void 0,function*(){var a;this.emit($.LocalTrackPublished,o,this.localParticipant),o.track instanceof tt&&(yield o.track.checkForSilence())&&this.emit($.LocalAudioSilenceDetected,o);const s=yield(a=o.track)===null||a===void 0?void 0:a.getDeviceId(),c=Yf(o.source);c&&s&&s!==this.localParticipant.activeDeviceMap.get(c)&&(this.localParticipant.activeDeviceMap.set(c,s),this.emit($.ActiveDeviceChanged,c,s))}),this.onLocalTrackUnpublished=o=>{this.emit($.LocalTrackUnpublished,o,this.localParticipant)},this.onLocalConnectionQualityChanged=o=>{this.emit($.ConnectionQualityChanged,o,this.localParticipant)},this.onMediaDevicesError=o=>{this.emit($.MediaDevicesError,o)},this.onLocalParticipantPermissionsChanged=o=>{this.emit($.ParticipantPermissionsChanged,o,this.localParticipant)},this.setMaxListeners(100),this.participants=new Map,this.identityToSid=new Map,this.options=Object.assign(Object.assign({},Op),e),this.log=Mi((r=this.options.loggerName)!==null&&r!==void 0?r:Zt.Room),this.options.audioCaptureDefaults=Object.assign(Object.assign({},Kh),e==null?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},Gh),e==null?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},xp),e==null?void 0:e.publishDefaults),this.maybeCreateEngine(),this.disconnectLock=new Tt,this.localParticipant=new gs("","",this.engine,this.options),this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",pr(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",pr(this.options.audioCaptureDefaults.deviceId)),!((n=this.options.audioOutput)===null||n===void 0)&&n.deviceId&&this.switchActiveDevice("audiooutput",pr(this.options.audioOutput.deviceId)).catch(o=>this.log.warn("Could not set audio output: ".concat(o.message),this.logContext)),this.options.e2ee&&this.setupE2EE()}setE2EEEnabled(e){return N(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;this.options.e2ee&&(this.e2eeManager=new mp(this.options.e2ee),this.e2eeManager.on(Zi.ParticipantEncryptionStatusChanged,(t,r)=>{r instanceof gs&&(this.isE2EEEnabled=t),this.emit($.ParticipantEncryptionStatusChanged,t,r)}),this.e2eeManager.on(Zi.EncryptionError,t=>this.emit($.EncryptionError,t)),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){return{room:this.name,roomSid:this.sid,identity:this.localParticipant.identity}}get isRecording(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&t!==void 0?t:!1}get sid(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.sid)!==null&&t!==void 0?t:""}get name(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&t!==void 0?t:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&t!==void 0?t:0}get numPublishers(){var e,t;return(t=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&t!==void 0?t:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new Lp(this.options),this.engine.on(re.ParticipantUpdate,this.handleParticipantUpdates).on(re.RoomUpdate,this.handleRoomUpdate).on(re.SpeakersChanged,this.handleSpeakersChanged).on(re.StreamStateChanged,this.handleStreamStateUpdate).on(re.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(re.SubscriptionError,this.handleSubscriptionError).on(re.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(re.MediaTrackAdded,(e,t,r)=>{this.onTrackAdded(e,t,r)}).on(re.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(re.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(re.DataPacketReceived,this.handleDataPacket).on(re.Resuming,()=>{this.clearConnectionReconcile(),this.setAndEmitConnectionState(fe.Reconnecting)&&this.emit($.Reconnecting)}).on(re.Resumed,()=>{this.setAndEmitConnectionState(fe.Connected),this.emit($.Reconnected),this.registerConnectionReconcile(),this.updateSubscriptions(),this.emitBufferedEvents()}).on(re.SignalResumed,()=>{this.bufferedEvents=[],this.state===fe.Reconnecting&&this.sendSyncState()}).on(re.Restarting,this.handleRestarting).on(re.SignalRestarted,this.handleSignalRestarted).on(re.DCBufferStatusChanged,(e,t)=>{this.emit($.DCBufferStatusChanged,e,t)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine))}static getLocalDevices(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return qe.getInstance().getDevices(e,t)}prepareConnection(e,t){return N(this,void 0,void 0,function*(){if(this.state===fe.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(Wo(new URL(e))&&t){this.regionUrlProvider=new Pc(e,t);const r=yield this.regionUrlProvider.getNextBestRegionUrl();r&&this.state===fe.Disconnected&&(this.regionUrl=r,yield fetch(vc(r),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(r),this.logContext))}else yield fetch(vc(e),{method:"HEAD"})}catch(r){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:r}))}}})}getParticipantByIdentity(e){if(this.localParticipant.identity===e)return this.localParticipant;const t=this.identityToSid.get(e);if(t)return this.participants.get(t)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,t){return N(this,void 0,void 0,function*(){let r=()=>{},n;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":n=new Le({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":n=new Le({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":n=new Le({scenario:{case:"serverLeave",value:!0}});break;case"migration":n=new Le({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":r=()=>N(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),n=new Le({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":r=()=>N(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),n=new Le({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":n=new Le({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),r=()=>N(this,void 0,void 0,function*(){const o=this.engine.client.onLeave;o&&o(new ht({reason:Ai.CLIENT_INITIATED,canReconnect:!0}))});break;case"subscriber-bandwidth":if(t===void 0||typeof t!="number")throw new Error("subscriber-bandwidth requires a number as argument");n=new Le({scenario:{case:"subscriberBandwidth",value:BigInt(t)}});break}n&&(yield this.engine.client.sendSimulateScenario(n),yield r())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveAudioOutputDevice(){var e,t;return(t=(e=this.options.audioOutput)===null||e===void 0?void 0:e.deviceId)!==null&&t!==void 0?t:""}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;var n,o,a;return N(this,void 0,void 0,function*(){let s=!1,c=!0;const l=r?{exact:t}:t;if(e==="audioinput"){const u=this.options.audioCaptureDefaults.deviceId;this.options.audioCaptureDefaults.deviceId=l,s=u!==l;const h=Array.from(this.localParticipant.audioTracks.values()).filter(g=>g.source===W.Source.Microphone);try{c=(yield Promise.all(h.map(g=>{var _;return(_=g.audioTrack)===null||_===void 0?void 0:_.setDeviceId(l)}))).every(g=>g===!0)}catch(g){throw this.options.audioCaptureDefaults.deviceId=u,g}}else if(e==="videoinput"){const u=this.options.videoCaptureDefaults.deviceId;this.options.videoCaptureDefaults.deviceId=l,s=u!==l;const h=Array.from(this.localParticipant.videoTracks.values()).filter(g=>g.source===W.Source.Camera);try{c=(yield Promise.all(h.map(g=>{var _;return(_=g.videoTrack)===null||_===void 0?void 0:_.setDeviceId(l)}))).every(g=>g===!0)}catch(g){throw this.options.videoCaptureDefaults.deviceId=u,g}}else if(e==="audiooutput"){if(!Ho()&&!this.options.expWebAudioMix||this.options.expWebAudioMix&&this.audioContext&&!("setSinkId"in this.audioContext))throw new Error("cannot switch audio output, setSinkId not supported");(n=(a=this.options).audioOutput)!==null&&n!==void 0||(a.audioOutput={});const u=this.options.audioOutput.deviceId;this.options.audioOutput.deviceId=t,s=u!==l;try{this.options.expWebAudioMix?(o=this.audioContext)===null||o===void 0||o.setSinkId(t):yield Promise.all(Array.from(this.participants.values()).map(h=>h.setAudioOutput({deviceId:t})))}catch(h){throw this.options.audioOutput.deviceId=u,h}}return s&&c&&(this.localParticipant.activeDeviceMap.set(e,t),this.emit($.ActiveDeviceChanged,e,t)),c})}setupLocalParticipantEvents(){this.localParticipant.on(G.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(G.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(G.TrackMuted,this.onLocalTrackMuted).on(G.TrackUnmuted,this.onLocalTrackUnmuted).on(G.LocalTrackPublished,this.onLocalTrackPublished).on(G.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(G.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(G.MediaDevicesError,this.onMediaDevicesError).on(G.AudioStreamAcquired,this.startAudio).on(G.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.participants.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,t,r){if(this.state===fe.Connecting||this.state===fe.Reconnecting){const u=()=>{this.onTrackAdded(e,t,r),h()},h=()=>{this.off($.Reconnected,u),this.off($.Connected,u),this.off($.Disconnected,h)};this.once($.Reconnected,u),this.once($.Connected,u),this.once($.Disconnected,h);return}if(this.state===fe.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}const n=ip(t.id),o=n[0];let a=n[1],s=e.id;if(a&&a.startsWith("TR")&&(s=a),o===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const c=this.participants.get(o);if(!c){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(o),this.logContext);return}let l;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?l=this.options.adaptiveStream:l={}),c.addSubscribedMediaTrack(e,s,t,r,l)}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,t=arguments.length>1?arguments[1]:void 0;var r;if(this.clearConnectionReconcile(),this.bufferedEvents=[],this.state!==fe.Disconnected){this.regionUrl=void 0;try{this.participants.forEach(n=>{n.tracks.forEach(o=>{n.unpublishTrack(o.trackSid)})}),this.localParticipant.tracks.forEach(n=>{var o,a;n.track&&this.localParticipant.unpublishTrack(n.track,e),e&&((o=n.track)===null||o===void 0||o.detach(),(a=n.track)===null||a===void 0||a.stop())}),this.localParticipant.off(G.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(G.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(G.TrackMuted,this.onLocalTrackMuted).off(G.TrackUnmuted,this.onLocalTrackUnmuted).off(G.LocalTrackPublished,this.onLocalTrackPublished).off(G.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(G.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(G.MediaDevicesError,this.onMediaDevicesError).off(G.AudioStreamAcquired,this.startAudio).off(G.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.tracks.clear(),this.localParticipant.videoTracks.clear(),this.localParticipant.audioTracks.clear(),this.participants.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.expWebAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),Ye()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(r=navigator.mediaDevices)===null||r===void 0||r.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(fe.Disconnected),this.emit($.Disconnected,t)}}}handleParticipantDisconnected(e,t){this.participants.delete(e),t&&(this.identityToSid.delete(t.identity),t.tracks.forEach(r=>{t.unpublishTrack(r.trackSid,!0)}),this.emit($.ParticipantDisconnected,t))}acquireAudioContext(){var e,t;return N(this,void 0,void 0,function*(){if(typeof this.options.expWebAudioMix!="boolean"&&this.options.expWebAudioMix.audioContext?this.audioContext=this.options.expWebAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=Uh())!==null&&e!==void 0?e:void 0),this.audioContext&&this.audioContext.state==="suspended")try{yield this.audioContext.resume()}catch(n){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:n}))}this.options.expWebAudioMix&&this.participants.forEach(n=>n.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext);const r=((t=this.audioContext)===null||t===void 0?void 0:t.state)==="running";r!==this.canPlaybackAudio&&(this.audioEnabled=r,this.emit($.AudioPlaybackStatusChanged,r))})}createParticipant(e,t){var r;let n;return t?n=Tn.fromParticipantInfo(this.engine.client,t):n=new Tn(this.engine.client,e,"",void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.expWebAudioMix&&n.setAudioContext(this.audioContext),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&n.setAudioOutput(this.options.audioOutput).catch(o=>this.log.warn("Could not set audio output: ".concat(o.message),this.logContext)),n}getOrCreateParticipant(e,t){if(this.participants.has(e))return this.participants.get(e);const r=this.createParticipant(e,t);return this.participants.set(e,r),this.identityToSid.set(t.identity,t.sid),this.emitWhenConnected($.ParticipantConnected,r),r.on(G.TrackPublished,n=>{this.emitWhenConnected($.TrackPublished,n,r)}).on(G.TrackSubscribed,(n,o)=>{n.kind===W.Kind.Audio?(n.on(ee.AudioPlaybackStarted,this.handleAudioPlaybackStarted),n.on(ee.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):n.kind===W.Kind.Video&&(n.on(ee.VideoPlaybackFailed,this.handleVideoPlaybackFailed),n.on(ee.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit($.TrackSubscribed,n,o,r)}).on(G.TrackUnpublished,n=>{this.emit($.TrackUnpublished,n,r)}).on(G.TrackUnsubscribed,(n,o)=>{this.emit($.TrackUnsubscribed,n,o,r)}).on(G.TrackSubscriptionFailed,n=>{this.emit($.TrackSubscriptionFailed,n,r)}).on(G.TrackMuted,n=>{this.emitWhenConnected($.TrackMuted,n,r)}).on(G.TrackUnmuted,n=>{this.emitWhenConnected($.TrackUnmuted,n,r)}).on(G.ParticipantMetadataChanged,n=>{this.emitWhenConnected($.ParticipantMetadataChanged,n,r)}).on(G.ParticipantNameChanged,n=>{this.emitWhenConnected($.ParticipantNameChanged,n,r)}).on(G.ConnectionQualityChanged,n=>{this.emitWhenConnected($.ConnectionQualityChanged,n,r)}).on(G.ParticipantPermissionsChanged,n=>{this.emitWhenConnected($.ParticipantPermissionsChanged,n,r)}).on(G.TrackSubscriptionStatusChanged,(n,o)=>{this.emitWhenConnected($.TrackSubscriptionStatusChanged,n,o,r)}).on(G.TrackSubscriptionFailed,(n,o)=>{this.emit($.TrackSubscriptionFailed,n,r,o)}).on(G.TrackSubscriptionPermissionChanged,(n,o)=>{this.emitWhenConnected($.TrackSubscriptionPermissionChanged,n,o,r)}),t&&r.updateInfo(t),r}sendSyncState(){const e=Array.from(this.participants.values()).reduce((r,n)=>(r.push(...n.getTracks()),r),[]),t=this.localParticipant.getTracks();this.engine.sendSyncState(e,t)}updateSubscriptions(){for(const e of this.participants.values())for(const t of e.videoTracks.values())t.isSubscribed&&t instanceof tu&&t.emitTrackUpdate()}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=Me.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Ai.STATE_MISMATCH))):e=0},Kp)}clearConnectionReconcile(){this.connectionReconcileInterval&&Me.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit($.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[t,r]=e;this.emit(t,...r)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return this.state===fe.Connected?this.emit(e,...r):(this.state===fe.Reconnecting&&this.bufferedEvents.push([e,r]),!1)}simulateParticipants(e){var t,r;return N(this,void 0,void 0,function*(){const n=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),o=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new Yr({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:ce.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new it({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit($.SignalConnected),this.emit($.Connected),this.setAndEmitConnectionState(fe.Connected),n.video){const a=new ms(W.Kind.Video,new Xe({source:Te.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Ue.AUDIO,name:"video-dummy"}),new at(n.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:gc(160*((t=o.aspectRatios[0])!==null&&t!==void 0?t:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(a),this.localParticipant.emit(G.LocalTrackPublished,a)}if(n.audio){const a=new ms(W.Kind.Audio,new Xe({source:Te.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Ue.AUDIO}),new tt(n.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:co(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(a),this.localParticipant.emit(G.LocalTrackPublished,a)}for(let a=0;a<o.count-1;a+=1){let s=new it({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(a),state:gr.ACTIVE,tracks:[],joinedAt:ce.parse(Date.now())});const c=this.getOrCreateParticipant(s.identity,s);if(o.video){const l=gc(160*((r=o.aspectRatios[a%o.aspectRatios.length])!==null&&r!==void 0?r:1),160,!1,!0),u=new Xe({source:Te.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Ue.AUDIO});c.addSubscribedMediaTrack(l,u.sid,new MediaStream([l])),s.tracks=[...s.tracks,u]}if(o.audio){const l=co(),u=new Xe({source:Te.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Ue.AUDIO});c.addSubscribedMediaTrack(l,u.sid,new MediaStream([l])),s.tracks=[...s.tracks,u]}c.updateInfo(s)}})}emit(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];if(e!==$.ActiveSpeakersChanged){const o=iu(r).filter(a=>a!==void 0);this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:o}))}return super.emit(e,...r)}}function iu(i){return i.map(e=>{if(e)return Array.isArray(e)?iu(e):typeof e=="object"?"logContext"in e&&e.logContext:e})}var vt;(function(i){i[i.IDLE=0]="IDLE",i[i.RUNNING=1]="RUNNING",i[i.SKIPPED=2]="SKIPPED",i[i.SUCCESS=3]="SUCCESS",i[i.FAILED=4]="FAILED"})(vt||(vt={}));class en extends ii.EventEmitter{constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=vt.IDLE,this.logs=[],this.errorsAsWarnings=!1,this.url=e,this.token=t,this.name=this.constructor.name,this.room=new $o(r.roomOptions),this.connectOptions=r.connectOptions,r.errorsAsWarnings&&(this.errorsAsWarnings=r.errorsAsWarnings)}run(e){return N(this,void 0,void 0,function*(){if(this.status!==vt.IDLE)throw Error("check is running already");this.setStatus(vt.RUNNING);try{yield this.perform()}catch(t){t instanceof Error&&(this.errorsAsWarnings?this.appendWarning(t.message):this.appendError(t.message))}return yield this.disconnect(),yield new Promise(t=>setTimeout(t,500)),this.status!==vt.SKIPPED&&this.setStatus(this.isSuccess()?vt.SUCCESS:vt.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(){return N(this,void 0,void 0,function*(){return this.room.state===fe.Connected?this.room:(yield this.room.connect(this.url,this.token),this.room)})}disconnect(){return N(this,void 0,void 0,function*(){this.room&&this.room.state!==fe.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(vt.SKIPPED)}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}function ru(i){var e,t;return N(this,void 0,void 0,function*(){i??(i={}),(e=i.audio)!==null&&e!==void 0||(i.audio=!0),(t=i.video)!==null&&t!==void 0||(i.video=!0);const r=Fh(i,Kh,Gh),n=Ls(r),o=navigator.mediaDevices.getUserMedia(n);i.audio&&(qe.userMediaPromiseMap.set("audioinput",o),o.catch(()=>qe.userMediaPromiseMap.delete("audioinput"))),i.video&&(qe.userMediaPromiseMap.set("videoinput",o),o.catch(()=>qe.userMediaPromiseMap.delete("videoinput")));const a=yield o;return a.getTracks().map(s=>{const c=s.kind==="audio";c?i.audio:i.video;let l;const u=c?n.audio:n.video;typeof u!="boolean"&&(l=u),l?l.deviceId=s.getSettings().deviceId:l={deviceId:s.getSettings().deviceId};const h=Xh(s,l);return h.kind===W.Kind.Video?h.source=W.Source.Camera:h.kind===W.Kind.Audio&&(h.source=W.Source.Microphone),h.mediaStream=a,h})})}function Gp(i){return N(this,void 0,void 0,function*(){return(yield ru({audio:!1,video:i}))[0]})}function Xp(i){return N(this,void 0,void 0,function*(){return(yield ru({audio:i,video:!1}))[0]})}class Qp extends en{get description(){return"Can publish audio"}perform(){var e;return N(this,void 0,void 0,function*(){const t=yield this.connect(),r=yield Xp();t.localParticipant.publishTrack(r),yield new Promise(a=>setTimeout(a,3e3));const n=yield(e=r.sender)===null||e===void 0?void 0:e.getStats();if(!n)throw new Error("Could not get RTCStats");let o=0;if(n.forEach(a=>{a.type==="outbound-rtp"&&a.mediaType==="audio"&&(o=a.packetsSent)}),o===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(o," audio packets"))})}}class Yp extends en{get description(){return"Can publish video"}perform(){var e;return N(this,void 0,void 0,function*(){const t=yield this.connect(),r=yield Gp();t.localParticipant.publishTrack(r),yield new Promise(a=>setTimeout(a,3e3));const n=yield(e=r.sender)===null||e===void 0?void 0:e.getStats();if(!n)throw new Error("Could not get RTCStats");let o=0;if(n.forEach(a=>{a.type==="outbound-rtp"&&a.mediaType==="video"&&(o=a.packetsSent)}),o===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(o," video packets"))})}}class Zp extends en{get description(){return"Resuming connection after interruption"}perform(){var e;return N(this,void 0,void 0,function*(){const t=yield this.connect();let r=!1,n=!1,o;const a=new Promise(c=>{setTimeout(c,5e3),o=c});t.on($.Reconnecting,()=>{r=!0}).on($.Reconnected,()=>{n=!0,o(!0)}),(e=t.engine.client.ws)===null||e===void 0||e.close();const s=t.engine.client.onClose;if(s&&s(""),yield a,r){if(!n||t.state!==fe.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class em extends en{get description(){return"Can connect via TURN"}perform(){var e,t;return N(this,void 0,void 0,function*(){const r=new Sa,n=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});let o=!1,a=!1,s=!1;for(let c of n.iceServers)for(let l of c.urls)l.startsWith("turn:")?(a=!0,s=!0):l.startsWith("turns:")&&(a=!0,s=!0,o=!0),l.startsWith("stun:")&&(s=!0);s?a&&!o&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield r.close(),!((t=(e=this.connectOptions)===null||e===void 0?void 0:e.rtcConfig)===null||t===void 0)&&t.iceServers||a?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(c=>setTimeout(c,0)))})}}class tm extends en{get description(){return"Establishing WebRTC connection"}perform(){return N(this,void 0,void 0,function*(){let e=!1,t=!1;this.room.on($.SignalConnected,()=>{const r=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(n,o)=>{if(n.candidate){const a=new RTCIceCandidate(n);let s="".concat(a.protocol," ").concat(a.address,":").concat(a.port," ").concat(a.type);a.address&&(im(a.address)?s+=" (private)":a.protocol==="tcp"&&a.tcpType==="passive"?(e=!0,s+=" (passive)"):a.protocol==="udp"&&(t=!0)),this.appendMessage(s)}r&&r(n,o)},this.room.engine.pcManager&&(this.room.engine.pcManager.subscriber.onIceCandidateError=n=>{n instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(n.errorCode," ").concat(n.errorText," ").concat(n.url))})});try{yield this.connect(),he.info("now the room is connected")}catch(r){throw this.appendWarning("ports need to be open on firewall in order to connect."),r}e||this.appendWarning("Server is not configured for ICE/TCP"),t||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function im(i){const e=i.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const t=parseInt(e[1],10);if(t>=16&&t<=31)return!0}}return!1}class rm extends en{get description(){return"Connecting to signal connection via WebSocket"}perform(){var e,t,r;return N(this,void 0,void 0,function*(){(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let n=new Sa;const o=yield n.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});this.appendMessage("Connected to server, version ".concat(o.serverVersion,".")),((e=o.serverInfo)===null||e===void 0?void 0:e.edition)===Vr.Cloud&&(!((t=o.serverInfo)===null||t===void 0)&&t.region)&&this.appendMessage("LiveKit Cloud: ".concat((r=o.serverInfo)===null||r===void 0?void 0:r.region)),yield n.close()})}}class Ib extends ii.EventEmitter{constructor(e,t){super(),this.checkResults=new Map,this.url=e,this.token=t}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:vt.IDLE,name:"",description:""}),e}updateCheck(e,t){this.checkResults.set(e,t),this.emit("checkUpdate",e,t)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==vt.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return N(this,void 0,void 0,function*(){const t=this.getNextCheckId(),r=new e(this.url,this.token),n=a=>{this.updateCheck(t,a)};r.on("update",n);const o=yield r.run();return r.off("update",n),o})}checkWebsocket(){return N(this,void 0,void 0,function*(){return this.createAndRunCheck(rm)})}checkWebRTC(){return N(this,void 0,void 0,function*(){return this.createAndRunCheck(tm)})}checkTURN(){return N(this,void 0,void 0,function*(){return this.createAndRunCheck(em)})}checkReconnect(){return N(this,void 0,void 0,function*(){return this.createAndRunCheck(Zp)})}checkPublishAudio(){return N(this,void 0,void 0,function*(){return this.createAndRunCheck(Qp)})}checkPublishVideo(){return N(this,void 0,void 0,function*(){return this.createAndRunCheck(Yp)})}}function Mb(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var t;const r=i instanceof zr?i.mediaStreamTrack:i,n=r.getSettings();let o={facingMode:(t=e.defaultFacingMode)!==null&&t!==void 0?t:"user",confidence:"low"};if("facingMode"in n){const a=n.facingMode;he.debug("rawFacingMode",{rawFacingMode:a}),a&&typeof a=="string"&&om(a)&&(o={facingMode:a,confidence:"high"})}if(["low","medium"].includes(o.confidence)){he.debug("Try to get facing mode from device label: (".concat(r.label,")"));const a=sm(r.label);a!==void 0&&(o=a)}return o}const Lc=new Map([["obs virtual camera",{facingMode:"environment",confidence:"medium"}]]),nm=new Map([["iphone",{facingMode:"environment",confidence:"medium"}],["ipad",{facingMode:"environment",confidence:"medium"}]]);function sm(i){var e;const t=i.trim().toLowerCase();if(t!=="")return Lc.has(t)?Lc.get(t):(e=Array.from(nm.entries()).find(r=>{let[n]=r;return t.includes(n)}))===null||e===void 0?void 0:e[1]}function om(i){return i===void 0||["user","environment","left","right"].includes(i)}const zo=Math.min,Ar=Math.max,vs=Math.round,rr=i=>({x:i,y:i}),am={left:"right",right:"left",bottom:"top",top:"bottom"},cm={start:"end",end:"start"};function Ic(i,e,t){return Ar(i,zo(e,t))}function Ms(i,e){return typeof i=="function"?i(e):i}function yr(i){return i.split("-")[0]}function Bs(i){return i.split("-")[1]}function nu(i){return i==="x"?"y":"x"}function su(i){return i==="y"?"height":"width"}function Kr(i){return["top","bottom"].includes(yr(i))?"y":"x"}function ou(i){return nu(Kr(i))}function lm(i,e,t){t===void 0&&(t=!1);const r=Bs(i),n=ou(i),o=su(n);let a=n==="x"?r===(t?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[o]>e.floating[o]&&(a=_s(a)),[a,_s(a)]}function hm(i){const e=_s(i);return[Ko(i),e,Ko(e)]}function Ko(i){return i.replace(/start|end/g,e=>cm[e])}function um(i,e,t){const r=["left","right"],n=["right","left"],o=["top","bottom"],a=["bottom","top"];switch(i){case"top":case"bottom":return t?e?n:r:e?r:n;case"left":case"right":return e?o:a;default:return[]}}function dm(i,e,t,r){const n=Bs(i);let o=um(yr(i),t==="start",r);return n&&(o=o.map(a=>a+"-"+n),e&&(o=o.concat(o.map(Ko)))),o}function _s(i){return i.replace(/left|right|bottom|top/g,e=>am[e])}function fm(i){return{top:0,right:0,bottom:0,left:0,...i}}function pm(i){return typeof i!="number"?fm(i):{top:i,right:i,bottom:i,left:i}}function bs(i){const{x:e,y:t,width:r,height:n}=i;return{width:r,height:n,top:t,left:e,right:e+r,bottom:t+n,x:e,y:t}}function Mc(i,e,t){let{reference:r,floating:n}=i;const o=Kr(e),a=ou(e),s=su(a),c=yr(e),l=o==="y",u=r.x+r.width/2-n.width/2,h=r.y+r.height/2-n.height/2,g=r[s]/2-n[s]/2;let _;switch(c){case"top":_={x:u,y:r.y-n.height};break;case"bottom":_={x:u,y:r.y+r.height};break;case"right":_={x:r.x+r.width,y:h};break;case"left":_={x:r.x-n.width,y:h};break;default:_={x:r.x,y:r.y}}switch(Bs(e)){case"start":_[a]-=g*(t&&l?-1:1);break;case"end":_[a]+=g*(t&&l?-1:1);break}return _}const mm=async(i,e,t)=>{const{placement:r="bottom",strategy:n="absolute",middleware:o=[],platform:a}=t,s=o.filter(Boolean),c=await(a.isRTL==null?void 0:a.isRTL(e));let l=await a.getElementRects({reference:i,floating:e,strategy:n}),{x:u,y:h}=Mc(l,r,c),g=r,_={},y=0;for(let v=0;v<s.length;v++){const{name:f,fn:p}=s[v],{x:d,y:m,data:b,reset:C}=await p({x:u,y:h,initialPlacement:r,placement:g,strategy:n,middlewareData:_,rects:l,platform:a,elements:{reference:i,floating:e}});u=d??u,h=m??h,_={..._,[f]:{..._[f],...b}},C&&y<=50&&(y++,typeof C=="object"&&(C.placement&&(g=C.placement),C.rects&&(l=C.rects===!0?await a.getElementRects({reference:i,floating:e,strategy:n}):C.rects),{x:u,y:h}=Mc(l,g,c)),v=-1)}return{x:u,y:h,placement:g,strategy:n,middlewareData:_}};async function au(i,e){var t;e===void 0&&(e={});const{x:r,y:n,platform:o,rects:a,elements:s,strategy:c}=i,{boundary:l="clippingAncestors",rootBoundary:u="viewport",elementContext:h="floating",altBoundary:g=!1,padding:_=0}=Ms(e,i),y=pm(_),f=s[g?h==="floating"?"reference":"floating":h],p=bs(await o.getClippingRect({element:(t=await(o.isElement==null?void 0:o.isElement(f)))==null||t?f:f.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(s.floating)),boundary:l,rootBoundary:u,strategy:c})),d=h==="floating"?{x:r,y:n,width:a.floating.width,height:a.floating.height}:a.reference,m=await(o.getOffsetParent==null?void 0:o.getOffsetParent(s.floating)),b=await(o.isElement==null?void 0:o.isElement(m))?await(o.getScale==null?void 0:o.getScale(m))||{x:1,y:1}:{x:1,y:1},C=bs(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:s,rect:d,offsetParent:m,strategy:c}):d);return{top:(p.top-C.top+y.top)/b.y,bottom:(C.bottom-p.bottom+y.bottom)/b.y,left:(p.left-C.left+y.left)/b.x,right:(C.right-p.right+y.right)/b.x}}const gm=function(i){return i===void 0&&(i={}),{name:"flip",options:i,async fn(e){var t,r;const{placement:n,middlewareData:o,rects:a,initialPlacement:s,platform:c,elements:l}=e,{mainAxis:u=!0,crossAxis:h=!0,fallbackPlacements:g,fallbackStrategy:_="bestFit",fallbackAxisSideDirection:y="none",flipAlignment:v=!0,...f}=Ms(i,e);if((t=o.arrow)!=null&&t.alignmentOffset)return{};const p=yr(n),d=Kr(s),m=yr(s)===s,b=await(c.isRTL==null?void 0:c.isRTL(l.floating)),C=g||(m||!v?[_s(s)]:hm(s)),w=y!=="none";!g&&w&&C.push(...dm(s,v,y,b));const T=[s,...C],S=await au(e,f),k=[];let O=((r=o.flip)==null?void 0:r.overflows)||[];if(u&&k.push(S[p]),h){const U=lm(n,a,b);k.push(S[U[0]],S[U[1]])}if(O=[...O,{placement:n,overflows:k}],!k.every(U=>U<=0)){var L,M;const U=(((L=o.flip)==null?void 0:L.index)||0)+1,q=T[U];if(q)return{data:{index:U,overflows:O},reset:{placement:q}};let X=(M=O.filter(Y=>Y.overflows[0]<=0).sort((Y,F)=>Y.overflows[1]-F.overflows[1])[0])==null?void 0:M.placement;if(!X)switch(_){case"bestFit":{var D;const Y=(D=O.filter(F=>{if(w){const E=Kr(F.placement);return E===d||E==="y"}return!0}).map(F=>[F.placement,F.overflows.filter(E=>E>0).reduce((E,x)=>E+x,0)]).sort((F,E)=>F[1]-E[1])[0])==null?void 0:D[0];Y&&(X=Y);break}case"initialPlacement":X=s;break}if(n!==X)return{reset:{placement:X}}}return{}}}};async function vm(i,e){const{placement:t,platform:r,elements:n}=i,o=await(r.isRTL==null?void 0:r.isRTL(n.floating)),a=yr(t),s=Bs(t),c=Kr(t)==="y",l=["left","top"].includes(a)?-1:1,u=o&&c?-1:1,h=Ms(e,i);let{mainAxis:g,crossAxis:_,alignmentAxis:y}=typeof h=="number"?{mainAxis:h,crossAxis:0,alignmentAxis:null}:{mainAxis:h.mainAxis||0,crossAxis:h.crossAxis||0,alignmentAxis:h.alignmentAxis};return s&&typeof y=="number"&&(_=s==="end"?y*-1:y),c?{x:_*u,y:g*l}:{x:g*l,y:_*u}}const _m=function(i){return i===void 0&&(i=0),{name:"offset",options:i,async fn(e){var t,r;const{x:n,y:o,placement:a,middlewareData:s}=e,c=await vm(e,i);return a===((t=s.offset)==null?void 0:t.placement)&&(r=s.arrow)!=null&&r.alignmentOffset?{}:{x:n+c.x,y:o+c.y,data:{...c,placement:a}}}}},bm=function(i){return i===void 0&&(i={}),{name:"shift",options:i,async fn(e){const{x:t,y:r,placement:n}=e,{mainAxis:o=!0,crossAxis:a=!1,limiter:s={fn:f=>{let{x:p,y:d}=f;return{x:p,y:d}}},...c}=Ms(i,e),l={x:t,y:r},u=await au(e,c),h=Kr(yr(n)),g=nu(h);let _=l[g],y=l[h];if(o){const f=g==="y"?"top":"left",p=g==="y"?"bottom":"right",d=_+u[f],m=_-u[p];_=Ic(d,_,m)}if(a){const f=h==="y"?"top":"left",p=h==="y"?"bottom":"right",d=y+u[f],m=y-u[p];y=Ic(d,y,m)}const v=s.fn({...e,[g]:_,[h]:y});return{...v,data:{x:v.x-t,y:v.y-r,enabled:{[g]:o,[h]:a}}}}}};function Ns(){return typeof window<"u"}function nr(i){return cu(i)?(i.nodeName||"").toLowerCase():"#document"}function rt(i){var e;return(i==null||(e=i.ownerDocument)==null?void 0:e.defaultView)||window}function ar(i){var e;return(e=(cu(i)?i.ownerDocument:i.document)||window.document)==null?void 0:e.documentElement}function cu(i){return Ns()?i instanceof Node||i instanceof rt(i).Node:!1}function ei(i){return Ns()?i instanceof Element||i instanceof rt(i).Element:!1}function ti(i){return Ns()?i instanceof HTMLElement||i instanceof rt(i).HTMLElement:!1}function Bc(i){return!Ns()||typeof ShadowRoot>"u"?!1:i instanceof ShadowRoot||i instanceof rt(i).ShadowRoot}function In(i){const{overflow:e,overflowX:t,overflowY:r,display:n}=ut(i);return/auto|scroll|overlay|hidden|clip/.test(e+r+t)&&!["inline","contents"].includes(n)}function ym(i){return["table","td","th"].includes(nr(i))}function Sm(i){return[":popover-open",":modal"].some(e=>{try{return i.matches(e)}catch{return!1}})}function ka(i){const e=Ta(),t=ei(i)?ut(i):i;return t.transform!=="none"||t.perspective!=="none"||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||["transform","perspective","filter"].some(r=>(t.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(t.contain||"").includes(r))}function Cm(i){let e=Gr(i);for(;ti(e)&&!Fs(e);){if(ka(e))return e;if(Sm(e))return null;e=Gr(e)}return null}function Ta(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Fs(i){return["html","body","#document"].includes(nr(i))}function ut(i){return rt(i).getComputedStyle(i)}function Us(i){return ei(i)?{scrollLeft:i.scrollLeft,scrollTop:i.scrollTop}:{scrollLeft:i.scrollX,scrollTop:i.scrollY}}function Gr(i){if(nr(i)==="html")return i;const e=i.assignedSlot||i.parentNode||Bc(i)&&i.host||ar(i);return Bc(e)?e.host:e}function lu(i){const e=Gr(i);return Fs(e)?i.ownerDocument?i.ownerDocument.body:i.body:ti(e)&&In(e)?e:lu(e)}function Go(i,e,t){var r;e===void 0&&(e=[]),t===void 0&&(t=!0);const n=lu(i),o=n===((r=i.ownerDocument)==null?void 0:r.body),a=rt(n);if(o){const s=wm(a);return e.concat(a,a.visualViewport||[],In(n)?n:[],s&&t?Go(s):[])}return e.concat(n,Go(n,[],t))}function wm(i){return i.parent&&Object.getPrototypeOf(i.parent)?i.frameElement:null}function hu(i){const e=ut(i);let t=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const n=ti(i),o=n?i.offsetWidth:t,a=n?i.offsetHeight:r,s=vs(t)!==o||vs(r)!==a;return s&&(t=o,r=a),{width:t,height:r,$:s}}function uu(i){return ei(i)?i:i.contextElement}function Lr(i){const e=uu(i);if(!ti(e))return rr(1);const t=e.getBoundingClientRect(),{width:r,height:n,$:o}=hu(e);let a=(o?vs(t.width):t.width)/r,s=(o?vs(t.height):t.height)/n;return(!a||!Number.isFinite(a))&&(a=1),(!s||!Number.isFinite(s))&&(s=1),{x:a,y:s}}const km=rr(0);function du(i){const e=rt(i);return!Ta()||!e.visualViewport?km:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function Tm(i,e,t){return e===void 0&&(e=!1),!t||e&&t!==rt(i)?!1:e}function En(i,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=!1);const n=i.getBoundingClientRect(),o=uu(i);let a=rr(1);e&&(r?ei(r)&&(a=Lr(r)):a=Lr(i));const s=Tm(o,t,r)?du(o):rr(0);let c=(n.left+s.x)/a.x,l=(n.top+s.y)/a.y,u=n.width/a.x,h=n.height/a.y;if(o){const g=rt(o),_=r&&ei(r)?rt(r):r;let y=g.frameElement;for(;y&&r&&_!==g;){const v=Lr(y),f=y.getBoundingClientRect(),p=ut(y),d=f.left+(y.clientLeft+parseFloat(p.paddingLeft))*v.x,m=f.top+(y.clientTop+parseFloat(p.paddingTop))*v.y;c*=v.x,l*=v.y,u*=v.x,h*=v.y,c+=d,l+=m,y=rt(y).frameElement}}return bs({width:u,height:h,x:c,y:l})}function Em(i){let{rect:e,offsetParent:t,strategy:r}=i;const n=ti(t),o=ar(t);if(t===o)return e;let a={scrollLeft:0,scrollTop:0},s=rr(1);const c=rr(0);if((n||!n&&r!=="fixed")&&((nr(t)!=="body"||In(o))&&(a=Us(t)),ti(t))){const l=En(t);s=Lr(t),c.x=l.x+t.clientLeft,c.y=l.y+t.clientTop}return{width:e.width*s.x,height:e.height*s.y,x:e.x*s.x-a.scrollLeft*s.x+c.x,y:e.y*s.y-a.scrollTop*s.y+c.y}}function Pm(i){return Array.from(i.getClientRects())}function fu(i){return En(ar(i)).left+Us(i).scrollLeft}function Rm(i){const e=ar(i),t=Us(i),r=i.ownerDocument.body,n=Ar(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),o=Ar(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let a=-t.scrollLeft+fu(i);const s=-t.scrollTop;return ut(r).direction==="rtl"&&(a+=Ar(e.clientWidth,r.clientWidth)-n),{width:n,height:o,x:a,y:s}}function xm(i,e){const t=rt(i),r=ar(i),n=t.visualViewport;let o=r.clientWidth,a=r.clientHeight,s=0,c=0;if(n){o=n.width,a=n.height;const l=Ta();(!l||l&&e==="fixed")&&(s=n.offsetLeft,c=n.offsetTop)}return{width:o,height:a,x:s,y:c}}function Om(i,e){const t=En(i,!0,e==="fixed"),r=t.top+i.clientTop,n=t.left+i.clientLeft,o=ti(i)?Lr(i):rr(1),a=i.clientWidth*o.x,s=i.clientHeight*o.y,c=n*o.x,l=r*o.y;return{width:a,height:s,x:c,y:l}}function Nc(i,e,t){let r;if(e==="viewport")r=xm(i,t);else if(e==="document")r=Rm(ar(i));else if(ei(e))r=Om(e,t);else{const n=du(i);r={...e,x:e.x-n.x,y:e.y-n.y}}return bs(r)}function pu(i,e){const t=Gr(i);return t===e||!ei(t)||Fs(t)?!1:ut(t).position==="fixed"||pu(t,e)}function Dm(i,e){const t=e.get(i);if(t)return t;let r=Go(i,[],!1).filter(s=>ei(s)&&nr(s)!=="body"),n=null;const o=ut(i).position==="fixed";let a=o?Gr(i):i;for(;ei(a)&&!Fs(a);){const s=ut(a),c=ka(a);!c&&s.position==="fixed"&&(n=null),(o?!c&&!n:!c&&s.position==="static"&&!!n&&["absolute","fixed"].includes(n.position)||In(a)&&!c&&pu(i,a))?r=r.filter(u=>u!==a):n=s,a=Gr(a)}return e.set(i,r),r}function Am(i){let{element:e,boundary:t,rootBoundary:r,strategy:n}=i;const a=[...t==="clippingAncestors"?Dm(e,this._c):[].concat(t),r],s=a[0],c=a.reduce((l,u)=>{const h=Nc(e,u,n);return l.top=Ar(h.top,l.top),l.right=zo(h.right,l.right),l.bottom=zo(h.bottom,l.bottom),l.left=Ar(h.left,l.left),l},Nc(e,s,n));return{width:c.right-c.left,height:c.bottom-c.top,x:c.left,y:c.top}}function Lm(i){const{width:e,height:t}=hu(i);return{width:e,height:t}}function Im(i,e,t){const r=ti(e),n=ar(e),o=t==="fixed",a=En(i,!0,o,e);let s={scrollLeft:0,scrollTop:0};const c=rr(0);if(r||!r&&!o)if((nr(e)!=="body"||In(n))&&(s=Us(e)),r){const l=En(e,!0,o,e);c.x=l.x+e.clientLeft,c.y=l.y+e.clientTop}else n&&(c.x=fu(n));return{x:a.left+s.scrollLeft-c.x,y:a.top+s.scrollTop-c.y,width:a.width,height:a.height}}function Fc(i,e){return!ti(i)||ut(i).position==="fixed"?null:e?e(i):i.offsetParent}function mu(i,e){const t=rt(i);if(!ti(i))return t;let r=Fc(i,e);for(;r&&ym(r)&&ut(r).position==="static";)r=Fc(r,e);return r&&(nr(r)==="html"||nr(r)==="body"&&ut(r).position==="static"&&!ka(r))?t:r||Cm(i)||t}const Mm=async function(i){let{reference:e,floating:t,strategy:r}=i;const n=this.getOffsetParent||mu,o=this.getDimensions;return{reference:Im(e,await n(t),r),floating:{x:0,y:0,...await o(t)}}};function Bm(i){return ut(i).direction==="rtl"}const Nm={convertOffsetParentRelativeRectToViewportRelativeRect:Em,getDocumentElement:ar,getClippingRect:Am,getOffsetParent:mu,getElementRects:Mm,getClientRects:Pm,getDimensions:Lm,getScale:Lr,isElement:ei,isRTL:Bm},Fm=bm,Um=gm,jm=(i,e,t)=>{const r=new Map,n={platform:Nm,...t},o={...n.platform,_c:r};return mm(i,e,{...n,platform:o})};var gu={exports:{}};(function(i){(function(e,t){i.exports?i.exports=t():e.log=t()})(xd,function(){var e=function(){},t="undefined",r=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),n=["trace","debug","info","warn","error"];function o(v,f){var p=v[f];if(typeof p.bind=="function")return p.bind(v);try{return Function.prototype.bind.call(p,v)}catch{return function(){return Function.prototype.apply.apply(p,[v,arguments])}}}function a(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function s(v){return v==="debug"&&(v="log"),typeof console===t?!1:v==="trace"&&r?a:console[v]!==void 0?o(console,v):console.log!==void 0?o(console,"log"):e}function c(v,f){for(var p=0;p<n.length;p++){var d=n[p];this[d]=p<v?e:this.methodFactory(d,v,f)}this.log=this.debug}function l(v,f,p){return function(){typeof console!==t&&(c.call(this,f,p),this[v].apply(this,arguments))}}function u(v,f,p){return s(v)||l.apply(this,arguments)}function h(v,f,p){var d=this,m;f=f??"WARN";var b="loglevel";typeof v=="string"?b+=":"+v:typeof v=="symbol"&&(b=void 0);function C(k){var O=(n[k]||"silent").toUpperCase();if(!(typeof window===t||!b)){try{window.localStorage[b]=O;return}catch{}try{window.document.cookie=encodeURIComponent(b)+"="+O+";"}catch{}}}function w(){var k;if(!(typeof window===t||!b)){try{k=window.localStorage[b]}catch{}if(typeof k===t)try{var O=window.document.cookie,L=O.indexOf(encodeURIComponent(b)+"=");L!==-1&&(k=/^([^;]+)/.exec(O.slice(L))[1])}catch{}return d.levels[k]===void 0&&(k=void 0),k}}function T(){if(!(typeof window===t||!b)){try{window.localStorage.removeItem(b);return}catch{}try{window.document.cookie=encodeURIComponent(b)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}d.name=v,d.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},d.methodFactory=p||u,d.getLevel=function(){return m},d.setLevel=function(k,O){if(typeof k=="string"&&d.levels[k.toUpperCase()]!==void 0&&(k=d.levels[k.toUpperCase()]),typeof k=="number"&&k>=0&&k<=d.levels.SILENT){if(m=k,O!==!1&&C(k),c.call(d,k,v),typeof console===t&&k<d.levels.SILENT)return"No console available for logging"}else throw"log.setLevel() called with invalid level: "+k},d.setDefaultLevel=function(k){f=k,w()||d.setLevel(k,!1)},d.resetLevel=function(){d.setLevel(f,!1),T()},d.enableAll=function(k){d.setLevel(d.levels.TRACE,k)},d.disableAll=function(k){d.setLevel(d.levels.SILENT,k)};var S=w();S==null&&(S=f),d.setLevel(S,!1)}var g=new h,_={};g.getLogger=function(f){if(typeof f!="symbol"&&typeof f!="string"||f==="")throw new TypeError("You must supply a name when creating a logger.");var p=_[f];return p||(p=_[f]=new h(f,g.getLevel(),g.methodFactory)),p};var y=typeof window!==t?window.log:void 0;return g.noConflict=function(){return typeof window!==t&&window.log===g&&(window.log=y),g},g.getLoggers=function(){return _},g.default=g,g})})(gu);var Hm=gu.exports;const Wm=Od(Hm);var Xo=function(i,e){return Xo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},Xo(i,e)};function Ni(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Xo(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function qm(i,e,t,r){function n(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function s(u){try{l(r.next(u))}catch(h){a(h)}}function c(u){try{l(r.throw(u))}catch(h){a(h)}}function l(u){u.done?o(u.value):n(u.value).then(s,c)}l((r=r.apply(i,e||[])).next())})}function vu(i,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,n,o,a=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,l[0]&&(t=0)),t;)try{if(r=1,n&&(o=l[0]&2?n.return:l[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,l[1])).done)return o;switch(n=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,n=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(i,t)}catch(u){l=[6,u],n=0}finally{r=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Xr(i){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&i[e],r=0;if(t)return t.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&r>=i.length&&(i=void 0),{value:i&&i[r++],done:!i}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function sr(i,e){var t=typeof Symbol=="function"&&i[Symbol.iterator];if(!t)return i;var r=t.call(i),n,o=[],a;try{for(;(e===void 0||e-- >0)&&!(n=r.next()).done;)o.push(n.value)}catch(s){a={error:s}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return o}function Sr(i,e,t){if(t||arguments.length===2)for(var r=0,n=e.length,o;r<n;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return i.concat(o||Array.prototype.slice.call(e))}function Ir(i){return this instanceof Ir?(this.v=i,this):new Ir(i)}function Vm(i,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(i,e||[]),n,o=[];return n=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",a),n[Symbol.asyncIterator]=function(){return this},n;function a(_){return function(y){return Promise.resolve(y).then(_,h)}}function s(_,y){r[_]&&(n[_]=function(v){return new Promise(function(f,p){o.push([_,v,f,p])>1||c(_,v)})},y&&(n[_]=y(n[_])))}function c(_,y){try{l(r[_](y))}catch(v){g(o[0][3],v)}}function l(_){_.value instanceof Ir?Promise.resolve(_.value.v).then(u,h):g(o[0][2],_)}function u(_){c("next",_)}function h(_){c("throw",_)}function g(_,y){_(y),o.shift(),o.length&&c(o[0][0],o[0][1])}}function Jm(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=i[Symbol.asyncIterator],t;return e?e.call(i):(i=typeof Xr=="function"?Xr(i):i[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(o){t[o]=i[o]&&function(a){return new Promise(function(s,c){a=i[o](a),n(s,c,a.done,a.value)})}}function n(o,a,s,c){Promise.resolve(c).then(function(l){o({value:l,done:s})},a)}}function ve(i){return typeof i=="function"}function Ea(i){var e=function(r){Error.call(r),r.stack=new Error().stack},t=i(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var po=Ea(function(i){return function(t){i(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(r,n){return n+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function ys(i,e){if(i){var t=i.indexOf(e);0<=t&&i.splice(t,1)}}var Mn=function(){function i(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return i.prototype.unsubscribe=function(){var e,t,r,n,o;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var s=Xr(a),c=s.next();!c.done;c=s.next()){var l=c.value;l.remove(this)}}catch(v){e={error:v}}finally{try{c&&!c.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}else a.remove(this);var u=this.initialTeardown;if(ve(u))try{u()}catch(v){o=v instanceof po?v.errors:[v]}var h=this._finalizers;if(h){this._finalizers=null;try{for(var g=Xr(h),_=g.next();!_.done;_=g.next()){var y=_.value;try{Uc(y)}catch(v){o=o??[],v instanceof po?o=Sr(Sr([],sr(o)),sr(v.errors)):o.push(v)}}}catch(v){r={error:v}}finally{try{_&&!_.done&&(n=g.return)&&n.call(g)}finally{if(r)throw r.error}}}if(o)throw new po(o)}},i.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)Uc(e);else{if(e instanceof i){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},i.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},i.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},i.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&ys(t,e)},i.prototype.remove=function(e){var t=this._finalizers;t&&ys(t,e),e instanceof i&&e._removeParent(this)},i.EMPTY=function(){var e=new i;return e.closed=!0,e}(),i}(),_u=Mn.EMPTY;function bu(i){return i instanceof Mn||i&&"closed"in i&&ve(i.remove)&&ve(i.add)&&ve(i.unsubscribe)}function Uc(i){ve(i)?i():i.unsubscribe()}var yu={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Qo={setTimeout:function(i,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var n=Qo.delegate;return n!=null&&n.setTimeout?n.setTimeout.apply(n,Sr([i,e],sr(t))):setTimeout.apply(void 0,Sr([i,e],sr(t)))},clearTimeout:function(i){var e=Qo.delegate;return((e==null?void 0:e.clearTimeout)||clearTimeout)(i)},delegate:void 0};function Su(i){Qo.setTimeout(function(){throw i})}function Ss(){}function ns(i){i()}var Pa=function(i){Ni(e,i);function e(t){var r=i.call(this)||this;return r.isStopped=!1,t?(r.destination=t,bu(t)&&t.add(r)):r.destination=Gm,r}return e.create=function(t,r,n){return new Yo(t,r,n)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,i.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Mn),$m=Function.prototype.bind;function mo(i,e){return $m.call(i,e)}var zm=function(){function i(e){this.partialObserver=e}return i.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(r){qn(r)}},i.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(r){qn(r)}else qn(e)},i.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){qn(t)}},i}(),Yo=function(i){Ni(e,i);function e(t,r,n){var o=i.call(this)||this,a;if(ve(t)||!t)a={next:t??void 0,error:r??void 0,complete:n??void 0};else{var s;o&&yu.useDeprecatedNextContext?(s=Object.create(t),s.unsubscribe=function(){return o.unsubscribe()},a={next:t.next&&mo(t.next,s),error:t.error&&mo(t.error,s),complete:t.complete&&mo(t.complete,s)}):a=t}return o.destination=new zm(a),o}return e}(Pa);function qn(i){Su(i)}function Km(i){throw i}var Gm={closed:!0,next:Ss,error:Km,complete:Ss},Ra=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function xa(i){return i}function Xm(i){return i.length===0?xa:i.length===1?i[0]:function(t){return i.reduce(function(r,n){return n(r)},t)}}var Be=function(){function i(e){e&&(this._subscribe=e)}return i.prototype.lift=function(e){var t=new i;return t.source=this,t.operator=e,t},i.prototype.subscribe=function(e,t,r){var n=this,o=Ym(e)?e:new Yo(e,t,r);return ns(function(){var a=n,s=a.operator,c=a.source;o.add(s?s.call(o,c):c?n._subscribe(o):n._trySubscribe(o))}),o},i.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},i.prototype.forEach=function(e,t){var r=this;return t=jc(t),new t(function(n,o){var a=new Yo({next:function(s){try{e(s)}catch(c){o(c),a.unsubscribe()}},error:o,complete:n});r.subscribe(a)})},i.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},i.prototype[Ra]=function(){return this},i.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Xm(e)(this)},i.prototype.toPromise=function(e){var t=this;return e=jc(e),new e(function(r,n){var o;t.subscribe(function(a){return o=a},function(a){return n(a)},function(){return r(o)})})},i.create=function(e){return new i(e)},i}();function jc(i){var e;return(e=i??yu.Promise)!==null&&e!==void 0?e:Promise}function Qm(i){return i&&ve(i.next)&&ve(i.error)&&ve(i.complete)}function Ym(i){return i&&i instanceof Pa||Qm(i)&&bu(i)}function Zm(i){return ve(i==null?void 0:i.lift)}function dt(i){return function(e){if(Zm(e))return e.lift(function(t){try{return i(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function Rt(i,e,t,r,n){return new eg(i,e,t,r,n)}var eg=function(i){Ni(e,i);function e(t,r,n,o,a,s){var c=i.call(this,t)||this;return c.onFinalize=a,c.shouldUnsubscribe=s,c._next=r?function(l){try{r(l)}catch(u){t.error(u)}}:i.prototype._next,c._error=o?function(l){try{o(l)}catch(u){t.error(u)}finally{this.unsubscribe()}}:i.prototype._error,c._complete=n?function(){try{n()}catch(l){t.error(l)}finally{this.unsubscribe()}}:i.prototype._complete,c}return e.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;i.prototype.unsubscribe.call(this),!r&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},e}(Pa),tg=Ea(function(i){return function(){i(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),or=function(i){Ni(e,i);function e(){var t=i.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var r=new Hc(this,this);return r.operator=t,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new tg},e.prototype.next=function(t){var r=this;ns(function(){var n,o;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var a=Xr(r.currentObservers),s=a.next();!s.done;s=a.next()){var c=s.value;c.next(t)}}catch(l){n={error:l}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(n)throw n.error}}}})},e.prototype.error=function(t){var r=this;ns(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=t;for(var n=r.observers;n.length;)n.shift().error(t)}})},e.prototype.complete=function(){var t=this;ns(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var r=t.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),i.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var r=this,n=this,o=n.hasError,a=n.isStopped,s=n.observers;return o||a?_u:(this.currentObservers=null,s.push(t),new Mn(function(){r.currentObservers=null,ys(s,t)}))},e.prototype._checkFinalizedStatuses=function(t){var r=this,n=r.hasError,o=r.thrownError,a=r.isStopped;n?t.error(o):a&&t.complete()},e.prototype.asObservable=function(){var t=new Be;return t.source=this,t},e.create=function(t,r){return new Hc(t,r)},e}(Be),Hc=function(i){Ni(e,i);function e(t,r){var n=i.call(this)||this;return n.destination=t,n.source=r,n}return e.prototype.next=function(t){var r,n;(n=(r=this.destination)===null||r===void 0?void 0:r.next)===null||n===void 0||n.call(r,t)},e.prototype.error=function(t){var r,n;(n=(r=this.destination)===null||r===void 0?void 0:r.error)===null||n===void 0||n.call(r,t)},e.prototype.complete=function(){var t,r;(r=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||r===void 0||r.call(t)},e.prototype._subscribe=function(t){var r,n;return(n=(r=this.source)===null||r===void 0?void 0:r.subscribe(t))!==null&&n!==void 0?n:_u},e}(or),Cu=function(i){Ni(e,i);function e(t){var r=i.call(this)||this;return r._value=t,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(t){var r=i.prototype._subscribe.call(this,t);return!r.closed&&t.next(this._value),r},e.prototype.getValue=function(){var t=this,r=t.hasError,n=t.thrownError,o=t._value;if(r)throw n;return this._throwIfClosed(),o},e.prototype.next=function(t){i.prototype.next.call(this,this._value=t)},e}(or),wu={now:function(){return(wu.delegate||Date).now()},delegate:void 0},ig=function(i){Ni(e,i);function e(t,r){return i.call(this)||this}return e.prototype.schedule=function(t,r){return this},e}(Mn),Cs={setInterval:function(i,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var n=Cs.delegate;return n!=null&&n.setInterval?n.setInterval.apply(n,Sr([i,e],sr(t))):setInterval.apply(void 0,Sr([i,e],sr(t)))},clearInterval:function(i){var e=Cs.delegate;return((e==null?void 0:e.clearInterval)||clearInterval)(i)},delegate:void 0},rg=function(i){Ni(e,i);function e(t,r){var n=i.call(this,t,r)||this;return n.scheduler=t,n.work=r,n.pending=!1,n}return e.prototype.schedule=function(t,r){var n;if(r===void 0&&(r=0),this.closed)return this;this.state=t;var o=this.id,a=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(a,o,r)),this.pending=!0,this.delay=r,this.id=(n=this.id)!==null&&n!==void 0?n:this.requestAsyncId(a,this.id,r),this},e.prototype.requestAsyncId=function(t,r,n){return n===void 0&&(n=0),Cs.setInterval(t.flush.bind(t,this),n)},e.prototype.recycleAsyncId=function(t,r,n){if(n===void 0&&(n=0),n!=null&&this.delay===n&&this.pending===!1)return r;r!=null&&Cs.clearInterval(r)},e.prototype.execute=function(t,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(t,r);if(n)return n;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,r){var n=!1,o;try{this.work(t)}catch(a){n=!0,o=a||new Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),o},e.prototype.unsubscribe=function(){if(!this.closed){var t=this,r=t.id,n=t.scheduler,o=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,ys(o,this),r!=null&&(this.id=this.recycleAsyncId(n,r,null)),this.delay=null,i.prototype.unsubscribe.call(this)}},e}(ig),Wc=function(){function i(e,t){t===void 0&&(t=i.now),this.schedulerActionCtor=e,this.now=t}return i.prototype.schedule=function(e,t,r){return t===void 0&&(t=0),new this.schedulerActionCtor(this,e).schedule(r,t)},i.now=wu.now,i}(),ng=function(i){Ni(e,i);function e(t,r){r===void 0&&(r=Wc.now);var n=i.call(this,t,r)||this;return n.actions=[],n._active=!1,n}return e.prototype.flush=function(t){var r=this.actions;if(this._active){r.push(t);return}var n;this._active=!0;do if(n=t.execute(t.state,t.delay))break;while(t=r.shift());if(this._active=!1,n){for(;t=r.shift();)t.unsubscribe();throw n}},e}(Wc),sg=new ng(rg);function og(i){return i&&ve(i.schedule)}function ag(i){return i[i.length-1]}function Oa(i){return og(ag(i))?i.pop():void 0}var Da=function(i){return i&&typeof i.length=="number"&&typeof i!="function"};function ku(i){return ve(i==null?void 0:i.then)}function Tu(i){return ve(i[Ra])}function Eu(i){return Symbol.asyncIterator&&ve(i==null?void 0:i[Symbol.asyncIterator])}function Pu(i){return new TypeError("You provided "+(i!==null&&typeof i=="object"?"an invalid object":"'"+i+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function cg(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Ru=cg();function xu(i){return ve(i==null?void 0:i[Ru])}function Ou(i){return Vm(this,arguments,function(){var t,r,n,o;return vu(this,function(a){switch(a.label){case 0:t=i.getReader(),a.label=1;case 1:a.trys.push([1,,9,10]),a.label=2;case 2:return[4,Ir(t.read())];case 3:return r=a.sent(),n=r.value,o=r.done,o?[4,Ir(void 0)]:[3,5];case 4:return[2,a.sent()];case 5:return[4,Ir(n)];case 6:return[4,a.sent()];case 7:return a.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function Du(i){return ve(i==null?void 0:i.getReader)}function Fi(i){if(i instanceof Be)return i;if(i!=null){if(Tu(i))return lg(i);if(Da(i))return hg(i);if(ku(i))return ug(i);if(Eu(i))return Au(i);if(xu(i))return dg(i);if(Du(i))return fg(i)}throw Pu(i)}function lg(i){return new Be(function(e){var t=i[Ra]();if(ve(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function hg(i){return new Be(function(e){for(var t=0;t<i.length&&!e.closed;t++)e.next(i[t]);e.complete()})}function ug(i){return new Be(function(e){i.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,Su)})}function dg(i){return new Be(function(e){var t,r;try{for(var n=Xr(i),o=n.next();!o.done;o=n.next()){var a=o.value;if(e.next(a),e.closed)return}}catch(s){t={error:s}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}e.complete()})}function Au(i){return new Be(function(e){pg(i,e).catch(function(t){return e.error(t)})})}function fg(i){return Au(Ou(i))}function pg(i,e){var t,r,n,o;return qm(this,void 0,void 0,function(){var a,s;return vu(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),t=Jm(i),c.label=1;case 1:return[4,t.next()];case 2:if(r=c.sent(),!!r.done)return[3,4];if(a=r.value,e.next(a),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=c.sent(),n={error:s},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(o=t.return)?[4,o.call(t)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(n)throw n.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function Ii(i,e,t,r,n){r===void 0&&(r=0),n===void 0&&(n=!1);var o=e.schedule(function(){t(),n?i.add(this.schedule(null,r)):this.unsubscribe()},r);if(i.add(o),!n)return o}function Lu(i,e){return e===void 0&&(e=0),dt(function(t,r){t.subscribe(Rt(r,function(n){return Ii(r,i,function(){return r.next(n)},e)},function(){return Ii(r,i,function(){return r.complete()},e)},function(n){return Ii(r,i,function(){return r.error(n)},e)}))})}function Iu(i,e){return e===void 0&&(e=0),dt(function(t,r){r.add(i.schedule(function(){return t.subscribe(r)},e))})}function mg(i,e){return Fi(i).pipe(Iu(e),Lu(e))}function gg(i,e){return Fi(i).pipe(Iu(e),Lu(e))}function vg(i,e){return new Be(function(t){var r=0;return e.schedule(function(){r===i.length?t.complete():(t.next(i[r++]),t.closed||this.schedule())})})}function _g(i,e){return new Be(function(t){var r;return Ii(t,e,function(){r=i[Ru](),Ii(t,e,function(){var n,o,a;try{n=r.next(),o=n.value,a=n.done}catch(s){t.error(s);return}a?t.complete():t.next(o)},0,!0)}),function(){return ve(r==null?void 0:r.return)&&r.return()}})}function Mu(i,e){if(!i)throw new Error("Iterable cannot be null");return new Be(function(t){Ii(t,e,function(){var r=i[Symbol.asyncIterator]();Ii(t,e,function(){r.next().then(function(n){n.done?t.complete():t.next(n.value)})},0,!0)})})}function bg(i,e){return Mu(Ou(i),e)}function yg(i,e){if(i!=null){if(Tu(i))return mg(i,e);if(Da(i))return vg(i,e);if(ku(i))return gg(i,e);if(Eu(i))return Mu(i,e);if(xu(i))return _g(i,e);if(Du(i))return bg(i,e)}throw Pu(i)}function Bu(i,e){return e?yg(i,e):Fi(i)}function qc(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];var t=Oa(i);return Bu(i,t)}function Sg(i){return i instanceof Date&&!isNaN(i)}var Cg=Ea(function(i){return function(t){t===void 0&&(t=null),i(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}});function wg(i,e){var t=Sg(i)?{first:i}:typeof i=="number"?{each:i}:i,r=t.first,n=t.each,o=t.with,a=o===void 0?kg:o,s=t.scheduler,c=s===void 0?e??sg:s,l=t.meta,u=l===void 0?null:l;if(r==null&&n==null)throw new TypeError("No timeout provided.");return dt(function(h,g){var _,y,v=null,f=0,p=function(d){y=Ii(g,c,function(){try{_.unsubscribe(),Fi(a({meta:u,lastValue:v,seen:f})).subscribe(g)}catch(m){g.error(m)}},d)};_=h.subscribe(Rt(g,function(d){y==null||y.unsubscribe(),f++,g.next(v=d),n>0&&p(n)},void 0,void 0,function(){y!=null&&y.closed||y==null||y.unsubscribe(),v=null})),!f&&p(r!=null?typeof r=="number"?r:+r-c.now():n)})}function kg(i){throw new Cg(i)}function De(i,e){return dt(function(t,r){var n=0;t.subscribe(Rt(r,function(o){r.next(i.call(e,o,n++))}))})}var Tg=Array.isArray;function Eg(i,e){return Tg(e)?i.apply(void 0,Sr([],sr(e))):i(e)}function Pg(i){return De(function(e){return Eg(i,e)})}function Rg(i,e,t,r,n,o,a,s){var c=[],l=0,u=0,h=!1,g=function(){h&&!c.length&&!l&&e.complete()},_=function(v){return l<r?y(v):c.push(v)},y=function(v){o&&e.next(v),l++;var f=!1;Fi(t(v,u++)).subscribe(Rt(e,function(p){n==null||n(p),o?_(p):e.next(p)},function(){f=!0},void 0,function(){if(f)try{l--;for(var p=function(){var d=c.shift();a?Ii(e,a,function(){return y(d)}):y(d)};c.length&&l<r;)p();g()}catch(d){e.error(d)}}))};return i.subscribe(Rt(e,_,function(){h=!0,g()})),function(){s==null||s()}}function Aa(i,e,t){return t===void 0&&(t=1/0),ve(e)?Aa(function(r,n){return De(function(o,a){return e(r,o,n,a)})(Fi(i(r,n)))},t):(typeof e=="number"&&(t=e),dt(function(r,n){return Rg(r,n,i,t)}))}function xg(i){return i===void 0&&(i=1/0),Aa(xa,i)}function Og(){return xg(1)}function ws(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];return Og()(Bu(i,Oa(i)))}var Dg=["addListener","removeListener"],Ag=["addEventListener","removeEventListener"],Lg=["on","off"];function Zo(i,e,t,r){if(ve(t)&&(r=t,t=void 0),r)return Zo(i,e,t).pipe(Pg(r));var n=sr(Bg(i)?Ag.map(function(s){return function(c){return i[s](e,c,t)}}):Ig(i)?Dg.map(Vc(i,e)):Mg(i)?Lg.map(Vc(i,e)):[],2),o=n[0],a=n[1];if(!o&&Da(i))return Aa(function(s){return Zo(s,e,t)})(Fi(i));if(!o)throw new TypeError("Invalid event target");return new Be(function(s){var c=function(){for(var l=[],u=0;u<arguments.length;u++)l[u]=arguments[u];return s.next(1<l.length?l:l[0])};return o(c),function(){return a(c)}})}function Vc(i,e){return function(t){return function(r){return i[t](e,r)}}}function Ig(i){return ve(i.addListener)&&ve(i.removeListener)}function Mg(i){return ve(i.on)&&ve(i.off)}function Bg(i){return ve(i.addEventListener)&&ve(i.removeEventListener)}function La(i,e){return dt(function(t,r){var n=0;t.subscribe(Rt(r,function(o){return i.call(e,o,n++)&&r.next(o)}))})}function Ng(i,e,t,r,n){return function(o,a){var s=t,c=e,l=0;o.subscribe(Rt(a,function(u){var h=l++;c=s?i(c,u,h):(s=!0,u),r&&a.next(c)},n&&function(){s&&a.next(c),a.complete()}))}}function Fg(i,e){return e===void 0&&(e=xa),i=i??Ug,dt(function(t,r){var n,o=!0;t.subscribe(Rt(r,function(a){var s=e(a);(o||!i(n,s))&&(o=!1,n=s,r.next(a))}))})}function Ug(i,e){return i===e}function jg(i){return dt(function(e,t){try{e.subscribe(t)}finally{t.add(i)}})}function Hg(i,e){return dt(Ng(i,e,arguments.length>=2,!0))}function Wg(i){return dt(function(e,t){var r=!1,n=Rt(t,function(){n==null||n.unsubscribe(),r=!0},Ss);Fi(i).subscribe(n),e.subscribe(Rt(t,function(o){return r&&t.next(o)}))})}function ft(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];var t=Oa(i);return dt(function(r,n){(t?ws(i,r,t):ws(i,r)).subscribe(n)})}function Jc(i){return dt(function(e,t){Fi(i).subscribe(Rt(t,function(){return t.complete()},Ss)),!t.closed&&e.subscribe(t)})}var qg=Object.defineProperty,Vg=Object.defineProperties,Jg=Object.getOwnPropertyDescriptors,ks=Object.getOwnPropertySymbols,Nu=Object.prototype.hasOwnProperty,Fu=Object.prototype.propertyIsEnumerable,$c=(i,e,t)=>e in i?qg(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ea=(i,e)=>{for(var t in e||(e={}))Nu.call(e,t)&&$c(i,t,e[t]);if(ks)for(var t of ks(e))Fu.call(e,t)&&$c(i,t,e[t]);return i},$g=(i,e)=>Vg(i,Jg(e)),zg=(i,e)=>{var t={};for(var r in i)Nu.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&ks)for(var r of ks(i))e.indexOf(r)<0&&Fu.call(i,r)&&(t[r]=i[r]);return t},ri=(i,e,t)=>new Promise((r,n)=>{var o=c=>{try{s(t.next(c))}catch(l){n(l)}},a=c=>{try{s(t.throw(c))}catch(l){n(l)}},s=c=>c.done?r(c.value):Promise.resolve(c.value).then(o,a);s((t=t.apply(i,e)).next())}),Uu="lk";function nt(i){return typeof i>"u"?!1:Kg(i)||Gg(i)}function Kg(i){var e;return i?i.hasOwnProperty("participant")&&i.hasOwnProperty("source")&&i.hasOwnProperty("track")&&typeof((e=i.publication)==null?void 0:e.track)<"u":!1}function Gg(i){return i?i.hasOwnProperty("participant")&&i.hasOwnProperty("source")&&i.hasOwnProperty("publication")&&typeof i.publication<"u":!1}function Pn(i){return i?i.hasOwnProperty("participant")&&i.hasOwnProperty("source")&&typeof i.publication>"u":!1}function Qe(i){if(typeof i=="string"||typeof i=="number")return`${i}`;if(Pn(i))return`${i.participant.identity}_${i.source}_placeholder`;if(nt(i))return`${i.participant.identity}_${i.publication.source}_${i.publication.trackSid}`;throw new Error(`Can't generate a id for the given track reference: ${i}`)}function Bb(i,e){return i===void 0||e===void 0?!1:nt(i)&&nt(e)?i.publication.trackSid===e.publication.trackSid:Qe(i)===Qe(e)}function Nb(i,e){return typeof e>"u"?!1:nt(i)?e.some(t=>t.participant.identity===i.participant.identity&&nt(t)&&t.publication.trackSid===i.publication.trackSid):Pn(i)?e.some(t=>t.participant.identity===i.participant.identity&&Pn(t)&&t.source===i.source):!1}function Xg(i,e){return Pn(i)&&nt(e)&&e.participant.identity===i.participant.identity&&e.source===i.source}function Fb(i){return i instanceof gs}function Ub(){const i=document.createElement("p");i.style.width="100%",i.style.height="200px";const e=document.createElement("div");e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.visibility="hidden",e.style.width="200px",e.style.height="150px",e.style.overflow="hidden",e.appendChild(i),document.body.appendChild(e);const t=i.offsetWidth;e.style.overflow="scroll";let r=i.offsetWidth;return t===r&&(r=e.clientWidth),document.body.removeChild(e),t-r}function jb(){return typeof document<"u"}function Hb(i,e){return ri(this,null,function*(){const{x:t,y:r}=yield jm(i,e,{placement:"top",middleware:[_m(6),Um(),Fm({padding:5})]});return{x:t,y:r}})}function Wb(i,e){return!i.contains(e.target)}var Qg=[$.ConnectionStateChanged,$.RoomMetadataChanged,$.ActiveSpeakersChanged,$.ConnectionQualityChanged,$.ParticipantConnected,$.ParticipantDisconnected,$.ParticipantPermissionsChanged,$.ParticipantMetadataChanged,$.TrackMuted,$.TrackUnmuted,$.TrackPublished,$.TrackUnpublished,$.TrackStreamStateChanged,$.TrackSubscriptionFailed,$.TrackSubscriptionPermissionChanged,$.TrackSubscriptionStatusChanged],Yg=[...Qg,$.LocalTrackPublished,$.LocalTrackUnpublished],Zg=[G.ConnectionQualityChanged,G.IsSpeakingChanged,G.ParticipantMetadataChanged,G.ParticipantPermissionsChanged,G.TrackMuted,G.TrackUnmuted,G.TrackPublished,G.TrackUnpublished,G.TrackStreamStateChanged,G.TrackSubscriptionFailed,G.TrackSubscriptionPermissionChanged,G.TrackSubscriptionStatusChanged];[...Zg,G.LocalTrackPublished,G.LocalTrackUnpublished];var ze=Wm.getLogger("lk-components-js");ze.setDefaultLevel("WARN");var qb=[{columns:1,rows:1,name:"1x1",minTiles:1,maxTiles:1,minWidth:0,minHeight:0},{columns:1,rows:2,name:"1x2",minTiles:2,maxTiles:2,minWidth:0,minHeight:0},{columns:2,rows:1,name:"2x1",minTiles:2,maxTiles:2,minWidth:900,minHeight:0},{columns:2,rows:2,name:"2x2",minTiles:3,maxTiles:4,minWidth:560,minHeight:0},{columns:3,rows:3,name:"3x3",minTiles:5,maxTiles:9,minWidth:700,minHeight:0},{columns:4,rows:4,name:"4x4",minTiles:10,maxTiles:16,minWidth:960,minHeight:0},{columns:5,rows:5,name:"5x5",minTiles:17,maxTiles:25,minWidth:1100,minHeight:0}];function ev(i,e,t,r){let n=0,o=i.find((a,s,c)=>{n=s;const l=c.findIndex((u,h)=>{const g=h>s,_=u.maxTiles===a.maxTiles;return g&&_})!==-1;return a.maxTiles>=e&&!l});if(o===void 0)if(o=i[i.length-1],o)ze.warn(`No layout found for: participantCount: ${e}, width/height: ${t}/${r} fallback to biggest available layout (${o.name}).`);else throw new Error("No layout or fallback layout found.");if((t<o.minWidth||r<o.minHeight)&&n>0){const a=i[n-1];o=ev(i.slice(0,n),a.maxTiles,t,r)}return o}function Vb(){return typeof navigator<"u"&&navigator.mediaDevices&&!!navigator.mediaDevices.getDisplayMedia}var Jb=[],$b={showChat:!1,unreadMessages:0};function tv(i){return typeof i=="object"}function zb(i){return Array.isArray(i)&&i.filter(tv).length>0}function iv(i,e){return e.audioLevel-i.audioLevel}function rv(i,e){return i.isSpeaking===e.isSpeaking?0:i.isSpeaking?-1:1}function nv(i,e){var t,r,n,o;return i.lastSpokeAt!==void 0||e.lastSpokeAt!==void 0?((r=(t=e.lastSpokeAt)==null?void 0:t.getTime())!=null?r:0)-((o=(n=i.lastSpokeAt)==null?void 0:n.getTime())!=null?o:0):0}function ta(i,e){var t,r,n,o;return((r=(t=i.joinedAt)==null?void 0:t.getTime())!=null?r:0)-((o=(n=e.joinedAt)==null?void 0:n.getTime())!=null?o:0)}function sv(i,e){return nt(i)?nt(e)?0:-1:nt(e)?1:0}function ov(i,e){const t=i.participant.isCameraEnabled,r=e.participant.isCameraEnabled;return t!==r?t?-1:1:0}function Kb(i){const e=[],t=[],r=[],n=[];i.forEach(s=>{s.participant.isLocal&&s.source===W.Source.Camera?e.push(s):s.source===W.Source.ScreenShare?t.push(s):s.source===W.Source.Camera?r.push(s):n.push(s)});const o=av(t),a=cv(r);return[...e,...o,...a,...n]}function av(i){const e=[],t=[];return i.forEach(n=>{n.participant.isLocal?e.push(n):t.push(n)}),e.sort((n,o)=>ta(n.participant,o.participant)),t.sort((n,o)=>ta(n.participant,o.participant)),[...t,...e]}function cv(i){const e=[],t=[];return i.forEach(r=>{r.participant.isLocal?e.push(r):t.push(r)}),t.sort((r,n)=>r.participant.isSpeaking&&n.participant.isSpeaking?iv(r.participant,n.participant):r.participant.isSpeaking!==n.participant.isSpeaking?rv(r.participant,n.participant):r.participant.lastSpokeAt!==n.participant.lastSpokeAt?nv(r.participant,n.participant):nt(r)!==nt(n)?sv(r,n):r.participant.isCameraEnabled!==n.participant.isCameraEnabled?ov(r,n):ta(r.participant,n.participant)),[...e,...t]}function lv(i,e){return i.reduce((t,r,n)=>n%e===0?[...t,[r]]:[...t.slice(0,-1),[...t.slice(-1)[0],r]],[])}function zc(i,e){const t=Math.max(i.length,e.length);return new Array(t).fill([]).map((r,n)=>[i[n],e[n]])}function Ts(i,e,t){return i.filter(r=>!e.map(n=>t(n)).includes(t(r)))}function ia(i){return i.map(e=>typeof e=="string"||typeof e=="number"?`${e}`:Qe(e))}function hv(i,e){return{dropped:Ts(i,e,Qe),added:Ts(e,i,Qe)}}function uv(i){return i.added.length!==0||i.dropped.length!==0}function ra(i,e){const t=e.findIndex(r=>Qe(r)===Qe(i));if(t===-1)throw new Error(`Element not part of the array: ${Qe(i)} not in ${ia(e)}`);return t}function dv(i,e,t){const r=ra(i,t),n=ra(e,t);return t.splice(r,1,e),t.splice(n,1,i),t}function fv(i,e){const t=ra(i,e);return e.splice(t,1),e}function pv(i,e){return[...e,i]}function go(i,e){return lv(i,e)}function Gb(i,e,t){let r=mv(i,e);if(r.length<e.length){const a=Ts(e,r,Qe);r=[...r,...a]}const n=go(r,t),o=go(e,t);if(zc(n,o).forEach(([a,s],c)=>{if(a&&s){const l=go(r,t)[c],u=hv(l,s);uv(u)&&(ze.debug(`Detected visual changes on page: ${c}, current: ${ia(a)}, next: ${ia(s)}`,{changes:u}),u.added.length===u.dropped.length&&zc(u.added,u.dropped).forEach(([h,g])=>{if(h&&g)r=dv(h,g,r);else throw new Error(`For a swap action we need a addition and a removal one is missing: ${h}, ${g}`)}),u.added.length===0&&u.dropped.length>0&&u.dropped.forEach(h=>{r=fv(h,r)}),u.added.length>0&&u.dropped.length===0&&u.added.forEach(h=>{r=pv(h,r)}))}}),r.length>e.length){const a=Ts(r,e,Qe);r=r.filter(s=>!a.map(Qe).includes(Qe(s)))}return r}function mv(i,e){return i.map(t=>{const r=e.find(n=>Qe(t)===Qe(n)||typeof t!="number"&&Pn(t)&&nt(n)&&Xg(t,n));return r??t})}function Ia(i,...e){return new Be(r=>{const n=()=>{r.next(i)};return e.forEach(a=>{i.on(a,n)}),()=>{e.forEach(a=>{i.off(a,n)})}}).pipe(ft(i))}function js(i,e){return new Be(r=>{const n=(...a)=>{r.next(a)};return i.on(e,n),()=>{i.off(e,n)}})}function Xb(i){return js(i,$.ConnectionStateChanged).pipe(De(([e])=>e),ft(i.state))}function Qb(i,e,t=!0){var r;const n=()=>ri(this,null,function*(){try{const s=yield $o.getLocalDevices(i,t);o.next(s)}catch(s){e==null||e(s)}}),o=new or,a=o.pipe(jg(()=>{var s;(s=navigator==null?void 0:navigator.mediaDevices)==null||s.removeEventListener("devicechange",n)}));if(typeof window<"u"){if(!window.isSecureContext)throw new Error("Accessing media devices is available only in secure contexts (HTTPS and localhost), in some or all supporting browsers. See: https://developer.mozilla.org/en-US/docs/Web/API/Navigator/mediaDevices");(r=navigator==null?void 0:navigator.mediaDevices)==null||r.addEventListener("devicechange",n)}return ws($o.getLocalDevices(i,t).catch(s=>e==null?void 0:e(s)),a)}function gv(i){return js(i,$.DataReceived)}function vv(i){return Ia(i,$.AudioPlaybackStatusChanged).pipe(De(t=>({canPlayAudio:t.canPlaybackAudio})))}function _v(i){return Ia(i,$.VideoPlaybackStatusChanged).pipe(De(t=>({canPlayVideo:t.canPlaybackVideo})))}function bv(i,e){return js(i,$.ActiveDeviceChanged).pipe(La(([t])=>t===e),De(([t,r])=>(ze.debug("activeDeviceObservable | RoomEvent.ActiveDeviceChanged",{kind:t,deviceId:r}),r)),ft(i.getActiveDevice(e)))}function Yb(i,e){return js(i,$.ParticipantEncryptionStatusChanged).pipe(La(([,t])=>e.identity===(t==null?void 0:t.identity)||!t&&e.identity===i.localParticipant.identity),De(([t])=>t),ft(e instanceof gs?e.isE2EEEnabled:e.isEncrypted))}function Ze(i){return`${Uu}-${i}`}function Zb(i){const e=Kc(i),t=ju(i.participant).pipe(De(()=>Kc(i)),ft(e));return{className:Ze(i.source===W.Source.Camera||i.source===W.Source.ScreenShare?"participant-media-video":"participant-media-audio"),trackObserver:t}}function Kc(i){if(nt(i))return i.publication;{const{source:e,name:t,participant:r}=i;if(e&&t)return r.getTracks().find(n=>n.source===e&&n.trackName===t);if(t)return r.getTrackByName(t);if(e)return r.getTrack(e);throw new Error("At least one of source and name needs to be defined")}}function Ma(i,...e){return new Be(r=>{const n=()=>{r.next(i)};return e.forEach(a=>{i.on(a,n)}),()=>{e.forEach(a=>{i.off(a,n)})}}).pipe(ft(i))}function ju(i){return Ma(i,G.TrackMuted,G.TrackUnmuted,G.ParticipantPermissionsChanged,G.TrackPublished,G.TrackUnpublished,G.LocalTrackPublished,G.LocalTrackUnpublished,G.MediaDevicesError,G.TrackSubscriptionStatusChanged).pipe(De(t=>{const{isMicrophoneEnabled:r,isCameraEnabled:n,isScreenShareEnabled:o}=t,a=t.getTrack(W.Source.Microphone),s=t.getTrack(W.Source.Camera);return{isCameraEnabled:n,isMicrophoneEnabled:r,isScreenShareEnabled:o,cameraTrack:s,microphoneTrack:a,participant:t}}))}function yv(i){return Ma(i,G.ParticipantMetadataChanged).pipe(De(({name:t,identity:r,metadata:n})=>({name:t,identity:r,metadata:n})),ft({name:i.name,identity:i.identity,metadata:i.metadata}))}function Sv(i){return Ba(i,G.ConnectionQualityChanged).pipe(De(([t])=>t),ft(i.connectionQuality))}function Ba(i,e){return new Be(r=>{const n=(...a)=>{r.next(a)};return i.on(e,n),()=>{i.off(e,n)}})}function Cv(i){var e,t,r,n;return Ma(i.participant,G.TrackMuted,G.TrackUnmuted,G.TrackSubscribed,G.TrackUnsubscribed,G.LocalTrackPublished,G.LocalTrackUnpublished).pipe(De(o=>{var a,s;const c=(a=i.publication)!=null?a:o.getTrack(i.source);return(s=c==null?void 0:c.isMuted)!=null?s:!0}),ft((n=(r=(e=i.publication)==null?void 0:e.isMuted)!=null?r:(t=i.participant.getTrack(i.source))==null?void 0:t.isMuted)!=null?n:!0))}function ey(i){return Ba(i,G.IsSpeakingChanged).pipe(De(([e])=>e))}function ty(i){return Ba(i,G.ParticipantPermissionsChanged).pipe(De(()=>i.permissions),ft(i.permissions))}function iy(i,e,t){const{localParticipant:r}=e,n=(l,u)=>{let h=!1;switch(l){case W.Source.Camera:h=u.isCameraEnabled;break;case W.Source.Microphone:h=u.isMicrophoneEnabled;break;case W.Source.ScreenShare:h=u.isScreenShareEnabled;break}return h},o=ju(r).pipe(De(l=>n(i,l.participant)),ft(n(i,r))),a=new or,s=(l,u)=>ri(this,null,function*(){try{switch(u??(u=t),a.next(!0),i){case W.Source.Camera:yield r.setCameraEnabled(l??!r.isCameraEnabled,u);break;case W.Source.Microphone:yield r.setMicrophoneEnabled(l??!r.isMicrophoneEnabled,u);break;case W.Source.ScreenShare:yield r.setScreenShareEnabled(l??!r.isScreenShareEnabled,u);break;default:break}}finally{a.next(!1)}});return{className:Ze("button"),toggle:s,enabledObserver:o,pendingObserver:a.asObservable()}}function ry(){let i=!1;const e=new or,t=new or,r=o=>ri(this,null,function*(){t.next(!0),i=o??!i,e.next(i),t.next(!1)});return{className:Ze("button"),toggle:r,enabledObserver:e.asObservable(),pendingObserver:t.asObservable()}}function ny(i,e,t){const r=new Cu(void 0),n=e?bv(e,i):r.asObservable(),o=(s,...c)=>ri(this,[s,...c],function*(l,u={}){var h,g,_;if(e){ze.debug(`Switching active device of kind "${i}" with id ${l}.`),yield e.switchActiveDevice(i,l,u.exact);const y=(h=e.getActiveDevice(i))!=null?h:l;y!==l&&l!=="default"&&ze.info(`We tried to select the device with id (${l}), but the browser decided to select the device with id (${y}) instead.`);let v;i==="audioinput"?v=(g=e.localParticipant.getTrack(W.Source.Microphone))==null?void 0:g.track:i==="videoinput"&&(v=(_=e.localParticipant.getTrack(W.Source.Camera))==null?void 0:_.track);const f=l==="default"&&!v||l==="default"&&(v==null?void 0:v.mediaStreamTrack.label.startsWith("Default"));r.next(f?l:y)}else if(t){yield t.setDeviceId(u.exact?{exact:l}:l);const y=yield t.getDeviceId();r.next(l==="default"&&t.mediaStreamTrack.label.startsWith("Default")?l:y)}else r.value!==l&&(ze.warn("device switch skipped, please provide either a room or a local track to switch on. "),r.next(l))});return{className:Ze("media-device-select"),activeDeviceObservable:n,setActiveMediaDevice:o}}function sy(i){const e=r=>{i.disconnect(r)};return{className:Ze("disconnect-button"),disconnect:e}}function oy(i){const e=Ze("connection-quality"),t=Sv(i);return{className:e,connectionQualityObserver:t}}function ay(i){let e="track-muted-indicator-camera";switch(i.source){case W.Source.Camera:e="track-muted-indicator-camera";break;case W.Source.Microphone:e="track-muted-indicator-microphone";break}const t=Ze(e),r=Cv(i);return{className:t,mediaMutedObserver:r}}function cy(i){return{className:"lk-participant-name",infoObserver:yv(i)}}function ly(){return{className:Ze("participant-tile")}}var wv={CHAT:"lk-chat-topic"};function Hu(i,e,t){return ri(this,arguments,function*(r,n,o,a={}){const{kind:s,destination:c}=a;yield r.publishData(n,s??Re.RELIABLE,{destination:c,topic:o})})}function kv(i,e,t){const r=gv(i).pipe(La(([,,,s])=>e===void 0||s===e),De(([s,c,,l])=>{const u={payload:s,topic:l,from:c};return t==null||t(u),u}));let n;const o=new Be(s=>{n=s});return{messageObservable:r,isSendingObservable:o,send:(s,...c)=>ri(this,[s,...c],function*(l,u={}){n.next(!0);try{yield Hu(i.localParticipant,l,e,u)}finally{n.next(!1)}})}}var Tv=new TextEncoder,Ev=new TextDecoder,Vn=new Map,Pv=i=>Tv.encode(JSON.stringify({message:i.message,timestamp:i.timestamp})),Rv=i=>JSON.parse(Ev.decode(i));function hy(i,e){var t,r;const n=new or,{messageDecoder:o,messageEncoder:a,channelTopic:s}=e??{},c=s??wv.CHAT;let l=!1;Vn.has(i)||(l=!0);const u=(t=Vn.get(i))!=null?t:new Map,h=(r=u.get(c))!=null?r:new or;if(u.set(c,h),Vn.set(i,u),l){const{messageObservable:d}=kv(i,c);d.pipe(Jc(n)).subscribe(h)}const g=o??Rv,_=h.pipe(De(d=>{const m=g(d.payload);return $g(ea({},m),{from:d.from})}),Hg((d,m)=>[...d,m],[]),Jc(n)),y=new Cu(!1),v=a??Pv,f=d=>ri(this,null,function*(){const m=Date.now(),b=v({message:d,timestamp:m});y.next(!0);try{yield Hu(i.localParticipant,b,c,{kind:Re.RELIABLE}),h.next({payload:b,topic:c,from:i.localParticipant})}finally{y.next(!1)}});function p(){n.next(),n.complete(),Vn.clear()}return i.once($.Disconnected,p),{messageObservable:_,isSendingObservable:y,send:f}}function uy(){const i=t=>ri(this,null,function*(){ze.info("Start Audio for room: ",t),yield t.startAudio()});return{className:Ze("start-audio-button"),roomAudioPlaybackAllowedObservable:vv,handleStartAudioPlayback:i}}function dy(){const i=t=>ri(this,null,function*(){ze.info("Start Video for room: ",t),yield t.startVideo()});return{className:Ze("start-audio-button"),roomVideoPlaybackAllowedObservable:_v,handleStartVideoPlayback:i}}function fy(){return{className:[Ze("button"),Ze("chat-toggle")].join(" ")}}function py(){return{className:[Ze("button"),Ze("focus-toggle-button")].join(" ")}}function my(){return{className:"lk-room-container"}}function Gc(i,e,t=!0){const n=[i.localParticipant,...Array.from(i.participants.values())],o=[];return n.forEach(a=>{e.forEach(s=>{const c=Array.from(a.tracks.values()).filter(l=>l.source===s&&(!t||l.track)).map(l=>({participant:a,publication:l,source:l.source}));o.push(...c)})}),{trackReferences:o,participants:n}}function gy(i,e,t){var r,n;const o=(r=t.additionalRoomEvents)!=null?r:Yg,a=(n=t.onlySubscribed)!=null?n:!0,s=Array.from(new Set([$.ParticipantConnected,$.ParticipantDisconnected,$.ConnectionStateChanged,$.LocalTrackPublished,$.LocalTrackUnpublished,$.TrackPublished,$.TrackUnpublished,$.TrackSubscriptionStatusChanged,...o]).values());return Ia(i,...s).pipe(De(l=>{const u=Gc(l,e,a);return ze.debug(`TrackReference[] was updated. (length ${u.trackReferences.length})`,u),u}),ft(Gc(i,e,a)))}function vy(i,e=1e3){if(i===null)return qc(!1);const t=Zo(i,"mousemove",{passive:!0}).pipe(De(()=>!0)),r=t.pipe(wg({each:e,with:()=>ws(qc(!1),r.pipe(Wg(t)))}),Fg());return r}function xv(i,e){if(typeof localStorage>"u"){ze.error("Local storage is not available.");return}try{localStorage.setItem(i,JSON.stringify(e))}catch(t){ze.error(`Error setting item to local storage: ${t}`)}}function Ov(i){if(typeof localStorage>"u"){ze.error("Local storage is not available.");return}try{const e=localStorage.getItem(i);if(!e){ze.warn(`Item with key ${i} does not exist in local storage.`);return}return JSON.parse(e)}catch(e){ze.error(`Error getting item from local storage: ${e}`);return}}function Dv(i){return{load:()=>Ov(i),save:e=>xv(i,e)}}var Av=`${Uu}-user-choices`,cr={videoEnabled:!0,audioEnabled:!0,videoDeviceId:"",audioDeviceId:"",username:"",e2ee:!1,sharedPassphrase:""},{load:Lv,save:Iv}=Dv(Av);function _y(i,e=!1){if(e===!0)return;const t=i,r=zg(t,["e2ee","sharedPassphrase"]);Iv(r)}function by(i,e=!1){var t,r,n,o,a,s,c;const l={videoEnabled:(t=i==null?void 0:i.videoEnabled)!=null?t:cr.videoEnabled,audioEnabled:(r=i==null?void 0:i.audioEnabled)!=null?r:cr.audioEnabled,videoDeviceId:(n=i==null?void 0:i.videoDeviceId)!=null?n:cr.videoDeviceId,audioDeviceId:(o=i==null?void 0:i.audioDeviceId)!=null?o:cr.audioDeviceId,username:(a=i==null?void 0:i.username)!=null?a:cr.username,e2ee:(s=i==null?void 0:i.e2ee)!=null?s:cr.e2ee,sharedPassphrase:(c=i==null?void 0:i.sharedPassphrase)!=null?c:cr.sharedPassphrase};if(e)return l;{const u=Lv();return ea(ea({},l),u??{})}}globalThis&&globalThis.__awaiter;function yy(i,e){const[t,r]=ls.useState(i);return ls.useEffect(()=>{const n=setTimeout(()=>r(i),e||500);return()=>{clearTimeout(n)}},[i,e]),t}globalThis&&globalThis.__awaiter;function Sy(i,{threshold:e=0,root:t=null,rootMargin:r="0%",freezeOnceVisible:n=!1}){const[o,a]=ls.useState(),s=(o==null?void 0:o.isIntersecting)&&n,c=([l])=>{a(l)};return ls.useEffect(()=>{const l=i==null?void 0:i.current;if(!!!window.IntersectionObserver||s||!l)return;const h={threshold:e,root:t,rootMargin:r},g=new IntersectionObserver(c,h);return g.observe(l),()=>g.disconnect()},[i==null?void 0:i.current,JSON.stringify(e),t,r,s]),o}function Wu(i,e){return function(){return i.apply(e,arguments)}}const{toString:Mv}=Object.prototype,{getPrototypeOf:Na}=Object,Hs=(i=>e=>{const t=Mv.call(e);return i[t]||(i[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),xt=i=>(i=i.toLowerCase(),e=>Hs(e)===i),Ws=i=>e=>typeof e===i,{isArray:tn}=Array,Rn=Ws("undefined");function Bv(i){return i!==null&&!Rn(i)&&i.constructor!==null&&!Rn(i.constructor)&&st(i.constructor.isBuffer)&&i.constructor.isBuffer(i)}const qu=xt("ArrayBuffer");function Nv(i){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(i):e=i&&i.buffer&&qu(i.buffer),e}const Fv=Ws("string"),st=Ws("function"),Vu=Ws("number"),qs=i=>i!==null&&typeof i=="object",Uv=i=>i===!0||i===!1,ss=i=>{if(Hs(i)!=="object")return!1;const e=Na(i);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)},jv=xt("Date"),Hv=xt("File"),Wv=xt("Blob"),qv=xt("FileList"),Vv=i=>qs(i)&&st(i.pipe),Jv=i=>{let e;return i&&(typeof FormData=="function"&&i instanceof FormData||st(i.append)&&((e=Hs(i))==="formdata"||e==="object"&&st(i.toString)&&i.toString()==="[object FormData]"))},$v=xt("URLSearchParams"),[zv,Kv,Gv,Xv]=["ReadableStream","Request","Response","Headers"].map(xt),Qv=i=>i.trim?i.trim():i.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Bn(i,e,{allOwnKeys:t=!1}={}){if(i===null||typeof i>"u")return;let r,n;if(typeof i!="object"&&(i=[i]),tn(i))for(r=0,n=i.length;r<n;r++)e.call(null,i[r],r,i);else{const o=t?Object.getOwnPropertyNames(i):Object.keys(i),a=o.length;let s;for(r=0;r<a;r++)s=o[r],e.call(null,i[s],s,i)}}function Ju(i,e){e=e.toLowerCase();const t=Object.keys(i);let r=t.length,n;for(;r-- >0;)if(n=t[r],e===n.toLowerCase())return n;return null}const lr=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),$u=i=>!Rn(i)&&i!==lr;function na(){const{caseless:i}=$u(this)&&this||{},e={},t=(r,n)=>{const o=i&&Ju(e,n)||n;ss(e[o])&&ss(r)?e[o]=na(e[o],r):ss(r)?e[o]=na({},r):tn(r)?e[o]=r.slice():e[o]=r};for(let r=0,n=arguments.length;r<n;r++)arguments[r]&&Bn(arguments[r],t);return e}const Yv=(i,e,t,{allOwnKeys:r}={})=>(Bn(e,(n,o)=>{t&&st(n)?i[o]=Wu(n,t):i[o]=n},{allOwnKeys:r}),i),Zv=i=>(i.charCodeAt(0)===65279&&(i=i.slice(1)),i),e_=(i,e,t,r)=>{i.prototype=Object.create(e.prototype,r),i.prototype.constructor=i,Object.defineProperty(i,"super",{value:e.prototype}),t&&Object.assign(i.prototype,t)},t_=(i,e,t,r)=>{let n,o,a;const s={};if(e=e||{},i==null)return e;do{for(n=Object.getOwnPropertyNames(i),o=n.length;o-- >0;)a=n[o],(!r||r(a,i,e))&&!s[a]&&(e[a]=i[a],s[a]=!0);i=t!==!1&&Na(i)}while(i&&(!t||t(i,e))&&i!==Object.prototype);return e},i_=(i,e,t)=>{i=String(i),(t===void 0||t>i.length)&&(t=i.length),t-=e.length;const r=i.indexOf(e,t);return r!==-1&&r===t},r_=i=>{if(!i)return null;if(tn(i))return i;let e=i.length;if(!Vu(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=i[e];return t},n_=(i=>e=>i&&e instanceof i)(typeof Uint8Array<"u"&&Na(Uint8Array)),s_=(i,e)=>{const r=(i&&i[Symbol.iterator]).call(i);let n;for(;(n=r.next())&&!n.done;){const o=n.value;e.call(i,o[0],o[1])}},o_=(i,e)=>{let t;const r=[];for(;(t=i.exec(e))!==null;)r.push(t);return r},a_=xt("HTMLFormElement"),c_=i=>i.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,n){return r.toUpperCase()+n}),Xc=(({hasOwnProperty:i})=>(e,t)=>i.call(e,t))(Object.prototype),l_=xt("RegExp"),zu=(i,e)=>{const t=Object.getOwnPropertyDescriptors(i),r={};Bn(t,(n,o)=>{let a;(a=e(n,o,i))!==!1&&(r[o]=a||n)}),Object.defineProperties(i,r)},h_=i=>{zu(i,(e,t)=>{if(st(i)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const r=i[t];if(st(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},u_=(i,e)=>{const t={},r=n=>{n.forEach(o=>{t[o]=!0})};return tn(i)?r(i):r(String(i).split(e)),t},d_=()=>{},f_=(i,e)=>i!=null&&Number.isFinite(i=+i)?i:e;function p_(i){return!!(i&&st(i.append)&&i[Symbol.toStringTag]==="FormData"&&i[Symbol.iterator])}const m_=i=>{const e=new Array(10),t=(r,n)=>{if(qs(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[n]=r;const o=tn(r)?[]:{};return Bn(r,(a,s)=>{const c=t(a,n+1);!Rn(c)&&(o[s]=c)}),e[n]=void 0,o}}return r};return t(i,0)},g_=xt("AsyncFunction"),v_=i=>i&&(qs(i)||st(i))&&st(i.then)&&st(i.catch),Ku=((i,e)=>i?setImmediate:e?((t,r)=>(lr.addEventListener("message",({source:n,data:o})=>{n===lr&&o===t&&r.length&&r.shift()()},!1),n=>{r.push(n),lr.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",st(lr.postMessage)),__=typeof queueMicrotask<"u"?queueMicrotask.bind(lr):typeof process<"u"&&process.nextTick||Ku,j={isArray:tn,isArrayBuffer:qu,isBuffer:Bv,isFormData:Jv,isArrayBufferView:Nv,isString:Fv,isNumber:Vu,isBoolean:Uv,isObject:qs,isPlainObject:ss,isReadableStream:zv,isRequest:Kv,isResponse:Gv,isHeaders:Xv,isUndefined:Rn,isDate:jv,isFile:Hv,isBlob:Wv,isRegExp:l_,isFunction:st,isStream:Vv,isURLSearchParams:$v,isTypedArray:n_,isFileList:qv,forEach:Bn,merge:na,extend:Yv,trim:Qv,stripBOM:Zv,inherits:e_,toFlatObject:t_,kindOf:Hs,kindOfTest:xt,endsWith:i_,toArray:r_,forEachEntry:s_,matchAll:o_,isHTMLForm:a_,hasOwnProperty:Xc,hasOwnProp:Xc,reduceDescriptors:zu,freezeMethods:h_,toObjectSet:u_,toCamelCase:c_,noop:d_,toFiniteNumber:f_,findKey:Ju,global:lr,isContextDefined:$u,isSpecCompliantForm:p_,toJSONObject:m_,isAsyncFn:g_,isThenable:v_,setImmediate:Ku,asap:__};function ae(i,e,t,r,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=i,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),r&&(this.request=r),n&&(this.response=n,this.status=n.status?n.status:null)}j.inherits(ae,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:j.toJSONObject(this.config),code:this.code,status:this.status}}});const Gu=ae.prototype,Xu={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(i=>{Xu[i]={value:i}});Object.defineProperties(ae,Xu);Object.defineProperty(Gu,"isAxiosError",{value:!0});ae.from=(i,e,t,r,n,o)=>{const a=Object.create(Gu);return j.toFlatObject(i,a,function(c){return c!==Error.prototype},s=>s!=="isAxiosError"),ae.call(a,i.message,e,t,r,n),a.cause=i,a.name=i.name,o&&Object.assign(a,o),a};const b_=null;function sa(i){return j.isPlainObject(i)||j.isArray(i)}function Qu(i){return j.endsWith(i,"[]")?i.slice(0,-2):i}function Qc(i,e,t){return i?i.concat(e).map(function(n,o){return n=Qu(n),!t&&o?"["+n+"]":n}).join(t?".":""):e}function y_(i){return j.isArray(i)&&!i.some(sa)}const S_=j.toFlatObject(j,{},null,function(e){return/^is[A-Z]/.test(e)});function Vs(i,e,t){if(!j.isObject(i))throw new TypeError("target must be an object");e=e||new FormData,t=j.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(v,f){return!j.isUndefined(f[v])});const r=t.metaTokens,n=t.visitor||u,o=t.dots,a=t.indexes,c=(t.Blob||typeof Blob<"u"&&Blob)&&j.isSpecCompliantForm(e);if(!j.isFunction(n))throw new TypeError("visitor must be a function");function l(y){if(y===null)return"";if(j.isDate(y))return y.toISOString();if(!c&&j.isBlob(y))throw new ae("Blob is not supported. Use a Buffer instead.");return j.isArrayBuffer(y)||j.isTypedArray(y)?c&&typeof Blob=="function"?new Blob([y]):Buffer.from(y):y}function u(y,v,f){let p=y;if(y&&!f&&typeof y=="object"){if(j.endsWith(v,"{}"))v=r?v:v.slice(0,-2),y=JSON.stringify(y);else if(j.isArray(y)&&y_(y)||(j.isFileList(y)||j.endsWith(v,"[]"))&&(p=j.toArray(y)))return v=Qu(v),p.forEach(function(m,b){!(j.isUndefined(m)||m===null)&&e.append(a===!0?Qc([v],b,o):a===null?v:v+"[]",l(m))}),!1}return sa(y)?!0:(e.append(Qc(f,v,o),l(y)),!1)}const h=[],g=Object.assign(S_,{defaultVisitor:u,convertValue:l,isVisitable:sa});function _(y,v){if(!j.isUndefined(y)){if(h.indexOf(y)!==-1)throw Error("Circular reference detected in "+v.join("."));h.push(y),j.forEach(y,function(p,d){(!(j.isUndefined(p)||p===null)&&n.call(e,p,j.isString(d)?d.trim():d,v,g))===!0&&_(p,v?v.concat(d):[d])}),h.pop()}}if(!j.isObject(i))throw new TypeError("data must be an object");return _(i),e}function Yc(i){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(i).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function Fa(i,e){this._pairs=[],i&&Vs(i,this,e)}const Yu=Fa.prototype;Yu.append=function(e,t){this._pairs.push([e,t])};Yu.toString=function(e){const t=e?function(r){return e.call(this,r,Yc)}:Yc;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};function C_(i){return encodeURIComponent(i).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Zu(i,e,t){if(!e)return i;const r=t&&t.encode||C_;j.isFunction(t)&&(t={serialize:t});const n=t&&t.serialize;let o;if(n?o=n(e,t):o=j.isURLSearchParams(e)?e.toString():new Fa(e,t).toString(r),o){const a=i.indexOf("#");a!==-1&&(i=i.slice(0,a)),i+=(i.indexOf("?")===-1?"?":"&")+o}return i}class w_{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){j.forEach(this.handlers,function(r){r!==null&&e(r)})}}const Zc=w_,ed={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},k_=typeof URLSearchParams<"u"?URLSearchParams:Fa,T_=typeof FormData<"u"?FormData:null,E_=typeof Blob<"u"?Blob:null,P_={isBrowser:!0,classes:{URLSearchParams:k_,FormData:T_,Blob:E_},protocols:["http","https","file","blob","url","data"]},Ua=typeof window<"u"&&typeof document<"u",oa=typeof navigator=="object"&&navigator||void 0,R_=Ua&&(!oa||["ReactNative","NativeScript","NS"].indexOf(oa.product)<0),x_=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),O_=Ua&&window.location.href||"http://localhost",D_=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Ua,hasStandardBrowserEnv:R_,hasStandardBrowserWebWorkerEnv:x_,navigator:oa,origin:O_},Symbol.toStringTag,{value:"Module"})),He={...D_,...P_};function A_(i,e){return Vs(i,new He.classes.URLSearchParams,Object.assign({visitor:function(t,r,n,o){return He.isNode&&j.isBuffer(t)?(this.append(r,t.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},e))}function L_(i){return j.matchAll(/\w+|\[(\w*)]/g,i).map(e=>e[0]==="[]"?"":e[1]||e[0])}function I_(i){const e={},t=Object.keys(i);let r;const n=t.length;let o;for(r=0;r<n;r++)o=t[r],e[o]=i[o];return e}function td(i){function e(t,r,n,o){let a=t[o++];if(a==="__proto__")return!0;const s=Number.isFinite(+a),c=o>=t.length;return a=!a&&j.isArray(n)?n.length:a,c?(j.hasOwnProp(n,a)?n[a]=[n[a],r]:n[a]=r,!s):((!n[a]||!j.isObject(n[a]))&&(n[a]=[]),e(t,r,n[a],o)&&j.isArray(n[a])&&(n[a]=I_(n[a])),!s)}if(j.isFormData(i)&&j.isFunction(i.entries)){const t={};return j.forEachEntry(i,(r,n)=>{e(L_(r),n,t,0)}),t}return null}function M_(i,e,t){if(j.isString(i))try{return(e||JSON.parse)(i),j.trim(i)}catch(r){if(r.name!=="SyntaxError")throw r}return(t||JSON.stringify)(i)}const ja={transitional:ed,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const r=t.getContentType()||"",n=r.indexOf("application/json")>-1,o=j.isObject(e);if(o&&j.isHTMLForm(e)&&(e=new FormData(e)),j.isFormData(e))return n?JSON.stringify(td(e)):e;if(j.isArrayBuffer(e)||j.isBuffer(e)||j.isStream(e)||j.isFile(e)||j.isBlob(e)||j.isReadableStream(e))return e;if(j.isArrayBufferView(e))return e.buffer;if(j.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(o){if(r.indexOf("application/x-www-form-urlencoded")>-1)return A_(e,this.formSerializer).toString();if((s=j.isFileList(e))||r.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return Vs(s?{"files[]":e}:e,c&&new c,this.formSerializer)}}return o||n?(t.setContentType("application/json",!1),M_(e)):e}],transformResponse:[function(e){const t=this.transitional||ja.transitional,r=t&&t.forcedJSONParsing,n=this.responseType==="json";if(j.isResponse(e)||j.isReadableStream(e))return e;if(e&&j.isString(e)&&(r&&!this.responseType||n)){const a=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(s){if(a)throw s.name==="SyntaxError"?ae.from(s,ae.ERR_BAD_RESPONSE,this,null,this.response):s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:He.classes.FormData,Blob:He.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};j.forEach(["delete","get","head","post","put","patch"],i=>{ja.headers[i]={}});const Ha=ja,B_=j.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),N_=i=>{const e={};let t,r,n;return i&&i.split(`
`).forEach(function(a){n=a.indexOf(":"),t=a.substring(0,n).trim().toLowerCase(),r=a.substring(n+1).trim(),!(!t||e[t]&&B_[t])&&(t==="set-cookie"?e[t]?e[t].push(r):e[t]=[r]:e[t]=e[t]?e[t]+", "+r:r)}),e},el=Symbol("internals");function pn(i){return i&&String(i).trim().toLowerCase()}function os(i){return i===!1||i==null?i:j.isArray(i)?i.map(os):String(i)}function F_(i){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=t.exec(i);)e[r[1]]=r[2];return e}const U_=i=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(i.trim());function vo(i,e,t,r,n){if(j.isFunction(r))return r.call(this,e,t);if(n&&(e=t),!!j.isString(e)){if(j.isString(r))return e.indexOf(r)!==-1;if(j.isRegExp(r))return r.test(e)}}function j_(i){return i.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}function H_(i,e){const t=j.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(i,r+t,{value:function(n,o,a){return this[r].call(this,e,n,o,a)},configurable:!0})})}class Js{constructor(e){e&&this.set(e)}set(e,t,r){const n=this;function o(s,c,l){const u=pn(c);if(!u)throw new Error("header name must be a non-empty string");const h=j.findKey(n,u);(!h||n[h]===void 0||l===!0||l===void 0&&n[h]!==!1)&&(n[h||c]=os(s))}const a=(s,c)=>j.forEach(s,(l,u)=>o(l,u,c));if(j.isPlainObject(e)||e instanceof this.constructor)a(e,t);else if(j.isString(e)&&(e=e.trim())&&!U_(e))a(N_(e),t);else if(j.isHeaders(e))for(const[s,c]of e.entries())o(c,s,r);else e!=null&&o(t,e,r);return this}get(e,t){if(e=pn(e),e){const r=j.findKey(this,e);if(r){const n=this[r];if(!t)return n;if(t===!0)return F_(n);if(j.isFunction(t))return t.call(this,n,r);if(j.isRegExp(t))return t.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=pn(e),e){const r=j.findKey(this,e);return!!(r&&this[r]!==void 0&&(!t||vo(this,this[r],r,t)))}return!1}delete(e,t){const r=this;let n=!1;function o(a){if(a=pn(a),a){const s=j.findKey(r,a);s&&(!t||vo(r,r[s],s,t))&&(delete r[s],n=!0)}}return j.isArray(e)?e.forEach(o):o(e),n}clear(e){const t=Object.keys(this);let r=t.length,n=!1;for(;r--;){const o=t[r];(!e||vo(this,this[o],o,e,!0))&&(delete this[o],n=!0)}return n}normalize(e){const t=this,r={};return j.forEach(this,(n,o)=>{const a=j.findKey(r,o);if(a){t[a]=os(n),delete t[o];return}const s=e?j_(o):String(o).trim();s!==o&&delete t[o],t[s]=os(n),r[s]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return j.forEach(this,(r,n)=>{r!=null&&r!==!1&&(t[n]=e&&j.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach(n=>r.set(n)),r}static accessor(e){const r=(this[el]=this[el]={accessors:{}}).accessors,n=this.prototype;function o(a){const s=pn(a);r[s]||(H_(n,a),r[s]=!0)}return j.isArray(e)?e.forEach(o):o(e),this}}Js.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);j.reduceDescriptors(Js.prototype,({value:i},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>i,set(r){this[t]=r}}});j.freezeMethods(Js);const Et=Js;function _o(i,e){const t=this||Ha,r=e||t,n=Et.from(r.headers);let o=r.data;return j.forEach(i,function(s){o=s.call(t,o,n.normalize(),e?e.status:void 0)}),n.normalize(),o}function id(i){return!!(i&&i.__CANCEL__)}function rn(i,e,t){ae.call(this,i??"canceled",ae.ERR_CANCELED,e,t),this.name="CanceledError"}j.inherits(rn,ae,{__CANCEL__:!0});function rd(i,e,t){const r=t.config.validateStatus;!t.status||!r||r(t.status)?i(t):e(new ae("Request failed with status code "+t.status,[ae.ERR_BAD_REQUEST,ae.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function W_(i){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(i);return e&&e[1]||""}function q_(i,e){i=i||10;const t=new Array(i),r=new Array(i);let n=0,o=0,a;return e=e!==void 0?e:1e3,function(c){const l=Date.now(),u=r[o];a||(a=l),t[n]=c,r[n]=l;let h=o,g=0;for(;h!==n;)g+=t[h++],h=h%i;if(n=(n+1)%i,n===o&&(o=(o+1)%i),l-a<e)return;const _=u&&l-u;return _?Math.round(g*1e3/_):void 0}}function V_(i,e){let t=0,r=1e3/e,n,o;const a=(l,u=Date.now())=>{t=u,n=null,o&&(clearTimeout(o),o=null),i.apply(null,l)};return[(...l)=>{const u=Date.now(),h=u-t;h>=r?a(l,u):(n=l,o||(o=setTimeout(()=>{o=null,a(n)},r-h)))},()=>n&&a(n)]}const Es=(i,e,t=3)=>{let r=0;const n=q_(50,250);return V_(o=>{const a=o.loaded,s=o.lengthComputable?o.total:void 0,c=a-r,l=n(c),u=a<=s;r=a;const h={loaded:a,total:s,progress:s?a/s:void 0,bytes:c,rate:l||void 0,estimated:l&&s&&u?(s-a)/l:void 0,event:o,lengthComputable:s!=null,[e?"download":"upload"]:!0};i(h)},t)},tl=(i,e)=>{const t=i!=null;return[r=>e[0]({lengthComputable:t,total:i,loaded:r}),e[1]]},il=i=>(...e)=>j.asap(()=>i(...e)),J_=He.hasStandardBrowserEnv?((i,e)=>t=>(t=new URL(t,He.origin),i.protocol===t.protocol&&i.host===t.host&&(e||i.port===t.port)))(new URL(He.origin),He.navigator&&/(msie|trident)/i.test(He.navigator.userAgent)):()=>!0,$_=He.hasStandardBrowserEnv?{write(i,e,t,r,n,o){const a=[i+"="+encodeURIComponent(e)];j.isNumber(t)&&a.push("expires="+new Date(t).toGMTString()),j.isString(r)&&a.push("path="+r),j.isString(n)&&a.push("domain="+n),o===!0&&a.push("secure"),document.cookie=a.join("; ")},read(i){const e=document.cookie.match(new RegExp("(^|;\\s*)("+i+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(i){this.write(i,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function z_(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}function K_(i,e){return e?i.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):i}function nd(i,e,t){let r=!z_(e);return i&&(r||t==!1)?K_(i,e):e}const rl=i=>i instanceof Et?{...i}:i;function Cr(i,e){e=e||{};const t={};function r(l,u,h,g){return j.isPlainObject(l)&&j.isPlainObject(u)?j.merge.call({caseless:g},l,u):j.isPlainObject(u)?j.merge({},u):j.isArray(u)?u.slice():u}function n(l,u,h,g){if(j.isUndefined(u)){if(!j.isUndefined(l))return r(void 0,l,h,g)}else return r(l,u,h,g)}function o(l,u){if(!j.isUndefined(u))return r(void 0,u)}function a(l,u){if(j.isUndefined(u)){if(!j.isUndefined(l))return r(void 0,l)}else return r(void 0,u)}function s(l,u,h){if(h in e)return r(l,u);if(h in i)return r(void 0,l)}const c={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:s,headers:(l,u,h)=>n(rl(l),rl(u),h,!0)};return j.forEach(Object.keys(Object.assign({},i,e)),function(u){const h=c[u]||n,g=h(i[u],e[u],u);j.isUndefined(g)&&h!==s||(t[u]=g)}),t}const sd=i=>{const e=Cr({},i);let{data:t,withXSRFToken:r,xsrfHeaderName:n,xsrfCookieName:o,headers:a,auth:s}=e;e.headers=a=Et.from(a),e.url=Zu(nd(e.baseURL,e.url,e.allowAbsoluteUrls),i.params,i.paramsSerializer),s&&a.set("Authorization","Basic "+btoa((s.username||"")+":"+(s.password?unescape(encodeURIComponent(s.password)):"")));let c;if(j.isFormData(t)){if(He.hasStandardBrowserEnv||He.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if((c=a.getContentType())!==!1){const[l,...u]=c?c.split(";").map(h=>h.trim()).filter(Boolean):[];a.setContentType([l||"multipart/form-data",...u].join("; "))}}if(He.hasStandardBrowserEnv&&(r&&j.isFunction(r)&&(r=r(e)),r||r!==!1&&J_(e.url))){const l=n&&o&&$_.read(o);l&&a.set(n,l)}return e},G_=typeof XMLHttpRequest<"u",X_=G_&&function(i){return new Promise(function(t,r){const n=sd(i);let o=n.data;const a=Et.from(n.headers).normalize();let{responseType:s,onUploadProgress:c,onDownloadProgress:l}=n,u,h,g,_,y;function v(){_&&_(),y&&y(),n.cancelToken&&n.cancelToken.unsubscribe(u),n.signal&&n.signal.removeEventListener("abort",u)}let f=new XMLHttpRequest;f.open(n.method.toUpperCase(),n.url,!0),f.timeout=n.timeout;function p(){if(!f)return;const m=Et.from("getAllResponseHeaders"in f&&f.getAllResponseHeaders()),C={data:!s||s==="text"||s==="json"?f.responseText:f.response,status:f.status,statusText:f.statusText,headers:m,config:i,request:f};rd(function(T){t(T),v()},function(T){r(T),v()},C),f=null}"onloadend"in f?f.onloadend=p:f.onreadystatechange=function(){!f||f.readyState!==4||f.status===0&&!(f.responseURL&&f.responseURL.indexOf("file:")===0)||setTimeout(p)},f.onabort=function(){f&&(r(new ae("Request aborted",ae.ECONNABORTED,i,f)),f=null)},f.onerror=function(){r(new ae("Network Error",ae.ERR_NETWORK,i,f)),f=null},f.ontimeout=function(){let b=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const C=n.transitional||ed;n.timeoutErrorMessage&&(b=n.timeoutErrorMessage),r(new ae(b,C.clarifyTimeoutError?ae.ETIMEDOUT:ae.ECONNABORTED,i,f)),f=null},o===void 0&&a.setContentType(null),"setRequestHeader"in f&&j.forEach(a.toJSON(),function(b,C){f.setRequestHeader(C,b)}),j.isUndefined(n.withCredentials)||(f.withCredentials=!!n.withCredentials),s&&s!=="json"&&(f.responseType=n.responseType),l&&([g,y]=Es(l,!0),f.addEventListener("progress",g)),c&&f.upload&&([h,_]=Es(c),f.upload.addEventListener("progress",h),f.upload.addEventListener("loadend",_)),(n.cancelToken||n.signal)&&(u=m=>{f&&(r(!m||m.type?new rn(null,i,f):m),f.abort(),f=null)},n.cancelToken&&n.cancelToken.subscribe(u),n.signal&&(n.signal.aborted?u():n.signal.addEventListener("abort",u)));const d=W_(n.url);if(d&&He.protocols.indexOf(d)===-1){r(new ae("Unsupported protocol "+d+":",ae.ERR_BAD_REQUEST,i));return}f.send(o||null)})},Q_=(i,e)=>{const{length:t}=i=i?i.filter(Boolean):[];if(e||t){let r=new AbortController,n;const o=function(l){if(!n){n=!0,s();const u=l instanceof Error?l:this.reason;r.abort(u instanceof ae?u:new rn(u instanceof Error?u.message:u))}};let a=e&&setTimeout(()=>{a=null,o(new ae(`timeout ${e} of ms exceeded`,ae.ETIMEDOUT))},e);const s=()=>{i&&(a&&clearTimeout(a),a=null,i.forEach(l=>{l.unsubscribe?l.unsubscribe(o):l.removeEventListener("abort",o)}),i=null)};i.forEach(l=>l.addEventListener("abort",o));const{signal:c}=r;return c.unsubscribe=()=>j.asap(s),c}},Y_=Q_,Z_=function*(i,e){let t=i.byteLength;if(!e||t<e){yield i;return}let r=0,n;for(;r<t;)n=r+e,yield i.slice(r,n),r=n},e0=async function*(i,e){for await(const t of t0(i))yield*Z_(t,e)},t0=async function*(i){if(i[Symbol.asyncIterator]){yield*i;return}const e=i.getReader();try{for(;;){const{done:t,value:r}=await e.read();if(t)break;yield r}}finally{await e.cancel()}},nl=(i,e,t,r)=>{const n=e0(i,e);let o=0,a,s=c=>{a||(a=!0,r&&r(c))};return new ReadableStream({async pull(c){try{const{done:l,value:u}=await n.next();if(l){s(),c.close();return}let h=u.byteLength;if(t){let g=o+=h;t(g)}c.enqueue(new Uint8Array(u))}catch(l){throw s(l),l}},cancel(c){return s(c),n.return()}},{highWaterMark:2})},$s=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",od=$s&&typeof ReadableStream=="function",i0=$s&&(typeof TextEncoder=="function"?(i=>e=>i.encode(e))(new TextEncoder):async i=>new Uint8Array(await new Response(i).arrayBuffer())),ad=(i,...e)=>{try{return!!i(...e)}catch{return!1}},r0=od&&ad(()=>{let i=!1;const e=new Request(He.origin,{body:new ReadableStream,method:"POST",get duplex(){return i=!0,"half"}}).headers.has("Content-Type");return i&&!e}),sl=64*1024,aa=od&&ad(()=>j.isReadableStream(new Response("").body)),Ps={stream:aa&&(i=>i.body)};$s&&(i=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!Ps[e]&&(Ps[e]=j.isFunction(i[e])?t=>t[e]():(t,r)=>{throw new ae(`Response type '${e}' is not supported`,ae.ERR_NOT_SUPPORT,r)})})})(new Response);const n0=async i=>{if(i==null)return 0;if(j.isBlob(i))return i.size;if(j.isSpecCompliantForm(i))return(await new Request(He.origin,{method:"POST",body:i}).arrayBuffer()).byteLength;if(j.isArrayBufferView(i)||j.isArrayBuffer(i))return i.byteLength;if(j.isURLSearchParams(i)&&(i=i+""),j.isString(i))return(await i0(i)).byteLength},s0=async(i,e)=>{const t=j.toFiniteNumber(i.getContentLength());return t??n0(e)},o0=$s&&(async i=>{let{url:e,method:t,data:r,signal:n,cancelToken:o,timeout:a,onDownloadProgress:s,onUploadProgress:c,responseType:l,headers:u,withCredentials:h="same-origin",fetchOptions:g}=sd(i);l=l?(l+"").toLowerCase():"text";let _=Y_([n,o&&o.toAbortSignal()],a),y;const v=_&&_.unsubscribe&&(()=>{_.unsubscribe()});let f;try{if(c&&r0&&t!=="get"&&t!=="head"&&(f=await s0(u,r))!==0){let C=new Request(e,{method:"POST",body:r,duplex:"half"}),w;if(j.isFormData(r)&&(w=C.headers.get("content-type"))&&u.setContentType(w),C.body){const[T,S]=tl(f,Es(il(c)));r=nl(C.body,sl,T,S)}}j.isString(h)||(h=h?"include":"omit");const p="credentials"in Request.prototype;y=new Request(e,{...g,signal:_,method:t.toUpperCase(),headers:u.normalize().toJSON(),body:r,duplex:"half",credentials:p?h:void 0});let d=await fetch(y);const m=aa&&(l==="stream"||l==="response");if(aa&&(s||m&&v)){const C={};["status","statusText","headers"].forEach(k=>{C[k]=d[k]});const w=j.toFiniteNumber(d.headers.get("content-length")),[T,S]=s&&tl(w,Es(il(s),!0))||[];d=new Response(nl(d.body,sl,T,()=>{S&&S(),v&&v()}),C)}l=l||"text";let b=await Ps[j.findKey(Ps,l)||"text"](d,i);return!m&&v&&v(),await new Promise((C,w)=>{rd(C,w,{data:b,headers:Et.from(d.headers),status:d.status,statusText:d.statusText,config:i,request:y})})}catch(p){throw v&&v(),p&&p.name==="TypeError"&&/fetch/i.test(p.message)?Object.assign(new ae("Network Error",ae.ERR_NETWORK,i,y),{cause:p.cause||p}):ae.from(p,p&&p.code,i,y)}}),ca={http:b_,xhr:X_,fetch:o0};j.forEach(ca,(i,e)=>{if(i){try{Object.defineProperty(i,"name",{value:e})}catch{}Object.defineProperty(i,"adapterName",{value:e})}});const ol=i=>`- ${i}`,a0=i=>j.isFunction(i)||i===null||i===!1,cd={getAdapter:i=>{i=j.isArray(i)?i:[i];const{length:e}=i;let t,r;const n={};for(let o=0;o<e;o++){t=i[o];let a;if(r=t,!a0(t)&&(r=ca[(a=String(t)).toLowerCase()],r===void 0))throw new ae(`Unknown adapter '${a}'`);if(r)break;n[a||"#"+o]=r}if(!r){const o=Object.entries(n).map(([s,c])=>`adapter ${s} `+(c===!1?"is not supported by the environment":"is not available in the build"));let a=e?o.length>1?`since :
`+o.map(ol).join(`
`):" "+ol(o[0]):"as no adapter specified";throw new ae("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return r},adapters:ca};function bo(i){if(i.cancelToken&&i.cancelToken.throwIfRequested(),i.signal&&i.signal.aborted)throw new rn(null,i)}function al(i){return bo(i),i.headers=Et.from(i.headers),i.data=_o.call(i,i.transformRequest),["post","put","patch"].indexOf(i.method)!==-1&&i.headers.setContentType("application/x-www-form-urlencoded",!1),cd.getAdapter(i.adapter||Ha.adapter)(i).then(function(r){return bo(i),r.data=_o.call(i,i.transformResponse,r),r.headers=Et.from(r.headers),r},function(r){return id(r)||(bo(i),r&&r.response&&(r.response.data=_o.call(i,i.transformResponse,r.response),r.response.headers=Et.from(r.response.headers))),Promise.reject(r)})}const ld="1.8.4",zs={};["object","boolean","number","function","string","symbol"].forEach((i,e)=>{zs[i]=function(r){return typeof r===i||"a"+(e<1?"n ":" ")+i}});const cl={};zs.transitional=function(e,t,r){function n(o,a){return"[Axios v"+ld+"] Transitional option '"+o+"'"+a+(r?". "+r:"")}return(o,a,s)=>{if(e===!1)throw new ae(n(a," has been removed"+(t?" in "+t:"")),ae.ERR_DEPRECATED);return t&&!cl[a]&&(cl[a]=!0,console.warn(n(a," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(o,a,s):!0}};zs.spelling=function(e){return(t,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};function c0(i,e,t){if(typeof i!="object")throw new ae("options must be an object",ae.ERR_BAD_OPTION_VALUE);const r=Object.keys(i);let n=r.length;for(;n-- >0;){const o=r[n],a=e[o];if(a){const s=i[o],c=s===void 0||a(s,o,i);if(c!==!0)throw new ae("option "+o+" must be "+c,ae.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new ae("Unknown option "+o,ae.ERR_BAD_OPTION)}}const as={assertOptions:c0,validators:zs},Dt=as.validators;class Rs{constructor(e){this.defaults=e,this.interceptors={request:new Zc,response:new Zc}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;const o=n.stack?n.stack.replace(/^.+\n/,""):"";try{r.stack?o&&!String(r.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+o):r.stack=o}catch{}}throw r}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Cr(this.defaults,t);const{transitional:r,paramsSerializer:n,headers:o}=t;r!==void 0&&as.assertOptions(r,{silentJSONParsing:Dt.transitional(Dt.boolean),forcedJSONParsing:Dt.transitional(Dt.boolean),clarifyTimeoutError:Dt.transitional(Dt.boolean)},!1),n!=null&&(j.isFunction(n)?t.paramsSerializer={serialize:n}:as.assertOptions(n,{encode:Dt.function,serialize:Dt.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),as.assertOptions(t,{baseUrl:Dt.spelling("baseURL"),withXsrfToken:Dt.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=o&&j.merge(o.common,o[t.method]);o&&j.forEach(["delete","get","head","post","put","patch","common"],y=>{delete o[y]}),t.headers=Et.concat(a,o);const s=[];let c=!0;this.interceptors.request.forEach(function(v){typeof v.runWhen=="function"&&v.runWhen(t)===!1||(c=c&&v.synchronous,s.unshift(v.fulfilled,v.rejected))});const l=[];this.interceptors.response.forEach(function(v){l.push(v.fulfilled,v.rejected)});let u,h=0,g;if(!c){const y=[al.bind(this),void 0];for(y.unshift.apply(y,s),y.push.apply(y,l),g=y.length,u=Promise.resolve(t);h<g;)u=u.then(y[h++],y[h++]);return u}g=s.length;let _=t;for(h=0;h<g;){const y=s[h++],v=s[h++];try{_=y(_)}catch(f){v.call(this,f);break}}try{u=al.call(this,_)}catch(y){return Promise.reject(y)}for(h=0,g=l.length;h<g;)u=u.then(l[h++],l[h++]);return u}getUri(e){e=Cr(this.defaults,e);const t=nd(e.baseURL,e.url,e.allowAbsoluteUrls);return Zu(t,e.params,e.paramsSerializer)}}j.forEach(["delete","get","head","options"],function(e){Rs.prototype[e]=function(t,r){return this.request(Cr(r||{},{method:e,url:t,data:(r||{}).data}))}});j.forEach(["post","put","patch"],function(e){function t(r){return function(o,a,s){return this.request(Cr(s||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:o,data:a}))}}Rs.prototype[e]=t(),Rs.prototype[e+"Form"]=t(!0)});const cs=Rs;class Wa{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(o){t=o});const r=this;this.promise.then(n=>{if(!r._listeners)return;let o=r._listeners.length;for(;o-- >0;)r._listeners[o](n);r._listeners=null}),this.promise.then=n=>{let o;const a=new Promise(s=>{r.subscribe(s),o=s}).then(n);return a.cancel=function(){r.unsubscribe(o)},a},e(function(o,a,s){r.reason||(r.reason=new rn(o,a,s),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=r=>{e.abort(r)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new Wa(function(n){e=n}),cancel:e}}}const l0=Wa;function h0(i){return function(t){return i.apply(null,t)}}function u0(i){return j.isObject(i)&&i.isAxiosError===!0}const la={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(la).forEach(([i,e])=>{la[e]=i});const d0=la;function hd(i){const e=new cs(i),t=Wu(cs.prototype.request,e);return j.extend(t,cs.prototype,e,{allOwnKeys:!0}),j.extend(t,e,null,{allOwnKeys:!0}),t.create=function(n){return hd(Cr(i,n))},t}const Ee=hd(Ha);Ee.Axios=cs;Ee.CanceledError=rn;Ee.CancelToken=l0;Ee.isCancel=id;Ee.VERSION=ld;Ee.toFormData=Vs;Ee.AxiosError=ae;Ee.Cancel=Ee.CanceledError;Ee.all=function(e){return Promise.all(e)};Ee.spread=h0;Ee.isAxiosError=u0;Ee.mergeConfig=Cr;Ee.AxiosHeaders=Et;Ee.formToJSON=i=>td(j.isHTMLForm(i)?new FormData(i):i);Ee.getAdapter=cd.getAdapter;Ee.HttpStatusCode=d0;Ee.default=Ee;const Cy=Ee;function f0(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function ll(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),t.push.apply(t,r)}return t}function hl(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ll(Object(t),!0).forEach(function(r){f0(i,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):ll(Object(t)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(t,r))})}return i}function p0(i,e){if(i==null)return{};var t={},r=Object.keys(i),n,o;for(o=0;o<r.length;o++)n=r[o],!(e.indexOf(n)>=0)&&(t[n]=i[n]);return t}function m0(i,e){if(i==null)return{};var t=p0(i,e),r,n;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(i);for(n=0;n<o.length;n++)r=o[n],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(i,r)&&(t[r]=i[r])}return t}function g0(i,e){return v0(i)||_0(i,e)||b0(i,e)||y0()}function v0(i){if(Array.isArray(i))return i}function _0(i,e){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(i)))){var t=[],r=!0,n=!1,o=void 0;try{for(var a=i[Symbol.iterator](),s;!(r=(s=a.next()).done)&&(t.push(s.value),!(e&&t.length===e));r=!0);}catch(c){n=!0,o=c}finally{try{!r&&a.return!=null&&a.return()}finally{if(n)throw o}}return t}}function b0(i,e){if(i){if(typeof i=="string")return ul(i,e);var t=Object.prototype.toString.call(i).slice(8,-1);if(t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set")return Array.from(i);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ul(i,e)}}function ul(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=i[t];return r}function y0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function S0(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function dl(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),t.push.apply(t,r)}return t}function fl(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?dl(Object(t),!0).forEach(function(r){S0(i,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):dl(Object(t)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(t,r))})}return i}function C0(){for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];return function(r){return e.reduceRight(function(n,o){return o(n)},r)}}function vn(i){return function e(){for(var t=this,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return n.length>=i.length?i.apply(this,n):function(){for(var a=arguments.length,s=new Array(a),c=0;c<a;c++)s[c]=arguments[c];return e.apply(t,[].concat(n,s))}}}function xs(i){return{}.toString.call(i).includes("Object")}function w0(i){return!Object.keys(i).length}function xn(i){return typeof i=="function"}function k0(i,e){return Object.prototype.hasOwnProperty.call(i,e)}function T0(i,e){return xs(e)||ir("changeType"),Object.keys(e).some(function(t){return!k0(i,t)})&&ir("changeField"),e}function E0(i){xn(i)||ir("selectorType")}function P0(i){xn(i)||xs(i)||ir("handlerType"),xs(i)&&Object.values(i).some(function(e){return!xn(e)})&&ir("handlersType")}function R0(i){i||ir("initialIsRequired"),xs(i)||ir("initialType"),w0(i)&&ir("initialContent")}function x0(i,e){throw new Error(i[e]||i.default)}var O0={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},ir=vn(x0)(O0),Jn={changes:T0,selector:E0,handler:P0,initial:R0};function D0(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Jn.initial(i),Jn.handler(e);var t={current:i},r=vn(I0)(t,e),n=vn(L0)(t),o=vn(Jn.changes)(i),a=vn(A0)(t);function s(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(u){return u};return Jn.selector(l),l(t.current)}function c(l){C0(r,n,o,a)(l)}return[s,c]}function A0(i,e){return xn(e)?e(i.current):e}function L0(i,e){return i.current=fl(fl({},i.current),e),e}function I0(i,e,t){return xn(e)?e(i.current):Object.keys(t).forEach(function(r){var n;return(n=e[r])===null||n===void 0?void 0:n.call(e,i.current[r])}),t}var M0={create:D0},B0={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.52.2/min/vs"}};function N0(i){return function e(){for(var t=this,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return n.length>=i.length?i.apply(this,n):function(){for(var a=arguments.length,s=new Array(a),c=0;c<a;c++)s[c]=arguments[c];return e.apply(t,[].concat(n,s))}}}function F0(i){return{}.toString.call(i).includes("Object")}function U0(i){return i||pl("configIsRequired"),F0(i)||pl("configType"),i.urls?(j0(),{paths:{vs:i.urls.monacoBase}}):i}function j0(){console.warn(ud.deprecation)}function H0(i,e){throw new Error(i[e]||i.default)}var ud={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},pl=N0(H0)(ud),W0={config:U0},q0=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(n){return t.reduceRight(function(o,a){return a(o)},n)}};function dd(i,e){return Object.keys(e).forEach(function(t){e[t]instanceof Object&&i[t]&&Object.assign(e[t],dd(i[t],e[t]))}),hl(hl({},i),e)}var V0={type:"cancelation",msg:"operation is manually canceled"};function yo(i){var e=!1,t=new Promise(function(r,n){i.then(function(o){return e?n(V0):r(o)}),i.catch(n)});return t.cancel=function(){return e=!0},t}var J0=M0.create({config:B0,isInitialized:!1,resolve:null,reject:null,monaco:null}),fd=g0(J0,2),Nn=fd[0],Ks=fd[1];function $0(i){var e=W0.config(i),t=e.monaco,r=m0(e,["monaco"]);Ks(function(n){return{config:dd(n.config,r),monaco:t}})}function z0(){var i=Nn(function(e){var t=e.monaco,r=e.isInitialized,n=e.resolve;return{monaco:t,isInitialized:r,resolve:n}});if(!i.isInitialized){if(Ks({isInitialized:!0}),i.monaco)return i.resolve(i.monaco),yo(So);if(window.monaco&&window.monaco.editor)return pd(window.monaco),i.resolve(window.monaco),yo(So);q0(K0,X0)(Q0)}return yo(So)}function K0(i){return document.body.appendChild(i)}function G0(i){var e=document.createElement("script");return i&&(e.src=i),e}function X0(i){var e=Nn(function(r){var n=r.config,o=r.reject;return{config:n,reject:o}}),t=G0("".concat(e.config.paths.vs,"/loader.js"));return t.onload=function(){return i()},t.onerror=e.reject,t}function Q0(){var i=Nn(function(t){var r=t.config,n=t.resolve,o=t.reject;return{config:r,resolve:n,reject:o}}),e=window.require;e.config(i.config),e(["vs/editor/editor.main"],function(t){pd(t),i.resolve(t)},function(t){i.reject(t)})}function pd(i){Nn().monaco||Ks({monaco:i})}function Y0(){return Nn(function(i){var e=i.monaco;return e})}var So=new Promise(function(i,e){return Ks({resolve:i,reject:e})}),wy={config:$0,init:z0,__getMonacoInstance:Y0},md={exports:{}};(function(i,e){(function(t,r){i.exports=r()})(globalThis,()=>(()=>{var t={4567:function(a,s,c){var l=this&&this.__decorate||function(d,m,b,C){var w,T=arguments.length,S=T<3?m:C===null?C=Object.getOwnPropertyDescriptor(m,b):C;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(d,m,b,C);else for(var k=d.length-1;k>=0;k--)(w=d[k])&&(S=(T<3?w(S):T>3?w(m,b,S):w(m,b))||S);return T>3&&S&&Object.defineProperty(m,b,S),S},u=this&&this.__param||function(d,m){return function(b,C){m(b,C,d)}};Object.defineProperty(s,"__esModule",{value:!0}),s.AccessibilityManager=void 0;const h=c(9042),g=c(9924),_=c(844),y=c(4725),v=c(2585),f=c(3656);let p=s.AccessibilityManager=class extends _.Disposable{constructor(d,m,b,C){super(),this._terminal=d,this._coreBrowserService=b,this._renderService=C,this._rowColumns=new WeakMap,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityContainer=this._coreBrowserService.mainDocument.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=this._coreBrowserService.mainDocument.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let w=0;w<this._terminal.rows;w++)this._rowElements[w]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[w]);if(this._topBoundaryFocusListener=w=>this._handleBoundaryFocus(w,0),this._bottomBoundaryFocusListener=w=>this._handleBoundaryFocus(w,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=this._coreBrowserService.mainDocument.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this.register(new g.TimeBasedDebouncer(this._renderRows.bind(this))),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this.register(this._terminal.onResize(w=>this._handleResize(w.rows))),this.register(this._terminal.onRender(w=>this._refreshRows(w.start,w.end))),this.register(this._terminal.onScroll(()=>this._refreshRows())),this.register(this._terminal.onA11yChar(w=>this._handleChar(w))),this.register(this._terminal.onLineFeed(()=>this._handleChar(`
`))),this.register(this._terminal.onA11yTab(w=>this._handleTab(w))),this.register(this._terminal.onKey(w=>this._handleKey(w.key))),this.register(this._terminal.onBlur(()=>this._clearLiveRegion())),this.register(this._renderService.onDimensionsChange(()=>this._refreshRowsDimensions())),this.register((0,f.addDisposableDomListener)(document,"selectionchange",()=>this._handleSelectionChange())),this.register(this._coreBrowserService.onDprChange(()=>this._refreshRowsDimensions())),this._refreshRows(),this.register((0,_.toDisposable)(()=>{this._accessibilityContainer.remove(),this._rowElements.length=0}))}_handleTab(d){for(let m=0;m<d;m++)this._handleChar(" ")}_handleChar(d){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==d&&(this._charsToAnnounce+=d):this._charsToAnnounce+=d,d===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===21&&(this._liveRegion.textContent+=h.tooMuchOutput)))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0}_handleKey(d){this._clearLiveRegion(),/\p{Control}/u.test(d)||this._charsToConsume.push(d)}_refreshRows(d,m){this._liveRegionDebouncer.refresh(d,m,this._terminal.rows)}_renderRows(d,m){const b=this._terminal.buffer,C=b.lines.length.toString();for(let w=d;w<=m;w++){const T=b.lines.get(b.ydisp+w),S=[],k=(T==null?void 0:T.translateToString(!0,void 0,void 0,S))||"",O=(b.ydisp+w+1).toString(),L=this._rowElements[w];L&&(k.length===0?(L.innerText=" ",this._rowColumns.set(L,[0,1])):(L.textContent=k,this._rowColumns.set(L,S)),L.setAttribute("aria-posinset",O),L.setAttribute("aria-setsize",C))}this._announceCharacters()}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(d,m){const b=d.target,C=this._rowElements[m===0?1:this._rowElements.length-2];if(b.getAttribute("aria-posinset")===(m===0?"1":`${this._terminal.buffer.lines.length}`)||d.relatedTarget!==C)return;let w,T;if(m===0?(w=b,T=this._rowElements.pop(),this._rowContainer.removeChild(T)):(w=this._rowElements.shift(),T=b,this._rowContainer.removeChild(w)),w.removeEventListener("focus",this._topBoundaryFocusListener),T.removeEventListener("focus",this._bottomBoundaryFocusListener),m===0){const S=this._createAccessibilityTreeNode();this._rowElements.unshift(S),this._rowContainer.insertAdjacentElement("afterbegin",S)}else{const S=this._createAccessibilityTreeNode();this._rowElements.push(S),this._rowContainer.appendChild(S)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(m===0?-1:1),this._rowElements[m===0?1:this._rowElements.length-2].focus(),d.preventDefault(),d.stopImmediatePropagation()}_handleSelectionChange(){var k;if(this._rowElements.length===0)return;const d=document.getSelection();if(!d)return;if(d.isCollapsed)return void(this._rowContainer.contains(d.anchorNode)&&this._terminal.clearSelection());if(!d.anchorNode||!d.focusNode)return void console.error("anchorNode and/or focusNode are null");let m={node:d.anchorNode,offset:d.anchorOffset},b={node:d.focusNode,offset:d.focusOffset};if((m.node.compareDocumentPosition(b.node)&Node.DOCUMENT_POSITION_PRECEDING||m.node===b.node&&m.offset>b.offset)&&([m,b]=[b,m]),m.node.compareDocumentPosition(this._rowElements[0])&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)&&(m={node:this._rowElements[0].childNodes[0],offset:0}),!this._rowContainer.contains(m.node))return;const C=this._rowElements.slice(-1)[0];if(b.node.compareDocumentPosition(C)&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_PRECEDING)&&(b={node:C,offset:((k=C.textContent)==null?void 0:k.length)??0}),!this._rowContainer.contains(b.node))return;const w=({node:O,offset:L})=>{const M=O instanceof Text?O.parentNode:O;let D=parseInt(M==null?void 0:M.getAttribute("aria-posinset"),10)-1;if(isNaN(D))return console.warn("row is invalid. Race condition?"),null;const U=this._rowColumns.get(M);if(!U)return console.warn("columns is null. Race condition?"),null;let q=L<U.length?U[L]:U.slice(-1)[0]+1;return q>=this._terminal.cols&&(++D,q=0),{row:D,column:q}},T=w(m),S=w(b);if(T&&S){if(T.row>S.row||T.row===S.row&&T.column>=S.column)throw new Error("invalid range");this._terminal.select(T.column,T.row,(S.row-T.row)*this._terminal.cols-T.column+S.column)}}_handleResize(d){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let m=this._rowContainer.children.length;m<this._terminal.rows;m++)this._rowElements[m]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[m]);for(;this._rowElements.length>d;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){const d=this._coreBrowserService.mainDocument.createElement("div");return d.setAttribute("role","listitem"),d.tabIndex=-1,this._refreshRowDimensions(d),d}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){this._accessibilityContainer.style.width=`${this._renderService.dimensions.css.canvas.width}px`,this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let d=0;d<this._terminal.rows;d++)this._refreshRowDimensions(this._rowElements[d])}}_refreshRowDimensions(d){d.style.height=`${this._renderService.dimensions.css.cell.height}px`}};s.AccessibilityManager=p=l([u(1,v.IInstantiationService),u(2,y.ICoreBrowserService),u(3,y.IRenderService)],p)},3614:(a,s)=>{function c(g){return g.replace(/\r?\n/g,"\r")}function l(g,_){return _?"\x1B[200~"+g+"\x1B[201~":g}function u(g,_,y,v){g=l(g=c(g),y.decPrivateModes.bracketedPasteMode&&v.rawOptions.ignoreBracketedPasteMode!==!0),y.triggerDataEvent(g,!0),_.value=""}function h(g,_,y){const v=y.getBoundingClientRect(),f=g.clientX-v.left-10,p=g.clientY-v.top-10;_.style.width="20px",_.style.height="20px",_.style.left=`${f}px`,_.style.top=`${p}px`,_.style.zIndex="1000",_.focus()}Object.defineProperty(s,"__esModule",{value:!0}),s.rightClickHandler=s.moveTextAreaUnderMouseCursor=s.paste=s.handlePasteEvent=s.copyHandler=s.bracketTextForPaste=s.prepareTextForTerminal=void 0,s.prepareTextForTerminal=c,s.bracketTextForPaste=l,s.copyHandler=function(g,_){g.clipboardData&&g.clipboardData.setData("text/plain",_.selectionText),g.preventDefault()},s.handlePasteEvent=function(g,_,y,v){g.stopPropagation(),g.clipboardData&&u(g.clipboardData.getData("text/plain"),_,y,v)},s.paste=u,s.moveTextAreaUnderMouseCursor=h,s.rightClickHandler=function(g,_,y,v,f){h(g,_,y),f&&v.rightClickSelect(g),_.value=v.selectionText,_.select()}},7239:(a,s,c)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.ColorContrastCache=void 0;const l=c(1505);s.ColorContrastCache=class{constructor(){this._color=new l.TwoKeyMap,this._css=new l.TwoKeyMap}setCss(u,h,g){this._css.set(u,h,g)}getCss(u,h){return this._css.get(u,h)}setColor(u,h,g){this._color.set(u,h,g)}getColor(u,h){return this._color.get(u,h)}clear(){this._color.clear(),this._css.clear()}}},3656:(a,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.addDisposableDomListener=void 0,s.addDisposableDomListener=function(c,l,u,h){c.addEventListener(l,u,h);let g=!1;return{dispose:()=>{g||(g=!0,c.removeEventListener(l,u,h))}}}},3551:function(a,s,c){var l=this&&this.__decorate||function(p,d,m,b){var C,w=arguments.length,T=w<3?d:b===null?b=Object.getOwnPropertyDescriptor(d,m):b;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")T=Reflect.decorate(p,d,m,b);else for(var S=p.length-1;S>=0;S--)(C=p[S])&&(T=(w<3?C(T):w>3?C(d,m,T):C(d,m))||T);return w>3&&T&&Object.defineProperty(d,m,T),T},u=this&&this.__param||function(p,d){return function(m,b){d(m,b,p)}};Object.defineProperty(s,"__esModule",{value:!0}),s.Linkifier=void 0;const h=c(3656),g=c(8460),_=c(844),y=c(2585),v=c(4725);let f=s.Linkifier=class extends _.Disposable{get currentLink(){return this._currentLink}constructor(p,d,m,b,C){super(),this._element=p,this._mouseService=d,this._renderService=m,this._bufferService=b,this._linkProviderService=C,this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this.register(new g.EventEmitter),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this.register(new g.EventEmitter),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this.register((0,_.getDisposeArrayDisposable)(this._linkCacheDisposables)),this.register((0,_.toDisposable)(()=>{var w;this._lastMouseEvent=void 0,(w=this._activeProviderReplies)==null||w.clear()})),this.register(this._bufferService.onResize(()=>{this._clearCurrentLink(),this._wasResized=!0})),this.register((0,h.addDisposableDomListener)(this._element,"mouseleave",()=>{this._isMouseOut=!0,this._clearCurrentLink()})),this.register((0,h.addDisposableDomListener)(this._element,"mousemove",this._handleMouseMove.bind(this))),this.register((0,h.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,h.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))}_handleMouseMove(p){this._lastMouseEvent=p;const d=this._positionFromMouseEvent(p,this._element,this._mouseService);if(!d)return;this._isMouseOut=!1;const m=p.composedPath();for(let b=0;b<m.length;b++){const C=m[b];if(C.classList.contains("xterm"))break;if(C.classList.contains("xterm-hover"))return}this._lastBufferCell&&d.x===this._lastBufferCell.x&&d.y===this._lastBufferCell.y||(this._handleHover(d),this._lastBufferCell=d)}_handleHover(p){if(this._activeLine!==p.y||this._wasResized)return this._clearCurrentLink(),this._askForLink(p,!1),void(this._wasResized=!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,p)||(this._clearCurrentLink(),this._askForLink(p,!0))}_askForLink(p,d){var b,C;this._activeProviderReplies&&d||((b=this._activeProviderReplies)==null||b.forEach(w=>{w==null||w.forEach(T=>{T.link.dispose&&T.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=p.y);let m=!1;for(const[w,T]of this._linkProviderService.linkProviders.entries())d?(C=this._activeProviderReplies)!=null&&C.get(w)&&(m=this._checkLinkProviderResult(w,p,m)):T.provideLinks(p.y,S=>{var O,L;if(this._isMouseOut)return;const k=S==null?void 0:S.map(M=>({link:M}));(O=this._activeProviderReplies)==null||O.set(w,k),m=this._checkLinkProviderResult(w,p,m),((L=this._activeProviderReplies)==null?void 0:L.size)===this._linkProviderService.linkProviders.length&&this._removeIntersectingLinks(p.y,this._activeProviderReplies)})}_removeIntersectingLinks(p,d){const m=new Set;for(let b=0;b<d.size;b++){const C=d.get(b);if(C)for(let w=0;w<C.length;w++){const T=C[w],S=T.link.range.start.y<p?0:T.link.range.start.x,k=T.link.range.end.y>p?this._bufferService.cols:T.link.range.end.x;for(let O=S;O<=k;O++){if(m.has(O)){C.splice(w--,1);break}m.add(O)}}}}_checkLinkProviderResult(p,d,m){var w;if(!this._activeProviderReplies)return m;const b=this._activeProviderReplies.get(p);let C=!1;for(let T=0;T<p;T++)this._activeProviderReplies.has(T)&&!this._activeProviderReplies.get(T)||(C=!0);if(!C&&b){const T=b.find(S=>this._linkAtPosition(S.link,d));T&&(m=!0,this._handleNewLink(T))}if(this._activeProviderReplies.size===this._linkProviderService.linkProviders.length&&!m)for(let T=0;T<this._activeProviderReplies.size;T++){const S=(w=this._activeProviderReplies.get(T))==null?void 0:w.find(k=>this._linkAtPosition(k.link,d));if(S){m=!0,this._handleNewLink(S);break}}return m}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(p){if(!this._currentLink)return;const d=this._positionFromMouseEvent(p,this._element,this._mouseService);d&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,d)&&this._currentLink.link.activate(p,this._currentLink.link.text)}_clearCurrentLink(p,d){this._currentLink&&this._lastMouseEvent&&(!p||!d||this._currentLink.link.range.start.y>=p&&this._currentLink.link.range.end.y<=d)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,_.disposeArray)(this._linkCacheDisposables))}_handleNewLink(p){if(!this._lastMouseEvent)return;const d=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);d&&this._linkAtPosition(p.link,d)&&(this._currentLink=p,this._currentLink.state={decorations:{underline:p.link.decorations===void 0||p.link.decorations.underline,pointerCursor:p.link.decorations===void 0||p.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,p.link,this._lastMouseEvent),p.link.decorations={},Object.defineProperties(p.link.decorations,{pointerCursor:{get:()=>{var m,b;return(b=(m=this._currentLink)==null?void 0:m.state)==null?void 0:b.decorations.pointerCursor},set:m=>{var b;(b=this._currentLink)!=null&&b.state&&this._currentLink.state.decorations.pointerCursor!==m&&(this._currentLink.state.decorations.pointerCursor=m,this._currentLink.state.isHovered&&this._element.classList.toggle("xterm-cursor-pointer",m))}},underline:{get:()=>{var m,b;return(b=(m=this._currentLink)==null?void 0:m.state)==null?void 0:b.decorations.underline},set:m=>{var b,C,w;(b=this._currentLink)!=null&&b.state&&((w=(C=this._currentLink)==null?void 0:C.state)==null?void 0:w.decorations.underline)!==m&&(this._currentLink.state.decorations.underline=m,this._currentLink.state.isHovered&&this._fireUnderlineEvent(p.link,m))}}}),this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange(m=>{if(!this._currentLink)return;const b=m.start===0?0:m.start+1+this._bufferService.buffer.ydisp,C=this._bufferService.buffer.ydisp+1+m.end;if(this._currentLink.link.range.start.y>=b&&this._currentLink.link.range.end.y<=C&&(this._clearCurrentLink(b,C),this._lastMouseEvent)){const w=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);w&&this._askForLink(w,!1)}})))}_linkHover(p,d,m){var b;(b=this._currentLink)!=null&&b.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(d,!0),this._currentLink.state.decorations.pointerCursor&&p.classList.add("xterm-cursor-pointer")),d.hover&&d.hover(m,d.text)}_fireUnderlineEvent(p,d){const m=p.range,b=this._bufferService.buffer.ydisp,C=this._createLinkUnderlineEvent(m.start.x-1,m.start.y-b-1,m.end.x,m.end.y-b-1,void 0);(d?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(C)}_linkLeave(p,d,m){var b;(b=this._currentLink)!=null&&b.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(d,!1),this._currentLink.state.decorations.pointerCursor&&p.classList.remove("xterm-cursor-pointer")),d.leave&&d.leave(m,d.text)}_linkAtPosition(p,d){const m=p.range.start.y*this._bufferService.cols+p.range.start.x,b=p.range.end.y*this._bufferService.cols+p.range.end.x,C=d.y*this._bufferService.cols+d.x;return m<=C&&C<=b}_positionFromMouseEvent(p,d,m){const b=m.getCoords(p,d,this._bufferService.cols,this._bufferService.rows);if(b)return{x:b[0],y:b[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(p,d,m,b,C){return{x1:p,y1:d,x2:m,y2:b,cols:this._bufferService.cols,fg:C}}};s.Linkifier=f=l([u(1,v.IMouseService),u(2,v.IRenderService),u(3,y.IBufferService),u(4,v.ILinkProviderService)],f)},9042:(a,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.tooMuchOutput=s.promptLabel=void 0,s.promptLabel="Terminal input",s.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},3730:function(a,s,c){var l=this&&this.__decorate||function(v,f,p,d){var m,b=arguments.length,C=b<3?f:d===null?d=Object.getOwnPropertyDescriptor(f,p):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(v,f,p,d);else for(var w=v.length-1;w>=0;w--)(m=v[w])&&(C=(b<3?m(C):b>3?m(f,p,C):m(f,p))||C);return b>3&&C&&Object.defineProperty(f,p,C),C},u=this&&this.__param||function(v,f){return function(p,d){f(p,d,v)}};Object.defineProperty(s,"__esModule",{value:!0}),s.OscLinkProvider=void 0;const h=c(511),g=c(2585);let _=s.OscLinkProvider=class{constructor(v,f,p){this._bufferService=v,this._optionsService=f,this._oscLinkService=p}provideLinks(v,f){var k;const p=this._bufferService.buffer.lines.get(v-1);if(!p)return void f(void 0);const d=[],m=this._optionsService.rawOptions.linkHandler,b=new h.CellData,C=p.getTrimmedLength();let w=-1,T=-1,S=!1;for(let O=0;O<C;O++)if(T!==-1||p.hasContent(O)){if(p.loadCell(O,b),b.hasExtendedAttrs()&&b.extended.urlId){if(T===-1){T=O,w=b.extended.urlId;continue}S=b.extended.urlId!==w}else T!==-1&&(S=!0);if(S||T!==-1&&O===C-1){const L=(k=this._oscLinkService.getLinkData(w))==null?void 0:k.uri;if(L){const M={start:{x:T+1,y:v},end:{x:O+(S||O!==C-1?0:1),y:v}};let D=!1;if(!(m!=null&&m.allowNonHttpProtocols))try{const U=new URL(L);["http:","https:"].includes(U.protocol)||(D=!0)}catch{D=!0}D||d.push({text:L,range:M,activate:(U,q)=>m?m.activate(U,q,M):y(0,q),hover:(U,q)=>{var X;return(X=m==null?void 0:m.hover)==null?void 0:X.call(m,U,q,M)},leave:(U,q)=>{var X;return(X=m==null?void 0:m.leave)==null?void 0:X.call(m,U,q,M)}})}S=!1,b.hasExtendedAttrs()&&b.extended.urlId?(T=O,w=b.extended.urlId):(T=-1,w=-1)}}f(d)}};function y(v,f){if(confirm(`Do you want to navigate to ${f}?

WARNING: This link could potentially be dangerous`)){const p=window.open();if(p){try{p.opener=null}catch{}p.location.href=f}else console.warn("Opening link blocked as opener could not be cleared")}}s.OscLinkProvider=_=l([u(0,g.IBufferService),u(1,g.IOptionsService),u(2,g.IOscLinkService)],_)},6193:(a,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.RenderDebouncer=void 0,s.RenderDebouncer=class{constructor(c,l){this._renderCallback=c,this._coreBrowserService=l,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(c){return this._refreshCallbacks.push(c),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh())),this._animationFrame}refresh(c,l,u){this._rowCount=u,c=c!==void 0?c:0,l=l!==void 0?l:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,c):c,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,l):l,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return void this._runRefreshCallbacks();const c=Math.max(this._rowStart,0),l=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(c,l),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(const c of this._refreshCallbacks)c(0);this._refreshCallbacks=[]}}},3236:(a,s,c)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.Terminal=void 0;const l=c(3614),u=c(3656),h=c(3551),g=c(9042),_=c(3730),y=c(1680),v=c(3107),f=c(5744),p=c(2950),d=c(1296),m=c(428),b=c(4269),C=c(5114),w=c(8934),T=c(3230),S=c(9312),k=c(4725),O=c(6731),L=c(8055),M=c(8969),D=c(8460),U=c(844),q=c(6114),X=c(8437),Y=c(2584),F=c(7399),E=c(5941),x=c(9074),A=c(2585),I=c(5435),z=c(4567),Q=c(779);class ne extends M.CoreTerminal{get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}constructor(B={}){super(B),this.browser=q,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this.register(new U.MutableDisposable),this._onCursorMove=this.register(new D.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onKey=this.register(new D.EventEmitter),this.onKey=this._onKey.event,this._onRender=this.register(new D.EventEmitter),this.onRender=this._onRender.event,this._onSelectionChange=this.register(new D.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this.register(new D.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onBell=this.register(new D.EventEmitter),this.onBell=this._onBell.event,this._onFocus=this.register(new D.EventEmitter),this._onBlur=this.register(new D.EventEmitter),this._onA11yCharEmitter=this.register(new D.EventEmitter),this._onA11yTabEmitter=this.register(new D.EventEmitter),this._onWillOpen=this.register(new D.EventEmitter),this._setup(),this._decorationService=this._instantiationService.createInstance(x.DecorationService),this._instantiationService.setService(A.IDecorationService,this._decorationService),this._linkProviderService=this._instantiationService.createInstance(Q.LinkProviderService),this._instantiationService.setService(k.ILinkProviderService,this._linkProviderService),this._linkProviderService.registerLinkProvider(this._instantiationService.createInstance(_.OscLinkProvider)),this.register(this._inputHandler.onRequestBell(()=>this._onBell.fire())),this.register(this._inputHandler.onRequestRefreshRows((P,K)=>this.refresh(P,K))),this.register(this._inputHandler.onRequestSendFocus(()=>this._reportFocus())),this.register(this._inputHandler.onRequestReset(()=>this.reset())),this.register(this._inputHandler.onRequestWindowsOptionsReport(P=>this._reportWindowsOptions(P))),this.register(this._inputHandler.onColor(P=>this._handleColorEvent(P))),this.register((0,D.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,D.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,D.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,D.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize(P=>this._afterResize(P.cols,P.rows))),this.register((0,U.toDisposable)(()=>{var P,K;this._customKeyEventHandler=void 0,(K=(P=this.element)==null?void 0:P.parentNode)==null||K.removeChild(this.element)}))}_handleColorEvent(B){if(this._themeService)for(const P of B){let K,H="";switch(P.index){case 256:K="foreground",H="10";break;case 257:K="background",H="11";break;case 258:K="cursor",H="12";break;default:K="ansi",H="4;"+P.index}switch(P.type){case 0:const te=L.color.toColorRGB(K==="ansi"?this._themeService.colors.ansi[P.index]:this._themeService.colors[K]);this.coreService.triggerDataEvent(`${Y.C0.ESC}]${H};${(0,E.toRgbString)(te)}${Y.C1_ESCAPED.ST}`);break;case 1:if(K==="ansi")this._themeService.modifyColors(Z=>Z.ansi[P.index]=L.channels.toColor(...P.color));else{const Z=K;this._themeService.modifyColors(ue=>ue[Z]=L.channels.toColor(...P.color))}break;case 2:this._themeService.restoreColor(P.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(B){B?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(z.AccessibilityManager,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(B){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(Y.C0.ESC+"[I"),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){var B;return(B=this.textarea)==null?void 0:B.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(Y.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;const B=this.buffer.ybase+this.buffer.y,P=this.buffer.lines.get(B);if(!P)return;const K=Math.min(this.buffer.x,this.cols-1),H=this._renderService.dimensions.css.cell.height,te=P.getWidth(K),Z=this._renderService.dimensions.css.cell.width*te,ue=this.buffer.y*this._renderService.dimensions.css.cell.height,ye=K*this._renderService.dimensions.css.cell.width;this.textarea.style.left=ye+"px",this.textarea.style.top=ue+"px",this.textarea.style.width=Z+"px",this.textarea.style.height=H+"px",this.textarea.style.lineHeight=H+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register((0,u.addDisposableDomListener)(this.element,"copy",P=>{this.hasSelection()&&(0,l.copyHandler)(P,this._selectionService)}));const B=P=>(0,l.handlePasteEvent)(P,this.textarea,this.coreService,this.optionsService);this.register((0,u.addDisposableDomListener)(this.textarea,"paste",B)),this.register((0,u.addDisposableDomListener)(this.element,"paste",B)),q.isFirefox?this.register((0,u.addDisposableDomListener)(this.element,"mousedown",P=>{P.button===2&&(0,l.rightClickHandler)(P,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})):this.register((0,u.addDisposableDomListener)(this.element,"contextmenu",P=>{(0,l.rightClickHandler)(P,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})),q.isLinux&&this.register((0,u.addDisposableDomListener)(this.element,"auxclick",P=>{P.button===1&&(0,l.moveTextAreaUnderMouseCursor)(P,this.textarea,this.screenElement)}))}_bindKeys(){this.register((0,u.addDisposableDomListener)(this.textarea,"keyup",B=>this._keyUp(B),!0)),this.register((0,u.addDisposableDomListener)(this.textarea,"keydown",B=>this._keyDown(B),!0)),this.register((0,u.addDisposableDomListener)(this.textarea,"keypress",B=>this._keyPress(B),!0)),this.register((0,u.addDisposableDomListener)(this.textarea,"compositionstart",()=>this._compositionHelper.compositionstart())),this.register((0,u.addDisposableDomListener)(this.textarea,"compositionupdate",B=>this._compositionHelper.compositionupdate(B))),this.register((0,u.addDisposableDomListener)(this.textarea,"compositionend",()=>this._compositionHelper.compositionend())),this.register((0,u.addDisposableDomListener)(this.textarea,"input",B=>this._inputEvent(B),!0)),this.register(this.onRender(()=>this._compositionHelper.updateCompositionElements()))}open(B){var K;if(!B)throw new Error("Terminal requires a parent element.");if(B.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),((K=this.element)==null?void 0:K.ownerDocument.defaultView)&&this._coreBrowserService)return void(this.element.ownerDocument.defaultView!==this._coreBrowserService.window&&(this._coreBrowserService.window=this.element.ownerDocument.defaultView));this._document=B.ownerDocument,this.options.documentOverride&&this.options.documentOverride instanceof Document&&(this._document=this.optionsService.rawOptions.documentOverride),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),B.appendChild(this.element);const P=this._document.createDocumentFragment();this._viewportElement=this._document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),P.appendChild(this._viewportElement),this._viewportScrollArea=this._document.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=this._document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this.register((0,u.addDisposableDomListener)(this.screenElement,"mousemove",H=>this.updateCursorStyle(H))),this._helperContainer=this._document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),P.appendChild(this.screenElement),this.textarea=this._document.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",g.promptLabel),q.isChromeOS||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._coreBrowserService=this.register(this._instantiationService.createInstance(C.CoreBrowserService,this.textarea,B.ownerDocument.defaultView??window,this._document??typeof window<"u"?window.document:null)),this._instantiationService.setService(k.ICoreBrowserService,this._coreBrowserService),this.register((0,u.addDisposableDomListener)(this.textarea,"focus",H=>this._handleTextAreaFocus(H))),this.register((0,u.addDisposableDomListener)(this.textarea,"blur",()=>this._handleTextAreaBlur())),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(m.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(k.ICharSizeService,this._charSizeService),this._themeService=this._instantiationService.createInstance(O.ThemeService),this._instantiationService.setService(k.IThemeService,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(b.CharacterJoinerService),this._instantiationService.setService(k.ICharacterJoinerService,this._characterJoinerService),this._renderService=this.register(this._instantiationService.createInstance(T.RenderService,this.rows,this.screenElement)),this._instantiationService.setService(k.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange(H=>this._onRender.fire(H))),this.onResize(H=>this._renderService.resize(H.cols,H.rows)),this._compositionView=this._document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(p.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this._mouseService=this._instantiationService.createInstance(w.MouseService),this._instantiationService.setService(k.IMouseService,this._mouseService),this.linkifier=this.register(this._instantiationService.createInstance(h.Linkifier,this.screenElement)),this.element.appendChild(P);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this.viewport=this._instantiationService.createInstance(y.Viewport,this._viewportElement,this._viewportScrollArea),this.viewport.onRequestScrollLines(H=>this.scrollLines(H.amount,H.suppressScrollEvent,1)),this.register(this._inputHandler.onRequestSyncScrollBar(()=>this.viewport.syncScrollArea())),this.register(this.viewport),this.register(this.onCursorMove(()=>{this._renderService.handleCursorMove(),this._syncTextArea()})),this.register(this.onResize(()=>this._renderService.handleResize(this.cols,this.rows))),this.register(this.onBlur(()=>this._renderService.handleBlur())),this.register(this.onFocus(()=>this._renderService.handleFocus())),this.register(this._renderService.onDimensionsChange(()=>this.viewport.syncScrollArea())),this._selectionService=this.register(this._instantiationService.createInstance(S.SelectionService,this.element,this.screenElement,this.linkifier)),this._instantiationService.setService(k.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines(H=>this.scrollLines(H.amount,H.suppressScrollEvent))),this.register(this._selectionService.onSelectionChange(()=>this._onSelectionChange.fire())),this.register(this._selectionService.onRequestRedraw(H=>this._renderService.handleSelectionChanged(H.start,H.end,H.columnSelectMode))),this.register(this._selectionService.onLinuxMouseSelection(H=>{this.textarea.value=H,this.textarea.focus(),this.textarea.select()})),this.register(this._onScroll.event(H=>{this.viewport.syncScrollArea(),this._selectionService.refresh()})),this.register((0,u.addDisposableDomListener)(this._viewportElement,"scroll",()=>this._selectionService.refresh())),this.register(this._instantiationService.createInstance(v.BufferDecorationRenderer,this.screenElement)),this.register((0,u.addDisposableDomListener)(this.element,"mousedown",H=>this._selectionService.handleMouseDown(H))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(z.AccessibilityManager,this)),this.register(this.optionsService.onSpecificOptionChange("screenReaderMode",H=>this._handleScreenReaderModeOptionChange(H))),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(f.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRulerWidth",H=>{!this._overviewRulerRenderer&&H&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(f.OverviewRulerRenderer,this._viewportElement,this.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(d.DomRenderer,this,this._document,this.element,this.screenElement,this._viewportElement,this._helperContainer,this.linkifier)}bindMouse(){const B=this,P=this.element;function K(Z){const ue=B._mouseService.getMouseReportCoords(Z,B.screenElement);if(!ue)return!1;let ye,Se;switch(Z.overrideType||Z.type){case"mousemove":Se=32,Z.buttons===void 0?(ye=3,Z.button!==void 0&&(ye=Z.button<3?Z.button:3)):ye=1&Z.buttons?0:4&Z.buttons?1:2&Z.buttons?2:3;break;case"mouseup":Se=0,ye=Z.button<3?Z.button:3;break;case"mousedown":Se=1,ye=Z.button<3?Z.button:3;break;case"wheel":if(B._customWheelEventHandler&&B._customWheelEventHandler(Z)===!1||B.viewport.getLinesScrolled(Z)===0)return!1;Se=Z.deltaY<0?0:1,ye=4;break;default:return!1}return!(Se===void 0||ye===void 0||ye>4)&&B.coreMouseService.triggerMouseEvent({col:ue.col,row:ue.row,x:ue.x,y:ue.y,button:ye,action:Se,ctrl:Z.ctrlKey,alt:Z.altKey,shift:Z.shiftKey})}const H={mouseup:null,wheel:null,mousedrag:null,mousemove:null},te={mouseup:Z=>(K(Z),Z.buttons||(this._document.removeEventListener("mouseup",H.mouseup),H.mousedrag&&this._document.removeEventListener("mousemove",H.mousedrag)),this.cancel(Z)),wheel:Z=>(K(Z),this.cancel(Z,!0)),mousedrag:Z=>{Z.buttons&&K(Z)},mousemove:Z=>{Z.buttons||K(Z)}};this.register(this.coreMouseService.onProtocolChange(Z=>{Z?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(Z)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&Z?H.mousemove||(P.addEventListener("mousemove",te.mousemove),H.mousemove=te.mousemove):(P.removeEventListener("mousemove",H.mousemove),H.mousemove=null),16&Z?H.wheel||(P.addEventListener("wheel",te.wheel,{passive:!1}),H.wheel=te.wheel):(P.removeEventListener("wheel",H.wheel),H.wheel=null),2&Z?H.mouseup||(H.mouseup=te.mouseup):(this._document.removeEventListener("mouseup",H.mouseup),H.mouseup=null),4&Z?H.mousedrag||(H.mousedrag=te.mousedrag):(this._document.removeEventListener("mousemove",H.mousedrag),H.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,u.addDisposableDomListener)(P,"mousedown",Z=>{if(Z.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection(Z))return K(Z),H.mouseup&&this._document.addEventListener("mouseup",H.mouseup),H.mousedrag&&this._document.addEventListener("mousemove",H.mousedrag),this.cancel(Z)})),this.register((0,u.addDisposableDomListener)(P,"wheel",Z=>{if(!H.wheel){if(this._customWheelEventHandler&&this._customWheelEventHandler(Z)===!1)return!1;if(!this.buffer.hasScrollback){const ue=this.viewport.getLinesScrolled(Z);if(ue===0)return;const ye=Y.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(Z.deltaY<0?"A":"B");let Se="";for(let Ke=0;Ke<Math.abs(ue);Ke++)Se+=ye;return this.coreService.triggerDataEvent(Se,!0),this.cancel(Z,!0)}return this.viewport.handleWheel(Z)?this.cancel(Z):void 0}},{passive:!1})),this.register((0,u.addDisposableDomListener)(P,"touchstart",Z=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchStart(Z),this.cancel(Z)},{passive:!0})),this.register((0,u.addDisposableDomListener)(P,"touchmove",Z=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchMove(Z)?void 0:this.cancel(Z)},{passive:!1}))}refresh(B,P){var K;(K=this._renderService)==null||K.refreshRows(B,P)}updateCursorStyle(B){var P;(P=this._selectionService)!=null&&P.shouldColumnSelect(B)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(B,P,K=0){var H;K===1?(super.scrollLines(B,P,K),this.refresh(0,this.rows-1)):(H=this.viewport)==null||H.scrollLines(B)}paste(B){(0,l.paste)(B,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(B){this._customKeyEventHandler=B}attachCustomWheelEventHandler(B){this._customWheelEventHandler=B}registerLinkProvider(B){return this._linkProviderService.registerLinkProvider(B)}registerCharacterJoiner(B){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");const P=this._characterJoinerService.register(B);return this.refresh(0,this.rows-1),P}deregisterCharacterJoiner(B){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(B)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(B){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+B)}registerDecoration(B){return this._decorationService.registerDecoration(B)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(B,P,K){this._selectionService.setSelection(B,P,K)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){var B;(B=this._selectionService)==null||B.clearSelection()}selectAll(){var B;(B=this._selectionService)==null||B.selectAll()}selectLines(B,P){var K;(K=this._selectionService)==null||K.selectLines(B,P)}_keyDown(B){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(B)===!1)return!1;const P=this.browser.isMac&&this.options.macOptionIsMeta&&B.altKey;if(!P&&!this._compositionHelper.keydown(B))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(),!1;P||B.key!=="Dead"&&B.key!=="AltGraph"||(this._unprocessedDeadKey=!0);const K=(0,F.evaluateKeyboardEvent)(B,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(B),K.type===3||K.type===2){const H=this.rows-1;return this.scrollLines(K.type===2?-H:H),this.cancel(B,!0)}return K.type===1&&this.selectAll(),!!this._isThirdLevelShift(this.browser,B)||(K.cancel&&this.cancel(B,!0),!K.key||!!(B.key&&!B.ctrlKey&&!B.altKey&&!B.metaKey&&B.key.length===1&&B.key.charCodeAt(0)>=65&&B.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(K.key!==Y.C0.ETX&&K.key!==Y.C0.CR||(this.textarea.value=""),this._onKey.fire({key:K.key,domEvent:B}),this._showCursor(),this.coreService.triggerDataEvent(K.key,!0),!this.optionsService.rawOptions.screenReaderMode||B.altKey||B.ctrlKey?this.cancel(B,!0):void(this._keyDownHandled=!0))))}_isThirdLevelShift(B,P){const K=B.isMac&&!this.options.macOptionIsMeta&&P.altKey&&!P.ctrlKey&&!P.metaKey||B.isWindows&&P.altKey&&P.ctrlKey&&!P.metaKey||B.isWindows&&P.getModifierState("AltGraph");return P.type==="keypress"?K:K&&(!P.keyCode||P.keyCode>47)}_keyUp(B){this._keyDownSeen=!1,this._customKeyEventHandler&&this._customKeyEventHandler(B)===!1||(function(P){return P.keyCode===16||P.keyCode===17||P.keyCode===18}(B)||this.focus(),this.updateCursorStyle(B),this._keyPressHandled=!1)}_keyPress(B){let P;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(B)===!1)return!1;if(this.cancel(B),B.charCode)P=B.charCode;else if(B.which===null||B.which===void 0)P=B.keyCode;else{if(B.which===0||B.charCode===0)return!1;P=B.which}return!(!P||(B.altKey||B.ctrlKey||B.metaKey)&&!this._isThirdLevelShift(this.browser,B)||(P=String.fromCharCode(P),this._onKey.fire({key:P,domEvent:B}),this._showCursor(),this.coreService.triggerDataEvent(P,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(B){if(B.data&&B.inputType==="insertText"&&(!B.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;const P=B.data;return this.coreService.triggerDataEvent(P,!0),this.cancel(B),!0}return!1}resize(B,P){B!==this.cols||P!==this.rows?super.resize(B,P):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(B,P){var K,H;(K=this._charSizeService)==null||K.measure(),(H=this.viewport)==null||H.syncScrollArea(!0)}clear(){var B;if(this.buffer.ybase!==0||this.buffer.y!==0){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let P=1;P<this.rows;P++)this.buffer.lines.push(this.buffer.getBlankLine(X.DEFAULT_ATTR_DATA));this._onScroll.fire({position:this.buffer.ydisp,source:0}),(B=this.viewport)==null||B.reset(),this.refresh(0,this.rows-1)}}reset(){var P,K;this.options.rows=this.rows,this.options.cols=this.cols;const B=this._customKeyEventHandler;this._setup(),super.reset(),(P=this._selectionService)==null||P.reset(),this._decorationService.reset(),(K=this.viewport)==null||K.reset(),this._customKeyEventHandler=B,this.refresh(0,this.rows-1)}clearTextureAtlas(){var B;(B=this._renderService)==null||B.clearTextureAtlas()}_reportFocus(){var B;(B=this.element)!=null&&B.classList.contains("focus")?this.coreService.triggerDataEvent(Y.C0.ESC+"[I"):this.coreService.triggerDataEvent(Y.C0.ESC+"[O")}_reportWindowsOptions(B){if(this._renderService)switch(B){case I.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:const P=this._renderService.dimensions.css.canvas.width.toFixed(0),K=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${Y.C0.ESC}[4;${K};${P}t`);break;case I.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:const H=this._renderService.dimensions.css.cell.width.toFixed(0),te=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${Y.C0.ESC}[6;${te};${H}t`)}}cancel(B,P){if(this.options.cancelEvents||P)return B.preventDefault(),B.stopPropagation(),!1}}s.Terminal=ne},9924:(a,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.TimeBasedDebouncer=void 0,s.TimeBasedDebouncer=class{constructor(c,l=1e3){this._renderCallback=c,this._debounceThresholdMS=l,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(c,l,u){this._rowCount=u,c=c!==void 0?c:0,l=l!==void 0?l:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,c):c,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,l):l;const h=Date.now();if(h-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=h,this._innerRefresh();else if(!this._additionalRefreshRequested){const g=h-this._lastRefreshMs,_=this._debounceThresholdMS-g;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0},_)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;const c=Math.max(this._rowStart,0),l=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(c,l)}}},1680:function(a,s,c){var l=this&&this.__decorate||function(p,d,m,b){var C,w=arguments.length,T=w<3?d:b===null?b=Object.getOwnPropertyDescriptor(d,m):b;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")T=Reflect.decorate(p,d,m,b);else for(var S=p.length-1;S>=0;S--)(C=p[S])&&(T=(w<3?C(T):w>3?C(d,m,T):C(d,m))||T);return w>3&&T&&Object.defineProperty(d,m,T),T},u=this&&this.__param||function(p,d){return function(m,b){d(m,b,p)}};Object.defineProperty(s,"__esModule",{value:!0}),s.Viewport=void 0;const h=c(3656),g=c(4725),_=c(8460),y=c(844),v=c(2585);let f=s.Viewport=class extends y.Disposable{constructor(p,d,m,b,C,w,T,S){super(),this._viewportElement=p,this._scrollArea=d,this._bufferService=m,this._optionsService=b,this._charSizeService=C,this._renderService=w,this._coreBrowserService=T,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this._onRequestScrollLines=this.register(new _.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register((0,h.addDisposableDomListener)(this._viewportElement,"scroll",this._handleScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(k=>this._activeBuffer=k.activeBuffer)),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange(k=>this._renderDimensions=k)),this._handleThemeChange(S.colors),this.register(S.onChangeColors(k=>this._handleThemeChange(k))),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.syncScrollArea())),setTimeout(()=>this.syncScrollArea())}_handleThemeChange(p){this._viewportElement.style.backgroundColor=p.background.css}reset(){this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._coreBrowserService.window.requestAnimationFrame(()=>this.syncScrollArea())}_refresh(p){if(p)return this._innerRefresh(),void(this._refreshAnimationFrame!==null&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));this._refreshAnimationFrame===null&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderDimensions.device.cell.height/this._coreBrowserService.dpr,this._currentDeviceCellHeight=this._renderDimensions.device.cell.height,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;const d=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderDimensions.css.canvas.height);this._lastRecordedBufferHeight!==d&&(this._lastRecordedBufferHeight=d,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}const p=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==p&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=p),this._refreshAnimationFrame=null}syncScrollArea(p=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(p);this._lastRecordedViewportHeight===this._renderService.dimensions.css.canvas.height&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.device.cell.height===this._currentDeviceCellHeight||this._refresh(p)}_handleScroll(p){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._onRequestScrollLines.fire({amount:0,suppressScrollEvent:!0});const d=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._onRequestScrollLines.fire({amount:d,suppressScrollEvent:!0})}_smoothScroll(){if(this._isDisposed||this._smoothScrollState.origin===-1||this._smoothScrollState.target===-1)return;const p=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(p*(this._smoothScrollState.target-this._smoothScrollState.origin)),p<1?this._coreBrowserService.window.requestAnimationFrame(()=>this._smoothScroll()):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(p,d){const m=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(d<0&&this._viewportElement.scrollTop!==0||d>0&&m<this._lastRecordedBufferHeight)||(p.cancelable&&p.preventDefault(),!1)}handleWheel(p){const d=this._getPixelsScrolled(p);return d!==0&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target===-1?this._smoothScrollState.target=this._viewportElement.scrollTop+d:this._smoothScrollState.target+=d,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=d,this._bubbleScroll(p,d))}scrollLines(p){if(p!==0)if(this._optionsService.rawOptions.smoothScrollDuration){const d=p*this._currentRowHeight;this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target=this._smoothScrollState.origin+d,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()}else this._onRequestScrollLines.fire({amount:p,suppressScrollEvent:!1})}_getPixelsScrolled(p){if(p.deltaY===0||p.shiftKey)return 0;let d=this._applyScrollModifier(p.deltaY,p);return p.deltaMode===WheelEvent.DOM_DELTA_LINE?d*=this._currentRowHeight:p.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(d*=this._currentRowHeight*this._bufferService.rows),d}getBufferElements(p,d){var S;let m,b="";const C=[],w=d??this._bufferService.buffer.lines.length,T=this._bufferService.buffer.lines;for(let k=p;k<w;k++){const O=T.get(k);if(!O)continue;const L=(S=T.get(k+1))==null?void 0:S.isWrapped;if(b+=O.translateToString(!L),!L||k===T.length-1){const M=document.createElement("div");M.textContent=b,C.push(M),b.length>0&&(m=M),b=""}}return{bufferElements:C,cursorElement:m}}getLinesScrolled(p){if(p.deltaY===0||p.shiftKey)return 0;let d=this._applyScrollModifier(p.deltaY,p);return p.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(d/=this._currentRowHeight+0,this._wheelPartialScroll+=d,d=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):p.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(d*=this._bufferService.rows),d}_applyScrollModifier(p,d){const m=this._optionsService.rawOptions.fastScrollModifier;return m==="alt"&&d.altKey||m==="ctrl"&&d.ctrlKey||m==="shift"&&d.shiftKey?p*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:p*this._optionsService.rawOptions.scrollSensitivity}handleTouchStart(p){this._lastTouchY=p.touches[0].pageY}handleTouchMove(p){const d=this._lastTouchY-p.touches[0].pageY;return this._lastTouchY=p.touches[0].pageY,d!==0&&(this._viewportElement.scrollTop+=d,this._bubbleScroll(p,d))}};s.Viewport=f=l([u(2,v.IBufferService),u(3,v.IOptionsService),u(4,g.ICharSizeService),u(5,g.IRenderService),u(6,g.ICoreBrowserService),u(7,g.IThemeService)],f)},3107:function(a,s,c){var l=this&&this.__decorate||function(v,f,p,d){var m,b=arguments.length,C=b<3?f:d===null?d=Object.getOwnPropertyDescriptor(f,p):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(v,f,p,d);else for(var w=v.length-1;w>=0;w--)(m=v[w])&&(C=(b<3?m(C):b>3?m(f,p,C):m(f,p))||C);return b>3&&C&&Object.defineProperty(f,p,C),C},u=this&&this.__param||function(v,f){return function(p,d){f(p,d,v)}};Object.defineProperty(s,"__esModule",{value:!0}),s.BufferDecorationRenderer=void 0;const h=c(4725),g=c(844),_=c(2585);let y=s.BufferDecorationRenderer=class extends g.Disposable{constructor(v,f,p,d,m){super(),this._screenElement=v,this._bufferService=f,this._coreBrowserService=p,this._decorationService=d,this._renderService=m,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange(()=>this._doRefreshDecorations())),this.register(this._renderService.onDimensionsChange(()=>{this._dimensionsChanged=!0,this._queueRefresh()})),this.register(this._coreBrowserService.onDprChange(()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt})),this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh())),this.register(this._decorationService.onDecorationRemoved(b=>this._removeDecoration(b))),this.register((0,g.toDisposable)(()=>{this._container.remove(),this._decorationElements.clear()}))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback(()=>{this._doRefreshDecorations(),this._animationFrame=void 0}))}_doRefreshDecorations(){for(const v of this._decorationService.decorations)this._renderDecoration(v);this._dimensionsChanged=!1}_renderDecoration(v){this._refreshStyle(v),this._dimensionsChanged&&this._refreshXPosition(v)}_createElement(v){var d;const f=this._coreBrowserService.mainDocument.createElement("div");f.classList.add("xterm-decoration"),f.classList.toggle("xterm-decoration-top-layer",((d=v==null?void 0:v.options)==null?void 0:d.layer)==="top"),f.style.width=`${Math.round((v.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,f.style.height=(v.options.height||1)*this._renderService.dimensions.css.cell.height+"px",f.style.top=(v.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height+"px",f.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;const p=v.options.x??0;return p&&p>this._bufferService.cols&&(f.style.display="none"),this._refreshXPosition(v,f),f}_refreshStyle(v){const f=v.marker.line-this._bufferService.buffers.active.ydisp;if(f<0||f>=this._bufferService.rows)v.element&&(v.element.style.display="none",v.onRenderEmitter.fire(v.element));else{let p=this._decorationElements.get(v);p||(p=this._createElement(v),v.element=p,this._decorationElements.set(v,p),this._container.appendChild(p),v.onDispose(()=>{this._decorationElements.delete(v),p.remove()})),p.style.top=f*this._renderService.dimensions.css.cell.height+"px",p.style.display=this._altBufferIsActive?"none":"block",v.onRenderEmitter.fire(p)}}_refreshXPosition(v,f=v.element){if(!f)return;const p=v.options.x??0;(v.options.anchor||"left")==="right"?f.style.right=p?p*this._renderService.dimensions.css.cell.width+"px":"":f.style.left=p?p*this._renderService.dimensions.css.cell.width+"px":""}_removeDecoration(v){var f;(f=this._decorationElements.get(v))==null||f.remove(),this._decorationElements.delete(v),v.dispose()}};s.BufferDecorationRenderer=y=l([u(1,_.IBufferService),u(2,h.ICoreBrowserService),u(3,_.IDecorationService),u(4,h.IRenderService)],y)},5871:(a,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.ColorZoneStore=void 0,s.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(c){if(c.options.overviewRulerOptions){for(const l of this._zones)if(l.color===c.options.overviewRulerOptions.color&&l.position===c.options.overviewRulerOptions.position){if(this._lineIntersectsZone(l,c.marker.line))return;if(this._lineAdjacentToZone(l,c.marker.line,c.options.overviewRulerOptions.position))return void this._addLineToZone(l,c.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=c.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=c.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=c.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=c.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:c.options.overviewRulerOptions.color,position:c.options.overviewRulerOptions.position,startBufferLine:c.marker.line,endBufferLine:c.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(c){this._linePadding=c}_lineIntersectsZone(c,l){return l>=c.startBufferLine&&l<=c.endBufferLine}_lineAdjacentToZone(c,l,u){return l>=c.startBufferLine-this._linePadding[u||"full"]&&l<=c.endBufferLine+this._linePadding[u||"full"]}_addLineToZone(c,l){c.startBufferLine=Math.min(c.startBufferLine,l),c.endBufferLine=Math.max(c.endBufferLine,l)}}},5744:function(a,s,c){var l=this&&this.__decorate||function(m,b,C,w){var T,S=arguments.length,k=S<3?b:w===null?w=Object.getOwnPropertyDescriptor(b,C):w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")k=Reflect.decorate(m,b,C,w);else for(var O=m.length-1;O>=0;O--)(T=m[O])&&(k=(S<3?T(k):S>3?T(b,C,k):T(b,C))||k);return S>3&&k&&Object.defineProperty(b,C,k),k},u=this&&this.__param||function(m,b){return function(C,w){b(C,w,m)}};Object.defineProperty(s,"__esModule",{value:!0}),s.OverviewRulerRenderer=void 0;const h=c(5871),g=c(4725),_=c(844),y=c(2585),v={full:0,left:0,center:0,right:0},f={full:0,left:0,center:0,right:0},p={full:0,left:0,center:0,right:0};let d=s.OverviewRulerRenderer=class extends _.Disposable{get _width(){return this._optionsService.options.overviewRulerWidth||0}constructor(m,b,C,w,T,S,k){var L;super(),this._viewportElement=m,this._screenElement=b,this._bufferService=C,this._decorationService=w,this._renderService=T,this._optionsService=S,this._coreBrowserService=k,this._colorZoneStore=new h.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),(L=this._viewportElement.parentElement)==null||L.insertBefore(this._canvas,this._viewportElement);const O=this._canvas.getContext("2d");if(!O)throw new Error("Ctx cannot be null");this._ctx=O,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners(),this.register((0,_.toDisposable)(()=>{var M;(M=this._canvas)==null||M.remove()}))}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh(void 0,!0))),this.register(this._decorationService.onDecorationRemoved(()=>this._queueRefresh(void 0,!0)))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange(()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"})),this.register(this._bufferService.onScroll(()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())}))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender(()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)})),this.register(this._optionsService.onSpecificOptionChange("overviewRulerWidth",()=>this._queueRefresh(!0))),this.register(this._coreBrowserService.onDprChange(()=>this._queueRefresh(!0))),this._queueRefresh(!0)}_refreshDrawConstants(){const m=Math.floor(this._canvas.width/3),b=Math.ceil(this._canvas.width/3);f.full=this._canvas.width,f.left=m,f.center=b,f.right=m,this._refreshDrawHeightConstants(),p.full=0,p.left=0,p.center=f.left,p.right=f.left+f.center}_refreshDrawHeightConstants(){v.full=Math.round(2*this._coreBrowserService.dpr);const m=this._canvas.height/this._bufferService.buffer.lines.length,b=Math.round(Math.max(Math.min(m,12),6)*this._coreBrowserService.dpr);v.left=b,v.center=b,v.right=b}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*v.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*v.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*v.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*v.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowserService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowserService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(const b of this._decorationService.decorations)this._colorZoneStore.addDecoration(b);this._ctx.lineWidth=1;const m=this._colorZoneStore.zones;for(const b of m)b.position!=="full"&&this._renderColorZone(b);for(const b of m)b.position==="full"&&this._renderColorZone(b);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(m){this._ctx.fillStyle=m.color,this._ctx.fillRect(p[m.position||"full"],Math.round((this._canvas.height-1)*(m.startBufferLine/this._bufferService.buffers.active.lines.length)-v[m.position||"full"]/2),f[m.position||"full"],Math.round((this._canvas.height-1)*((m.endBufferLine-m.startBufferLine)/this._bufferService.buffers.active.lines.length)+v[m.position||"full"]))}_queueRefresh(m,b){this._shouldUpdateDimensions=m||this._shouldUpdateDimensions,this._shouldUpdateAnchor=b||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._refreshDecorations(),this._animationFrame=void 0}))}};s.OverviewRulerRenderer=d=l([u(2,y.IBufferService),u(3,y.IDecorationService),u(4,g.IRenderService),u(5,y.IOptionsService),u(6,g.ICoreBrowserService)],d)},2950:function(a,s,c){var l=this&&this.__decorate||function(v,f,p,d){var m,b=arguments.length,C=b<3?f:d===null?d=Object.getOwnPropertyDescriptor(f,p):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(v,f,p,d);else for(var w=v.length-1;w>=0;w--)(m=v[w])&&(C=(b<3?m(C):b>3?m(f,p,C):m(f,p))||C);return b>3&&C&&Object.defineProperty(f,p,C),C},u=this&&this.__param||function(v,f){return function(p,d){f(p,d,v)}};Object.defineProperty(s,"__esModule",{value:!0}),s.CompositionHelper=void 0;const h=c(4725),g=c(2585),_=c(2584);let y=s.CompositionHelper=class{get isComposing(){return this._isComposing}constructor(v,f,p,d,m,b){this._textarea=v,this._compositionView=f,this._bufferService=p,this._optionsService=d,this._coreService=m,this._renderService=b,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(v){this._compositionView.textContent=v.data,this.updateCompositionElements(),setTimeout(()=>{this._compositionPosition.end=this._textarea.value.length},0)}compositionend(){this._finalizeComposition(!0)}keydown(v){if(this._isComposing||this._isSendingComposition){if(v.keyCode===229||v.keyCode===16||v.keyCode===17||v.keyCode===18)return!1;this._finalizeComposition(!1)}return v.keyCode!==229||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(v){if(this._compositionView.classList.remove("active"),this._isComposing=!1,v){const f={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(()=>{if(this._isSendingComposition){let p;this._isSendingComposition=!1,f.start+=this._dataAlreadySent.length,p=this._isComposing?this._textarea.value.substring(f.start,f.end):this._textarea.value.substring(f.start),p.length>0&&this._coreService.triggerDataEvent(p,!0)}},0)}else{this._isSendingComposition=!1;const f=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(f,!0)}}_handleAnyTextareaChanges(){const v=this._textarea.value;setTimeout(()=>{if(!this._isComposing){const f=this._textarea.value,p=f.replace(v,"");this._dataAlreadySent=p,f.length>v.length?this._coreService.triggerDataEvent(p,!0):f.length<v.length?this._coreService.triggerDataEvent(`${_.C0.DEL}`,!0):f.length===v.length&&f!==v&&this._coreService.triggerDataEvent(f,!0)}},0)}updateCompositionElements(v){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){const f=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),p=this._renderService.dimensions.css.cell.height,d=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,m=f*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=m+"px",this._compositionView.style.top=d+"px",this._compositionView.style.height=p+"px",this._compositionView.style.lineHeight=p+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";const b=this._compositionView.getBoundingClientRect();this._textarea.style.left=m+"px",this._textarea.style.top=d+"px",this._textarea.style.width=Math.max(b.width,1)+"px",this._textarea.style.height=Math.max(b.height,1)+"px",this._textarea.style.lineHeight=b.height+"px"}v||setTimeout(()=>this.updateCompositionElements(!0),0)}}};s.CompositionHelper=y=l([u(2,g.IBufferService),u(3,g.IOptionsService),u(4,g.ICoreService),u(5,h.IRenderService)],y)},9806:(a,s)=>{function c(l,u,h){const g=h.getBoundingClientRect(),_=l.getComputedStyle(h),y=parseInt(_.getPropertyValue("padding-left")),v=parseInt(_.getPropertyValue("padding-top"));return[u.clientX-g.left-y,u.clientY-g.top-v]}Object.defineProperty(s,"__esModule",{value:!0}),s.getCoords=s.getCoordsRelativeToElement=void 0,s.getCoordsRelativeToElement=c,s.getCoords=function(l,u,h,g,_,y,v,f,p){if(!y)return;const d=c(l,u,h);return d?(d[0]=Math.ceil((d[0]+(p?v/2:0))/v),d[1]=Math.ceil(d[1]/f),d[0]=Math.min(Math.max(d[0],1),g+(p?1:0)),d[1]=Math.min(Math.max(d[1],1),_),d):void 0}},9504:(a,s,c)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.moveToCellSequence=void 0;const l=c(2584);function u(f,p,d,m){const b=f-h(f,d),C=p-h(p,d),w=Math.abs(b-C)-function(T,S,k){let O=0;const L=T-h(T,k),M=S-h(S,k);for(let D=0;D<Math.abs(L-M);D++){const U=g(T,S)==="A"?-1:1,q=k.buffer.lines.get(L+U*D);q!=null&&q.isWrapped&&O++}return O}(f,p,d);return v(w,y(g(f,p),m))}function h(f,p){let d=0,m=p.buffer.lines.get(f),b=m==null?void 0:m.isWrapped;for(;b&&f>=0&&f<p.rows;)d++,m=p.buffer.lines.get(--f),b=m==null?void 0:m.isWrapped;return d}function g(f,p){return f>p?"A":"B"}function _(f,p,d,m,b,C){let w=f,T=p,S="";for(;w!==d||T!==m;)w+=b?1:-1,b&&w>C.cols-1?(S+=C.buffer.translateBufferLineToString(T,!1,f,w),w=0,f=0,T++):!b&&w<0&&(S+=C.buffer.translateBufferLineToString(T,!1,0,f+1),w=C.cols-1,f=w,T--);return S+C.buffer.translateBufferLineToString(T,!1,f,w)}function y(f,p){const d=p?"O":"[";return l.C0.ESC+d+f}function v(f,p){f=Math.floor(f);let d="";for(let m=0;m<f;m++)d+=p;return d}s.moveToCellSequence=function(f,p,d,m){const b=d.buffer.x,C=d.buffer.y;if(!d.buffer.hasScrollback)return function(S,k,O,L,M,D){return u(k,L,M,D).length===0?"":v(_(S,k,S,k-h(k,M),!1,M).length,y("D",D))}(b,C,0,p,d,m)+u(C,p,d,m)+function(S,k,O,L,M,D){let U;U=u(k,L,M,D).length>0?L-h(L,M):k;const q=L,X=function(Y,F,E,x,A,I){let z;return z=u(E,x,A,I).length>0?x-h(x,A):F,Y<E&&z<=x||Y>=E&&z<x?"C":"D"}(S,k,O,L,M,D);return v(_(S,U,O,q,X==="C",M).length,y(X,D))}(b,C,f,p,d,m);let w;if(C===p)return w=b>f?"D":"C",v(Math.abs(b-f),y(w,m));w=C>p?"D":"C";const T=Math.abs(C-p);return v(function(S,k){return k.cols-S}(C>p?f:b,d)+(T-1)*d.cols+1+((C>p?b:f)-1),y(w,m))}},1296:function(a,s,c){var l=this&&this.__decorate||function(D,U,q,X){var Y,F=arguments.length,E=F<3?U:X===null?X=Object.getOwnPropertyDescriptor(U,q):X;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")E=Reflect.decorate(D,U,q,X);else for(var x=D.length-1;x>=0;x--)(Y=D[x])&&(E=(F<3?Y(E):F>3?Y(U,q,E):Y(U,q))||E);return F>3&&E&&Object.defineProperty(U,q,E),E},u=this&&this.__param||function(D,U){return function(q,X){U(q,X,D)}};Object.defineProperty(s,"__esModule",{value:!0}),s.DomRenderer=void 0;const h=c(3787),g=c(2550),_=c(2223),y=c(6171),v=c(6052),f=c(4725),p=c(8055),d=c(8460),m=c(844),b=c(2585),C="xterm-dom-renderer-owner-",w="xterm-rows",T="xterm-fg-",S="xterm-bg-",k="xterm-focus",O="xterm-selection";let L=1,M=s.DomRenderer=class extends m.Disposable{constructor(D,U,q,X,Y,F,E,x,A,I,z,Q,ne){super(),this._terminal=D,this._document=U,this._element=q,this._screenElement=X,this._viewportElement=Y,this._helperContainer=F,this._linkifier2=E,this._charSizeService=A,this._optionsService=I,this._bufferService=z,this._coreBrowserService=Q,this._themeService=ne,this._terminalClass=L++,this._rowElements=[],this._selectionRenderModel=(0,v.createSelectionRenderModel)(),this.onRequestRedraw=this.register(new d.EventEmitter).event,this._rowContainer=this._document.createElement("div"),this._rowContainer.classList.add(w),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=this._document.createElement("div"),this._selectionContainer.classList.add(O),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=(0,y.createRenderDimensions)(),this._updateDimensions(),this.register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._themeService.onChangeColors(se=>this._injectCss(se))),this._injectCss(this._themeService.colors),this._rowFactory=x.createInstance(h.DomRendererRowFactory,document),this._element.classList.add(C+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline(se=>this._handleLinkHover(se))),this.register(this._linkifier2.onHideLinkUnderline(se=>this._handleLinkLeave(se))),this.register((0,m.toDisposable)(()=>{this._element.classList.remove(C+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()})),this._widthCache=new g.WidthCache(this._document,this._helperContainer),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){const D=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*D,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*D),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/D),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/D),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(const q of this._rowElements)q.style.width=`${this.dimensions.css.canvas.width}px`,q.style.height=`${this.dimensions.css.cell.height}px`,q.style.lineHeight=`${this.dimensions.css.cell.height}px`,q.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));const U=`${this._terminalSelector} .${w} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=U,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(D){this._themeStyleElement||(this._themeStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let U=`${this._terminalSelector} .${w} { color: ${D.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;U+=`${this._terminalSelector} .${w} .xterm-dim { color: ${p.color.multiplyOpacity(D.foreground,.5).css};}`,U+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`;const q=`blink_underline_${this._terminalClass}`,X=`blink_bar_${this._terminalClass}`,Y=`blink_block_${this._terminalClass}`;U+=`@keyframes ${q} { 50% {  border-bottom-style: hidden; }}`,U+=`@keyframes ${X} { 50% {  box-shadow: none; }}`,U+=`@keyframes ${Y} { 0% {  background-color: ${D.cursor.css};  color: ${D.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${D.cursor.css}; }}`,U+=`${this._terminalSelector} .${w}.${k} .xterm-cursor.xterm-cursor-blink.xterm-cursor-underline { animation: ${q} 1s step-end infinite;}${this._terminalSelector} .${w}.${k} .xterm-cursor.xterm-cursor-blink.xterm-cursor-bar { animation: ${X} 1s step-end infinite;}${this._terminalSelector} .${w}.${k} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: ${Y} 1s step-end infinite;}${this._terminalSelector} .${w} .xterm-cursor.xterm-cursor-block { background-color: ${D.cursor.css}; color: ${D.cursorAccent.css};}${this._terminalSelector} .${w} .xterm-cursor.xterm-cursor-block:not(.xterm-cursor-blink) { background-color: ${D.cursor.css} !important; color: ${D.cursorAccent.css} !important;}${this._terminalSelector} .${w} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${D.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${w} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${D.cursor.css} inset;}${this._terminalSelector} .${w} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${D.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,U+=`${this._terminalSelector} .${O} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${O} div { position: absolute; background-color: ${D.selectionBackgroundOpaque.css};}${this._terminalSelector} .${O} div { position: absolute; background-color: ${D.selectionInactiveBackgroundOpaque.css};}`;for(const[F,E]of D.ansi.entries())U+=`${this._terminalSelector} .${T}${F} { color: ${E.css}; }${this._terminalSelector} .${T}${F}.xterm-dim { color: ${p.color.multiplyOpacity(E,.5).css}; }${this._terminalSelector} .${S}${F} { background-color: ${E.css}; }`;U+=`${this._terminalSelector} .${T}${_.INVERTED_DEFAULT_COLOR} { color: ${p.color.opaque(D.background).css}; }${this._terminalSelector} .${T}${_.INVERTED_DEFAULT_COLOR}.xterm-dim { color: ${p.color.multiplyOpacity(p.color.opaque(D.background),.5).css}; }${this._terminalSelector} .${S}${_.INVERTED_DEFAULT_COLOR} { background-color: ${D.foreground.css}; }`,this._themeStyleElement.textContent=U}_setDefaultSpacing(){const D=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${D}px`,this._rowFactory.defaultSpacing=D}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(D,U){for(let q=this._rowElements.length;q<=U;q++){const X=this._document.createElement("div");this._rowContainer.appendChild(X),this._rowElements.push(X)}for(;this._rowElements.length>U;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(D,U){this._refreshRowElements(D,U),this._updateDimensions(),this.handleSelectionChanged(this._selectionRenderModel.selectionStart,this._selectionRenderModel.selectionEnd,this._selectionRenderModel.columnSelectMode)}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(k),this.renderRows(0,this._bufferService.rows-1)}handleFocus(){this._rowContainer.classList.add(k),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(D,U,q){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(D,U,q),this.renderRows(0,this._bufferService.rows-1),!D||!U)return;this._selectionRenderModel.update(this._terminal,D,U,q);const X=this._selectionRenderModel.viewportStartRow,Y=this._selectionRenderModel.viewportEndRow,F=this._selectionRenderModel.viewportCappedStartRow,E=this._selectionRenderModel.viewportCappedEndRow;if(F>=this._bufferService.rows||E<0)return;const x=this._document.createDocumentFragment();if(q){const A=D[0]>U[0];x.appendChild(this._createSelectionElement(F,A?U[0]:D[0],A?D[0]:U[0],E-F+1))}else{const A=X===F?D[0]:0,I=F===Y?U[0]:this._bufferService.cols;x.appendChild(this._createSelectionElement(F,A,I));const z=E-F-1;if(x.appendChild(this._createSelectionElement(F+1,0,this._bufferService.cols,z)),F!==E){const Q=Y===E?U[0]:this._bufferService.cols;x.appendChild(this._createSelectionElement(E,0,Q))}}this._selectionContainer.appendChild(x)}_createSelectionElement(D,U,q,X=1){const Y=this._document.createElement("div"),F=U*this.dimensions.css.cell.width;let E=this.dimensions.css.cell.width*(q-U);return F+E>this.dimensions.css.canvas.width&&(E=this.dimensions.css.canvas.width-F),Y.style.height=X*this.dimensions.css.cell.height+"px",Y.style.top=D*this.dimensions.css.cell.height+"px",Y.style.left=`${F}px`,Y.style.width=`${E}px`,Y}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(const D of this._rowElements)D.replaceChildren()}renderRows(D,U){const q=this._bufferService.buffer,X=q.ybase+q.y,Y=Math.min(q.x,this._bufferService.cols-1),F=this._optionsService.rawOptions.cursorBlink,E=this._optionsService.rawOptions.cursorStyle,x=this._optionsService.rawOptions.cursorInactiveStyle;for(let A=D;A<=U;A++){const I=A+q.ydisp,z=this._rowElements[A],Q=q.lines.get(I);if(!z||!Q)break;z.replaceChildren(...this._rowFactory.createRow(Q,I,I===X,E,x,Y,F,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${C}${this._terminalClass}`}_handleLinkHover(D){this._setCellUnderline(D.x1,D.x2,D.y1,D.y2,D.cols,!0)}_handleLinkLeave(D){this._setCellUnderline(D.x1,D.x2,D.y1,D.y2,D.cols,!1)}_setCellUnderline(D,U,q,X,Y,F){q<0&&(D=0),X<0&&(U=0);const E=this._bufferService.rows-1;q=Math.max(Math.min(q,E),0),X=Math.max(Math.min(X,E),0),Y=Math.min(Y,this._bufferService.cols);const x=this._bufferService.buffer,A=x.ybase+x.y,I=Math.min(x.x,Y-1),z=this._optionsService.rawOptions.cursorBlink,Q=this._optionsService.rawOptions.cursorStyle,ne=this._optionsService.rawOptions.cursorInactiveStyle;for(let se=q;se<=X;++se){const B=se+x.ydisp,P=this._rowElements[se],K=x.lines.get(B);if(!P||!K)break;P.replaceChildren(...this._rowFactory.createRow(K,B,B===A,Q,ne,I,z,this.dimensions.css.cell.width,this._widthCache,F?se===q?D:0:-1,F?(se===X?U:Y)-1:-1))}}};s.DomRenderer=M=l([u(7,b.IInstantiationService),u(8,f.ICharSizeService),u(9,b.IOptionsService),u(10,b.IBufferService),u(11,f.ICoreBrowserService),u(12,f.IThemeService)],M)},3787:function(a,s,c){var l=this&&this.__decorate||function(w,T,S,k){var O,L=arguments.length,M=L<3?T:k===null?k=Object.getOwnPropertyDescriptor(T,S):k;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")M=Reflect.decorate(w,T,S,k);else for(var D=w.length-1;D>=0;D--)(O=w[D])&&(M=(L<3?O(M):L>3?O(T,S,M):O(T,S))||M);return L>3&&M&&Object.defineProperty(T,S,M),M},u=this&&this.__param||function(w,T){return function(S,k){T(S,k,w)}};Object.defineProperty(s,"__esModule",{value:!0}),s.DomRendererRowFactory=void 0;const h=c(2223),g=c(643),_=c(511),y=c(2585),v=c(8055),f=c(4725),p=c(4269),d=c(6171),m=c(3734);let b=s.DomRendererRowFactory=class{constructor(w,T,S,k,O,L,M){this._document=w,this._characterJoinerService=T,this._optionsService=S,this._coreBrowserService=k,this._coreService=O,this._decorationService=L,this._themeService=M,this._workCell=new _.CellData,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(w,T,S){this._selectionStart=w,this._selectionEnd=T,this._columnSelectMode=S}createRow(w,T,S,k,O,L,M,D,U,q,X){const Y=[],F=this._characterJoinerService.getJoinedCharacters(T),E=this._themeService.colors;let x,A=w.getNoBgTrimmedLength();S&&A<L+1&&(A=L+1);let I=0,z="",Q=0,ne=0,se=0,B=!1,P=0,K=!1,H=0;const te=[],Z=q!==-1&&X!==-1;for(let ue=0;ue<A;ue++){w.loadCell(ue,this._workCell);let ye=this._workCell.getWidth();if(ye===0)continue;let Se=!1,Ke=ue,oe=this._workCell;if(F.length>0&&ue===F[0][0]){Se=!0;const be=F.shift();oe=new p.JoinedCellData(this._workCell,w.translateToString(!0,be[0],be[1]),be[1]-be[0]),Ke=be[1]-1,ye=oe.getWidth()}const nn=this._isCellInSelection(ue,T),Qs=S&&ue===L,Ys=Z&&ue>=q&&ue<=X;let Zs=!1;this._decorationService.forEachDecorationAtCell(ue,T,void 0,be=>{Zs=!0});let Fn=oe.getChars()||g.WHITESPACE_CELL_CHAR;if(Fn===" "&&(oe.isUnderline()||oe.isOverline())&&(Fn=" "),H=ye*D-U.get(Fn,oe.isBold(),oe.isItalic()),x){if(I&&(nn&&K||!nn&&!K&&oe.bg===Q)&&(nn&&K&&E.selectionForeground||oe.fg===ne)&&oe.extended.ext===se&&Ys===B&&H===P&&!Qs&&!Se&&!Zs){oe.isInvisible()?z+=g.WHITESPACE_CELL_CHAR:z+=Fn,I++;continue}I&&(x.textContent=z),x=this._document.createElement("span"),I=0,z=""}else x=this._document.createElement("span");if(Q=oe.bg,ne=oe.fg,se=oe.extended.ext,B=Ys,P=H,K=nn,Se&&L>=ue&&L<=Ke&&(L=ue),!this._coreService.isCursorHidden&&Qs&&this._coreService.isCursorInitialized){if(te.push("xterm-cursor"),this._coreBrowserService.isFocused)M&&te.push("xterm-cursor-blink"),te.push(k==="bar"?"xterm-cursor-bar":k==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if(O)switch(O){case"outline":te.push("xterm-cursor-outline");break;case"block":te.push("xterm-cursor-block");break;case"bar":te.push("xterm-cursor-bar");break;case"underline":te.push("xterm-cursor-underline")}}if(oe.isBold()&&te.push("xterm-bold"),oe.isItalic()&&te.push("xterm-italic"),oe.isDim()&&te.push("xterm-dim"),z=oe.isInvisible()?g.WHITESPACE_CELL_CHAR:oe.getChars()||g.WHITESPACE_CELL_CHAR,oe.isUnderline()&&(te.push(`xterm-underline-${oe.extended.underlineStyle}`),z===" "&&(z=" "),!oe.isUnderlineColorDefault()))if(oe.isUnderlineColorRGB())x.style.textDecorationColor=`rgb(${m.AttributeData.toColorRGB(oe.getUnderlineColor()).join(",")})`;else{let be=oe.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&oe.isBold()&&be<8&&(be+=8),x.style.textDecorationColor=E.ansi[be].css}oe.isOverline()&&(te.push("xterm-overline"),z===" "&&(z=" ")),oe.isStrikethrough()&&te.push("xterm-strikethrough"),Ys&&(x.style.textDecoration="underline");let ot=oe.getFgColor(),sn=oe.getFgColorMode(),Ot=oe.getBgColor(),on=oe.getBgColorMode();const eo=!!oe.isInverse();if(eo){const be=ot;ot=Ot,Ot=be;const Rd=sn;sn=on,on=Rd}let Ui,Un,ji,an=!1;switch(this._decorationService.forEachDecorationAtCell(ue,T,void 0,be=>{be.options.layer!=="top"&&an||(be.backgroundColorRGB&&(on=50331648,Ot=be.backgroundColorRGB.rgba>>8&16777215,Ui=be.backgroundColorRGB),be.foregroundColorRGB&&(sn=50331648,ot=be.foregroundColorRGB.rgba>>8&16777215,Un=be.foregroundColorRGB),an=be.options.layer==="top")}),!an&&nn&&(Ui=this._coreBrowserService.isFocused?E.selectionBackgroundOpaque:E.selectionInactiveBackgroundOpaque,Ot=Ui.rgba>>8&16777215,on=50331648,an=!0,E.selectionForeground&&(sn=50331648,ot=E.selectionForeground.rgba>>8&16777215,Un=E.selectionForeground)),an&&te.push("xterm-decoration-top"),on){case 16777216:case 33554432:ji=E.ansi[Ot],te.push(`xterm-bg-${Ot}`);break;case 50331648:ji=v.channels.toColor(Ot>>16,Ot>>8&255,255&Ot),this._addStyle(x,`background-color:#${C((Ot>>>0).toString(16),"0",6)}`);break;default:eo?(ji=E.foreground,te.push(`xterm-bg-${h.INVERTED_DEFAULT_COLOR}`)):ji=E.background}switch(Ui||oe.isDim()&&(Ui=v.color.multiplyOpacity(ji,.5)),sn){case 16777216:case 33554432:oe.isBold()&&ot<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(ot+=8),this._applyMinimumContrast(x,ji,E.ansi[ot],oe,Ui,void 0)||te.push(`xterm-fg-${ot}`);break;case 50331648:const be=v.channels.toColor(ot>>16&255,ot>>8&255,255&ot);this._applyMinimumContrast(x,ji,be,oe,Ui,Un)||this._addStyle(x,`color:#${C(ot.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(x,ji,E.foreground,oe,Ui,Un)||eo&&te.push(`xterm-fg-${h.INVERTED_DEFAULT_COLOR}`)}te.length&&(x.className=te.join(" "),te.length=0),Qs||Se||Zs?x.textContent=z:I++,H!==this.defaultSpacing&&(x.style.letterSpacing=`${H}px`),Y.push(x),ue=Ke}return x&&I&&(x.textContent=z),Y}_applyMinimumContrast(w,T,S,k,O,L){if(this._optionsService.rawOptions.minimumContrastRatio===1||(0,d.treatGlyphAsBackgroundColor)(k.getCode()))return!1;const M=this._getContrastCache(k);let D;if(O||L||(D=M.getColor(T.rgba,S.rgba)),D===void 0){const U=this._optionsService.rawOptions.minimumContrastRatio/(k.isDim()?2:1);D=v.color.ensureContrastRatio(O||T,L||S,U),M.setColor((O||T).rgba,(L||S).rgba,D??null)}return!!D&&(this._addStyle(w,`color:${D.css}`),!0)}_getContrastCache(w){return w.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(w,T){w.setAttribute("style",`${w.getAttribute("style")||""}${T};`)}_isCellInSelection(w,T){const S=this._selectionStart,k=this._selectionEnd;return!(!S||!k)&&(this._columnSelectMode?S[0]<=k[0]?w>=S[0]&&T>=S[1]&&w<k[0]&&T<=k[1]:w<S[0]&&T>=S[1]&&w>=k[0]&&T<=k[1]:T>S[1]&&T<k[1]||S[1]===k[1]&&T===S[1]&&w>=S[0]&&w<k[0]||S[1]<k[1]&&T===k[1]&&w<k[0]||S[1]<k[1]&&T===S[1]&&w>=S[0])}};function C(w,T,S){for(;w.length<S;)w=T+w;return w}s.DomRendererRowFactory=b=l([u(1,f.ICharacterJoinerService),u(2,y.IOptionsService),u(3,f.ICoreBrowserService),u(4,y.ICoreService),u(5,y.IDecorationService),u(6,f.IThemeService)],b)},2550:(a,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.WidthCache=void 0,s.WidthCache=class{constructor(c,l){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=c.createElement("div"),this._container.classList.add("xterm-width-cache-measure-container"),this._container.setAttribute("aria-hidden","true"),this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";const u=c.createElement("span");u.classList.add("xterm-char-measure-element");const h=c.createElement("span");h.classList.add("xterm-char-measure-element"),h.style.fontWeight="bold";const g=c.createElement("span");g.classList.add("xterm-char-measure-element"),g.style.fontStyle="italic";const _=c.createElement("span");_.classList.add("xterm-char-measure-element"),_.style.fontWeight="bold",_.style.fontStyle="italic",this._measureElements=[u,h,g,_],this._container.appendChild(u),this._container.appendChild(h),this._container.appendChild(g),this._container.appendChild(_),l.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(c,l,u,h){c===this._font&&l===this._fontSize&&u===this._weight&&h===this._weightBold||(this._font=c,this._fontSize=l,this._weight=u,this._weightBold=h,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${u}`,this._measureElements[1].style.fontWeight=`${h}`,this._measureElements[2].style.fontWeight=`${u}`,this._measureElements[3].style.fontWeight=`${h}`,this.clear())}get(c,l,u){let h=0;if(!l&&!u&&c.length===1&&(h=c.charCodeAt(0))<256){if(this._flat[h]!==-9999)return this._flat[h];const y=this._measure(c,0);return y>0&&(this._flat[h]=y),y}let g=c;l&&(g+="B"),u&&(g+="I");let _=this._holey.get(g);if(_===void 0){let y=0;l&&(y|=1),u&&(y|=2),_=this._measure(c,y),_>0&&this._holey.set(g,_)}return _}_measure(c,l){const u=this._measureElements[l];return u.textContent=c.repeat(32),u.offsetWidth/32}}},2223:(a,s,c)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.TEXT_BASELINE=s.DIM_OPACITY=s.INVERTED_DEFAULT_COLOR=void 0;const l=c(6114);s.INVERTED_DEFAULT_COLOR=257,s.DIM_OPACITY=.5,s.TEXT_BASELINE=l.isFirefox||l.isLegacyEdge?"bottom":"ideographic"},6171:(a,s)=>{function c(u){return 57508<=u&&u<=57558}function l(u){return u>=128512&&u<=128591||u>=127744&&u<=128511||u>=128640&&u<=128767||u>=9728&&u<=9983||u>=9984&&u<=10175||u>=65024&&u<=65039||u>=129280&&u<=129535||u>=127462&&u<=127487}Object.defineProperty(s,"__esModule",{value:!0}),s.computeNextVariantOffset=s.createRenderDimensions=s.treatGlyphAsBackgroundColor=s.allowRescaling=s.isEmoji=s.isRestrictedPowerlineGlyph=s.isPowerlineGlyph=s.throwIfFalsy=void 0,s.throwIfFalsy=function(u){if(!u)throw new Error("value must not be falsy");return u},s.isPowerlineGlyph=c,s.isRestrictedPowerlineGlyph=function(u){return 57520<=u&&u<=57527},s.isEmoji=l,s.allowRescaling=function(u,h,g,_){return h===1&&g>Math.ceil(1.5*_)&&u!==void 0&&u>255&&!l(u)&&!c(u)&&!function(y){return 57344<=y&&y<=63743}(u)},s.treatGlyphAsBackgroundColor=function(u){return c(u)||function(h){return 9472<=h&&h<=9631}(u)},s.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}},s.computeNextVariantOffset=function(u,h,g=0){return(u-(2*Math.round(h)-g))%(2*Math.round(h))}},6052:(a,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.createSelectionRenderModel=void 0;class c{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(u,h,g,_=!1){if(this.selectionStart=h,this.selectionEnd=g,!h||!g||h[0]===g[0]&&h[1]===g[1])return void this.clear();const y=u.buffers.active.ydisp,v=h[1]-y,f=g[1]-y,p=Math.max(v,0),d=Math.min(f,u.rows-1);p>=u.rows||d<0?this.clear():(this.hasSelection=!0,this.columnSelectMode=_,this.viewportStartRow=v,this.viewportEndRow=f,this.viewportCappedStartRow=p,this.viewportCappedEndRow=d,this.startCol=h[0],this.endCol=g[0])}isCellSelected(u,h,g){return!!this.hasSelection&&(g-=u.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?h>=this.startCol&&g>=this.viewportCappedStartRow&&h<this.endCol&&g<=this.viewportCappedEndRow:h<this.startCol&&g>=this.viewportCappedStartRow&&h>=this.endCol&&g<=this.viewportCappedEndRow:g>this.viewportStartRow&&g<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&g===this.viewportStartRow&&h>=this.startCol&&h<this.endCol||this.viewportStartRow<this.viewportEndRow&&g===this.viewportEndRow&&h<this.endCol||this.viewportStartRow<this.viewportEndRow&&g===this.viewportStartRow&&h>=this.startCol)}}s.createSelectionRenderModel=function(){return new c}},456:(a,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.SelectionModel=void 0,s.SelectionModel=class{constructor(c){this._bufferService=c,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){const c=this.selectionStart[0]+this.selectionStartLength;return c>this._bufferService.cols?c%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(c/this._bufferService.cols)-1]:[c%this._bufferService.cols,this.selectionStart[1]+Math.floor(c/this._bufferService.cols)]:[c,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){const c=this.selectionStart[0]+this.selectionStartLength;return c>this._bufferService.cols?[c%this._bufferService.cols,this.selectionStart[1]+Math.floor(c/this._bufferService.cols)]:[Math.max(c,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){const c=this.selectionStart,l=this.selectionEnd;return!(!c||!l)&&(c[1]>l[1]||c[1]===l[1]&&c[0]>l[0])}handleTrim(c){return this.selectionStart&&(this.selectionStart[1]-=c),this.selectionEnd&&(this.selectionEnd[1]-=c),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(a,s,c){var l=this&&this.__decorate||function(d,m,b,C){var w,T=arguments.length,S=T<3?m:C===null?C=Object.getOwnPropertyDescriptor(m,b):C;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(d,m,b,C);else for(var k=d.length-1;k>=0;k--)(w=d[k])&&(S=(T<3?w(S):T>3?w(m,b,S):w(m,b))||S);return T>3&&S&&Object.defineProperty(m,b,S),S},u=this&&this.__param||function(d,m){return function(b,C){m(b,C,d)}};Object.defineProperty(s,"__esModule",{value:!0}),s.CharSizeService=void 0;const h=c(2585),g=c(8460),_=c(844);let y=s.CharSizeService=class extends _.Disposable{get hasValidSize(){return this.width>0&&this.height>0}constructor(d,m,b){super(),this._optionsService=b,this.width=0,this.height=0,this._onCharSizeChange=this.register(new g.EventEmitter),this.onCharSizeChange=this._onCharSizeChange.event;try{this._measureStrategy=this.register(new p(this._optionsService))}catch{this._measureStrategy=this.register(new f(d,m,this._optionsService))}this.register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],()=>this.measure()))}measure(){const d=this._measureStrategy.measure();d.width===this.width&&d.height===this.height||(this.width=d.width,this.height=d.height,this._onCharSizeChange.fire())}};s.CharSizeService=y=l([u(2,h.IOptionsService)],y);class v extends _.Disposable{constructor(){super(...arguments),this._result={width:0,height:0}}_validateAndSet(m,b){m!==void 0&&m>0&&b!==void 0&&b>0&&(this._result.width=m,this._result.height=b)}}class f extends v{constructor(m,b,C){super(),this._document=m,this._parentElement=b,this._optionsService=C,this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){return this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`,this._validateAndSet(Number(this._measureElement.offsetWidth)/32,Number(this._measureElement.offsetHeight)),this._result}}class p extends v{constructor(m){super(),this._optionsService=m,this._canvas=new OffscreenCanvas(100,100),this._ctx=this._canvas.getContext("2d");const b=this._ctx.measureText("W");if(!("width"in b&&"fontBoundingBoxAscent"in b&&"fontBoundingBoxDescent"in b))throw new Error("Required font metrics not supported")}measure(){this._ctx.font=`${this._optionsService.rawOptions.fontSize}px ${this._optionsService.rawOptions.fontFamily}`;const m=this._ctx.measureText("W");return this._validateAndSet(m.width,m.fontBoundingBoxAscent+m.fontBoundingBoxDescent),this._result}}},4269:function(a,s,c){var l=this&&this.__decorate||function(p,d,m,b){var C,w=arguments.length,T=w<3?d:b===null?b=Object.getOwnPropertyDescriptor(d,m):b;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")T=Reflect.decorate(p,d,m,b);else for(var S=p.length-1;S>=0;S--)(C=p[S])&&(T=(w<3?C(T):w>3?C(d,m,T):C(d,m))||T);return w>3&&T&&Object.defineProperty(d,m,T),T},u=this&&this.__param||function(p,d){return function(m,b){d(m,b,p)}};Object.defineProperty(s,"__esModule",{value:!0}),s.CharacterJoinerService=s.JoinedCellData=void 0;const h=c(3734),g=c(643),_=c(511),y=c(2585);class v extends h.AttributeData{constructor(d,m,b){super(),this.content=0,this.combinedData="",this.fg=d.fg,this.bg=d.bg,this.combinedData=m,this._width=b}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(d){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}s.JoinedCellData=v;let f=s.CharacterJoinerService=class gd{constructor(d){this._bufferService=d,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new _.CellData}register(d){const m={id:this._nextCharacterJoinerId++,handler:d};return this._characterJoiners.push(m),m.id}deregister(d){for(let m=0;m<this._characterJoiners.length;m++)if(this._characterJoiners[m].id===d)return this._characterJoiners.splice(m,1),!0;return!1}getJoinedCharacters(d){if(this._characterJoiners.length===0)return[];const m=this._bufferService.buffer.lines.get(d);if(!m||m.length===0)return[];const b=[],C=m.translateToString(!0);let w=0,T=0,S=0,k=m.getFg(0),O=m.getBg(0);for(let L=0;L<m.getTrimmedLength();L++)if(m.loadCell(L,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==k||this._workCell.bg!==O){if(L-w>1){const M=this._getJoinedRanges(C,S,T,m,w);for(let D=0;D<M.length;D++)b.push(M[D])}w=L,S=T,k=this._workCell.fg,O=this._workCell.bg}T+=this._workCell.getChars().length||g.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-w>1){const L=this._getJoinedRanges(C,S,T,m,w);for(let M=0;M<L.length;M++)b.push(L[M])}return b}_getJoinedRanges(d,m,b,C,w){const T=d.substring(m,b);let S=[];try{S=this._characterJoiners[0].handler(T)}catch(k){console.error(k)}for(let k=1;k<this._characterJoiners.length;k++)try{const O=this._characterJoiners[k].handler(T);for(let L=0;L<O.length;L++)gd._mergeRanges(S,O[L])}catch(O){console.error(O)}return this._stringRangesToCellRanges(S,C,w),S}_stringRangesToCellRanges(d,m,b){let C=0,w=!1,T=0,S=d[C];if(S){for(let k=b;k<this._bufferService.cols;k++){const O=m.getWidth(k),L=m.getString(k).length||g.WHITESPACE_CELL_CHAR.length;if(O!==0){if(!w&&S[0]<=T&&(S[0]=k,w=!0),S[1]<=T){if(S[1]=k,S=d[++C],!S)break;S[0]<=T?(S[0]=k,w=!0):w=!1}T+=L}}S&&(S[1]=this._bufferService.cols)}}static _mergeRanges(d,m){let b=!1;for(let C=0;C<d.length;C++){const w=d[C];if(b){if(m[1]<=w[0])return d[C-1][1]=m[1],d;if(m[1]<=w[1])return d[C-1][1]=Math.max(m[1],w[1]),d.splice(C,1),d;d.splice(C,1),C--}else{if(m[1]<=w[0])return d.splice(C,0,m),d;if(m[1]<=w[1])return w[0]=Math.min(m[0],w[0]),d;m[0]<w[1]&&(w[0]=Math.min(m[0],w[0]),b=!0)}}return b?d[d.length-1][1]=m[1]:d.push(m),d}};s.CharacterJoinerService=f=l([u(0,y.IBufferService)],f)},5114:(a,s,c)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.CoreBrowserService=void 0;const l=c(844),u=c(8460),h=c(3656);class g extends l.Disposable{constructor(v,f,p){super(),this._textarea=v,this._window=f,this.mainDocument=p,this._isFocused=!1,this._cachedIsFocused=void 0,this._screenDprMonitor=new _(this._window),this._onDprChange=this.register(new u.EventEmitter),this.onDprChange=this._onDprChange.event,this._onWindowChange=this.register(new u.EventEmitter),this.onWindowChange=this._onWindowChange.event,this.register(this.onWindowChange(d=>this._screenDprMonitor.setWindow(d))),this.register((0,u.forwardEvent)(this._screenDprMonitor.onDprChange,this._onDprChange)),this._textarea.addEventListener("focus",()=>this._isFocused=!0),this._textarea.addEventListener("blur",()=>this._isFocused=!1)}get window(){return this._window}set window(v){this._window!==v&&(this._window=v,this._onWindowChange.fire(this._window))}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(()=>this._cachedIsFocused=void 0)),this._cachedIsFocused}}s.CoreBrowserService=g;class _ extends l.Disposable{constructor(v){super(),this._parentWindow=v,this._windowResizeListener=this.register(new l.MutableDisposable),this._onDprChange=this.register(new u.EventEmitter),this.onDprChange=this._onDprChange.event,this._outerListener=()=>this._setDprAndFireIfDiffers(),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._updateDpr(),this._setWindowResizeListener(),this.register((0,l.toDisposable)(()=>this.clearListener()))}setWindow(v){this._parentWindow=v,this._setWindowResizeListener(),this._setDprAndFireIfDiffers()}_setWindowResizeListener(){this._windowResizeListener.value=(0,h.addDisposableDomListener)(this._parentWindow,"resize",()=>this._setDprAndFireIfDiffers())}_setDprAndFireIfDiffers(){this._parentWindow.devicePixelRatio!==this._currentDevicePixelRatio&&this._onDprChange.fire(this._parentWindow.devicePixelRatio),this._updateDpr()}_updateDpr(){var v;this._outerListener&&((v=this._resolutionMediaMatchList)==null||v.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._outerListener=void 0)}}},779:(a,s,c)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.LinkProviderService=void 0;const l=c(844);class u extends l.Disposable{constructor(){super(),this.linkProviders=[],this.register((0,l.toDisposable)(()=>this.linkProviders.length=0))}registerLinkProvider(g){return this.linkProviders.push(g),{dispose:()=>{const _=this.linkProviders.indexOf(g);_!==-1&&this.linkProviders.splice(_,1)}}}}s.LinkProviderService=u},8934:function(a,s,c){var l=this&&this.__decorate||function(y,v,f,p){var d,m=arguments.length,b=m<3?v:p===null?p=Object.getOwnPropertyDescriptor(v,f):p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(y,v,f,p);else for(var C=y.length-1;C>=0;C--)(d=y[C])&&(b=(m<3?d(b):m>3?d(v,f,b):d(v,f))||b);return m>3&&b&&Object.defineProperty(v,f,b),b},u=this&&this.__param||function(y,v){return function(f,p){v(f,p,y)}};Object.defineProperty(s,"__esModule",{value:!0}),s.MouseService=void 0;const h=c(4725),g=c(9806);let _=s.MouseService=class{constructor(y,v){this._renderService=y,this._charSizeService=v}getCoords(y,v,f,p,d){return(0,g.getCoords)(window,y,v,f,p,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,d)}getMouseReportCoords(y,v){const f=(0,g.getCoordsRelativeToElement)(window,y,v);if(this._charSizeService.hasValidSize)return f[0]=Math.min(Math.max(f[0],0),this._renderService.dimensions.css.canvas.width-1),f[1]=Math.min(Math.max(f[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(f[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(f[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(f[0]),y:Math.floor(f[1])}}};s.MouseService=_=l([u(0,h.IRenderService),u(1,h.ICharSizeService)],_)},3230:function(a,s,c){var l=this&&this.__decorate||function(d,m,b,C){var w,T=arguments.length,S=T<3?m:C===null?C=Object.getOwnPropertyDescriptor(m,b):C;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(d,m,b,C);else for(var k=d.length-1;k>=0;k--)(w=d[k])&&(S=(T<3?w(S):T>3?w(m,b,S):w(m,b))||S);return T>3&&S&&Object.defineProperty(m,b,S),S},u=this&&this.__param||function(d,m){return function(b,C){m(b,C,d)}};Object.defineProperty(s,"__esModule",{value:!0}),s.RenderService=void 0;const h=c(6193),g=c(4725),_=c(8460),y=c(844),v=c(7226),f=c(2585);let p=s.RenderService=class extends y.Disposable{get dimensions(){return this._renderer.value.dimensions}constructor(d,m,b,C,w,T,S,k){super(),this._rowCount=d,this._charSizeService=C,this._renderer=this.register(new y.MutableDisposable),this._pausedResizeTask=new v.DebouncedIdleTask,this._observerDisposable=this.register(new y.MutableDisposable),this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this.register(new _.EventEmitter),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this.register(new _.EventEmitter),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this.register(new _.EventEmitter),this.onRender=this._onRender.event,this._onRefreshRequest=this.register(new _.EventEmitter),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new h.RenderDebouncer((O,L)=>this._renderRows(O,L),S),this.register(this._renderDebouncer),this.register(S.onDprChange(()=>this.handleDevicePixelRatioChange())),this.register(T.onResize(()=>this._fullRefresh())),this.register(T.buffers.onBufferActivate(()=>{var O;return(O=this._renderer.value)==null?void 0:O.clear()})),this.register(b.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._charSizeService.onCharSizeChange(()=>this.handleCharSizeChanged())),this.register(w.onDecorationRegistered(()=>this._fullRefresh())),this.register(w.onDecorationRemoved(()=>this._fullRefresh())),this.register(b.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio","rescaleOverlappingGlyphs"],()=>{this.clear(),this.handleResize(T.cols,T.rows),this._fullRefresh()})),this.register(b.onMultipleOptionChange(["cursorBlink","cursorStyle"],()=>this.refreshRows(T.buffer.y,T.buffer.y,!0))),this.register(k.onChangeColors(()=>this._fullRefresh())),this._registerIntersectionObserver(S.window,m),this.register(S.onWindowChange(O=>this._registerIntersectionObserver(O,m)))}_registerIntersectionObserver(d,m){if("IntersectionObserver"in d){const b=new d.IntersectionObserver(C=>this._handleIntersectionChange(C[C.length-1]),{threshold:0});b.observe(m),this._observerDisposable.value=(0,y.toDisposable)(()=>b.disconnect())}}_handleIntersectionChange(d){this._isPaused=d.isIntersecting===void 0?d.intersectionRatio===0:!d.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(d,m,b=!1){this._isPaused?this._needsFullRefresh=!0:(b||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(d,m,this._rowCount))}_renderRows(d,m){this._renderer.value&&(d=Math.min(d,this._rowCount-1),m=Math.min(m,this._rowCount-1),this._renderer.value.renderRows(d,m),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:d,end:m}),this._onRender.fire({start:d,end:m}),this._isNextRenderRedrawOnly=!0)}resize(d,m){this._rowCount=m,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(d){this._renderer.value=d,this._renderer.value&&(this._renderer.value.onRequestRedraw(m=>this.refreshRows(m.start,m.end,!0)),this._needsSelectionRefresh=!0,this._fullRefresh())}addRefreshCallback(d){return this._renderDebouncer.addRefreshCallback(d)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){var d,m;this._renderer.value&&((m=(d=this._renderer.value).clearTextureAtlas)==null||m.call(d),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(d,m){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set(()=>{var b;return(b=this._renderer.value)==null?void 0:b.handleResize(d,m)}):this._renderer.value.handleResize(d,m),this._fullRefresh())}handleCharSizeChanged(){var d;(d=this._renderer.value)==null||d.handleCharSizeChanged()}handleBlur(){var d;(d=this._renderer.value)==null||d.handleBlur()}handleFocus(){var d;(d=this._renderer.value)==null||d.handleFocus()}handleSelectionChanged(d,m,b){var C;this._selectionState.start=d,this._selectionState.end=m,this._selectionState.columnSelectMode=b,(C=this._renderer.value)==null||C.handleSelectionChanged(d,m,b)}handleCursorMove(){var d;(d=this._renderer.value)==null||d.handleCursorMove()}clear(){var d;(d=this._renderer.value)==null||d.clear()}};s.RenderService=p=l([u(2,f.IOptionsService),u(3,g.ICharSizeService),u(4,f.IDecorationService),u(5,f.IBufferService),u(6,g.ICoreBrowserService),u(7,g.IThemeService)],p)},9312:function(a,s,c){var l=this&&this.__decorate||function(S,k,O,L){var M,D=arguments.length,U=D<3?k:L===null?L=Object.getOwnPropertyDescriptor(k,O):L;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")U=Reflect.decorate(S,k,O,L);else for(var q=S.length-1;q>=0;q--)(M=S[q])&&(U=(D<3?M(U):D>3?M(k,O,U):M(k,O))||U);return D>3&&U&&Object.defineProperty(k,O,U),U},u=this&&this.__param||function(S,k){return function(O,L){k(O,L,S)}};Object.defineProperty(s,"__esModule",{value:!0}),s.SelectionService=void 0;const h=c(9806),g=c(9504),_=c(456),y=c(4725),v=c(8460),f=c(844),p=c(6114),d=c(4841),m=c(511),b=c(2585),C=String.fromCharCode(160),w=new RegExp(C,"g");let T=s.SelectionService=class extends f.Disposable{constructor(S,k,O,L,M,D,U,q,X){super(),this._element=S,this._screenElement=k,this._linkifier=O,this._bufferService=L,this._coreService=M,this._mouseService=D,this._optionsService=U,this._renderService=q,this._coreBrowserService=X,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new m.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new v.EventEmitter),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this.register(new v.EventEmitter),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this.register(new v.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this.register(new v.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=Y=>this._handleMouseMove(Y),this._mouseUpListener=Y=>this._handleMouseUp(Y),this._coreService.onUserInput(()=>{this.hasSelection&&this.clearSelection()}),this._trimListener=this._bufferService.buffer.lines.onTrim(Y=>this._handleTrim(Y)),this.register(this._bufferService.buffers.onBufferActivate(Y=>this._handleBufferActivate(Y))),this.enable(),this._model=new _.SelectionModel(this._bufferService),this._activeSelectionMode=0,this.register((0,f.toDisposable)(()=>{this._removeMouseDownListeners()}))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){const S=this._model.finalSelectionStart,k=this._model.finalSelectionEnd;return!(!S||!k||S[0]===k[0]&&S[1]===k[1])}get selectionText(){const S=this._model.finalSelectionStart,k=this._model.finalSelectionEnd;if(!S||!k)return"";const O=this._bufferService.buffer,L=[];if(this._activeSelectionMode===3){if(S[0]===k[0])return"";const M=S[0]<k[0]?S[0]:k[0],D=S[0]<k[0]?k[0]:S[0];for(let U=S[1];U<=k[1];U++){const q=O.translateBufferLineToString(U,!0,M,D);L.push(q)}}else{const M=S[1]===k[1]?k[0]:void 0;L.push(O.translateBufferLineToString(S[1],!0,S[0],M));for(let D=S[1]+1;D<=k[1]-1;D++){const U=O.lines.get(D),q=O.translateBufferLineToString(D,!0);U!=null&&U.isWrapped?L[L.length-1]+=q:L.push(q)}if(S[1]!==k[1]){const D=O.lines.get(k[1]),U=O.translateBufferLineToString(k[1],!0,0,k[0]);D&&D.isWrapped?L[L.length-1]+=U:L.push(U)}}return L.map(M=>M.replace(w," ")).join(p.isWindows?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(S){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._refresh())),p.isLinux&&S&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(S){const k=this._getMouseBufferCoords(S),O=this._model.finalSelectionStart,L=this._model.finalSelectionEnd;return!!(O&&L&&k)&&this._areCoordsInSelection(k,O,L)}isCellInSelection(S,k){const O=this._model.finalSelectionStart,L=this._model.finalSelectionEnd;return!(!O||!L)&&this._areCoordsInSelection([S,k],O,L)}_areCoordsInSelection(S,k,O){return S[1]>k[1]&&S[1]<O[1]||k[1]===O[1]&&S[1]===k[1]&&S[0]>=k[0]&&S[0]<O[0]||k[1]<O[1]&&S[1]===O[1]&&S[0]<O[0]||k[1]<O[1]&&S[1]===k[1]&&S[0]>=k[0]}_selectWordAtCursor(S,k){var M,D;const O=(D=(M=this._linkifier.currentLink)==null?void 0:M.link)==null?void 0:D.range;if(O)return this._model.selectionStart=[O.start.x-1,O.start.y-1],this._model.selectionStartLength=(0,d.getRangeLength)(O,this._bufferService.cols),this._model.selectionEnd=void 0,!0;const L=this._getMouseBufferCoords(S);return!!L&&(this._selectWordAt(L,k),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(S,k){this._model.clearSelection(),S=Math.max(S,0),k=Math.min(k,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,S],this._model.selectionEnd=[this._bufferService.cols,k],this.refresh(),this._onSelectionChange.fire()}_handleTrim(S){this._model.handleTrim(S)&&this.refresh()}_getMouseBufferCoords(S){const k=this._mouseService.getCoords(S,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(k)return k[0]--,k[1]--,k[1]+=this._bufferService.buffer.ydisp,k}_getMouseEventScrollAmount(S){let k=(0,h.getCoordsRelativeToElement)(this._coreBrowserService.window,S,this._screenElement)[1];const O=this._renderService.dimensions.css.canvas.height;return k>=0&&k<=O?0:(k>O&&(k-=O),k=Math.min(Math.max(k,-50),50),k/=50,k/Math.abs(k)+Math.round(14*k))}shouldForceSelection(S){return p.isMac?S.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:S.shiftKey}handleMouseDown(S){if(this._mouseDownTimeStamp=S.timeStamp,(S.button!==2||!this.hasSelection)&&S.button===0){if(!this._enabled){if(!this.shouldForceSelection(S))return;S.stopPropagation()}S.preventDefault(),this._dragScrollAmount=0,this._enabled&&S.shiftKey?this._handleIncrementalClick(S):S.detail===1?this._handleSingleClick(S):S.detail===2?this._handleDoubleClick(S):S.detail===3&&this._handleTripleClick(S),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(()=>this._dragScroll(),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(S){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(S))}_handleSingleClick(S){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(S)?3:0,this._model.selectionStart=this._getMouseBufferCoords(S),!this._model.selectionStart)return;this._model.selectionEnd=void 0;const k=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);k&&k.length!==this._model.selectionStart[0]&&k.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(S){this._selectWordAtCursor(S,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(S){const k=this._getMouseBufferCoords(S);k&&(this._activeSelectionMode=2,this._selectLineAt(k[1]))}shouldColumnSelect(S){return S.altKey&&!(p.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(S){if(S.stopImmediatePropagation(),!this._model.selectionStart)return;const k=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(S),!this._model.selectionEnd)return void this.refresh(!0);this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(S),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));const O=this._bufferService.buffer;if(this._model.selectionEnd[1]<O.lines.length){const L=O.lines.get(this._model.selectionEnd[1]);L&&L.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]<this._bufferService.cols&&this._model.selectionEnd[0]++}k&&k[0]===this._model.selectionEnd[0]&&k[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});const S=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(S.ydisp+this._bufferService.rows,S.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=S.ydisp),this.refresh()}}_handleMouseUp(S){const k=S.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&k<500&&S.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){const O=this._mouseService.getCoords(S,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(O&&O[0]!==void 0&&O[1]!==void 0){const L=(0,g.moveToCellSequence)(O[0]-1,O[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(L,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){const S=this._model.finalSelectionStart,k=this._model.finalSelectionEnd,O=!(!S||!k||S[0]===k[0]&&S[1]===k[1]);O?S&&k&&(this._oldSelectionStart&&this._oldSelectionEnd&&S[0]===this._oldSelectionStart[0]&&S[1]===this._oldSelectionStart[1]&&k[0]===this._oldSelectionEnd[0]&&k[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(S,k,O)):this._oldHasSelection&&this._fireOnSelectionChange(S,k,O)}_fireOnSelectionChange(S,k,O){this._oldSelectionStart=S,this._oldSelectionEnd=k,this._oldHasSelection=O,this._onSelectionChange.fire()}_handleBufferActivate(S){this.clearSelection(),this._trimListener.dispose(),this._trimListener=S.activeBuffer.lines.onTrim(k=>this._handleTrim(k))}_convertViewportColToCharacterIndex(S,k){let O=k;for(let L=0;k>=L;L++){const M=S.loadCell(L,this._workCell).getChars().length;this._workCell.getWidth()===0?O--:M>1&&k!==L&&(O+=M-1)}return O}setSelection(S,k,O){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[S,k],this._model.selectionStartLength=O,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(S){this._isClickInSelection(S)||(this._selectWordAtCursor(S,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(S,k,O=!0,L=!0){if(S[0]>=this._bufferService.cols)return;const M=this._bufferService.buffer,D=M.lines.get(S[1]);if(!D)return;const U=M.translateBufferLineToString(S[1],!1);let q=this._convertViewportColToCharacterIndex(D,S[0]),X=q;const Y=S[0]-q;let F=0,E=0,x=0,A=0;if(U.charAt(q)===" "){for(;q>0&&U.charAt(q-1)===" ";)q--;for(;X<U.length&&U.charAt(X+1)===" ";)X++}else{let Q=S[0],ne=S[0];D.getWidth(Q)===0&&(F++,Q--),D.getWidth(ne)===2&&(E++,ne++);const se=D.getString(ne).length;for(se>1&&(A+=se-1,X+=se-1);Q>0&&q>0&&!this._isCharWordSeparator(D.loadCell(Q-1,this._workCell));){D.loadCell(Q-1,this._workCell);const B=this._workCell.getChars().length;this._workCell.getWidth()===0?(F++,Q--):B>1&&(x+=B-1,q-=B-1),q--,Q--}for(;ne<D.length&&X+1<U.length&&!this._isCharWordSeparator(D.loadCell(ne+1,this._workCell));){D.loadCell(ne+1,this._workCell);const B=this._workCell.getChars().length;this._workCell.getWidth()===2?(E++,ne++):B>1&&(A+=B-1,X+=B-1),X++,ne++}}X++;let I=q+Y-F+x,z=Math.min(this._bufferService.cols,X-q+F+E-x-A);if(k||U.slice(q,X).trim()!==""){if(O&&I===0&&D.getCodePoint(0)!==32){const Q=M.lines.get(S[1]-1);if(Q&&D.isWrapped&&Q.getCodePoint(this._bufferService.cols-1)!==32){const ne=this._getWordAt([this._bufferService.cols-1,S[1]-1],!1,!0,!1);if(ne){const se=this._bufferService.cols-ne.start;I-=se,z+=se}}}if(L&&I+z===this._bufferService.cols&&D.getCodePoint(this._bufferService.cols-1)!==32){const Q=M.lines.get(S[1]+1);if(Q!=null&&Q.isWrapped&&Q.getCodePoint(0)!==32){const ne=this._getWordAt([0,S[1]+1],!1,!1,!0);ne&&(z+=ne.length)}}return{start:I,length:z}}}_selectWordAt(S,k){const O=this._getWordAt(S,k);if(O){for(;O.start<0;)O.start+=this._bufferService.cols,S[1]--;this._model.selectionStart=[O.start,S[1]],this._model.selectionStartLength=O.length}}_selectToWordAt(S){const k=this._getWordAt(S,!0);if(k){let O=S[1];for(;k.start<0;)k.start+=this._bufferService.cols,O--;if(!this._model.areSelectionValuesReversed())for(;k.start+k.length>this._bufferService.cols;)k.length-=this._bufferService.cols,O++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?k.start:k.start+k.length,O]}}_isCharWordSeparator(S){return S.getWidth()!==0&&this._optionsService.rawOptions.wordSeparator.indexOf(S.getChars())>=0}_selectLineAt(S){const k=this._bufferService.buffer.getWrappedRangeForLine(S),O={start:{x:0,y:k.first},end:{x:this._bufferService.cols-1,y:k.last}};this._model.selectionStart=[0,k.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,d.getRangeLength)(O,this._bufferService.cols)}};s.SelectionService=T=l([u(3,b.IBufferService),u(4,b.ICoreService),u(5,y.IMouseService),u(6,b.IOptionsService),u(7,y.IRenderService),u(8,y.ICoreBrowserService)],T)},4725:(a,s,c)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.ILinkProviderService=s.IThemeService=s.ICharacterJoinerService=s.ISelectionService=s.IRenderService=s.IMouseService=s.ICoreBrowserService=s.ICharSizeService=void 0;const l=c(8343);s.ICharSizeService=(0,l.createDecorator)("CharSizeService"),s.ICoreBrowserService=(0,l.createDecorator)("CoreBrowserService"),s.IMouseService=(0,l.createDecorator)("MouseService"),s.IRenderService=(0,l.createDecorator)("RenderService"),s.ISelectionService=(0,l.createDecorator)("SelectionService"),s.ICharacterJoinerService=(0,l.createDecorator)("CharacterJoinerService"),s.IThemeService=(0,l.createDecorator)("ThemeService"),s.ILinkProviderService=(0,l.createDecorator)("LinkProviderService")},6731:function(a,s,c){var l=this&&this.__decorate||function(T,S,k,O){var L,M=arguments.length,D=M<3?S:O===null?O=Object.getOwnPropertyDescriptor(S,k):O;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")D=Reflect.decorate(T,S,k,O);else for(var U=T.length-1;U>=0;U--)(L=T[U])&&(D=(M<3?L(D):M>3?L(S,k,D):L(S,k))||D);return M>3&&D&&Object.defineProperty(S,k,D),D},u=this&&this.__param||function(T,S){return function(k,O){S(k,O,T)}};Object.defineProperty(s,"__esModule",{value:!0}),s.ThemeService=s.DEFAULT_ANSI_COLORS=void 0;const h=c(7239),g=c(8055),_=c(8460),y=c(844),v=c(2585),f=g.css.toColor("#ffffff"),p=g.css.toColor("#000000"),d=g.css.toColor("#ffffff"),m=g.css.toColor("#000000"),b={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};s.DEFAULT_ANSI_COLORS=Object.freeze((()=>{const T=[g.css.toColor("#2e3436"),g.css.toColor("#cc0000"),g.css.toColor("#4e9a06"),g.css.toColor("#c4a000"),g.css.toColor("#3465a4"),g.css.toColor("#75507b"),g.css.toColor("#06989a"),g.css.toColor("#d3d7cf"),g.css.toColor("#555753"),g.css.toColor("#ef2929"),g.css.toColor("#8ae234"),g.css.toColor("#fce94f"),g.css.toColor("#729fcf"),g.css.toColor("#ad7fa8"),g.css.toColor("#34e2e2"),g.css.toColor("#eeeeec")],S=[0,95,135,175,215,255];for(let k=0;k<216;k++){const O=S[k/36%6|0],L=S[k/6%6|0],M=S[k%6];T.push({css:g.channels.toCss(O,L,M),rgba:g.channels.toRgba(O,L,M)})}for(let k=0;k<24;k++){const O=8+10*k;T.push({css:g.channels.toCss(O,O,O),rgba:g.channels.toRgba(O,O,O)})}return T})());let C=s.ThemeService=class extends y.Disposable{get colors(){return this._colors}constructor(T){super(),this._optionsService=T,this._contrastCache=new h.ColorContrastCache,this._halfContrastCache=new h.ColorContrastCache,this._onChangeColors=this.register(new _.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:f,background:p,cursor:d,cursorAccent:m,selectionForeground:void 0,selectionBackgroundTransparent:b,selectionBackgroundOpaque:g.color.blend(p,b),selectionInactiveBackgroundTransparent:b,selectionInactiveBackgroundOpaque:g.color.blend(p,b),ansi:s.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",()=>this._contrastCache.clear())),this.register(this._optionsService.onSpecificOptionChange("theme",()=>this._setTheme(this._optionsService.rawOptions.theme)))}_setTheme(T={}){const S=this._colors;if(S.foreground=w(T.foreground,f),S.background=w(T.background,p),S.cursor=w(T.cursor,d),S.cursorAccent=w(T.cursorAccent,m),S.selectionBackgroundTransparent=w(T.selectionBackground,b),S.selectionBackgroundOpaque=g.color.blend(S.background,S.selectionBackgroundTransparent),S.selectionInactiveBackgroundTransparent=w(T.selectionInactiveBackground,S.selectionBackgroundTransparent),S.selectionInactiveBackgroundOpaque=g.color.blend(S.background,S.selectionInactiveBackgroundTransparent),S.selectionForeground=T.selectionForeground?w(T.selectionForeground,g.NULL_COLOR):void 0,S.selectionForeground===g.NULL_COLOR&&(S.selectionForeground=void 0),g.color.isOpaque(S.selectionBackgroundTransparent)&&(S.selectionBackgroundTransparent=g.color.opacity(S.selectionBackgroundTransparent,.3)),g.color.isOpaque(S.selectionInactiveBackgroundTransparent)&&(S.selectionInactiveBackgroundTransparent=g.color.opacity(S.selectionInactiveBackgroundTransparent,.3)),S.ansi=s.DEFAULT_ANSI_COLORS.slice(),S.ansi[0]=w(T.black,s.DEFAULT_ANSI_COLORS[0]),S.ansi[1]=w(T.red,s.DEFAULT_ANSI_COLORS[1]),S.ansi[2]=w(T.green,s.DEFAULT_ANSI_COLORS[2]),S.ansi[3]=w(T.yellow,s.DEFAULT_ANSI_COLORS[3]),S.ansi[4]=w(T.blue,s.DEFAULT_ANSI_COLORS[4]),S.ansi[5]=w(T.magenta,s.DEFAULT_ANSI_COLORS[5]),S.ansi[6]=w(T.cyan,s.DEFAULT_ANSI_COLORS[6]),S.ansi[7]=w(T.white,s.DEFAULT_ANSI_COLORS[7]),S.ansi[8]=w(T.brightBlack,s.DEFAULT_ANSI_COLORS[8]),S.ansi[9]=w(T.brightRed,s.DEFAULT_ANSI_COLORS[9]),S.ansi[10]=w(T.brightGreen,s.DEFAULT_ANSI_COLORS[10]),S.ansi[11]=w(T.brightYellow,s.DEFAULT_ANSI_COLORS[11]),S.ansi[12]=w(T.brightBlue,s.DEFAULT_ANSI_COLORS[12]),S.ansi[13]=w(T.brightMagenta,s.DEFAULT_ANSI_COLORS[13]),S.ansi[14]=w(T.brightCyan,s.DEFAULT_ANSI_COLORS[14]),S.ansi[15]=w(T.brightWhite,s.DEFAULT_ANSI_COLORS[15]),T.extendedAnsi){const k=Math.min(S.ansi.length-16,T.extendedAnsi.length);for(let O=0;O<k;O++)S.ansi[O+16]=w(T.extendedAnsi[O],s.DEFAULT_ANSI_COLORS[O+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(T){this._restoreColor(T),this._onChangeColors.fire(this.colors)}_restoreColor(T){if(T!==void 0)switch(T){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[T]=this._restoreColors.ansi[T]}else for(let S=0;S<this._restoreColors.ansi.length;++S)this._colors.ansi[S]=this._restoreColors.ansi[S]}modifyColors(T){T(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function w(T,S){if(T!==void 0)try{return g.css.toColor(T)}catch{}return S}s.ThemeService=C=l([u(0,v.IOptionsService)],C)},6349:(a,s,c)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.CircularList=void 0;const l=c(8460),u=c(844);class h extends u.Disposable{constructor(_){super(),this._maxLength=_,this.onDeleteEmitter=this.register(new l.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new l.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new l.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(_){if(this._maxLength===_)return;const y=new Array(_);for(let v=0;v<Math.min(_,this.length);v++)y[v]=this._array[this._getCyclicIndex(v)];this._array=y,this._maxLength=_,this._startIndex=0}get length(){return this._length}set length(_){if(_>this._length)for(let y=this._length;y<_;y++)this._array[y]=void 0;this._length=_}get(_){return this._array[this._getCyclicIndex(_)]}set(_,y){this._array[this._getCyclicIndex(_)]=y}push(_){this._array[this._getCyclicIndex(this._length)]=_,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(_,y,...v){if(y){for(let f=_;f<this._length-y;f++)this._array[this._getCyclicIndex(f)]=this._array[this._getCyclicIndex(f+y)];this._length-=y,this.onDeleteEmitter.fire({index:_,amount:y})}for(let f=this._length-1;f>=_;f--)this._array[this._getCyclicIndex(f+v.length)]=this._array[this._getCyclicIndex(f)];for(let f=0;f<v.length;f++)this._array[this._getCyclicIndex(_+f)]=v[f];if(v.length&&this.onInsertEmitter.fire({index:_,amount:v.length}),this._length+v.length>this._maxLength){const f=this._length+v.length-this._maxLength;this._startIndex+=f,this._length=this._maxLength,this.onTrimEmitter.fire(f)}else this._length+=v.length}trimStart(_){_>this._length&&(_=this._length),this._startIndex+=_,this._length-=_,this.onTrimEmitter.fire(_)}shiftElements(_,y,v){if(!(y<=0)){if(_<0||_>=this._length)throw new Error("start argument out of range");if(_+v<0)throw new Error("Cannot shift elements in list beyond index 0");if(v>0){for(let p=y-1;p>=0;p--)this.set(_+p+v,this.get(_+p));const f=_+y+v-this._length;if(f>0)for(this._length+=f;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let f=0;f<y;f++)this.set(_+f+v,this.get(_+f))}}_getCyclicIndex(_){return(this._startIndex+_)%this._maxLength}}s.CircularList=h},1439:(a,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.clone=void 0,s.clone=function c(l,u=5){if(typeof l!="object")return l;const h=Array.isArray(l)?[]:{};for(const g in l)h[g]=u<=1?l[g]:l[g]&&c(l[g],u-1);return h}},8055:(a,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.contrastRatio=s.toPaddedHex=s.rgba=s.rgb=s.css=s.color=s.channels=s.NULL_COLOR=void 0;let c=0,l=0,u=0,h=0;var g,_,y,v,f;function p(m){const b=m.toString(16);return b.length<2?"0"+b:b}function d(m,b){return m<b?(b+.05)/(m+.05):(m+.05)/(b+.05)}s.NULL_COLOR={css:"#00000000",rgba:0},function(m){m.toCss=function(b,C,w,T){return T!==void 0?`#${p(b)}${p(C)}${p(w)}${p(T)}`:`#${p(b)}${p(C)}${p(w)}`},m.toRgba=function(b,C,w,T=255){return(b<<24|C<<16|w<<8|T)>>>0},m.toColor=function(b,C,w,T){return{css:m.toCss(b,C,w,T),rgba:m.toRgba(b,C,w,T)}}}(g||(s.channels=g={})),function(m){function b(C,w){return h=Math.round(255*w),[c,l,u]=f.toChannels(C.rgba),{css:g.toCss(c,l,u,h),rgba:g.toRgba(c,l,u,h)}}m.blend=function(C,w){if(h=(255&w.rgba)/255,h===1)return{css:w.css,rgba:w.rgba};const T=w.rgba>>24&255,S=w.rgba>>16&255,k=w.rgba>>8&255,O=C.rgba>>24&255,L=C.rgba>>16&255,M=C.rgba>>8&255;return c=O+Math.round((T-O)*h),l=L+Math.round((S-L)*h),u=M+Math.round((k-M)*h),{css:g.toCss(c,l,u),rgba:g.toRgba(c,l,u)}},m.isOpaque=function(C){return(255&C.rgba)==255},m.ensureContrastRatio=function(C,w,T){const S=f.ensureContrastRatio(C.rgba,w.rgba,T);if(S)return g.toColor(S>>24&255,S>>16&255,S>>8&255)},m.opaque=function(C){const w=(255|C.rgba)>>>0;return[c,l,u]=f.toChannels(w),{css:g.toCss(c,l,u),rgba:w}},m.opacity=b,m.multiplyOpacity=function(C,w){return h=255&C.rgba,b(C,h*w/255)},m.toColorRGB=function(C){return[C.rgba>>24&255,C.rgba>>16&255,C.rgba>>8&255]}}(_||(s.color=_={})),function(m){let b,C;try{const w=document.createElement("canvas");w.width=1,w.height=1;const T=w.getContext("2d",{willReadFrequently:!0});T&&(b=T,b.globalCompositeOperation="copy",C=b.createLinearGradient(0,0,1,1))}catch{}m.toColor=function(w){if(w.match(/#[\da-f]{3,8}/i))switch(w.length){case 4:return c=parseInt(w.slice(1,2).repeat(2),16),l=parseInt(w.slice(2,3).repeat(2),16),u=parseInt(w.slice(3,4).repeat(2),16),g.toColor(c,l,u);case 5:return c=parseInt(w.slice(1,2).repeat(2),16),l=parseInt(w.slice(2,3).repeat(2),16),u=parseInt(w.slice(3,4).repeat(2),16),h=parseInt(w.slice(4,5).repeat(2),16),g.toColor(c,l,u,h);case 7:return{css:w,rgba:(parseInt(w.slice(1),16)<<8|255)>>>0};case 9:return{css:w,rgba:parseInt(w.slice(1),16)>>>0}}const T=w.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(T)return c=parseInt(T[1]),l=parseInt(T[2]),u=parseInt(T[3]),h=Math.round(255*(T[5]===void 0?1:parseFloat(T[5]))),g.toColor(c,l,u,h);if(!b||!C)throw new Error("css.toColor: Unsupported css format");if(b.fillStyle=C,b.fillStyle=w,typeof b.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(b.fillRect(0,0,1,1),[c,l,u,h]=b.getImageData(0,0,1,1).data,h!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:g.toRgba(c,l,u,h),css:w}}}(y||(s.css=y={})),function(m){function b(C,w,T){const S=C/255,k=w/255,O=T/255;return .2126*(S<=.03928?S/12.92:Math.pow((S+.055)/1.055,2.4))+.7152*(k<=.03928?k/12.92:Math.pow((k+.055)/1.055,2.4))+.0722*(O<=.03928?O/12.92:Math.pow((O+.055)/1.055,2.4))}m.relativeLuminance=function(C){return b(C>>16&255,C>>8&255,255&C)},m.relativeLuminance2=b}(v||(s.rgb=v={})),function(m){function b(w,T,S){const k=w>>24&255,O=w>>16&255,L=w>>8&255;let M=T>>24&255,D=T>>16&255,U=T>>8&255,q=d(v.relativeLuminance2(M,D,U),v.relativeLuminance2(k,O,L));for(;q<S&&(M>0||D>0||U>0);)M-=Math.max(0,Math.ceil(.1*M)),D-=Math.max(0,Math.ceil(.1*D)),U-=Math.max(0,Math.ceil(.1*U)),q=d(v.relativeLuminance2(M,D,U),v.relativeLuminance2(k,O,L));return(M<<24|D<<16|U<<8|255)>>>0}function C(w,T,S){const k=w>>24&255,O=w>>16&255,L=w>>8&255;let M=T>>24&255,D=T>>16&255,U=T>>8&255,q=d(v.relativeLuminance2(M,D,U),v.relativeLuminance2(k,O,L));for(;q<S&&(M<255||D<255||U<255);)M=Math.min(255,M+Math.ceil(.1*(255-M))),D=Math.min(255,D+Math.ceil(.1*(255-D))),U=Math.min(255,U+Math.ceil(.1*(255-U))),q=d(v.relativeLuminance2(M,D,U),v.relativeLuminance2(k,O,L));return(M<<24|D<<16|U<<8|255)>>>0}m.blend=function(w,T){if(h=(255&T)/255,h===1)return T;const S=T>>24&255,k=T>>16&255,O=T>>8&255,L=w>>24&255,M=w>>16&255,D=w>>8&255;return c=L+Math.round((S-L)*h),l=M+Math.round((k-M)*h),u=D+Math.round((O-D)*h),g.toRgba(c,l,u)},m.ensureContrastRatio=function(w,T,S){const k=v.relativeLuminance(w>>8),O=v.relativeLuminance(T>>8);if(d(k,O)<S){if(O<k){const D=b(w,T,S),U=d(k,v.relativeLuminance(D>>8));if(U<S){const q=C(w,T,S);return U>d(k,v.relativeLuminance(q>>8))?D:q}return D}const L=C(w,T,S),M=d(k,v.relativeLuminance(L>>8));if(M<S){const D=b(w,T,S);return M>d(k,v.relativeLuminance(D>>8))?L:D}return L}},m.reduceLuminance=b,m.increaseLuminance=C,m.toChannels=function(w){return[w>>24&255,w>>16&255,w>>8&255,255&w]}}(f||(s.rgba=f={})),s.toPaddedHex=p,s.contrastRatio=d},8969:(a,s,c)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.CoreTerminal=void 0;const l=c(844),u=c(2585),h=c(4348),g=c(7866),_=c(744),y=c(7302),v=c(6975),f=c(8460),p=c(1753),d=c(1480),m=c(7994),b=c(9282),C=c(5435),w=c(5981),T=c(2660);let S=!1;class k extends l.Disposable{get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new f.EventEmitter),this._onScroll.event(L=>{var M;(M=this._onScrollApi)==null||M.fire(L.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(L){for(const M in L)this.optionsService.options[M]=L[M]}constructor(L){super(),this._windowsWrappingHeuristics=this.register(new l.MutableDisposable),this._onBinary=this.register(new f.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new f.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new f.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new f.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new f.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new f.EventEmitter),this._instantiationService=new h.InstantiationService,this.optionsService=this.register(new y.OptionsService(L)),this._instantiationService.setService(u.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(_.BufferService)),this._instantiationService.setService(u.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(g.LogService)),this._instantiationService.setService(u.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(v.CoreService)),this._instantiationService.setService(u.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(p.CoreMouseService)),this._instantiationService.setService(u.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(d.UnicodeService)),this._instantiationService.setService(u.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(m.CharsetService),this._instantiationService.setService(u.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(T.OscLinkService),this._instantiationService.setService(u.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new C.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,f.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,f.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,f.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,f.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom())),this.register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this.register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],()=>this._handleWindowsPtyOptionChange())),this.register(this._bufferService.onScroll(M=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this.register(this._inputHandler.onScroll(M=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this.register(new w.WriteBuffer((M,D)=>this._inputHandler.parse(M,D))),this.register((0,f.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed))}write(L,M){this._writeBuffer.write(L,M)}writeSync(L,M){this._logService.logLevel<=u.LogLevelEnum.WARN&&!S&&(this._logService.warn("writeSync is unreliable and will be removed soon."),S=!0),this._writeBuffer.writeSync(L,M)}input(L,M=!0){this.coreService.triggerDataEvent(L,M)}resize(L,M){isNaN(L)||isNaN(M)||(L=Math.max(L,_.MINIMUM_COLS),M=Math.max(M,_.MINIMUM_ROWS),this._bufferService.resize(L,M))}scroll(L,M=!1){this._bufferService.scroll(L,M)}scrollLines(L,M,D){this._bufferService.scrollLines(L,M,D)}scrollPages(L){this.scrollLines(L*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(L){const M=L-this._bufferService.buffer.ydisp;M!==0&&this.scrollLines(M)}registerEscHandler(L,M){return this._inputHandler.registerEscHandler(L,M)}registerDcsHandler(L,M){return this._inputHandler.registerDcsHandler(L,M)}registerCsiHandler(L,M){return this._inputHandler.registerCsiHandler(L,M)}registerOscHandler(L,M){return this._inputHandler.registerOscHandler(L,M)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let L=!1;const M=this.optionsService.rawOptions.windowsPty;M&&M.buildNumber!==void 0&&M.buildNumber!==void 0?L=M.backend==="conpty"&&M.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(L=!0),L?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){const L=[];L.push(this.onLineFeed(b.updateWindowsModeWrappedState.bind(null,this._bufferService))),L.push(this.registerCsiHandler({final:"H"},()=>((0,b.updateWindowsModeWrappedState)(this._bufferService),!1))),this._windowsWrappingHeuristics.value=(0,l.toDisposable)(()=>{for(const M of L)M.dispose()})}}}s.CoreTerminal=k},8460:(a,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.runAndSubscribe=s.forwardEvent=s.EventEmitter=void 0,s.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=c=>(this._listeners.push(c),{dispose:()=>{if(!this._disposed){for(let l=0;l<this._listeners.length;l++)if(this._listeners[l]===c)return void this._listeners.splice(l,1)}}})),this._event}fire(c,l){const u=[];for(let h=0;h<this._listeners.length;h++)u.push(this._listeners[h]);for(let h=0;h<u.length;h++)u[h].call(void 0,c,l)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},s.forwardEvent=function(c,l){return c(u=>l.fire(u))},s.runAndSubscribe=function(c,l){return l(void 0),c(u=>l(u))}},5435:function(a,s,c){var l=this&&this.__decorate||function(F,E,x,A){var I,z=arguments.length,Q=z<3?E:A===null?A=Object.getOwnPropertyDescriptor(E,x):A;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Q=Reflect.decorate(F,E,x,A);else for(var ne=F.length-1;ne>=0;ne--)(I=F[ne])&&(Q=(z<3?I(Q):z>3?I(E,x,Q):I(E,x))||Q);return z>3&&Q&&Object.defineProperty(E,x,Q),Q},u=this&&this.__param||function(F,E){return function(x,A){E(x,A,F)}};Object.defineProperty(s,"__esModule",{value:!0}),s.InputHandler=s.WindowsOptionsReportType=void 0;const h=c(2584),g=c(7116),_=c(2015),y=c(844),v=c(482),f=c(8437),p=c(8460),d=c(643),m=c(511),b=c(3734),C=c(2585),w=c(1480),T=c(6242),S=c(6351),k=c(5941),O={"(":0,")":1,"*":2,"+":3,"-":1,".":2},L=131072;function M(F,E){if(F>24)return E.setWinLines||!1;switch(F){case 1:return!!E.restoreWin;case 2:return!!E.minimizeWin;case 3:return!!E.setWinPosition;case 4:return!!E.setWinSizePixels;case 5:return!!E.raiseWin;case 6:return!!E.lowerWin;case 7:return!!E.refreshWin;case 8:return!!E.setWinSizeChars;case 9:return!!E.maximizeWin;case 10:return!!E.fullscreenWin;case 11:return!!E.getWinState;case 13:return!!E.getWinPosition;case 14:return!!E.getWinSizePixels;case 15:return!!E.getScreenSizePixels;case 16:return!!E.getCellSizePixels;case 18:return!!E.getWinSizeChars;case 19:return!!E.getScreenSizeChars;case 20:return!!E.getIconTitle;case 21:return!!E.getWinTitle;case 22:return!!E.pushTitle;case 23:return!!E.popTitle;case 24:return!!E.setWinLines}return!1}var D;(function(F){F[F.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",F[F.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"})(D||(s.WindowsOptionsReportType=D={}));let U=0;class q extends y.Disposable{getAttrData(){return this._curAttrData}constructor(E,x,A,I,z,Q,ne,se,B=new _.EscapeSequenceParser){super(),this._bufferService=E,this._charsetService=x,this._coreService=A,this._logService=I,this._optionsService=z,this._oscLinkService=Q,this._coreMouseService=ne,this._unicodeService=se,this._parser=B,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new v.StringToUtf32,this._utf8Decoder=new v.Utf8ToUtf32,this._workCell=new m.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=f.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=f.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new p.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new p.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new p.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new p.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new p.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new p.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new p.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new p.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new p.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new p.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new p.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new p.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new p.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new X(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(P=>this._activeBuffer=P.activeBuffer)),this._parser.setCsiHandlerFallback((P,K)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(P),params:K.toArray()})}),this._parser.setEscHandlerFallback(P=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(P)})}),this._parser.setExecuteHandlerFallback(P=>{this._logService.debug("Unknown EXECUTE code: ",{code:P})}),this._parser.setOscHandlerFallback((P,K,H)=>{this._logService.debug("Unknown OSC code: ",{identifier:P,action:K,data:H})}),this._parser.setDcsHandlerFallback((P,K,H)=>{K==="HOOK"&&(H=H.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(P),action:K,payload:H})}),this._parser.setPrintHandler((P,K,H)=>this.print(P,K,H)),this._parser.registerCsiHandler({final:"@"},P=>this.insertChars(P)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},P=>this.scrollLeft(P)),this._parser.registerCsiHandler({final:"A"},P=>this.cursorUp(P)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},P=>this.scrollRight(P)),this._parser.registerCsiHandler({final:"B"},P=>this.cursorDown(P)),this._parser.registerCsiHandler({final:"C"},P=>this.cursorForward(P)),this._parser.registerCsiHandler({final:"D"},P=>this.cursorBackward(P)),this._parser.registerCsiHandler({final:"E"},P=>this.cursorNextLine(P)),this._parser.registerCsiHandler({final:"F"},P=>this.cursorPrecedingLine(P)),this._parser.registerCsiHandler({final:"G"},P=>this.cursorCharAbsolute(P)),this._parser.registerCsiHandler({final:"H"},P=>this.cursorPosition(P)),this._parser.registerCsiHandler({final:"I"},P=>this.cursorForwardTab(P)),this._parser.registerCsiHandler({final:"J"},P=>this.eraseInDisplay(P,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},P=>this.eraseInDisplay(P,!0)),this._parser.registerCsiHandler({final:"K"},P=>this.eraseInLine(P,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},P=>this.eraseInLine(P,!0)),this._parser.registerCsiHandler({final:"L"},P=>this.insertLines(P)),this._parser.registerCsiHandler({final:"M"},P=>this.deleteLines(P)),this._parser.registerCsiHandler({final:"P"},P=>this.deleteChars(P)),this._parser.registerCsiHandler({final:"S"},P=>this.scrollUp(P)),this._parser.registerCsiHandler({final:"T"},P=>this.scrollDown(P)),this._parser.registerCsiHandler({final:"X"},P=>this.eraseChars(P)),this._parser.registerCsiHandler({final:"Z"},P=>this.cursorBackwardTab(P)),this._parser.registerCsiHandler({final:"`"},P=>this.charPosAbsolute(P)),this._parser.registerCsiHandler({final:"a"},P=>this.hPositionRelative(P)),this._parser.registerCsiHandler({final:"b"},P=>this.repeatPrecedingCharacter(P)),this._parser.registerCsiHandler({final:"c"},P=>this.sendDeviceAttributesPrimary(P)),this._parser.registerCsiHandler({prefix:">",final:"c"},P=>this.sendDeviceAttributesSecondary(P)),this._parser.registerCsiHandler({final:"d"},P=>this.linePosAbsolute(P)),this._parser.registerCsiHandler({final:"e"},P=>this.vPositionRelative(P)),this._parser.registerCsiHandler({final:"f"},P=>this.hVPosition(P)),this._parser.registerCsiHandler({final:"g"},P=>this.tabClear(P)),this._parser.registerCsiHandler({final:"h"},P=>this.setMode(P)),this._parser.registerCsiHandler({prefix:"?",final:"h"},P=>this.setModePrivate(P)),this._parser.registerCsiHandler({final:"l"},P=>this.resetMode(P)),this._parser.registerCsiHandler({prefix:"?",final:"l"},P=>this.resetModePrivate(P)),this._parser.registerCsiHandler({final:"m"},P=>this.charAttributes(P)),this._parser.registerCsiHandler({final:"n"},P=>this.deviceStatus(P)),this._parser.registerCsiHandler({prefix:"?",final:"n"},P=>this.deviceStatusPrivate(P)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},P=>this.softReset(P)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},P=>this.setCursorStyle(P)),this._parser.registerCsiHandler({final:"r"},P=>this.setScrollRegion(P)),this._parser.registerCsiHandler({final:"s"},P=>this.saveCursor(P)),this._parser.registerCsiHandler({final:"t"},P=>this.windowOptions(P)),this._parser.registerCsiHandler({final:"u"},P=>this.restoreCursor(P)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},P=>this.insertColumns(P)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},P=>this.deleteColumns(P)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},P=>this.selectProtected(P)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},P=>this.requestMode(P,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},P=>this.requestMode(P,!1)),this._parser.setExecuteHandler(h.C0.BEL,()=>this.bell()),this._parser.setExecuteHandler(h.C0.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(h.C0.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(h.C0.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(h.C0.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(h.C0.BS,()=>this.backspace()),this._parser.setExecuteHandler(h.C0.HT,()=>this.tab()),this._parser.setExecuteHandler(h.C0.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(h.C0.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(h.C1.IND,()=>this.index()),this._parser.setExecuteHandler(h.C1.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(h.C1.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new T.OscHandler(P=>(this.setTitle(P),this.setIconName(P),!0))),this._parser.registerOscHandler(1,new T.OscHandler(P=>this.setIconName(P))),this._parser.registerOscHandler(2,new T.OscHandler(P=>this.setTitle(P))),this._parser.registerOscHandler(4,new T.OscHandler(P=>this.setOrReportIndexedColor(P))),this._parser.registerOscHandler(8,new T.OscHandler(P=>this.setHyperlink(P))),this._parser.registerOscHandler(10,new T.OscHandler(P=>this.setOrReportFgColor(P))),this._parser.registerOscHandler(11,new T.OscHandler(P=>this.setOrReportBgColor(P))),this._parser.registerOscHandler(12,new T.OscHandler(P=>this.setOrReportCursorColor(P))),this._parser.registerOscHandler(104,new T.OscHandler(P=>this.restoreIndexedColor(P))),this._parser.registerOscHandler(110,new T.OscHandler(P=>this.restoreFgColor(P))),this._parser.registerOscHandler(111,new T.OscHandler(P=>this.restoreBgColor(P))),this._parser.registerOscHandler(112,new T.OscHandler(P=>this.restoreCursorColor(P))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(const P in g.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:P},()=>this.selectCharset("("+P)),this._parser.registerEscHandler({intermediates:")",final:P},()=>this.selectCharset(")"+P)),this._parser.registerEscHandler({intermediates:"*",final:P},()=>this.selectCharset("*"+P)),this._parser.registerEscHandler({intermediates:"+",final:P},()=>this.selectCharset("+"+P)),this._parser.registerEscHandler({intermediates:"-",final:P},()=>this.selectCharset("-"+P)),this._parser.registerEscHandler({intermediates:".",final:P},()=>this.selectCharset("."+P)),this._parser.registerEscHandler({intermediates:"/",final:P},()=>this.selectCharset("/"+P));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler(P=>(this._logService.error("Parsing error: ",P),P)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new S.DcsHandler((P,K)=>this.requestStatusString(P,K)))}_preserveStack(E,x,A,I){this._parseStack.paused=!0,this._parseStack.cursorStartX=E,this._parseStack.cursorStartY=x,this._parseStack.decodedLength=A,this._parseStack.position=I}_logSlowResolvingAsync(E){this._logService.logLevel<=C.LogLevelEnum.WARN&&Promise.race([E,new Promise((x,A)=>setTimeout(()=>A("#SLOW_TIMEOUT"),5e3))]).catch(x=>{if(x!=="#SLOW_TIMEOUT")throw x;console.warn("async parser handler taking longer than 5000 ms")})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(E,x){let A,I=this._activeBuffer.x,z=this._activeBuffer.y,Q=0;const ne=this._parseStack.paused;if(ne){if(A=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,x))return this._logSlowResolvingAsync(A),A;I=this._parseStack.cursorStartX,z=this._parseStack.cursorStartY,this._parseStack.paused=!1,E.length>L&&(Q=this._parseStack.position+L)}if(this._logService.logLevel<=C.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+(typeof E=="string"?` "${E}"`:` "${Array.prototype.map.call(E,P=>String.fromCharCode(P)).join("")}"`),typeof E=="string"?E.split("").map(P=>P.charCodeAt(0)):E),this._parseBuffer.length<E.length&&this._parseBuffer.length<L&&(this._parseBuffer=new Uint32Array(Math.min(E.length,L))),ne||this._dirtyRowTracker.clearRange(),E.length>L)for(let P=Q;P<E.length;P+=L){const K=P+L<E.length?P+L:E.length,H=typeof E=="string"?this._stringDecoder.decode(E.substring(P,K),this._parseBuffer):this._utf8Decoder.decode(E.subarray(P,K),this._parseBuffer);if(A=this._parser.parse(this._parseBuffer,H))return this._preserveStack(I,z,H,P),this._logSlowResolvingAsync(A),A}else if(!ne){const P=typeof E=="string"?this._stringDecoder.decode(E,this._parseBuffer):this._utf8Decoder.decode(E,this._parseBuffer);if(A=this._parser.parse(this._parseBuffer,P))return this._preserveStack(I,z,P,0),this._logSlowResolvingAsync(A),A}this._activeBuffer.x===I&&this._activeBuffer.y===z||this._onCursorMove.fire();const se=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),B=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);B<this._bufferService.rows&&this._onRequestRefreshRows.fire(Math.min(B,this._bufferService.rows-1),Math.min(se,this._bufferService.rows-1))}print(E,x,A){let I,z;const Q=this._charsetService.charset,ne=this._optionsService.rawOptions.screenReaderMode,se=this._bufferService.cols,B=this._coreService.decPrivateModes.wraparound,P=this._coreService.modes.insertMode,K=this._curAttrData;let H=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&A-x>0&&H.getWidth(this._activeBuffer.x-1)===2&&H.setCellFromCodepoint(this._activeBuffer.x-1,0,1,K);let te=this._parser.precedingJoinState;for(let Z=x;Z<A;++Z){if(I=E[Z],I<127&&Q){const Ke=Q[String.fromCharCode(I)];Ke&&(I=Ke.charCodeAt(0))}const ue=this._unicodeService.charProperties(I,te);z=w.UnicodeService.extractWidth(ue);const ye=w.UnicodeService.extractShouldJoin(ue),Se=ye?w.UnicodeService.extractWidth(te):0;if(te=ue,ne&&this._onA11yChar.fire((0,v.stringFromCodePoint)(I)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+z-Se>se){if(B){const Ke=H;let oe=this._activeBuffer.x-Se;for(this._activeBuffer.x=Se,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),H=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),Se>0&&H instanceof f.BufferLine&&H.copyCellsFrom(Ke,oe,0,Se,!1);oe<se;)Ke.setCellFromCodepoint(oe++,0,1,K)}else if(this._activeBuffer.x=se-1,z===2)continue}if(ye&&this._activeBuffer.x){const Ke=H.getWidth(this._activeBuffer.x-1)?1:2;H.addCodepointToCell(this._activeBuffer.x-Ke,I,z);for(let oe=z-Se;--oe>=0;)H.setCellFromCodepoint(this._activeBuffer.x++,0,0,K)}else if(P&&(H.insertCells(this._activeBuffer.x,z-Se,this._activeBuffer.getNullCell(K)),H.getWidth(se-1)===2&&H.setCellFromCodepoint(se-1,d.NULL_CELL_CODE,d.NULL_CELL_WIDTH,K)),H.setCellFromCodepoint(this._activeBuffer.x++,I,z,K),z>0)for(;--z;)H.setCellFromCodepoint(this._activeBuffer.x++,0,0,K)}this._parser.precedingJoinState=te,this._activeBuffer.x<se&&A-x>0&&H.getWidth(this._activeBuffer.x)===0&&!H.hasContent(this._activeBuffer.x)&&H.setCellFromCodepoint(this._activeBuffer.x,0,1,K),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(E,x){return E.final!=="t"||E.prefix||E.intermediates?this._parser.registerCsiHandler(E,x):this._parser.registerCsiHandler(E,A=>!M(A.params[0],this._optionsService.rawOptions.windowOptions)||x(A))}registerDcsHandler(E,x){return this._parser.registerDcsHandler(E,new S.DcsHandler(x))}registerEscHandler(E,x){return this._parser.registerEscHandler(E,x)}registerOscHandler(E,x){return this._parser.registerOscHandler(E,new T.OscHandler(x))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){var E;if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&((E=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y))!=null&&E.isWrapped)){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;const x=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);x.hasWidth(this._activeBuffer.x)&&!x.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;const E=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-E),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(E=this._bufferService.cols-1){this._activeBuffer.x=Math.min(E,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(E,x){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=E,this._activeBuffer.y=this._activeBuffer.scrollTop+x):(this._activeBuffer.x=E,this._activeBuffer.y=x),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(E,x){this._restrictCursor(),this._setCursor(this._activeBuffer.x+E,this._activeBuffer.y+x)}cursorUp(E){const x=this._activeBuffer.y-this._activeBuffer.scrollTop;return x>=0?this._moveCursor(0,-Math.min(x,E.params[0]||1)):this._moveCursor(0,-(E.params[0]||1)),!0}cursorDown(E){const x=this._activeBuffer.scrollBottom-this._activeBuffer.y;return x>=0?this._moveCursor(0,Math.min(x,E.params[0]||1)):this._moveCursor(0,E.params[0]||1),!0}cursorForward(E){return this._moveCursor(E.params[0]||1,0),!0}cursorBackward(E){return this._moveCursor(-(E.params[0]||1),0),!0}cursorNextLine(E){return this.cursorDown(E),this._activeBuffer.x=0,!0}cursorPrecedingLine(E){return this.cursorUp(E),this._activeBuffer.x=0,!0}cursorCharAbsolute(E){return this._setCursor((E.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(E){return this._setCursor(E.length>=2?(E.params[1]||1)-1:0,(E.params[0]||1)-1),!0}charPosAbsolute(E){return this._setCursor((E.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(E){return this._moveCursor(E.params[0]||1,0),!0}linePosAbsolute(E){return this._setCursor(this._activeBuffer.x,(E.params[0]||1)-1),!0}vPositionRelative(E){return this._moveCursor(0,E.params[0]||1),!0}hVPosition(E){return this.cursorPosition(E),!0}tabClear(E){const x=E.params[0];return x===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:x===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(E){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let x=E.params[0]||1;for(;x--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(E){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let x=E.params[0]||1;for(;x--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(E){const x=E.params[0];return x===1&&(this._curAttrData.bg|=536870912),x!==2&&x!==0||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(E,x,A,I=!1,z=!1){const Q=this._activeBuffer.lines.get(this._activeBuffer.ybase+E);Q.replaceCells(x,A,this._activeBuffer.getNullCell(this._eraseAttrData()),z),I&&(Q.isWrapped=!1)}_resetBufferLine(E,x=!1){const A=this._activeBuffer.lines.get(this._activeBuffer.ybase+E);A&&(A.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),x),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+E),A.isWrapped=!1)}eraseInDisplay(E,x=!1){let A;switch(this._restrictCursor(this._bufferService.cols),E.params[0]){case 0:for(A=this._activeBuffer.y,this._dirtyRowTracker.markDirty(A),this._eraseInBufferLine(A++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,x);A<this._bufferService.rows;A++)this._resetBufferLine(A,x);this._dirtyRowTracker.markDirty(A);break;case 1:for(A=this._activeBuffer.y,this._dirtyRowTracker.markDirty(A),this._eraseInBufferLine(A,0,this._activeBuffer.x+1,!0,x),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(A+1).isWrapped=!1);A--;)this._resetBufferLine(A,x);this._dirtyRowTracker.markDirty(0);break;case 2:for(A=this._bufferService.rows,this._dirtyRowTracker.markDirty(A-1);A--;)this._resetBufferLine(A,x);this._dirtyRowTracker.markDirty(0);break;case 3:const I=this._activeBuffer.lines.length-this._bufferService.rows;I>0&&(this._activeBuffer.lines.trimStart(I),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-I,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-I,0),this._onScroll.fire(0))}return!0}eraseInLine(E,x=!1){switch(this._restrictCursor(this._bufferService.cols),E.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,x);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,x);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,x)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(E){this._restrictCursor();let x=E.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const A=this._activeBuffer.ybase+this._activeBuffer.y,I=this._bufferService.rows-1-this._activeBuffer.scrollBottom,z=this._bufferService.rows-1+this._activeBuffer.ybase-I+1;for(;x--;)this._activeBuffer.lines.splice(z-1,1),this._activeBuffer.lines.splice(A,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(E){this._restrictCursor();let x=E.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const A=this._activeBuffer.ybase+this._activeBuffer.y;let I;for(I=this._bufferService.rows-1-this._activeBuffer.scrollBottom,I=this._bufferService.rows-1+this._activeBuffer.ybase-I;x--;)this._activeBuffer.lines.splice(A,1),this._activeBuffer.lines.splice(I,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(E){this._restrictCursor();const x=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return x&&(x.insertCells(this._activeBuffer.x,E.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(E){this._restrictCursor();const x=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return x&&(x.deleteCells(this._activeBuffer.x,E.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(E){let x=E.params[0]||1;for(;x--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(E){let x=E.params[0]||1;for(;x--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(f.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(E){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const x=E.params[0]||1;for(let A=this._activeBuffer.scrollTop;A<=this._activeBuffer.scrollBottom;++A){const I=this._activeBuffer.lines.get(this._activeBuffer.ybase+A);I.deleteCells(0,x,this._activeBuffer.getNullCell(this._eraseAttrData())),I.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(E){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const x=E.params[0]||1;for(let A=this._activeBuffer.scrollTop;A<=this._activeBuffer.scrollBottom;++A){const I=this._activeBuffer.lines.get(this._activeBuffer.ybase+A);I.insertCells(0,x,this._activeBuffer.getNullCell(this._eraseAttrData())),I.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(E){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const x=E.params[0]||1;for(let A=this._activeBuffer.scrollTop;A<=this._activeBuffer.scrollBottom;++A){const I=this._activeBuffer.lines.get(this._activeBuffer.ybase+A);I.insertCells(this._activeBuffer.x,x,this._activeBuffer.getNullCell(this._eraseAttrData())),I.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(E){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const x=E.params[0]||1;for(let A=this._activeBuffer.scrollTop;A<=this._activeBuffer.scrollBottom;++A){const I=this._activeBuffer.lines.get(this._activeBuffer.ybase+A);I.deleteCells(this._activeBuffer.x,x,this._activeBuffer.getNullCell(this._eraseAttrData())),I.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(E){this._restrictCursor();const x=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return x&&(x.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(E.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(E){const x=this._parser.precedingJoinState;if(!x)return!0;const A=E.params[0]||1,I=w.UnicodeService.extractWidth(x),z=this._activeBuffer.x-I,Q=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(z),ne=new Uint32Array(Q.length*A);let se=0;for(let P=0;P<Q.length;){const K=Q.codePointAt(P)||0;ne[se++]=K,P+=K>65535?2:1}let B=se;for(let P=1;P<A;++P)ne.copyWithin(B,0,se),B+=se;return this.print(ne,0,B),!0}sendDeviceAttributesPrimary(E){return E.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(h.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(h.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(E){return E.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(h.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(h.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(E.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(h.C0.ESC+"[>83;40003;0c")),!0}_is(E){return(this._optionsService.rawOptions.termName+"").indexOf(E)===0}setMode(E){for(let x=0;x<E.length;x++)switch(E.params[x]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(E){for(let x=0;x<E.length;x++)switch(E.params[x]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,g.DEFAULT_CHARSET),this._charsetService.setgCharset(1,g.DEFAULT_CHARSET),this._charsetService.setgCharset(2,g.DEFAULT_CHARSET),this._charsetService.setgCharset(3,g.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(E){for(let x=0;x<E.length;x++)switch(E.params[x]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(E){for(let x=0;x<E.length;x++)switch(E.params[x]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),E.params[x]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(E,x){const A=this._coreService.decPrivateModes,{activeProtocol:I,activeEncoding:z}=this._coreMouseService,Q=this._coreService,{buffers:ne,cols:se}=this._bufferService,{active:B,alt:P}=ne,K=this._optionsService.rawOptions,H=ye=>ye?1:2,te=E.params[0];return Z=te,ue=x?te===2?4:te===4?H(Q.modes.insertMode):te===12?3:te===20?H(K.convertEol):0:te===1?H(A.applicationCursorKeys):te===3?K.windowOptions.setWinLines?se===80?2:se===132?1:0:0:te===6?H(A.origin):te===7?H(A.wraparound):te===8?3:te===9?H(I==="X10"):te===12?H(K.cursorBlink):te===25?H(!Q.isCursorHidden):te===45?H(A.reverseWraparound):te===66?H(A.applicationKeypad):te===67?4:te===1e3?H(I==="VT200"):te===1002?H(I==="DRAG"):te===1003?H(I==="ANY"):te===1004?H(A.sendFocus):te===1005?4:te===1006?H(z==="SGR"):te===1015?4:te===1016?H(z==="SGR_PIXELS"):te===1048?1:te===47||te===1047||te===1049?H(B===P):te===2004?H(A.bracketedPasteMode):0,Q.triggerDataEvent(`${h.C0.ESC}[${x?"":"?"}${Z};${ue}$y`),!0;var Z,ue}_updateAttrColor(E,x,A,I,z){return x===2?(E|=50331648,E&=-16777216,E|=b.AttributeData.fromColorRGB([A,I,z])):x===5&&(E&=-50331904,E|=33554432|255&A),E}_extractColor(E,x,A){const I=[0,0,-1,0,0,0];let z=0,Q=0;do{if(I[Q+z]=E.params[x+Q],E.hasSubParams(x+Q)){const ne=E.getSubParams(x+Q);let se=0;do I[1]===5&&(z=1),I[Q+se+1+z]=ne[se];while(++se<ne.length&&se+Q+1+z<I.length);break}if(I[1]===5&&Q+z>=2||I[1]===2&&Q+z>=5)break;I[1]&&(z=1)}while(++Q+x<E.length&&Q+z<I.length);for(let ne=2;ne<I.length;++ne)I[ne]===-1&&(I[ne]=0);switch(I[0]){case 38:A.fg=this._updateAttrColor(A.fg,I[1],I[3],I[4],I[5]);break;case 48:A.bg=this._updateAttrColor(A.bg,I[1],I[3],I[4],I[5]);break;case 58:A.extended=A.extended.clone(),A.extended.underlineColor=this._updateAttrColor(A.extended.underlineColor,I[1],I[3],I[4],I[5])}return Q}_processUnderline(E,x){x.extended=x.extended.clone(),(!~E||E>5)&&(E=1),x.extended.underlineStyle=E,x.fg|=268435456,E===0&&(x.fg&=-268435457),x.updateExtended()}_processSGR0(E){E.fg=f.DEFAULT_ATTR_DATA.fg,E.bg=f.DEFAULT_ATTR_DATA.bg,E.extended=E.extended.clone(),E.extended.underlineStyle=0,E.extended.underlineColor&=-67108864,E.updateExtended()}charAttributes(E){if(E.length===1&&E.params[0]===0)return this._processSGR0(this._curAttrData),!0;const x=E.length;let A;const I=this._curAttrData;for(let z=0;z<x;z++)A=E.params[z],A>=30&&A<=37?(I.fg&=-50331904,I.fg|=16777216|A-30):A>=40&&A<=47?(I.bg&=-50331904,I.bg|=16777216|A-40):A>=90&&A<=97?(I.fg&=-50331904,I.fg|=16777224|A-90):A>=100&&A<=107?(I.bg&=-50331904,I.bg|=16777224|A-100):A===0?this._processSGR0(I):A===1?I.fg|=134217728:A===3?I.bg|=67108864:A===4?(I.fg|=268435456,this._processUnderline(E.hasSubParams(z)?E.getSubParams(z)[0]:1,I)):A===5?I.fg|=536870912:A===7?I.fg|=67108864:A===8?I.fg|=1073741824:A===9?I.fg|=2147483648:A===2?I.bg|=134217728:A===21?this._processUnderline(2,I):A===22?(I.fg&=-134217729,I.bg&=-134217729):A===23?I.bg&=-67108865:A===24?(I.fg&=-268435457,this._processUnderline(0,I)):A===25?I.fg&=-536870913:A===27?I.fg&=-67108865:A===28?I.fg&=-1073741825:A===29?I.fg&=2147483647:A===39?(I.fg&=-67108864,I.fg|=16777215&f.DEFAULT_ATTR_DATA.fg):A===49?(I.bg&=-67108864,I.bg|=16777215&f.DEFAULT_ATTR_DATA.bg):A===38||A===48||A===58?z+=this._extractColor(E,z,I):A===53?I.bg|=1073741824:A===55?I.bg&=-1073741825:A===59?(I.extended=I.extended.clone(),I.extended.underlineColor=-1,I.updateExtended()):A===100?(I.fg&=-67108864,I.fg|=16777215&f.DEFAULT_ATTR_DATA.fg,I.bg&=-67108864,I.bg|=16777215&f.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",A);return!0}deviceStatus(E){switch(E.params[0]){case 5:this._coreService.triggerDataEvent(`${h.C0.ESC}[0n`);break;case 6:const x=this._activeBuffer.y+1,A=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${h.C0.ESC}[${x};${A}R`)}return!0}deviceStatusPrivate(E){if(E.params[0]===6){const x=this._activeBuffer.y+1,A=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${h.C0.ESC}[?${x};${A}R`)}return!0}softReset(E){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=f.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(E){const x=E.params[0]||1;switch(x){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}const A=x%2==1;return this._optionsService.options.cursorBlink=A,!0}setScrollRegion(E){const x=E.params[0]||1;let A;return(E.length<2||(A=E.params[1])>this._bufferService.rows||A===0)&&(A=this._bufferService.rows),A>x&&(this._activeBuffer.scrollTop=x-1,this._activeBuffer.scrollBottom=A-1,this._setCursor(0,0)),!0}windowOptions(E){if(!M(E.params[0],this._optionsService.rawOptions.windowOptions))return!0;const x=E.length>1?E.params[1]:0;switch(E.params[0]){case 14:x!==2&&this._onRequestWindowsOptionsReport.fire(D.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(D.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${h.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:x!==0&&x!==2||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),x!==0&&x!==1||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:x!==0&&x!==2||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),x!==0&&x!==1||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(E){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(E){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(E){return this._windowTitle=E,this._onTitleChange.fire(E),!0}setIconName(E){return this._iconName=E,!0}setOrReportIndexedColor(E){const x=[],A=E.split(";");for(;A.length>1;){const I=A.shift(),z=A.shift();if(/^\d+$/.exec(I)){const Q=parseInt(I);if(Y(Q))if(z==="?")x.push({type:0,index:Q});else{const ne=(0,k.parseColor)(z);ne&&x.push({type:1,index:Q,color:ne})}}}return x.length&&this._onColor.fire(x),!0}setHyperlink(E){const x=E.split(";");return!(x.length<2)&&(x[1]?this._createHyperlink(x[0],x[1]):!x[0]&&this._finishHyperlink())}_createHyperlink(E,x){this._getCurrentLinkId()&&this._finishHyperlink();const A=E.split(":");let I;const z=A.findIndex(Q=>Q.startsWith("id="));return z!==-1&&(I=A[z].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:I,uri:x}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(E,x){const A=E.split(";");for(let I=0;I<A.length&&!(x>=this._specialColors.length);++I,++x)if(A[I]==="?")this._onColor.fire([{type:0,index:this._specialColors[x]}]);else{const z=(0,k.parseColor)(A[I]);z&&this._onColor.fire([{type:1,index:this._specialColors[x],color:z}])}return!0}setOrReportFgColor(E){return this._setOrReportSpecialColor(E,0)}setOrReportBgColor(E){return this._setOrReportSpecialColor(E,1)}setOrReportCursorColor(E){return this._setOrReportSpecialColor(E,2)}restoreIndexedColor(E){if(!E)return this._onColor.fire([{type:2}]),!0;const x=[],A=E.split(";");for(let I=0;I<A.length;++I)if(/^\d+$/.exec(A[I])){const z=parseInt(A[I]);Y(z)&&x.push({type:2,index:z})}return x.length&&this._onColor.fire(x),!0}restoreFgColor(E){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(E){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(E){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,g.DEFAULT_CHARSET),!0}selectCharset(E){return E.length!==2?(this.selectDefaultCharset(),!0):(E[0]==="/"||this._charsetService.setgCharset(O[E[0]],g.CHARSETS[E[1]]||g.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){const E=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,E,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=f.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=f.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(E){return this._charsetService.setgLevel(E),!0}screenAlignmentPattern(){const E=new m.CellData;E.content=4194304|"E".charCodeAt(0),E.fg=this._curAttrData.fg,E.bg=this._curAttrData.bg,this._setCursor(0,0);for(let x=0;x<this._bufferService.rows;++x){const A=this._activeBuffer.ybase+this._activeBuffer.y+x,I=this._activeBuffer.lines.get(A);I&&(I.fill(E),I.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(E,x){const A=this._bufferService.buffer,I=this._optionsService.rawOptions;return(z=>(this._coreService.triggerDataEvent(`${h.C0.ESC}${z}${h.C0.ESC}\\`),!0))(E==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:E==='"p'?'P1$r61;1"p':E==="r"?`P1$r${A.scrollTop+1};${A.scrollBottom+1}r`:E==="m"?"P1$r0m":E===" q"?`P1$r${{block:2,underline:4,bar:6}[I.cursorStyle]-(I.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(E,x){this._dirtyRowTracker.markRangeDirty(E,x)}}s.InputHandler=q;let X=class{constructor(F){this._bufferService=F,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(F){F<this.start?this.start=F:F>this.end&&(this.end=F)}markRangeDirty(F,E){F>E&&(U=F,F=E,E=U),F<this.start&&(this.start=F),E>this.end&&(this.end=E)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};function Y(F){return 0<=F&&F<256}X=l([u(0,C.IBufferService)],X)},844:(a,s)=>{function c(l){for(const u of l)u.dispose();l.length=0}Object.defineProperty(s,"__esModule",{value:!0}),s.getDisposeArrayDisposable=s.disposeArray=s.toDisposable=s.MutableDisposable=s.Disposable=void 0,s.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const l of this._disposables)l.dispose();this._disposables.length=0}register(l){return this._disposables.push(l),l}unregister(l){const u=this._disposables.indexOf(l);u!==-1&&this._disposables.splice(u,1)}},s.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(l){var u;this._isDisposed||l===this._value||((u=this._value)==null||u.dispose(),this._value=l)}clear(){this.value=void 0}dispose(){var l;this._isDisposed=!0,(l=this._value)==null||l.dispose(),this._value=void 0}},s.toDisposable=function(l){return{dispose:l}},s.disposeArray=c,s.getDisposeArrayDisposable=function(l){return{dispose:()=>c(l)}}},1505:(a,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.FourKeyMap=s.TwoKeyMap=void 0;class c{constructor(){this._data={}}set(u,h,g){this._data[u]||(this._data[u]={}),this._data[u][h]=g}get(u,h){return this._data[u]?this._data[u][h]:void 0}clear(){this._data={}}}s.TwoKeyMap=c,s.FourKeyMap=class{constructor(){this._data=new c}set(l,u,h,g,_){this._data.get(l,u)||this._data.set(l,u,new c),this._data.get(l,u).set(h,g,_)}get(l,u,h,g){var _;return(_=this._data.get(l,u))==null?void 0:_.get(h,g)}clear(){this._data.clear()}}},6114:(a,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.isChromeOS=s.isLinux=s.isWindows=s.isIphone=s.isIpad=s.isMac=s.getSafariVersion=s.isSafari=s.isLegacyEdge=s.isFirefox=s.isNode=void 0,s.isNode=typeof process<"u"&&"title"in process;const c=s.isNode?"node":navigator.userAgent,l=s.isNode?"node":navigator.platform;s.isFirefox=c.includes("Firefox"),s.isLegacyEdge=c.includes("Edge"),s.isSafari=/^((?!chrome|android).)*safari/i.test(c),s.getSafariVersion=function(){if(!s.isSafari)return 0;const u=c.match(/Version\/(\d+)/);return u===null||u.length<2?0:parseInt(u[1])},s.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(l),s.isIpad=l==="iPad",s.isIphone=l==="iPhone",s.isWindows=["Windows","Win16","Win32","WinCE"].includes(l),s.isLinux=l.indexOf("Linux")>=0,s.isChromeOS=/\bCrOS\b/.test(c)},6106:(a,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.SortedList=void 0;let c=0;s.SortedList=class{constructor(l){this._getKey=l,this._array=[]}clear(){this._array.length=0}insert(l){this._array.length!==0?(c=this._search(this._getKey(l)),this._array.splice(c,0,l)):this._array.push(l)}delete(l){if(this._array.length===0)return!1;const u=this._getKey(l);if(u===void 0||(c=this._search(u),c===-1)||this._getKey(this._array[c])!==u)return!1;do if(this._array[c]===l)return this._array.splice(c,1),!0;while(++c<this._array.length&&this._getKey(this._array[c])===u);return!1}*getKeyIterator(l){if(this._array.length!==0&&(c=this._search(l),!(c<0||c>=this._array.length)&&this._getKey(this._array[c])===l))do yield this._array[c];while(++c<this._array.length&&this._getKey(this._array[c])===l)}forEachByKey(l,u){if(this._array.length!==0&&(c=this._search(l),!(c<0||c>=this._array.length)&&this._getKey(this._array[c])===l))do u(this._array[c]);while(++c<this._array.length&&this._getKey(this._array[c])===l)}values(){return[...this._array].values()}_search(l){let u=0,h=this._array.length-1;for(;h>=u;){let g=u+h>>1;const _=this._getKey(this._array[g]);if(_>l)h=g-1;else{if(!(_<l)){for(;g>0&&this._getKey(this._array[g-1])===l;)g--;return g}u=g+1}}return u}}},7226:(a,s,c)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.DebouncedIdleTask=s.IdleTaskQueue=s.PriorityTaskQueue=void 0;const l=c(6114);class u{constructor(){this._tasks=[],this._i=0}enqueue(_){this._tasks.push(_),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(_){this._idleCallback=void 0;let y=0,v=0,f=_.timeRemaining(),p=0;for(;this._i<this._tasks.length;){if(y=Date.now(),this._tasks[this._i]()||this._i++,y=Math.max(1,Date.now()-y),v=Math.max(y,v),p=_.timeRemaining(),1.5*v>p)return f-y<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(f-y))}ms`),void this._start();f=p}this.clear()}}class h extends u{_requestCallback(_){return setTimeout(()=>_(this._createDeadline(16)))}_cancelCallback(_){clearTimeout(_)}_createDeadline(_){const y=Date.now()+_;return{timeRemaining:()=>Math.max(0,y-Date.now())}}}s.PriorityTaskQueue=h,s.IdleTaskQueue=!l.isNode&&"requestIdleCallback"in window?class extends u{_requestCallback(g){return requestIdleCallback(g)}_cancelCallback(g){cancelIdleCallback(g)}}:h,s.DebouncedIdleTask=class{constructor(){this._queue=new s.IdleTaskQueue}set(g){this._queue.clear(),this._queue.enqueue(g)}flush(){this._queue.flush()}}},9282:(a,s,c)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.updateWindowsModeWrappedState=void 0;const l=c(643);s.updateWindowsModeWrappedState=function(u){const h=u.buffer.lines.get(u.buffer.ybase+u.buffer.y-1),g=h==null?void 0:h.get(u.cols-1),_=u.buffer.lines.get(u.buffer.ybase+u.buffer.y);_&&g&&(_.isWrapped=g[l.CHAR_DATA_CODE_INDEX]!==l.NULL_CELL_CODE&&g[l.CHAR_DATA_CODE_INDEX]!==l.WHITESPACE_CELL_CODE)}},3734:(a,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.ExtendedAttrs=s.AttributeData=void 0;class c{constructor(){this.fg=0,this.bg=0,this.extended=new l}static toColorRGB(h){return[h>>>16&255,h>>>8&255,255&h]}static fromColorRGB(h){return(255&h[0])<<16|(255&h[1])<<8|255&h[2]}clone(){const h=new c;return h.fg=this.fg,h.bg=this.bg,h.extended=this.extended.clone(),h}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}}s.AttributeData=c;class l{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(h){this._ext=h}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(h){this._ext&=-469762049,this._ext|=h<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(h){this._ext&=-67108864,this._ext|=67108863&h}get urlId(){return this._urlId}set urlId(h){this._urlId=h}get underlineVariantOffset(){const h=(3758096384&this._ext)>>29;return h<0?4294967288^h:h}set underlineVariantOffset(h){this._ext&=536870911,this._ext|=h<<29&3758096384}constructor(h=0,g=0){this._ext=0,this._urlId=0,this._ext=h,this._urlId=g}clone(){return new l(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}s.ExtendedAttrs=l},9092:(a,s,c)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.Buffer=s.MAX_BUFFER_SIZE=void 0;const l=c(6349),u=c(7226),h=c(3734),g=c(8437),_=c(4634),y=c(511),v=c(643),f=c(4863),p=c(7116);s.MAX_BUFFER_SIZE=4294967295,s.Buffer=class{constructor(d,m,b){this._hasScrollback=d,this._optionsService=m,this._bufferService=b,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=g.DEFAULT_ATTR_DATA.clone(),this.savedCharset=p.DEFAULT_CHARSET,this.markers=[],this._nullCell=y.CellData.fromCharData([0,v.NULL_CELL_CHAR,v.NULL_CELL_WIDTH,v.NULL_CELL_CODE]),this._whitespaceCell=y.CellData.fromCharData([0,v.WHITESPACE_CELL_CHAR,v.WHITESPACE_CELL_WIDTH,v.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new u.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new l.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(d){return d?(this._nullCell.fg=d.fg,this._nullCell.bg=d.bg,this._nullCell.extended=d.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new h.ExtendedAttrs),this._nullCell}getWhitespaceCell(d){return d?(this._whitespaceCell.fg=d.fg,this._whitespaceCell.bg=d.bg,this._whitespaceCell.extended=d.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new h.ExtendedAttrs),this._whitespaceCell}getBlankLine(d,m){return new g.BufferLine(this._bufferService.cols,this.getNullCell(d),m)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){const d=this.ybase+this.y-this.ydisp;return d>=0&&d<this._rows}_getCorrectBufferLength(d){if(!this._hasScrollback)return d;const m=d+this._optionsService.rawOptions.scrollback;return m>s.MAX_BUFFER_SIZE?s.MAX_BUFFER_SIZE:m}fillViewportRows(d){if(this.lines.length===0){d===void 0&&(d=g.DEFAULT_ATTR_DATA);let m=this._rows;for(;m--;)this.lines.push(this.getBlankLine(d))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new l.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(d,m){const b=this.getNullCell(g.DEFAULT_ATTR_DATA);let C=0;const w=this._getCorrectBufferLength(m);if(w>this.lines.maxLength&&(this.lines.maxLength=w),this.lines.length>0){if(this._cols<d)for(let S=0;S<this.lines.length;S++)C+=+this.lines.get(S).resize(d,b);let T=0;if(this._rows<m)for(let S=this._rows;S<m;S++)this.lines.length<m+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new g.BufferLine(d,b)):this.ybase>0&&this.lines.length<=this.ybase+this.y+T+1?(this.ybase--,T++,this.ydisp>0&&this.ydisp--):this.lines.push(new g.BufferLine(d,b)));else for(let S=this._rows;S>m;S--)this.lines.length>m+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(w<this.lines.maxLength){const S=this.lines.length-w;S>0&&(this.lines.trimStart(S),this.ybase=Math.max(this.ybase-S,0),this.ydisp=Math.max(this.ydisp-S,0),this.savedY=Math.max(this.savedY-S,0)),this.lines.maxLength=w}this.x=Math.min(this.x,d-1),this.y=Math.min(this.y,m-1),T&&(this.y+=T),this.savedX=Math.min(this.savedX,d-1),this.scrollTop=0}if(this.scrollBottom=m-1,this._isReflowEnabled&&(this._reflow(d,m),this._cols>d))for(let T=0;T<this.lines.length;T++)C+=+this.lines.get(T).resize(d,b);this._cols=d,this._rows=m,this._memoryCleanupQueue.clear(),C>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let d=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,d=!1);let m=0;for(;this._memoryCleanupPosition<this.lines.length;)if(m+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),m>100)return!0;return d}get _isReflowEnabled(){const d=this._optionsService.rawOptions.windowsPty;return d&&d.buildNumber?this._hasScrollback&&d.backend==="conpty"&&d.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(d,m){this._cols!==d&&(d>this._cols?this._reflowLarger(d,m):this._reflowSmaller(d,m))}_reflowLarger(d,m){const b=(0,_.reflowLargerGetLinesToRemove)(this.lines,this._cols,d,this.ybase+this.y,this.getNullCell(g.DEFAULT_ATTR_DATA));if(b.length>0){const C=(0,_.reflowLargerCreateNewLayout)(this.lines,b);(0,_.reflowLargerApplyNewLayout)(this.lines,C.layout),this._reflowLargerAdjustViewport(d,m,C.countRemoved)}}_reflowLargerAdjustViewport(d,m,b){const C=this.getNullCell(g.DEFAULT_ATTR_DATA);let w=b;for(;w-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<m&&this.lines.push(new g.BufferLine(d,C))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-b,0)}_reflowSmaller(d,m){const b=this.getNullCell(g.DEFAULT_ATTR_DATA),C=[];let w=0;for(let T=this.lines.length-1;T>=0;T--){let S=this.lines.get(T);if(!S||!S.isWrapped&&S.getTrimmedLength()<=d)continue;const k=[S];for(;S.isWrapped&&T>0;)S=this.lines.get(--T),k.unshift(S);const O=this.ybase+this.y;if(O>=T&&O<T+k.length)continue;const L=k[k.length-1].getTrimmedLength(),M=(0,_.reflowSmallerGetNewLineLengths)(k,this._cols,d),D=M.length-k.length;let U;U=this.ybase===0&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+D):Math.max(0,this.lines.length-this.lines.maxLength+D);const q=[];for(let A=0;A<D;A++){const I=this.getBlankLine(g.DEFAULT_ATTR_DATA,!0);q.push(I)}q.length>0&&(C.push({start:T+k.length+w,newLines:q}),w+=q.length),k.push(...q);let X=M.length-1,Y=M[X];Y===0&&(X--,Y=M[X]);let F=k.length-D-1,E=L;for(;F>=0;){const A=Math.min(E,Y);if(k[X]===void 0)break;if(k[X].copyCellsFrom(k[F],E-A,Y-A,A,!0),Y-=A,Y===0&&(X--,Y=M[X]),E-=A,E===0){F--;const I=Math.max(F,0);E=(0,_.getWrappedLineTrimmedLength)(k,I,this._cols)}}for(let A=0;A<k.length;A++)M[A]<d&&k[A].setCell(M[A],b);let x=D-U;for(;x-- >0;)this.ybase===0?this.y<m-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+w)-m&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+D,this.ybase+m-1)}if(C.length>0){const T=[],S=[];for(let X=0;X<this.lines.length;X++)S.push(this.lines.get(X));const k=this.lines.length;let O=k-1,L=0,M=C[L];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+w);let D=0;for(let X=Math.min(this.lines.maxLength-1,k+w-1);X>=0;X--)if(M&&M.start>O+D){for(let Y=M.newLines.length-1;Y>=0;Y--)this.lines.set(X--,M.newLines[Y]);X++,T.push({index:O+1,amount:M.newLines.length}),D+=M.newLines.length,M=C[++L]}else this.lines.set(X,S[O--]);let U=0;for(let X=T.length-1;X>=0;X--)T[X].index+=U,this.lines.onInsertEmitter.fire(T[X]),U+=T[X].amount;const q=Math.max(0,k+w-this.lines.maxLength);q>0&&this.lines.onTrimEmitter.fire(q)}}translateBufferLineToString(d,m,b=0,C){const w=this.lines.get(d);return w?w.translateToString(m,b,C):""}getWrappedRangeForLine(d){let m=d,b=d;for(;m>0&&this.lines.get(m).isWrapped;)m--;for(;b+1<this.lines.length&&this.lines.get(b+1).isWrapped;)b++;return{first:m,last:b}}setupTabStops(d){for(d!=null?this.tabs[d]||(d=this.prevStop(d)):(this.tabs={},d=0);d<this._cols;d+=this._optionsService.rawOptions.tabStopWidth)this.tabs[d]=!0}prevStop(d){for(d==null&&(d=this.x);!this.tabs[--d]&&d>0;);return d>=this._cols?this._cols-1:d<0?0:d}nextStop(d){for(d==null&&(d=this.x);!this.tabs[++d]&&d<this._cols;);return d>=this._cols?this._cols-1:d<0?0:d}clearMarkers(d){this._isClearing=!0;for(let m=0;m<this.markers.length;m++)this.markers[m].line===d&&(this.markers[m].dispose(),this.markers.splice(m--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let d=0;d<this.markers.length;d++)this.markers[d].dispose(),this.markers.splice(d--,1);this._isClearing=!1}addMarker(d){const m=new f.Marker(d);return this.markers.push(m),m.register(this.lines.onTrim(b=>{m.line-=b,m.line<0&&m.dispose()})),m.register(this.lines.onInsert(b=>{m.line>=b.index&&(m.line+=b.amount)})),m.register(this.lines.onDelete(b=>{m.line>=b.index&&m.line<b.index+b.amount&&m.dispose(),m.line>b.index&&(m.line-=b.amount)})),m.register(m.onDispose(()=>this._removeMarker(m))),m}_removeMarker(d){this._isClearing||this.markers.splice(this.markers.indexOf(d),1)}}},8437:(a,s,c)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.BufferLine=s.DEFAULT_ATTR_DATA=void 0;const l=c(3734),u=c(511),h=c(643),g=c(482);s.DEFAULT_ATTR_DATA=Object.freeze(new l.AttributeData);let _=0;class y{constructor(f,p,d=!1){this.isWrapped=d,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*f);const m=p||u.CellData.fromCharData([0,h.NULL_CELL_CHAR,h.NULL_CELL_WIDTH,h.NULL_CELL_CODE]);for(let b=0;b<f;++b)this.setCell(b,m);this.length=f}get(f){const p=this._data[3*f+0],d=2097151&p;return[this._data[3*f+1],2097152&p?this._combined[f]:d?(0,g.stringFromCodePoint)(d):"",p>>22,2097152&p?this._combined[f].charCodeAt(this._combined[f].length-1):d]}set(f,p){this._data[3*f+1]=p[h.CHAR_DATA_ATTR_INDEX],p[h.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[f]=p[1],this._data[3*f+0]=2097152|f|p[h.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*f+0]=p[h.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|p[h.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(f){return this._data[3*f+0]>>22}hasWidth(f){return 12582912&this._data[3*f+0]}getFg(f){return this._data[3*f+1]}getBg(f){return this._data[3*f+2]}hasContent(f){return 4194303&this._data[3*f+0]}getCodePoint(f){const p=this._data[3*f+0];return 2097152&p?this._combined[f].charCodeAt(this._combined[f].length-1):2097151&p}isCombined(f){return 2097152&this._data[3*f+0]}getString(f){const p=this._data[3*f+0];return 2097152&p?this._combined[f]:2097151&p?(0,g.stringFromCodePoint)(2097151&p):""}isProtected(f){return 536870912&this._data[3*f+2]}loadCell(f,p){return _=3*f,p.content=this._data[_+0],p.fg=this._data[_+1],p.bg=this._data[_+2],2097152&p.content&&(p.combinedData=this._combined[f]),268435456&p.bg&&(p.extended=this._extendedAttrs[f]),p}setCell(f,p){2097152&p.content&&(this._combined[f]=p.combinedData),268435456&p.bg&&(this._extendedAttrs[f]=p.extended),this._data[3*f+0]=p.content,this._data[3*f+1]=p.fg,this._data[3*f+2]=p.bg}setCellFromCodepoint(f,p,d,m){268435456&m.bg&&(this._extendedAttrs[f]=m.extended),this._data[3*f+0]=p|d<<22,this._data[3*f+1]=m.fg,this._data[3*f+2]=m.bg}addCodepointToCell(f,p,d){let m=this._data[3*f+0];2097152&m?this._combined[f]+=(0,g.stringFromCodePoint)(p):2097151&m?(this._combined[f]=(0,g.stringFromCodePoint)(2097151&m)+(0,g.stringFromCodePoint)(p),m&=-2097152,m|=2097152):m=p|4194304,d&&(m&=-12582913,m|=d<<22),this._data[3*f+0]=m}insertCells(f,p,d){if((f%=this.length)&&this.getWidth(f-1)===2&&this.setCellFromCodepoint(f-1,0,1,d),p<this.length-f){const m=new u.CellData;for(let b=this.length-f-p-1;b>=0;--b)this.setCell(f+p+b,this.loadCell(f+b,m));for(let b=0;b<p;++b)this.setCell(f+b,d)}else for(let m=f;m<this.length;++m)this.setCell(m,d);this.getWidth(this.length-1)===2&&this.setCellFromCodepoint(this.length-1,0,1,d)}deleteCells(f,p,d){if(f%=this.length,p<this.length-f){const m=new u.CellData;for(let b=0;b<this.length-f-p;++b)this.setCell(f+b,this.loadCell(f+p+b,m));for(let b=this.length-p;b<this.length;++b)this.setCell(b,d)}else for(let m=f;m<this.length;++m)this.setCell(m,d);f&&this.getWidth(f-1)===2&&this.setCellFromCodepoint(f-1,0,1,d),this.getWidth(f)!==0||this.hasContent(f)||this.setCellFromCodepoint(f,0,1,d)}replaceCells(f,p,d,m=!1){if(m)for(f&&this.getWidth(f-1)===2&&!this.isProtected(f-1)&&this.setCellFromCodepoint(f-1,0,1,d),p<this.length&&this.getWidth(p-1)===2&&!this.isProtected(p)&&this.setCellFromCodepoint(p,0,1,d);f<p&&f<this.length;)this.isProtected(f)||this.setCell(f,d),f++;else for(f&&this.getWidth(f-1)===2&&this.setCellFromCodepoint(f-1,0,1,d),p<this.length&&this.getWidth(p-1)===2&&this.setCellFromCodepoint(p,0,1,d);f<p&&f<this.length;)this.setCell(f++,d)}resize(f,p){if(f===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;const d=3*f;if(f>this.length){if(this._data.buffer.byteLength>=4*d)this._data=new Uint32Array(this._data.buffer,0,d);else{const m=new Uint32Array(d);m.set(this._data),this._data=m}for(let m=this.length;m<f;++m)this.setCell(m,p)}else{this._data=this._data.subarray(0,d);const m=Object.keys(this._combined);for(let C=0;C<m.length;C++){const w=parseInt(m[C],10);w>=f&&delete this._combined[w]}const b=Object.keys(this._extendedAttrs);for(let C=0;C<b.length;C++){const w=parseInt(b[C],10);w>=f&&delete this._extendedAttrs[w]}}return this.length=f,4*d*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){const f=new Uint32Array(this._data.length);return f.set(this._data),this._data=f,1}return 0}fill(f,p=!1){if(p)for(let d=0;d<this.length;++d)this.isProtected(d)||this.setCell(d,f);else{this._combined={},this._extendedAttrs={};for(let d=0;d<this.length;++d)this.setCell(d,f)}}copyFrom(f){this.length!==f.length?this._data=new Uint32Array(f._data):this._data.set(f._data),this.length=f.length,this._combined={};for(const p in f._combined)this._combined[p]=f._combined[p];this._extendedAttrs={};for(const p in f._extendedAttrs)this._extendedAttrs[p]=f._extendedAttrs[p];this.isWrapped=f.isWrapped}clone(){const f=new y(0);f._data=new Uint32Array(this._data),f.length=this.length;for(const p in this._combined)f._combined[p]=this._combined[p];for(const p in this._extendedAttrs)f._extendedAttrs[p]=this._extendedAttrs[p];return f.isWrapped=this.isWrapped,f}getTrimmedLength(){for(let f=this.length-1;f>=0;--f)if(4194303&this._data[3*f+0])return f+(this._data[3*f+0]>>22);return 0}getNoBgTrimmedLength(){for(let f=this.length-1;f>=0;--f)if(4194303&this._data[3*f+0]||50331648&this._data[3*f+2])return f+(this._data[3*f+0]>>22);return 0}copyCellsFrom(f,p,d,m,b){const C=f._data;if(b)for(let T=m-1;T>=0;T--){for(let S=0;S<3;S++)this._data[3*(d+T)+S]=C[3*(p+T)+S];268435456&C[3*(p+T)+2]&&(this._extendedAttrs[d+T]=f._extendedAttrs[p+T])}else for(let T=0;T<m;T++){for(let S=0;S<3;S++)this._data[3*(d+T)+S]=C[3*(p+T)+S];268435456&C[3*(p+T)+2]&&(this._extendedAttrs[d+T]=f._extendedAttrs[p+T])}const w=Object.keys(f._combined);for(let T=0;T<w.length;T++){const S=parseInt(w[T],10);S>=p&&(this._combined[S-p+d]=f._combined[S])}}translateToString(f,p,d,m){p=p??0,d=d??this.length,f&&(d=Math.min(d,this.getTrimmedLength())),m&&(m.length=0);let b="";for(;p<d;){const C=this._data[3*p+0],w=2097151&C,T=2097152&C?this._combined[p]:w?(0,g.stringFromCodePoint)(w):h.WHITESPACE_CELL_CHAR;if(b+=T,m)for(let S=0;S<T.length;++S)m.push(p);p+=C>>22||1}return m&&m.push(p),b}}s.BufferLine=y},4841:(a,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.getRangeLength=void 0,s.getRangeLength=function(c,l){if(c.start.y>c.end.y)throw new Error(`Buffer range end (${c.end.x}, ${c.end.y}) cannot be before start (${c.start.x}, ${c.start.y})`);return l*(c.end.y-c.start.y)+(c.end.x-c.start.x+1)}},4634:(a,s)=>{function c(l,u,h){if(u===l.length-1)return l[u].getTrimmedLength();const g=!l[u].hasContent(h-1)&&l[u].getWidth(h-1)===1,_=l[u+1].getWidth(0)===2;return g&&_?h-1:h}Object.defineProperty(s,"__esModule",{value:!0}),s.getWrappedLineTrimmedLength=s.reflowSmallerGetNewLineLengths=s.reflowLargerApplyNewLayout=s.reflowLargerCreateNewLayout=s.reflowLargerGetLinesToRemove=void 0,s.reflowLargerGetLinesToRemove=function(l,u,h,g,_){const y=[];for(let v=0;v<l.length-1;v++){let f=v,p=l.get(++f);if(!p.isWrapped)continue;const d=[l.get(v)];for(;f<l.length&&p.isWrapped;)d.push(p),p=l.get(++f);if(g>=v&&g<f){v+=d.length-1;continue}let m=0,b=c(d,m,u),C=1,w=0;for(;C<d.length;){const S=c(d,C,u),k=S-w,O=h-b,L=Math.min(k,O);d[m].copyCellsFrom(d[C],w,b,L,!1),b+=L,b===h&&(m++,b=0),w+=L,w===S&&(C++,w=0),b===0&&m!==0&&d[m-1].getWidth(h-1)===2&&(d[m].copyCellsFrom(d[m-1],h-1,b++,1,!1),d[m-1].setCell(h-1,_))}d[m].replaceCells(b,h,_);let T=0;for(let S=d.length-1;S>0&&(S>m||d[S].getTrimmedLength()===0);S--)T++;T>0&&(y.push(v+d.length-T),y.push(T)),v+=d.length-1}return y},s.reflowLargerCreateNewLayout=function(l,u){const h=[];let g=0,_=u[g],y=0;for(let v=0;v<l.length;v++)if(_===v){const f=u[++g];l.onDeleteEmitter.fire({index:v-y,amount:f}),v+=f-1,y+=f,_=u[++g]}else h.push(v);return{layout:h,countRemoved:y}},s.reflowLargerApplyNewLayout=function(l,u){const h=[];for(let g=0;g<u.length;g++)h.push(l.get(u[g]));for(let g=0;g<h.length;g++)l.set(g,h[g]);l.length=u.length},s.reflowSmallerGetNewLineLengths=function(l,u,h){const g=[],_=l.map((p,d)=>c(l,d,u)).reduce((p,d)=>p+d);let y=0,v=0,f=0;for(;f<_;){if(_-f<h){g.push(_-f);break}y+=h;const p=c(l,v,u);y>p&&(y-=p,v++);const d=l[v].getWidth(y-1)===2;d&&y--;const m=d?h-1:h;g.push(m),f+=m}return g},s.getWrappedLineTrimmedLength=c},5295:(a,s,c)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.BufferSet=void 0;const l=c(8460),u=c(844),h=c(9092);class g extends u.Disposable{constructor(y,v){super(),this._optionsService=y,this._bufferService=v,this._onBufferActivate=this.register(new l.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new h.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new h.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(y){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(y),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(y,v){this._normal.resize(y,v),this._alt.resize(y,v),this.setupTabStops(y)}setupTabStops(y){this._normal.setupTabStops(y),this._alt.setupTabStops(y)}}s.BufferSet=g},511:(a,s,c)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.CellData=void 0;const l=c(482),u=c(643),h=c(3734);class g extends h.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new h.ExtendedAttrs,this.combinedData=""}static fromCharData(y){const v=new g;return v.setFromCharData(y),v}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,l.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(y){this.fg=y[u.CHAR_DATA_ATTR_INDEX],this.bg=0;let v=!1;if(y[u.CHAR_DATA_CHAR_INDEX].length>2)v=!0;else if(y[u.CHAR_DATA_CHAR_INDEX].length===2){const f=y[u.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=f&&f<=56319){const p=y[u.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=p&&p<=57343?this.content=1024*(f-55296)+p-56320+65536|y[u.CHAR_DATA_WIDTH_INDEX]<<22:v=!0}else v=!0}else this.content=y[u.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|y[u.CHAR_DATA_WIDTH_INDEX]<<22;v&&(this.combinedData=y[u.CHAR_DATA_CHAR_INDEX],this.content=2097152|y[u.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}s.CellData=g},643:(a,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.WHITESPACE_CELL_CODE=s.WHITESPACE_CELL_WIDTH=s.WHITESPACE_CELL_CHAR=s.NULL_CELL_CODE=s.NULL_CELL_WIDTH=s.NULL_CELL_CHAR=s.CHAR_DATA_CODE_INDEX=s.CHAR_DATA_WIDTH_INDEX=s.CHAR_DATA_CHAR_INDEX=s.CHAR_DATA_ATTR_INDEX=s.DEFAULT_EXT=s.DEFAULT_ATTR=s.DEFAULT_COLOR=void 0,s.DEFAULT_COLOR=0,s.DEFAULT_ATTR=256|s.DEFAULT_COLOR<<9,s.DEFAULT_EXT=0,s.CHAR_DATA_ATTR_INDEX=0,s.CHAR_DATA_CHAR_INDEX=1,s.CHAR_DATA_WIDTH_INDEX=2,s.CHAR_DATA_CODE_INDEX=3,s.NULL_CELL_CHAR="",s.NULL_CELL_WIDTH=1,s.NULL_CELL_CODE=0,s.WHITESPACE_CELL_CHAR=" ",s.WHITESPACE_CELL_WIDTH=1,s.WHITESPACE_CELL_CODE=32},4863:(a,s,c)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.Marker=void 0;const l=c(8460),u=c(844);class h{get id(){return this._id}constructor(_){this.line=_,this.isDisposed=!1,this._disposables=[],this._id=h._nextId++,this._onDispose=this.register(new l.EventEmitter),this.onDispose=this._onDispose.event}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,u.disposeArray)(this._disposables),this._disposables.length=0)}register(_){return this._disposables.push(_),_}}s.Marker=h,h._nextId=1},7116:(a,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.DEFAULT_CHARSET=s.CHARSETS=void 0,s.CHARSETS={},s.DEFAULT_CHARSET=s.CHARSETS.B,s.CHARSETS[0]={"`":"◆",a:"▒",b:"␉",c:"␌",d:"␍",e:"␊",f:"°",g:"±",h:"␤",i:"␋",j:"┘",k:"┐",l:"┌",m:"└",n:"┼",o:"⎺",p:"⎻",q:"─",r:"⎼",s:"⎽",t:"├",u:"┤",v:"┴",w:"┬",x:"│",y:"≤",z:"≥","{":"π","|":"≠","}":"£","~":"·"},s.CHARSETS.A={"#":"£"},s.CHARSETS.B=void 0,s.CHARSETS[4]={"#":"£","@":"¾","[":"ij","\\":"½","]":"|","{":"¨","|":"f","}":"¼","~":"´"},s.CHARSETS.C=s.CHARSETS[5]={"[":"Ä","\\":"Ö","]":"Å","^":"Ü","`":"é","{":"ä","|":"ö","}":"å","~":"ü"},s.CHARSETS.R={"#":"£","@":"à","[":"°","\\":"ç","]":"§","{":"é","|":"ù","}":"è","~":"¨"},s.CHARSETS.Q={"@":"à","[":"â","\\":"ç","]":"ê","^":"î","`":"ô","{":"é","|":"ù","}":"è","~":"û"},s.CHARSETS.K={"@":"§","[":"Ä","\\":"Ö","]":"Ü","{":"ä","|":"ö","}":"ü","~":"ß"},s.CHARSETS.Y={"#":"£","@":"§","[":"°","\\":"ç","]":"é","`":"ù","{":"à","|":"ò","}":"è","~":"ì"},s.CHARSETS.E=s.CHARSETS[6]={"@":"Ä","[":"Æ","\\":"Ø","]":"Å","^":"Ü","`":"ä","{":"æ","|":"ø","}":"å","~":"ü"},s.CHARSETS.Z={"#":"£","@":"§","[":"¡","\\":"Ñ","]":"¿","{":"°","|":"ñ","}":"ç"},s.CHARSETS.H=s.CHARSETS[7]={"@":"É","[":"Ä","\\":"Ö","]":"Å","^":"Ü","`":"é","{":"ä","|":"ö","}":"å","~":"ü"},s.CHARSETS["="]={"#":"ù","@":"à","[":"é","\\":"ç","]":"ê","^":"î",_:"è","`":"ô","{":"ä","|":"ö","}":"ü","~":"û"}},2584:(a,s)=>{var c,l,u;Object.defineProperty(s,"__esModule",{value:!0}),s.C1_ESCAPED=s.C1=s.C0=void 0,function(h){h.NUL="\0",h.SOH="",h.STX="",h.ETX="",h.EOT="",h.ENQ="",h.ACK="",h.BEL="\x07",h.BS="\b",h.HT="	",h.LF=`
`,h.VT="\v",h.FF="\f",h.CR="\r",h.SO="",h.SI="",h.DLE="",h.DC1="",h.DC2="",h.DC3="",h.DC4="",h.NAK="",h.SYN="",h.ETB="",h.CAN="",h.EM="",h.SUB="",h.ESC="\x1B",h.FS="",h.GS="",h.RS="",h.US="",h.SP=" ",h.DEL=""}(c||(s.C0=c={})),function(h){h.PAD="",h.HOP="",h.BPH="",h.NBH="",h.IND="",h.NEL="",h.SSA="",h.ESA="",h.HTS="",h.HTJ="",h.VTS="",h.PLD="",h.PLU="",h.RI="",h.SS2="",h.SS3="",h.DCS="",h.PU1="",h.PU2="",h.STS="",h.CCH="",h.MW="",h.SPA="",h.EPA="",h.SOS="",h.SGCI="",h.SCI="",h.CSI="",h.ST="",h.OSC="",h.PM="",h.APC=""}(l||(s.C1=l={})),function(h){h.ST=`${c.ESC}\\`}(u||(s.C1_ESCAPED=u={}))},7399:(a,s,c)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.evaluateKeyboardEvent=void 0;const l=c(2584),u={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};s.evaluateKeyboardEvent=function(h,g,_,y){const v={type:0,cancel:!1,key:void 0},f=(h.shiftKey?1:0)|(h.altKey?2:0)|(h.ctrlKey?4:0)|(h.metaKey?8:0);switch(h.keyCode){case 0:h.key==="UIKeyInputUpArrow"?v.key=g?l.C0.ESC+"OA":l.C0.ESC+"[A":h.key==="UIKeyInputLeftArrow"?v.key=g?l.C0.ESC+"OD":l.C0.ESC+"[D":h.key==="UIKeyInputRightArrow"?v.key=g?l.C0.ESC+"OC":l.C0.ESC+"[C":h.key==="UIKeyInputDownArrow"&&(v.key=g?l.C0.ESC+"OB":l.C0.ESC+"[B");break;case 8:v.key=h.ctrlKey?"\b":l.C0.DEL,h.altKey&&(v.key=l.C0.ESC+v.key);break;case 9:if(h.shiftKey){v.key=l.C0.ESC+"[Z";break}v.key=l.C0.HT,v.cancel=!0;break;case 13:v.key=h.altKey?l.C0.ESC+l.C0.CR:l.C0.CR,v.cancel=!0;break;case 27:v.key=l.C0.ESC,h.altKey&&(v.key=l.C0.ESC+l.C0.ESC),v.cancel=!0;break;case 37:if(h.metaKey)break;f?(v.key=l.C0.ESC+"[1;"+(f+1)+"D",v.key===l.C0.ESC+"[1;3D"&&(v.key=l.C0.ESC+(_?"b":"[1;5D"))):v.key=g?l.C0.ESC+"OD":l.C0.ESC+"[D";break;case 39:if(h.metaKey)break;f?(v.key=l.C0.ESC+"[1;"+(f+1)+"C",v.key===l.C0.ESC+"[1;3C"&&(v.key=l.C0.ESC+(_?"f":"[1;5C"))):v.key=g?l.C0.ESC+"OC":l.C0.ESC+"[C";break;case 38:if(h.metaKey)break;f?(v.key=l.C0.ESC+"[1;"+(f+1)+"A",_||v.key!==l.C0.ESC+"[1;3A"||(v.key=l.C0.ESC+"[1;5A")):v.key=g?l.C0.ESC+"OA":l.C0.ESC+"[A";break;case 40:if(h.metaKey)break;f?(v.key=l.C0.ESC+"[1;"+(f+1)+"B",_||v.key!==l.C0.ESC+"[1;3B"||(v.key=l.C0.ESC+"[1;5B")):v.key=g?l.C0.ESC+"OB":l.C0.ESC+"[B";break;case 45:h.shiftKey||h.ctrlKey||(v.key=l.C0.ESC+"[2~");break;case 46:v.key=f?l.C0.ESC+"[3;"+(f+1)+"~":l.C0.ESC+"[3~";break;case 36:v.key=f?l.C0.ESC+"[1;"+(f+1)+"H":g?l.C0.ESC+"OH":l.C0.ESC+"[H";break;case 35:v.key=f?l.C0.ESC+"[1;"+(f+1)+"F":g?l.C0.ESC+"OF":l.C0.ESC+"[F";break;case 33:h.shiftKey?v.type=2:h.ctrlKey?v.key=l.C0.ESC+"[5;"+(f+1)+"~":v.key=l.C0.ESC+"[5~";break;case 34:h.shiftKey?v.type=3:h.ctrlKey?v.key=l.C0.ESC+"[6;"+(f+1)+"~":v.key=l.C0.ESC+"[6~";break;case 112:v.key=f?l.C0.ESC+"[1;"+(f+1)+"P":l.C0.ESC+"OP";break;case 113:v.key=f?l.C0.ESC+"[1;"+(f+1)+"Q":l.C0.ESC+"OQ";break;case 114:v.key=f?l.C0.ESC+"[1;"+(f+1)+"R":l.C0.ESC+"OR";break;case 115:v.key=f?l.C0.ESC+"[1;"+(f+1)+"S":l.C0.ESC+"OS";break;case 116:v.key=f?l.C0.ESC+"[15;"+(f+1)+"~":l.C0.ESC+"[15~";break;case 117:v.key=f?l.C0.ESC+"[17;"+(f+1)+"~":l.C0.ESC+"[17~";break;case 118:v.key=f?l.C0.ESC+"[18;"+(f+1)+"~":l.C0.ESC+"[18~";break;case 119:v.key=f?l.C0.ESC+"[19;"+(f+1)+"~":l.C0.ESC+"[19~";break;case 120:v.key=f?l.C0.ESC+"[20;"+(f+1)+"~":l.C0.ESC+"[20~";break;case 121:v.key=f?l.C0.ESC+"[21;"+(f+1)+"~":l.C0.ESC+"[21~";break;case 122:v.key=f?l.C0.ESC+"[23;"+(f+1)+"~":l.C0.ESC+"[23~";break;case 123:v.key=f?l.C0.ESC+"[24;"+(f+1)+"~":l.C0.ESC+"[24~";break;default:if(!h.ctrlKey||h.shiftKey||h.altKey||h.metaKey)if(_&&!y||!h.altKey||h.metaKey)!_||h.altKey||h.ctrlKey||h.shiftKey||!h.metaKey?h.key&&!h.ctrlKey&&!h.altKey&&!h.metaKey&&h.keyCode>=48&&h.key.length===1?v.key=h.key:h.key&&h.ctrlKey&&(h.key==="_"&&(v.key=l.C0.US),h.key==="@"&&(v.key=l.C0.NUL)):h.keyCode===65&&(v.type=1);else{const p=u[h.keyCode],d=p==null?void 0:p[h.shiftKey?1:0];if(d)v.key=l.C0.ESC+d;else if(h.keyCode>=65&&h.keyCode<=90){const m=h.ctrlKey?h.keyCode-64:h.keyCode+32;let b=String.fromCharCode(m);h.shiftKey&&(b=b.toUpperCase()),v.key=l.C0.ESC+b}else if(h.keyCode===32)v.key=l.C0.ESC+(h.ctrlKey?l.C0.NUL:" ");else if(h.key==="Dead"&&h.code.startsWith("Key")){let m=h.code.slice(3,4);h.shiftKey||(m=m.toLowerCase()),v.key=l.C0.ESC+m,v.cancel=!0}}else h.keyCode>=65&&h.keyCode<=90?v.key=String.fromCharCode(h.keyCode-64):h.keyCode===32?v.key=l.C0.NUL:h.keyCode>=51&&h.keyCode<=55?v.key=String.fromCharCode(h.keyCode-51+27):h.keyCode===56?v.key=l.C0.DEL:h.keyCode===219?v.key=l.C0.ESC:h.keyCode===220?v.key=l.C0.FS:h.keyCode===221&&(v.key=l.C0.GS)}return v}},482:(a,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.Utf8ToUtf32=s.StringToUtf32=s.utf32ToString=s.stringFromCodePoint=void 0,s.stringFromCodePoint=function(c){return c>65535?(c-=65536,String.fromCharCode(55296+(c>>10))+String.fromCharCode(c%1024+56320)):String.fromCharCode(c)},s.utf32ToString=function(c,l=0,u=c.length){let h="";for(let g=l;g<u;++g){let _=c[g];_>65535?(_-=65536,h+=String.fromCharCode(55296+(_>>10))+String.fromCharCode(_%1024+56320)):h+=String.fromCharCode(_)}return h},s.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(c,l){const u=c.length;if(!u)return 0;let h=0,g=0;if(this._interim){const _=c.charCodeAt(g++);56320<=_&&_<=57343?l[h++]=1024*(this._interim-55296)+_-56320+65536:(l[h++]=this._interim,l[h++]=_),this._interim=0}for(let _=g;_<u;++_){const y=c.charCodeAt(_);if(55296<=y&&y<=56319){if(++_>=u)return this._interim=y,h;const v=c.charCodeAt(_);56320<=v&&v<=57343?l[h++]=1024*(y-55296)+v-56320+65536:(l[h++]=y,l[h++]=v)}else y!==65279&&(l[h++]=y)}return h}},s.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(c,l){const u=c.length;if(!u)return 0;let h,g,_,y,v=0,f=0,p=0;if(this.interim[0]){let b=!1,C=this.interim[0];C&=(224&C)==192?31:(240&C)==224?15:7;let w,T=0;for(;(w=63&this.interim[++T])&&T<4;)C<<=6,C|=w;const S=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,k=S-T;for(;p<k;){if(p>=u)return 0;if(w=c[p++],(192&w)!=128){p--,b=!0;break}this.interim[T++]=w,C<<=6,C|=63&w}b||(S===2?C<128?p--:l[v++]=C:S===3?C<2048||C>=55296&&C<=57343||C===65279||(l[v++]=C):C<65536||C>1114111||(l[v++]=C)),this.interim.fill(0)}const d=u-4;let m=p;for(;m<u;){for(;!(!(m<d)||128&(h=c[m])||128&(g=c[m+1])||128&(_=c[m+2])||128&(y=c[m+3]));)l[v++]=h,l[v++]=g,l[v++]=_,l[v++]=y,m+=4;if(h=c[m++],h<128)l[v++]=h;else if((224&h)==192){if(m>=u)return this.interim[0]=h,v;if(g=c[m++],(192&g)!=128){m--;continue}if(f=(31&h)<<6|63&g,f<128){m--;continue}l[v++]=f}else if((240&h)==224){if(m>=u)return this.interim[0]=h,v;if(g=c[m++],(192&g)!=128){m--;continue}if(m>=u)return this.interim[0]=h,this.interim[1]=g,v;if(_=c[m++],(192&_)!=128){m--;continue}if(f=(15&h)<<12|(63&g)<<6|63&_,f<2048||f>=55296&&f<=57343||f===65279)continue;l[v++]=f}else if((248&h)==240){if(m>=u)return this.interim[0]=h,v;if(g=c[m++],(192&g)!=128){m--;continue}if(m>=u)return this.interim[0]=h,this.interim[1]=g,v;if(_=c[m++],(192&_)!=128){m--;continue}if(m>=u)return this.interim[0]=h,this.interim[1]=g,this.interim[2]=_,v;if(y=c[m++],(192&y)!=128){m--;continue}if(f=(7&h)<<18|(63&g)<<12|(63&_)<<6|63&y,f<65536||f>1114111)continue;l[v++]=f}}return v}}},225:(a,s,c)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.UnicodeV6=void 0;const l=c(1480),u=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],h=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]];let g;s.UnicodeV6=class{constructor(){if(this.version="6",!g){g=new Uint8Array(65536),g.fill(1),g[0]=0,g.fill(0,1,32),g.fill(0,127,160),g.fill(2,4352,4448),g[9001]=2,g[9002]=2,g.fill(2,11904,42192),g[12351]=1,g.fill(2,44032,55204),g.fill(2,63744,64256),g.fill(2,65040,65050),g.fill(2,65072,65136),g.fill(2,65280,65377),g.fill(2,65504,65511);for(let _=0;_<u.length;++_)g.fill(0,u[_][0],u[_][1]+1)}}wcwidth(_){return _<32?0:_<127?1:_<65536?g[_]:function(y,v){let f,p=0,d=v.length-1;if(y<v[0][0]||y>v[d][1])return!1;for(;d>=p;)if(f=p+d>>1,y>v[f][1])p=f+1;else{if(!(y<v[f][0]))return!0;d=f-1}return!1}(_,h)?0:_>=131072&&_<=196605||_>=196608&&_<=262141?2:1}charProperties(_,y){let v=this.wcwidth(_),f=v===0&&y!==0;if(f){const p=l.UnicodeService.extractWidth(y);p===0?f=!1:p>v&&(v=p)}return l.UnicodeService.createPropertyValue(0,v,f)}}},5981:(a,s,c)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.WriteBuffer=void 0;const l=c(8460),u=c(844);class h extends u.Disposable{constructor(_){super(),this._action=_,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new l.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(_,y){if(y!==void 0&&this._syncCalls>y)return void(this._syncCalls=0);if(this._pendingData+=_.length,this._writeBuffer.push(_),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let v;for(this._isSyncWriting=!0;v=this._writeBuffer.shift();){this._action(v);const f=this._callbacks.shift();f&&f()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(_,y){if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=_.length,this._writeBuffer.push(_),this._callbacks.push(y),void this._innerWrite();setTimeout(()=>this._innerWrite())}this._pendingData+=_.length,this._writeBuffer.push(_),this._callbacks.push(y)}_innerWrite(_=0,y=!0){const v=_||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){const f=this._writeBuffer[this._bufferOffset],p=this._action(f,y);if(p){const m=b=>Date.now()-v>=12?setTimeout(()=>this._innerWrite(0,b)):this._innerWrite(v,b);return void p.catch(b=>(queueMicrotask(()=>{throw b}),Promise.resolve(!1))).then(m)}const d=this._callbacks[this._bufferOffset];if(d&&d(),this._bufferOffset++,this._pendingData-=f.length,Date.now()-v>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}s.WriteBuffer=h},5941:(a,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.toRgbString=s.parseColor=void 0;const c=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,l=/^[\da-f]+$/;function u(h,g){const _=h.toString(16),y=_.length<2?"0"+_:_;switch(g){case 4:return _[0];case 8:return y;case 12:return(y+y).slice(0,3);default:return y+y}}s.parseColor=function(h){if(!h)return;let g=h.toLowerCase();if(g.indexOf("rgb:")===0){g=g.slice(4);const _=c.exec(g);if(_){const y=_[1]?15:_[4]?255:_[7]?4095:65535;return[Math.round(parseInt(_[1]||_[4]||_[7]||_[10],16)/y*255),Math.round(parseInt(_[2]||_[5]||_[8]||_[11],16)/y*255),Math.round(parseInt(_[3]||_[6]||_[9]||_[12],16)/y*255)]}}else if(g.indexOf("#")===0&&(g=g.slice(1),l.exec(g)&&[3,6,9,12].includes(g.length))){const _=g.length/3,y=[0,0,0];for(let v=0;v<3;++v){const f=parseInt(g.slice(_*v,_*v+_),16);y[v]=_===1?f<<4:_===2?f:_===3?f>>4:f>>8}return y}},s.toRgbString=function(h,g=16){const[_,y,v]=h;return`rgb:${u(_,g)}/${u(y,g)}/${u(v,g)}`}},5770:(a,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.PAYLOAD_LIMIT=void 0,s.PAYLOAD_LIMIT=1e7},6351:(a,s,c)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.DcsHandler=s.DcsParser=void 0;const l=c(482),u=c(8742),h=c(5770),g=[];s.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=g,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=g}registerHandler(y,v){this._handlers[y]===void 0&&(this._handlers[y]=[]);const f=this._handlers[y];return f.push(v),{dispose:()=>{const p=f.indexOf(v);p!==-1&&f.splice(p,1)}}}clearHandler(y){this._handlers[y]&&delete this._handlers[y]}setHandlerFallback(y){this._handlerFb=y}reset(){if(this._active.length)for(let y=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;y>=0;--y)this._active[y].unhook(!1);this._stack.paused=!1,this._active=g,this._ident=0}hook(y,v){if(this.reset(),this._ident=y,this._active=this._handlers[y]||g,this._active.length)for(let f=this._active.length-1;f>=0;f--)this._active[f].hook(v);else this._handlerFb(this._ident,"HOOK",v)}put(y,v,f){if(this._active.length)for(let p=this._active.length-1;p>=0;p--)this._active[p].put(y,v,f);else this._handlerFb(this._ident,"PUT",(0,l.utf32ToString)(y,v,f))}unhook(y,v=!0){if(this._active.length){let f=!1,p=this._active.length-1,d=!1;if(this._stack.paused&&(p=this._stack.loopPosition-1,f=v,d=this._stack.fallThrough,this._stack.paused=!1),!d&&f===!1){for(;p>=0&&(f=this._active[p].unhook(y),f!==!0);p--)if(f instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=p,this._stack.fallThrough=!1,f;p--}for(;p>=0;p--)if(f=this._active[p].unhook(!1),f instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=p,this._stack.fallThrough=!0,f}else this._handlerFb(this._ident,"UNHOOK",y);this._active=g,this._ident=0}};const _=new u.Params;_.addParam(0),s.DcsHandler=class{constructor(y){this._handler=y,this._data="",this._params=_,this._hitLimit=!1}hook(y){this._params=y.length>1||y.params[0]?y.clone():_,this._data="",this._hitLimit=!1}put(y,v,f){this._hitLimit||(this._data+=(0,l.utf32ToString)(y,v,f),this._data.length>h.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(y){let v=!1;if(this._hitLimit)v=!1;else if(y&&(v=this._handler(this._data,this._params),v instanceof Promise))return v.then(f=>(this._params=_,this._data="",this._hitLimit=!1,f));return this._params=_,this._data="",this._hitLimit=!1,v}}},2015:(a,s,c)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.EscapeSequenceParser=s.VT500_TRANSITION_TABLE=s.TransitionTable=void 0;const l=c(844),u=c(8742),h=c(6242),g=c(6351);class _{constructor(p){this.table=new Uint8Array(p)}setDefault(p,d){this.table.fill(p<<4|d)}add(p,d,m,b){this.table[d<<8|p]=m<<4|b}addMany(p,d,m,b){for(let C=0;C<p.length;C++)this.table[d<<8|p[C]]=m<<4|b}}s.TransitionTable=_;const y=160;s.VT500_TRANSITION_TABLE=function(){const f=new _(4095),p=Array.apply(null,Array(256)).map((T,S)=>S),d=(T,S)=>p.slice(T,S),m=d(32,127),b=d(0,24);b.push(25),b.push.apply(b,d(28,32));const C=d(0,14);let w;for(w in f.setDefault(1,0),f.addMany(m,0,2,0),C)f.addMany([24,26,153,154],w,3,0),f.addMany(d(128,144),w,3,0),f.addMany(d(144,152),w,3,0),f.add(156,w,0,0),f.add(27,w,11,1),f.add(157,w,4,8),f.addMany([152,158,159],w,0,7),f.add(155,w,11,3),f.add(144,w,11,9);return f.addMany(b,0,3,0),f.addMany(b,1,3,1),f.add(127,1,0,1),f.addMany(b,8,0,8),f.addMany(b,3,3,3),f.add(127,3,0,3),f.addMany(b,4,3,4),f.add(127,4,0,4),f.addMany(b,6,3,6),f.addMany(b,5,3,5),f.add(127,5,0,5),f.addMany(b,2,3,2),f.add(127,2,0,2),f.add(93,1,4,8),f.addMany(m,8,5,8),f.add(127,8,5,8),f.addMany([156,27,24,26,7],8,6,0),f.addMany(d(28,32),8,0,8),f.addMany([88,94,95],1,0,7),f.addMany(m,7,0,7),f.addMany(b,7,0,7),f.add(156,7,0,0),f.add(127,7,0,7),f.add(91,1,11,3),f.addMany(d(64,127),3,7,0),f.addMany(d(48,60),3,8,4),f.addMany([60,61,62,63],3,9,4),f.addMany(d(48,60),4,8,4),f.addMany(d(64,127),4,7,0),f.addMany([60,61,62,63],4,0,6),f.addMany(d(32,64),6,0,6),f.add(127,6,0,6),f.addMany(d(64,127),6,0,0),f.addMany(d(32,48),3,9,5),f.addMany(d(32,48),5,9,5),f.addMany(d(48,64),5,0,6),f.addMany(d(64,127),5,7,0),f.addMany(d(32,48),4,9,5),f.addMany(d(32,48),1,9,2),f.addMany(d(32,48),2,9,2),f.addMany(d(48,127),2,10,0),f.addMany(d(48,80),1,10,0),f.addMany(d(81,88),1,10,0),f.addMany([89,90,92],1,10,0),f.addMany(d(96,127),1,10,0),f.add(80,1,11,9),f.addMany(b,9,0,9),f.add(127,9,0,9),f.addMany(d(28,32),9,0,9),f.addMany(d(32,48),9,9,12),f.addMany(d(48,60),9,8,10),f.addMany([60,61,62,63],9,9,10),f.addMany(b,11,0,11),f.addMany(d(32,128),11,0,11),f.addMany(d(28,32),11,0,11),f.addMany(b,10,0,10),f.add(127,10,0,10),f.addMany(d(28,32),10,0,10),f.addMany(d(48,60),10,8,10),f.addMany([60,61,62,63],10,0,11),f.addMany(d(32,48),10,9,12),f.addMany(b,12,0,12),f.add(127,12,0,12),f.addMany(d(28,32),12,0,12),f.addMany(d(32,48),12,9,12),f.addMany(d(48,64),12,0,11),f.addMany(d(64,127),12,12,13),f.addMany(d(64,127),10,12,13),f.addMany(d(64,127),9,12,13),f.addMany(b,13,13,13),f.addMany(m,13,13,13),f.add(127,13,0,13),f.addMany([27,156,24,26],13,14,0),f.add(y,0,2,0),f.add(y,8,5,8),f.add(y,6,0,6),f.add(y,11,0,11),f.add(y,13,13,13),f}();class v extends l.Disposable{constructor(p=s.VT500_TRANSITION_TABLE){super(),this._transitions=p,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new u.Params,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(d,m,b)=>{},this._executeHandlerFb=d=>{},this._csiHandlerFb=(d,m)=>{},this._escHandlerFb=d=>{},this._errorHandlerFb=d=>d,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register((0,l.toDisposable)(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this.register(new h.OscParser),this._dcsParser=this.register(new g.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier(p,d=[64,126]){let m=0;if(p.prefix){if(p.prefix.length>1)throw new Error("only one byte as prefix supported");if(m=p.prefix.charCodeAt(0),m&&60>m||m>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(p.intermediates){if(p.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let C=0;C<p.intermediates.length;++C){const w=p.intermediates.charCodeAt(C);if(32>w||w>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");m<<=8,m|=w}}if(p.final.length!==1)throw new Error("final must be a single byte");const b=p.final.charCodeAt(0);if(d[0]>b||b>d[1])throw new Error(`final must be in range ${d[0]} .. ${d[1]}`);return m<<=8,m|=b,m}identToString(p){const d=[];for(;p;)d.push(String.fromCharCode(255&p)),p>>=8;return d.reverse().join("")}setPrintHandler(p){this._printHandler=p}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(p,d){const m=this._identifier(p,[48,126]);this._escHandlers[m]===void 0&&(this._escHandlers[m]=[]);const b=this._escHandlers[m];return b.push(d),{dispose:()=>{const C=b.indexOf(d);C!==-1&&b.splice(C,1)}}}clearEscHandler(p){this._escHandlers[this._identifier(p,[48,126])]&&delete this._escHandlers[this._identifier(p,[48,126])]}setEscHandlerFallback(p){this._escHandlerFb=p}setExecuteHandler(p,d){this._executeHandlers[p.charCodeAt(0)]=d}clearExecuteHandler(p){this._executeHandlers[p.charCodeAt(0)]&&delete this._executeHandlers[p.charCodeAt(0)]}setExecuteHandlerFallback(p){this._executeHandlerFb=p}registerCsiHandler(p,d){const m=this._identifier(p);this._csiHandlers[m]===void 0&&(this._csiHandlers[m]=[]);const b=this._csiHandlers[m];return b.push(d),{dispose:()=>{const C=b.indexOf(d);C!==-1&&b.splice(C,1)}}}clearCsiHandler(p){this._csiHandlers[this._identifier(p)]&&delete this._csiHandlers[this._identifier(p)]}setCsiHandlerFallback(p){this._csiHandlerFb=p}registerDcsHandler(p,d){return this._dcsParser.registerHandler(this._identifier(p),d)}clearDcsHandler(p){this._dcsParser.clearHandler(this._identifier(p))}setDcsHandlerFallback(p){this._dcsParser.setHandlerFallback(p)}registerOscHandler(p,d){return this._oscParser.registerHandler(p,d)}clearOscHandler(p){this._oscParser.clearHandler(p)}setOscHandlerFallback(p){this._oscParser.setHandlerFallback(p)}setErrorHandler(p){this._errorHandler=p}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(p,d,m,b,C){this._parseStack.state=p,this._parseStack.handlers=d,this._parseStack.handlerPos=m,this._parseStack.transition=b,this._parseStack.chunkPos=C}parse(p,d,m){let b,C=0,w=0,T=0;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,T=this._parseStack.chunkPos+1;else{if(m===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");const S=this._parseStack.handlers;let k=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(m===!1&&k>-1){for(;k>=0&&(b=S[k](this._params),b!==!0);k--)if(b instanceof Promise)return this._parseStack.handlerPos=k,b}this._parseStack.handlers=[];break;case 4:if(m===!1&&k>-1){for(;k>=0&&(b=S[k](),b!==!0);k--)if(b instanceof Promise)return this._parseStack.handlerPos=k,b}this._parseStack.handlers=[];break;case 6:if(C=p[this._parseStack.chunkPos],b=this._dcsParser.unhook(C!==24&&C!==26,m),b)return b;C===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(C=p[this._parseStack.chunkPos],b=this._oscParser.end(C!==24&&C!==26,m),b)return b;C===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,T=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=15&this._parseStack.transition}for(let S=T;S<d;++S){switch(C=p[S],w=this._transitions.table[this.currentState<<8|(C<160?C:y)],w>>4){case 2:for(let D=S+1;;++D){if(D>=d||(C=p[D])<32||C>126&&C<y){this._printHandler(p,S,D),S=D-1;break}if(++D>=d||(C=p[D])<32||C>126&&C<y){this._printHandler(p,S,D),S=D-1;break}if(++D>=d||(C=p[D])<32||C>126&&C<y){this._printHandler(p,S,D),S=D-1;break}if(++D>=d||(C=p[D])<32||C>126&&C<y){this._printHandler(p,S,D),S=D-1;break}}break;case 3:this._executeHandlers[C]?this._executeHandlers[C]():this._executeHandlerFb(C),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:S,code:C,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:const k=this._csiHandlers[this._collect<<8|C];let O=k?k.length-1:-1;for(;O>=0&&(b=k[O](this._params),b!==!0);O--)if(b instanceof Promise)return this._preserveStack(3,k,O,w,S),b;O<0&&this._csiHandlerFb(this._collect<<8|C,this._params),this.precedingJoinState=0;break;case 8:do switch(C){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(C-48)}while(++S<d&&(C=p[S])>47&&C<60);S--;break;case 9:this._collect<<=8,this._collect|=C;break;case 10:const L=this._escHandlers[this._collect<<8|C];let M=L?L.length-1:-1;for(;M>=0&&(b=L[M](),b!==!0);M--)if(b instanceof Promise)return this._preserveStack(4,L,M,w,S),b;M<0&&this._escHandlerFb(this._collect<<8|C),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|C,this._params);break;case 13:for(let D=S+1;;++D)if(D>=d||(C=p[D])===24||C===26||C===27||C>127&&C<y){this._dcsParser.put(p,S,D),S=D-1;break}break;case 14:if(b=this._dcsParser.unhook(C!==24&&C!==26),b)return this._preserveStack(6,[],0,w,S),b;C===27&&(w|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let D=S+1;;D++)if(D>=d||(C=p[D])<32||C>127&&C<y){this._oscParser.put(p,S,D),S=D-1;break}break;case 6:if(b=this._oscParser.end(C!==24&&C!==26),b)return this._preserveStack(5,[],0,w,S),b;C===27&&(w|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0}this.currentState=15&w}}}s.EscapeSequenceParser=v},6242:(a,s,c)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.OscHandler=s.OscParser=void 0;const l=c(5770),u=c(482),h=[];s.OscParser=class{constructor(){this._state=0,this._active=h,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(g,_){this._handlers[g]===void 0&&(this._handlers[g]=[]);const y=this._handlers[g];return y.push(_),{dispose:()=>{const v=y.indexOf(_);v!==-1&&y.splice(v,1)}}}clearHandler(g){this._handlers[g]&&delete this._handlers[g]}setHandlerFallback(g){this._handlerFb=g}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=h}reset(){if(this._state===2)for(let g=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;g>=0;--g)this._active[g].end(!1);this._stack.paused=!1,this._active=h,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||h,this._active.length)for(let g=this._active.length-1;g>=0;g--)this._active[g].start();else this._handlerFb(this._id,"START")}_put(g,_,y){if(this._active.length)for(let v=this._active.length-1;v>=0;v--)this._active[v].put(g,_,y);else this._handlerFb(this._id,"PUT",(0,u.utf32ToString)(g,_,y))}start(){this.reset(),this._state=1}put(g,_,y){if(this._state!==3){if(this._state===1)for(;_<y;){const v=g[_++];if(v===59){this._state=2,this._start();break}if(v<48||57<v)return void(this._state=3);this._id===-1&&(this._id=0),this._id=10*this._id+v-48}this._state===2&&y-_>0&&this._put(g,_,y)}}end(g,_=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),this._active.length){let y=!1,v=this._active.length-1,f=!1;if(this._stack.paused&&(v=this._stack.loopPosition-1,y=_,f=this._stack.fallThrough,this._stack.paused=!1),!f&&y===!1){for(;v>=0&&(y=this._active[v].end(g),y!==!0);v--)if(y instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=v,this._stack.fallThrough=!1,y;v--}for(;v>=0;v--)if(y=this._active[v].end(!1),y instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=v,this._stack.fallThrough=!0,y}else this._handlerFb(this._id,"END",g);this._active=h,this._id=-1,this._state=0}}},s.OscHandler=class{constructor(g){this._handler=g,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(g,_,y){this._hitLimit||(this._data+=(0,u.utf32ToString)(g,_,y),this._data.length>l.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(g){let _=!1;if(this._hitLimit)_=!1;else if(g&&(_=this._handler(this._data),_ instanceof Promise))return _.then(y=>(this._data="",this._hitLimit=!1,y));return this._data="",this._hitLimit=!1,_}}},8742:(a,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.Params=void 0;const c=2147483647;class l{static fromArray(h){const g=new l;if(!h.length)return g;for(let _=Array.isArray(h[0])?1:0;_<h.length;++_){const y=h[_];if(Array.isArray(y))for(let v=0;v<y.length;++v)g.addSubParam(y[v]);else g.addParam(y)}return g}constructor(h=32,g=32){if(this.maxLength=h,this.maxSubParamsLength=g,g>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(h),this.length=0,this._subParams=new Int32Array(g),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(h),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}clone(){const h=new l(this.maxLength,this.maxSubParamsLength);return h.params.set(this.params),h.length=this.length,h._subParams.set(this._subParams),h._subParamsLength=this._subParamsLength,h._subParamsIdx.set(this._subParamsIdx),h._rejectDigits=this._rejectDigits,h._rejectSubDigits=this._rejectSubDigits,h._digitIsSub=this._digitIsSub,h}toArray(){const h=[];for(let g=0;g<this.length;++g){h.push(this.params[g]);const _=this._subParamsIdx[g]>>8,y=255&this._subParamsIdx[g];y-_>0&&h.push(Array.prototype.slice.call(this._subParams,_,y))}return h}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(h){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(h<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=h>c?c:h}}addSubParam(h){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(h<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=h>c?c:h,this._subParamsIdx[this.length-1]++}}hasSubParams(h){return(255&this._subParamsIdx[h])-(this._subParamsIdx[h]>>8)>0}getSubParams(h){const g=this._subParamsIdx[h]>>8,_=255&this._subParamsIdx[h];return _-g>0?this._subParams.subarray(g,_):null}getSubParamsAll(){const h={};for(let g=0;g<this.length;++g){const _=this._subParamsIdx[g]>>8,y=255&this._subParamsIdx[g];y-_>0&&(h[g]=this._subParams.slice(_,y))}return h}addDigit(h){let g;if(this._rejectDigits||!(g=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;const _=this._digitIsSub?this._subParams:this.params,y=_[g-1];_[g-1]=~y?Math.min(10*y+h,c):h}}s.Params=l},5741:(a,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.AddonManager=void 0,s.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let c=this._addons.length-1;c>=0;c--)this._addons[c].instance.dispose()}loadAddon(c,l){const u={instance:l,dispose:l.dispose,isDisposed:!1};this._addons.push(u),l.dispose=()=>this._wrappedAddonDispose(u),l.activate(c)}_wrappedAddonDispose(c){if(c.isDisposed)return;let l=-1;for(let u=0;u<this._addons.length;u++)if(this._addons[u]===c){l=u;break}if(l===-1)throw new Error("Could not dispose an addon that has not been loaded");c.isDisposed=!0,c.dispose.apply(c.instance),this._addons.splice(l,1)}}},8771:(a,s,c)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.BufferApiView=void 0;const l=c(3785),u=c(511);s.BufferApiView=class{constructor(h,g){this._buffer=h,this.type=g}init(h){return this._buffer=h,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(h){const g=this._buffer.lines.get(h);if(g)return new l.BufferLineApiView(g)}getNullCell(){return new u.CellData}}},3785:(a,s,c)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.BufferLineApiView=void 0;const l=c(511);s.BufferLineApiView=class{constructor(u){this._line=u}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(u,h){if(!(u<0||u>=this._line.length))return h?(this._line.loadCell(u,h),h):this._line.loadCell(u,new l.CellData)}translateToString(u,h,g){return this._line.translateToString(u,h,g)}}},8285:(a,s,c)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.BufferNamespaceApi=void 0;const l=c(8771),u=c(8460),h=c(844);class g extends h.Disposable{constructor(y){super(),this._core=y,this._onBufferChange=this.register(new u.EventEmitter),this.onBufferChange=this._onBufferChange.event,this._normal=new l.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new l.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}s.BufferNamespaceApi=g},7975:(a,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.ParserApi=void 0,s.ParserApi=class{constructor(c){this._core=c}registerCsiHandler(c,l){return this._core.registerCsiHandler(c,u=>l(u.toArray()))}addCsiHandler(c,l){return this.registerCsiHandler(c,l)}registerDcsHandler(c,l){return this._core.registerDcsHandler(c,(u,h)=>l(u,h.toArray()))}addDcsHandler(c,l){return this.registerDcsHandler(c,l)}registerEscHandler(c,l){return this._core.registerEscHandler(c,l)}addEscHandler(c,l){return this.registerEscHandler(c,l)}registerOscHandler(c,l){return this._core.registerOscHandler(c,l)}addOscHandler(c,l){return this.registerOscHandler(c,l)}}},7090:(a,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.UnicodeApi=void 0,s.UnicodeApi=class{constructor(c){this._core=c}register(c){this._core.unicodeService.register(c)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(c){this._core.unicodeService.activeVersion=c}}},744:function(a,s,c){var l=this&&this.__decorate||function(f,p,d,m){var b,C=arguments.length,w=C<3?p:m===null?m=Object.getOwnPropertyDescriptor(p,d):m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")w=Reflect.decorate(f,p,d,m);else for(var T=f.length-1;T>=0;T--)(b=f[T])&&(w=(C<3?b(w):C>3?b(p,d,w):b(p,d))||w);return C>3&&w&&Object.defineProperty(p,d,w),w},u=this&&this.__param||function(f,p){return function(d,m){p(d,m,f)}};Object.defineProperty(s,"__esModule",{value:!0}),s.BufferService=s.MINIMUM_ROWS=s.MINIMUM_COLS=void 0;const h=c(8460),g=c(844),_=c(5295),y=c(2585);s.MINIMUM_COLS=2,s.MINIMUM_ROWS=1;let v=s.BufferService=class extends g.Disposable{get buffer(){return this.buffers.active}constructor(f){super(),this.isUserScrolling=!1,this._onResize=this.register(new h.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new h.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(f.rawOptions.cols||0,s.MINIMUM_COLS),this.rows=Math.max(f.rawOptions.rows||0,s.MINIMUM_ROWS),this.buffers=this.register(new _.BufferSet(f,this))}resize(f,p){this.cols=f,this.rows=p,this.buffers.resize(f,p),this._onResize.fire({cols:f,rows:p})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(f,p=!1){const d=this.buffer;let m;m=this._cachedBlankLine,m&&m.length===this.cols&&m.getFg(0)===f.fg&&m.getBg(0)===f.bg||(m=d.getBlankLine(f,p),this._cachedBlankLine=m),m.isWrapped=p;const b=d.ybase+d.scrollTop,C=d.ybase+d.scrollBottom;if(d.scrollTop===0){const w=d.lines.isFull;C===d.lines.length-1?w?d.lines.recycle().copyFrom(m):d.lines.push(m.clone()):d.lines.splice(C+1,0,m.clone()),w?this.isUserScrolling&&(d.ydisp=Math.max(d.ydisp-1,0)):(d.ybase++,this.isUserScrolling||d.ydisp++)}else{const w=C-b+1;d.lines.shiftElements(b+1,w-1,-1),d.lines.set(C,m.clone())}this.isUserScrolling||(d.ydisp=d.ybase),this._onScroll.fire(d.ydisp)}scrollLines(f,p,d){const m=this.buffer;if(f<0){if(m.ydisp===0)return;this.isUserScrolling=!0}else f+m.ydisp>=m.ybase&&(this.isUserScrolling=!1);const b=m.ydisp;m.ydisp=Math.max(Math.min(m.ydisp+f,m.ybase),0),b!==m.ydisp&&(p||this._onScroll.fire(m.ydisp))}};s.BufferService=v=l([u(0,y.IOptionsService)],v)},7994:(a,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.CharsetService=void 0,s.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(c){this.glevel=c,this.charset=this._charsets[c]}setgCharset(c,l){this._charsets[c]=l,this.glevel===c&&(this.charset=l)}}},1753:function(a,s,c){var l=this&&this.__decorate||function(m,b,C,w){var T,S=arguments.length,k=S<3?b:w===null?w=Object.getOwnPropertyDescriptor(b,C):w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")k=Reflect.decorate(m,b,C,w);else for(var O=m.length-1;O>=0;O--)(T=m[O])&&(k=(S<3?T(k):S>3?T(b,C,k):T(b,C))||k);return S>3&&k&&Object.defineProperty(b,C,k),k},u=this&&this.__param||function(m,b){return function(C,w){b(C,w,m)}};Object.defineProperty(s,"__esModule",{value:!0}),s.CoreMouseService=void 0;const h=c(2585),g=c(8460),_=c(844),y={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:m=>m.button!==4&&m.action===1&&(m.ctrl=!1,m.alt=!1,m.shift=!1,!0)},VT200:{events:19,restrict:m=>m.action!==32},DRAG:{events:23,restrict:m=>m.action!==32||m.button!==3},ANY:{events:31,restrict:m=>!0}};function v(m,b){let C=(m.ctrl?16:0)|(m.shift?4:0)|(m.alt?8:0);return m.button===4?(C|=64,C|=m.action):(C|=3&m.button,4&m.button&&(C|=64),8&m.button&&(C|=128),m.action===32?C|=32:m.action!==0||b||(C|=3)),C}const f=String.fromCharCode,p={DEFAULT:m=>{const b=[v(m,!1)+32,m.col+32,m.row+32];return b[0]>255||b[1]>255||b[2]>255?"":`\x1B[M${f(b[0])}${f(b[1])}${f(b[2])}`},SGR:m=>{const b=m.action===0&&m.button!==4?"m":"M";return`\x1B[<${v(m,!0)};${m.col};${m.row}${b}`},SGR_PIXELS:m=>{const b=m.action===0&&m.button!==4?"m":"M";return`\x1B[<${v(m,!0)};${m.x};${m.y}${b}`}};let d=s.CoreMouseService=class extends _.Disposable{constructor(m,b){super(),this._bufferService=m,this._coreService=b,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new g.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(const C of Object.keys(y))this.addProtocol(C,y[C]);for(const C of Object.keys(p))this.addEncoding(C,p[C]);this.reset()}addProtocol(m,b){this._protocols[m]=b}addEncoding(m,b){this._encodings[m]=b}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(m){if(!this._protocols[m])throw new Error(`unknown protocol "${m}"`);this._activeProtocol=m,this._onProtocolChange.fire(this._protocols[m].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(m){if(!this._encodings[m])throw new Error(`unknown encoding "${m}"`);this._activeEncoding=m}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(m){if(m.col<0||m.col>=this._bufferService.cols||m.row<0||m.row>=this._bufferService.rows||m.button===4&&m.action===32||m.button===3&&m.action!==32||m.button!==4&&(m.action===2||m.action===3)||(m.col++,m.row++,m.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,m,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(m))return!1;const b=this._encodings[this._activeEncoding](m);return b&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(b):this._coreService.triggerDataEvent(b,!0)),this._lastEvent=m,!0}explainEvents(m){return{down:!!(1&m),up:!!(2&m),drag:!!(4&m),move:!!(8&m),wheel:!!(16&m)}}_equalEvents(m,b,C){if(C){if(m.x!==b.x||m.y!==b.y)return!1}else if(m.col!==b.col||m.row!==b.row)return!1;return m.button===b.button&&m.action===b.action&&m.ctrl===b.ctrl&&m.alt===b.alt&&m.shift===b.shift}};s.CoreMouseService=d=l([u(0,h.IBufferService),u(1,h.ICoreService)],d)},6975:function(a,s,c){var l=this&&this.__decorate||function(d,m,b,C){var w,T=arguments.length,S=T<3?m:C===null?C=Object.getOwnPropertyDescriptor(m,b):C;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(d,m,b,C);else for(var k=d.length-1;k>=0;k--)(w=d[k])&&(S=(T<3?w(S):T>3?w(m,b,S):w(m,b))||S);return T>3&&S&&Object.defineProperty(m,b,S),S},u=this&&this.__param||function(d,m){return function(b,C){m(b,C,d)}};Object.defineProperty(s,"__esModule",{value:!0}),s.CoreService=void 0;const h=c(1439),g=c(8460),_=c(844),y=c(2585),v=Object.freeze({insertMode:!1}),f=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0});let p=s.CoreService=class extends _.Disposable{constructor(d,m,b){super(),this._bufferService=d,this._logService=m,this._optionsService=b,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new g.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new g.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new g.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new g.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,h.clone)(v),this.decPrivateModes=(0,h.clone)(f)}reset(){this.modes=(0,h.clone)(v),this.decPrivateModes=(0,h.clone)(f)}triggerDataEvent(d,m=!1){if(this._optionsService.rawOptions.disableStdin)return;const b=this._bufferService.buffer;m&&this._optionsService.rawOptions.scrollOnUserInput&&b.ybase!==b.ydisp&&this._onRequestScrollToBottom.fire(),m&&this._onUserInput.fire(),this._logService.debug(`sending data "${d}"`,()=>d.split("").map(C=>C.charCodeAt(0))),this._onData.fire(d)}triggerBinaryEvent(d){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${d}"`,()=>d.split("").map(m=>m.charCodeAt(0))),this._onBinary.fire(d))}};s.CoreService=p=l([u(0,y.IBufferService),u(1,y.ILogService),u(2,y.IOptionsService)],p)},9074:(a,s,c)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.DecorationService=void 0;const l=c(8055),u=c(8460),h=c(844),g=c(6106);let _=0,y=0;class v extends h.Disposable{get decorations(){return this._decorations.values()}constructor(){super(),this._decorations=new g.SortedList(d=>d==null?void 0:d.marker.line),this._onDecorationRegistered=this.register(new u.EventEmitter),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this.register(new u.EventEmitter),this.onDecorationRemoved=this._onDecorationRemoved.event,this.register((0,h.toDisposable)(()=>this.reset()))}registerDecoration(d){if(d.marker.isDisposed)return;const m=new f(d);if(m){const b=m.marker.onDispose(()=>m.dispose());m.onDispose(()=>{m&&(this._decorations.delete(m)&&this._onDecorationRemoved.fire(m),b.dispose())}),this._decorations.insert(m),this._onDecorationRegistered.fire(m)}return m}reset(){for(const d of this._decorations.values())d.dispose();this._decorations.clear()}*getDecorationsAtCell(d,m,b){let C=0,w=0;for(const T of this._decorations.getKeyIterator(m))C=T.options.x??0,w=C+(T.options.width??1),d>=C&&d<w&&(!b||(T.options.layer??"bottom")===b)&&(yield T)}forEachDecorationAtCell(d,m,b,C){this._decorations.forEachByKey(m,w=>{_=w.options.x??0,y=_+(w.options.width??1),d>=_&&d<y&&(!b||(w.options.layer??"bottom")===b)&&C(w)})}}s.DecorationService=v;class f extends h.Disposable{get isDisposed(){return this._isDisposed}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=l.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=l.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}constructor(d){super(),this.options=d,this.onRenderEmitter=this.register(new u.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new u.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=d.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}dispose(){this._onDispose.fire(),super.dispose()}}},4348:(a,s,c)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.InstantiationService=s.ServiceCollection=void 0;const l=c(2585),u=c(8343);class h{constructor(..._){this._entries=new Map;for(const[y,v]of _)this.set(y,v)}set(_,y){const v=this._entries.get(_);return this._entries.set(_,y),v}forEach(_){for(const[y,v]of this._entries.entries())_(y,v)}has(_){return this._entries.has(_)}get(_){return this._entries.get(_)}}s.ServiceCollection=h,s.InstantiationService=class{constructor(){this._services=new h,this._services.set(l.IInstantiationService,this)}setService(g,_){this._services.set(g,_)}getService(g){return this._services.get(g)}createInstance(g,..._){const y=(0,u.getServiceDependencies)(g).sort((p,d)=>p.index-d.index),v=[];for(const p of y){const d=this._services.get(p.id);if(!d)throw new Error(`[createInstance] ${g.name} depends on UNKNOWN service ${p.id}.`);v.push(d)}const f=y.length>0?y[0].index:_.length;if(_.length!==f)throw new Error(`[createInstance] First service dependency of ${g.name} at position ${f+1} conflicts with ${_.length} static arguments`);return new g(..._,...v)}}},7866:function(a,s,c){var l=this&&this.__decorate||function(f,p,d,m){var b,C=arguments.length,w=C<3?p:m===null?m=Object.getOwnPropertyDescriptor(p,d):m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")w=Reflect.decorate(f,p,d,m);else for(var T=f.length-1;T>=0;T--)(b=f[T])&&(w=(C<3?b(w):C>3?b(p,d,w):b(p,d))||w);return C>3&&w&&Object.defineProperty(p,d,w),w},u=this&&this.__param||function(f,p){return function(d,m){p(d,m,f)}};Object.defineProperty(s,"__esModule",{value:!0}),s.traceCall=s.setTraceLogger=s.LogService=void 0;const h=c(844),g=c(2585),_={trace:g.LogLevelEnum.TRACE,debug:g.LogLevelEnum.DEBUG,info:g.LogLevelEnum.INFO,warn:g.LogLevelEnum.WARN,error:g.LogLevelEnum.ERROR,off:g.LogLevelEnum.OFF};let y,v=s.LogService=class extends h.Disposable{get logLevel(){return this._logLevel}constructor(f){super(),this._optionsService=f,this._logLevel=g.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),y=this}_updateLogLevel(){this._logLevel=_[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(f){for(let p=0;p<f.length;p++)typeof f[p]=="function"&&(f[p]=f[p]())}_log(f,p,d){this._evalLazyOptionalParams(d),f.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+p,...d)}trace(f,...p){var d;this._logLevel<=g.LogLevelEnum.TRACE&&this._log(((d=this._optionsService.options.logger)==null?void 0:d.trace.bind(this._optionsService.options.logger))??console.log,f,p)}debug(f,...p){var d;this._logLevel<=g.LogLevelEnum.DEBUG&&this._log(((d=this._optionsService.options.logger)==null?void 0:d.debug.bind(this._optionsService.options.logger))??console.log,f,p)}info(f,...p){var d;this._logLevel<=g.LogLevelEnum.INFO&&this._log(((d=this._optionsService.options.logger)==null?void 0:d.info.bind(this._optionsService.options.logger))??console.info,f,p)}warn(f,...p){var d;this._logLevel<=g.LogLevelEnum.WARN&&this._log(((d=this._optionsService.options.logger)==null?void 0:d.warn.bind(this._optionsService.options.logger))??console.warn,f,p)}error(f,...p){var d;this._logLevel<=g.LogLevelEnum.ERROR&&this._log(((d=this._optionsService.options.logger)==null?void 0:d.error.bind(this._optionsService.options.logger))??console.error,f,p)}};s.LogService=v=l([u(0,g.IOptionsService)],v),s.setTraceLogger=function(f){y=f},s.traceCall=function(f,p,d){if(typeof d.value!="function")throw new Error("not supported");const m=d.value;d.value=function(...b){if(y.logLevel!==g.LogLevelEnum.TRACE)return m.apply(this,b);y.trace(`GlyphRenderer#${m.name}(${b.map(w=>JSON.stringify(w)).join(", ")})`);const C=m.apply(this,b);return y.trace(`GlyphRenderer#${m.name} return`,C),C}}},7302:(a,s,c)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.OptionsService=s.DEFAULT_OPTIONS=void 0;const l=c(8460),u=c(844),h=c(6114);s.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rescaleOverlappingGlyphs:!1,rightClickSelectsWord:h.isMac,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};const g=["normal","bold","100","200","300","400","500","600","700","800","900"];class _ extends u.Disposable{constructor(v){super(),this._onOptionChange=this.register(new l.EventEmitter),this.onOptionChange=this._onOptionChange.event;const f={...s.DEFAULT_OPTIONS};for(const p in v)if(p in f)try{const d=v[p];f[p]=this._sanitizeAndValidateOption(p,d)}catch(d){console.error(d)}this.rawOptions=f,this.options={...f},this._setupOptions(),this.register((0,u.toDisposable)(()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null}))}onSpecificOptionChange(v,f){return this.onOptionChange(p=>{p===v&&f(this.rawOptions[v])})}onMultipleOptionChange(v,f){return this.onOptionChange(p=>{v.indexOf(p)!==-1&&f()})}_setupOptions(){const v=p=>{if(!(p in s.DEFAULT_OPTIONS))throw new Error(`No option with key "${p}"`);return this.rawOptions[p]},f=(p,d)=>{if(!(p in s.DEFAULT_OPTIONS))throw new Error(`No option with key "${p}"`);d=this._sanitizeAndValidateOption(p,d),this.rawOptions[p]!==d&&(this.rawOptions[p]=d,this._onOptionChange.fire(p))};for(const p in this.rawOptions){const d={get:v.bind(this,p),set:f.bind(this,p)};Object.defineProperty(this.options,p,d)}}_sanitizeAndValidateOption(v,f){switch(v){case"cursorStyle":if(f||(f=s.DEFAULT_OPTIONS[v]),!function(p){return p==="block"||p==="underline"||p==="bar"}(f))throw new Error(`"${f}" is not a valid value for ${v}`);break;case"wordSeparator":f||(f=s.DEFAULT_OPTIONS[v]);break;case"fontWeight":case"fontWeightBold":if(typeof f=="number"&&1<=f&&f<=1e3)break;f=g.includes(f)?f:s.DEFAULT_OPTIONS[v];break;case"cursorWidth":f=Math.floor(f);case"lineHeight":case"tabStopWidth":if(f<1)throw new Error(`${v} cannot be less than 1, value: ${f}`);break;case"minimumContrastRatio":f=Math.max(1,Math.min(21,Math.round(10*f)/10));break;case"scrollback":if((f=Math.min(f,4294967295))<0)throw new Error(`${v} cannot be less than 0, value: ${f}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(f<=0)throw new Error(`${v} cannot be less than or equal to 0, value: ${f}`);break;case"rows":case"cols":if(!f&&f!==0)throw new Error(`${v} must be numeric, value: ${f}`);break;case"windowsPty":f=f??{}}return f}}s.OptionsService=_},2660:function(a,s,c){var l=this&&this.__decorate||function(_,y,v,f){var p,d=arguments.length,m=d<3?y:f===null?f=Object.getOwnPropertyDescriptor(y,v):f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(_,y,v,f);else for(var b=_.length-1;b>=0;b--)(p=_[b])&&(m=(d<3?p(m):d>3?p(y,v,m):p(y,v))||m);return d>3&&m&&Object.defineProperty(y,v,m),m},u=this&&this.__param||function(_,y){return function(v,f){y(v,f,_)}};Object.defineProperty(s,"__esModule",{value:!0}),s.OscLinkService=void 0;const h=c(2585);let g=s.OscLinkService=class{constructor(_){this._bufferService=_,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(_){const y=this._bufferService.buffer;if(_.id===void 0){const b=y.addMarker(y.ybase+y.y),C={data:_,id:this._nextId++,lines:[b]};return b.onDispose(()=>this._removeMarkerFromLink(C,b)),this._dataByLinkId.set(C.id,C),C.id}const v=_,f=this._getEntryIdKey(v),p=this._entriesWithId.get(f);if(p)return this.addLineToLink(p.id,y.ybase+y.y),p.id;const d=y.addMarker(y.ybase+y.y),m={id:this._nextId++,key:this._getEntryIdKey(v),data:v,lines:[d]};return d.onDispose(()=>this._removeMarkerFromLink(m,d)),this._entriesWithId.set(m.key,m),this._dataByLinkId.set(m.id,m),m.id}addLineToLink(_,y){const v=this._dataByLinkId.get(_);if(v&&v.lines.every(f=>f.line!==y)){const f=this._bufferService.buffer.addMarker(y);v.lines.push(f),f.onDispose(()=>this._removeMarkerFromLink(v,f))}}getLinkData(_){var y;return(y=this._dataByLinkId.get(_))==null?void 0:y.data}_getEntryIdKey(_){return`${_.id};;${_.uri}`}_removeMarkerFromLink(_,y){const v=_.lines.indexOf(y);v!==-1&&(_.lines.splice(v,1),_.lines.length===0&&(_.data.id!==void 0&&this._entriesWithId.delete(_.key),this._dataByLinkId.delete(_.id)))}};s.OscLinkService=g=l([u(0,h.IBufferService)],g)},8343:(a,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.createDecorator=s.getServiceDependencies=s.serviceRegistry=void 0;const c="di$target",l="di$dependencies";s.serviceRegistry=new Map,s.getServiceDependencies=function(u){return u[l]||[]},s.createDecorator=function(u){if(s.serviceRegistry.has(u))return s.serviceRegistry.get(u);const h=function(g,_,y){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");(function(v,f,p){f[c]===f?f[l].push({id:v,index:p}):(f[l]=[{id:v,index:p}],f[c]=f)})(h,g,y)};return h.toString=()=>u,s.serviceRegistry.set(u,h),h}},2585:(a,s,c)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.IDecorationService=s.IUnicodeService=s.IOscLinkService=s.IOptionsService=s.ILogService=s.LogLevelEnum=s.IInstantiationService=s.ICharsetService=s.ICoreService=s.ICoreMouseService=s.IBufferService=void 0;const l=c(8343);var u;s.IBufferService=(0,l.createDecorator)("BufferService"),s.ICoreMouseService=(0,l.createDecorator)("CoreMouseService"),s.ICoreService=(0,l.createDecorator)("CoreService"),s.ICharsetService=(0,l.createDecorator)("CharsetService"),s.IInstantiationService=(0,l.createDecorator)("InstantiationService"),function(h){h[h.TRACE=0]="TRACE",h[h.DEBUG=1]="DEBUG",h[h.INFO=2]="INFO",h[h.WARN=3]="WARN",h[h.ERROR=4]="ERROR",h[h.OFF=5]="OFF"}(u||(s.LogLevelEnum=u={})),s.ILogService=(0,l.createDecorator)("LogService"),s.IOptionsService=(0,l.createDecorator)("OptionsService"),s.IOscLinkService=(0,l.createDecorator)("OscLinkService"),s.IUnicodeService=(0,l.createDecorator)("UnicodeService"),s.IDecorationService=(0,l.createDecorator)("DecorationService")},1480:(a,s,c)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.UnicodeService=void 0;const l=c(8460),u=c(225);class h{static extractShouldJoin(_){return(1&_)!=0}static extractWidth(_){return _>>1&3}static extractCharKind(_){return _>>3}static createPropertyValue(_,y,v=!1){return(16777215&_)<<3|(3&y)<<1|(v?1:0)}constructor(){this._providers=Object.create(null),this._active="",this._onChange=new l.EventEmitter,this.onChange=this._onChange.event;const _=new u.UnicodeV6;this.register(_),this._active=_.version,this._activeProvider=_}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(_){if(!this._providers[_])throw new Error(`unknown Unicode version "${_}"`);this._active=_,this._activeProvider=this._providers[_],this._onChange.fire(_)}register(_){this._providers[_.version]=_}wcwidth(_){return this._activeProvider.wcwidth(_)}getStringCellWidth(_){let y=0,v=0;const f=_.length;for(let p=0;p<f;++p){let d=_.charCodeAt(p);if(55296<=d&&d<=56319){if(++p>=f)return y+this.wcwidth(d);const C=_.charCodeAt(p);56320<=C&&C<=57343?d=1024*(d-55296)+C-56320+65536:y+=this.wcwidth(C)}const m=this.charProperties(d,v);let b=h.extractWidth(m);h.extractShouldJoin(m)&&(b-=h.extractWidth(v)),y+=b,v=m}return y}charProperties(_,y){return this._activeProvider.charProperties(_,y)}}s.UnicodeService=h}},r={};function n(a){var s=r[a];if(s!==void 0)return s.exports;var c=r[a]={exports:{}};return t[a].call(c.exports,c,c.exports,n),c.exports}var o={};return(()=>{var a=o;Object.defineProperty(a,"__esModule",{value:!0}),a.Terminal=void 0;const s=n(9042),c=n(3236),l=n(844),u=n(5741),h=n(8285),g=n(7975),_=n(7090),y=["cols","rows"];class v extends l.Disposable{constructor(p){super(),this._core=this.register(new c.Terminal(p)),this._addonManager=this.register(new u.AddonManager),this._publicOptions={...this._core.options};const d=b=>this._core.options[b],m=(b,C)=>{this._checkReadonlyOptions(b),this._core.options[b]=C};for(const b in this._core.options){const C={get:d.bind(this,b),set:m.bind(this,b)};Object.defineProperty(this._publicOptions,b,C)}}_checkReadonlyOptions(p){if(y.includes(p))throw new Error(`Option "${p}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new g.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new _.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this.register(new h.BufferNamespaceApi(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){const p=this._core.coreService.decPrivateModes;let d="none";switch(this._core.coreMouseService.activeProtocol){case"X10":d="x10";break;case"VT200":d="vt200";break;case"DRAG":d="drag";break;case"ANY":d="any"}return{applicationCursorKeysMode:p.applicationCursorKeys,applicationKeypadMode:p.applicationKeypad,bracketedPasteMode:p.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:d,originMode:p.origin,reverseWraparoundMode:p.reverseWraparound,sendFocusMode:p.sendFocus,wraparoundMode:p.wraparound}}get options(){return this._publicOptions}set options(p){for(const d in p)this._publicOptions[d]=p[d]}blur(){this._core.blur()}focus(){this._core.focus()}input(p,d=!0){this._core.input(p,d)}resize(p,d){this._verifyIntegers(p,d),this._core.resize(p,d)}open(p){this._core.open(p)}attachCustomKeyEventHandler(p){this._core.attachCustomKeyEventHandler(p)}attachCustomWheelEventHandler(p){this._core.attachCustomWheelEventHandler(p)}registerLinkProvider(p){return this._core.registerLinkProvider(p)}registerCharacterJoiner(p){return this._checkProposedApi(),this._core.registerCharacterJoiner(p)}deregisterCharacterJoiner(p){this._checkProposedApi(),this._core.deregisterCharacterJoiner(p)}registerMarker(p=0){return this._verifyIntegers(p),this._core.registerMarker(p)}registerDecoration(p){return this._checkProposedApi(),this._verifyPositiveIntegers(p.x??0,p.width??0,p.height??0),this._core.registerDecoration(p)}hasSelection(){return this._core.hasSelection()}select(p,d,m){this._verifyIntegers(p,d,m),this._core.select(p,d,m)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(p,d){this._verifyIntegers(p,d),this._core.selectLines(p,d)}dispose(){super.dispose()}scrollLines(p){this._verifyIntegers(p),this._core.scrollLines(p)}scrollPages(p){this._verifyIntegers(p),this._core.scrollPages(p)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(p){this._verifyIntegers(p),this._core.scrollToLine(p)}clear(){this._core.clear()}write(p,d){this._core.write(p,d)}writeln(p,d){this._core.write(p),this._core.write(`\r
`,d)}paste(p){this._core.paste(p)}refresh(p,d){this._verifyIntegers(p,d),this._core.refresh(p,d)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(p){this._addonManager.loadAddon(this,p)}static get strings(){return s}_verifyIntegers(...p){for(const d of p)if(d===1/0||isNaN(d)||d%1!=0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...p){for(const d of p)if(d&&(d===1/0||isNaN(d)||d%1!=0||d<0))throw new Error("This API only accepts positive integers")}}a.Terminal=v})(),o})())})(md);var ky=md.exports,vd={exports:{}};(function(i,e){(function(t,r){i.exports=r()})(self,()=>(()=>{var t={};return(()=>{var r=t;Object.defineProperty(r,"__esModule",{value:!0}),r.FitAddon=void 0,r.FitAddon=class{activate(n){this._terminal=n}dispose(){}fit(){const n=this.proposeDimensions();if(!n||!this._terminal||isNaN(n.cols)||isNaN(n.rows))return;const o=this._terminal._core;this._terminal.rows===n.rows&&this._terminal.cols===n.cols||(o._renderService.clear(),this._terminal.resize(n.cols,n.rows))}proposeDimensions(){if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;const n=this._terminal._core,o=n._renderService.dimensions;if(o.css.cell.width===0||o.css.cell.height===0)return;const a=this._terminal.options.scrollback===0?0:n.viewport.scrollBarWidth,s=window.getComputedStyle(this._terminal.element.parentElement),c=parseInt(s.getPropertyValue("height")),l=Math.max(0,parseInt(s.getPropertyValue("width"))),u=window.getComputedStyle(this._terminal.element),h=c-(parseInt(u.getPropertyValue("padding-top"))+parseInt(u.getPropertyValue("padding-bottom"))),g=l-(parseInt(u.getPropertyValue("padding-right"))+parseInt(u.getPropertyValue("padding-left")))-a;return{cols:Math.max(2,Math.floor(g/o.css.cell.width)),rows:Math.max(1,Math.floor(h/o.css.cell.height))}}}})(),t})())})(vd);var Ty=vd.exports,_d={exports:{}};(function(i,e){(function(t,r){i.exports=r()})(self,()=>(()=>{var t={6:(a,s)=>{function c(u){try{const h=new URL(u),g=h.password&&h.username?`${h.protocol}//${h.username}:${h.password}@${h.host}`:h.username?`${h.protocol}//${h.username}@${h.host}`:`${h.protocol}//${h.host}`;return u.toLocaleLowerCase().startsWith(g.toLocaleLowerCase())}catch{return!1}}Object.defineProperty(s,"__esModule",{value:!0}),s.LinkComputer=s.WebLinkProvider=void 0,s.WebLinkProvider=class{constructor(u,h,g,_={}){this._terminal=u,this._regex=h,this._handler=g,this._options=_}provideLinks(u,h){const g=l.computeLink(u,this._regex,this._terminal,this._handler);h(this._addCallbacks(g))}_addCallbacks(u){return u.map(h=>(h.leave=this._options.leave,h.hover=(g,_)=>{if(this._options.hover){const{range:y}=h;this._options.hover(g,_,y)}},h))}};class l{static computeLink(h,g,_,y){const v=new RegExp(g.source,(g.flags||"")+"g"),[f,p]=l._getWindowedLineStrings(h-1,_),d=f.join("");let m;const b=[];for(;m=v.exec(d);){const C=m[0];if(!c(C))continue;const[w,T]=l._mapStrIdx(_,p,0,m.index),[S,k]=l._mapStrIdx(_,w,T,C.length);if(w===-1||T===-1||S===-1||k===-1)continue;const O={start:{x:T+1,y:w+1},end:{x:k,y:S+1}};b.push({range:O,text:C,activate:y})}return b}static _getWindowedLineStrings(h,g){let _,y=h,v=h,f=0,p="";const d=[];if(_=g.buffer.active.getLine(h)){const m=_.translateToString(!0);if(_.isWrapped&&m[0]!==" "){for(f=0;(_=g.buffer.active.getLine(--y))&&f<2048&&(p=_.translateToString(!0),f+=p.length,d.push(p),_.isWrapped&&p.indexOf(" ")===-1););d.reverse()}for(d.push(m),f=0;(_=g.buffer.active.getLine(++v))&&_.isWrapped&&f<2048&&(p=_.translateToString(!0),f+=p.length,d.push(p),p.indexOf(" ")===-1););}return[d,y]}static _mapStrIdx(h,g,_,y){const v=h.buffer.active,f=v.getNullCell();let p=_;for(;y;){const d=v.getLine(g);if(!d)return[-1,-1];for(let m=p;m<d.length;++m){d.getCell(m,f);const b=f.getChars();if(f.getWidth()&&(y-=b.length||1,m===d.length-1&&b==="")){const C=v.getLine(g+1);C&&C.isWrapped&&(C.getCell(0,f),f.getWidth()===2&&(y+=1))}if(y<0)return[g,m]}g++,p=0}return[g,p]}}s.LinkComputer=l}},r={};function n(a){var s=r[a];if(s!==void 0)return s.exports;var c=r[a]={exports:{}};return t[a](c,c.exports,n),c.exports}var o={};return(()=>{var a=o;Object.defineProperty(a,"__esModule",{value:!0}),a.WebLinksAddon=void 0;const s=n(6),c=/(https?|HTTPS?):[/]{2}[^\s"'!*(){}|\\\^<>`]*[^\s"':,.!?{}|\\\^~\[\]`()<>]/;function l(u,h){const g=window.open();if(g){try{g.opener=null}catch{}g.location.href=h}else console.warn("Opening link blocked as opener could not be cleared")}a.WebLinksAddon=class{constructor(u=l,h={}){this._handler=u,this._options=h}activate(u){this._terminal=u;const h=this._options,g=h.urlRegex||c;this._linkProvider=this._terminal.registerLinkProvider(new s.WebLinkProvider(this._terminal,g,this._handler,h))}dispose(){var u;(u=this._linkProvider)==null||u.dispose()}}})(),o})())})(_d);var Ey=_d.exports;function Py(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function Qr(i){"@babel/helpers - typeof";return Qr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qr(i)}function Z0(i,e){if(Qr(i)!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var r=t.call(i,e||"default");if(Qr(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function bd(i){var e=Z0(i,"string");return Qr(e)=="symbol"?e:e+""}function ml(i,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(i,bd(r.key),r)}}function Ry(i,e,t){return e&&ml(i.prototype,e),t&&ml(i,t),Object.defineProperty(i,"prototype",{writable:!1}),i}function eb(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function xy(i,e){if(e&&(Qr(e)=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return eb(i)}function gl(i){return gl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},gl(i)}function ha(i,e){return ha=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},ha(i,e)}function Oy(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),e&&ha(i,e)}function Dy(i,e,t){return(e=bd(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Ay(i){if(i==null)throw new TypeError("Cannot destructure "+i)}function vl(){return vl=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(i[r]=t[r])}return i},vl.apply(null,arguments)}const tb=!!(typeof window<"u"&&window.document&&window.document.createElement);var $n;function Ly(i){if((!$n&&$n!==0||i)&&tb){var e=document.createElement("div");e.style.position="absolute",e.style.top="-9999px",e.style.width="50px",e.style.height="50px",e.style.overflow="scroll",document.body.appendChild(e),$n=e.offsetWidth-e.clientWidth,document.body.removeChild(e)}return $n}function ib(i,e){if(i==null)return{};var t={};for(var r in i)if({}.hasOwnProperty.call(i,r)){if(e.includes(r))continue;t[r]=i[r]}return t}function Iy(i,e){if(i==null)return{};var t,r,n=ib(i,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(i);for(r=0;r<o.length;r++)t=o[r],e.includes(t)||{}.propertyIsEnumerable.call(i,t)&&(n[t]=i[t])}return n}function ua(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,r=Array(e);t<e;t++)r[t]=i[t];return r}function rb(i){if(Array.isArray(i))return ua(i)}function nb(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function yd(i,e){if(i){if(typeof i=="string")return ua(i,e);var t={}.toString.call(i).slice(8,-1);return t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set"?Array.from(i):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?ua(i,e):void 0}}function sb(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function My(i){return rb(i)||nb(i)||yd(i)||sb()}function ob(i){if(Array.isArray(i))return i}function ab(i,e){var t=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t!=null){var r,n,o,a,s=[],c=!0,l=!1;try{if(o=(t=t.call(i)).next,e===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(r=o.call(t)).done)&&(s.push(r.value),s.length!==e);c=!0);}catch(u){l=!0,n=u}finally{try{if(!c&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(l)throw n}}return s}}function cb(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function By(i,e){return ob(i)||ab(i,e)||yd(i,e)||cb()}var Gs=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(i){return this.listeners.add(i),this.onSubscribe(),()=>{this.listeners.delete(i),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Xs=typeof window>"u"||"Deno"in globalThis;function mt(){}function lb(i,e){return typeof i=="function"?i(e):i}function hb(i){return typeof i=="number"&&i>=0&&i!==1/0}function ub(i,e){return Math.max(i+(e||0)-Date.now(),0)}function _l(i,e){return typeof i=="function"?i(e):i}function db(i,e){return typeof i=="function"?i(e):i}function bl(i,e){const{type:t="all",exact:r,fetchStatus:n,predicate:o,queryKey:a,stale:s}=i;if(a){if(r){if(e.queryHash!==qa(a,e.options))return!1}else if(!Dn(e.queryKey,a))return!1}if(t!=="all"){const c=e.isActive();if(t==="active"&&!c||t==="inactive"&&c)return!1}return!(typeof s=="boolean"&&e.isStale()!==s||n&&n!==e.state.fetchStatus||o&&!o(e))}function yl(i,e){const{exact:t,status:r,predicate:n,mutationKey:o}=i;if(o){if(!e.options.mutationKey)return!1;if(t){if(On(e.options.mutationKey)!==On(o))return!1}else if(!Dn(e.options.mutationKey,o))return!1}return!(r&&e.state.status!==r||n&&!n(e))}function qa(i,e){return((e==null?void 0:e.queryKeyHashFn)||On)(i)}function On(i){return JSON.stringify(i,(e,t)=>da(t)?Object.keys(t).sort().reduce((r,n)=>(r[n]=t[n],r),{}):t)}function Dn(i,e){return i===e?!0:typeof i!=typeof e?!1:i&&e&&typeof i=="object"&&typeof e=="object"?!Object.keys(e).some(t=>!Dn(i[t],e[t])):!1}function Sd(i,e){if(i===e)return i;const t=Sl(i)&&Sl(e);if(t||da(i)&&da(e)){const r=t?i:Object.keys(i),n=r.length,o=t?e:Object.keys(e),a=o.length,s=t?[]:{};let c=0;for(let l=0;l<a;l++){const u=t?l:o[l];(!t&&r.includes(u)||t)&&i[u]===void 0&&e[u]===void 0?(s[u]=void 0,c++):(s[u]=Sd(i[u],e[u]),s[u]===i[u]&&i[u]!==void 0&&c++)}return n===a&&c===n?i:s}return e}function Sl(i){return Array.isArray(i)&&i.length===Object.keys(i).length}function da(i){if(!Cl(i))return!1;const e=i.constructor;if(e===void 0)return!0;const t=e.prototype;return!(!Cl(t)||!t.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(i)!==Object.prototype)}function Cl(i){return Object.prototype.toString.call(i)==="[object Object]"}function fb(i){return new Promise(e=>{setTimeout(e,i)})}function pb(i,e,t){return typeof t.structuralSharing=="function"?t.structuralSharing(i,e):t.structuralSharing!==!1?Sd(i,e):e}function mb(i,e,t=0){const r=[...i,e];return t&&r.length>t?r.slice(1):r}function gb(i,e,t=0){const r=[e,...i];return t&&r.length>t?r.slice(0,-1):r}var Va=Symbol();function Cd(i,e){return!i.queryFn&&(e!=null&&e.initialPromise)?()=>e.initialPromise:!i.queryFn||i.queryFn===Va?()=>Promise.reject(new Error(`Missing queryFn: '${i.queryHash}'`)):i.queryFn}var hr,Vi,Mr,Tl,vb=(Tl=class extends Gs{constructor(){super();de(this,hr,void 0);de(this,Vi,void 0);de(this,Mr,void 0);le(this,Mr,e=>{if(!Xs&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}})}onSubscribe(){V(this,Vi)||this.setEventListener(V(this,Mr))}onUnsubscribe(){var e;this.hasListeners()||((e=V(this,Vi))==null||e.call(this),le(this,Vi,void 0))}setEventListener(e){var t;le(this,Mr,e),(t=V(this,Vi))==null||t.call(this),le(this,Vi,e(r=>{typeof r=="boolean"?this.setFocused(r):this.onFocus()}))}setFocused(e){V(this,hr)!==e&&(le(this,hr,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){var e;return typeof V(this,hr)=="boolean"?V(this,hr):((e=globalThis.document)==null?void 0:e.visibilityState)!=="hidden"}},hr=new WeakMap,Vi=new WeakMap,Mr=new WeakMap,Tl),wd=new vb,Br,Ji,Nr,El,_b=(El=class extends Gs{constructor(){super();de(this,Br,!0);de(this,Ji,void 0);de(this,Nr,void 0);le(this,Nr,e=>{if(!Xs&&window.addEventListener){const t=()=>e(!0),r=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",r,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",r)}}})}onSubscribe(){V(this,Ji)||this.setEventListener(V(this,Nr))}onUnsubscribe(){var e;this.hasListeners()||((e=V(this,Ji))==null||e.call(this),le(this,Ji,void 0))}setEventListener(e){var t;le(this,Nr,e),(t=V(this,Ji))==null||t.call(this),le(this,Ji,e(this.setOnline.bind(this)))}setOnline(e){V(this,Br)!==e&&(le(this,Br,e),this.listeners.forEach(r=>{r(e)}))}isOnline(){return V(this,Br)}},Br=new WeakMap,Ji=new WeakMap,Nr=new WeakMap,El),Os=new _b;function bb(){let i,e;const t=new Promise((n,o)=>{i=n,e=o});t.status="pending",t.catch(()=>{});function r(n){Object.assign(t,n),delete t.resolve,delete t.reject}return t.resolve=n=>{r({status:"fulfilled",value:n}),i(n)},t.reject=n=>{r({status:"rejected",reason:n}),e(n)},t}function yb(i){return Math.min(1e3*2**i,3e4)}function kd(i){return(i??"online")==="online"?Os.isOnline():!0}var Td=class extends Error{constructor(i){super("CancelledError"),this.revert=i==null?void 0:i.revert,this.silent=i==null?void 0:i.silent}};function Co(i){return i instanceof Td}function Ed(i){let e=!1,t=0,r=!1,n;const o=bb(),a=v=>{var f;r||(g(new Td(v)),(f=i.abort)==null||f.call(i))},s=()=>{e=!0},c=()=>{e=!1},l=()=>wd.isFocused()&&(i.networkMode==="always"||Os.isOnline())&&i.canRun(),u=()=>kd(i.networkMode)&&i.canRun(),h=v=>{var f;r||(r=!0,(f=i.onSuccess)==null||f.call(i,v),n==null||n(),o.resolve(v))},g=v=>{var f;r||(r=!0,(f=i.onError)==null||f.call(i,v),n==null||n(),o.reject(v))},_=()=>new Promise(v=>{var f;n=p=>{(r||l())&&v(p)},(f=i.onPause)==null||f.call(i)}).then(()=>{var v;n=void 0,r||(v=i.onContinue)==null||v.call(i)}),y=()=>{if(r)return;let v;const f=t===0?i.initialPromise:void 0;try{v=f??i.fn()}catch(p){v=Promise.reject(p)}Promise.resolve(v).then(h).catch(p=>{var w;if(r)return;const d=i.retry??(Xs?0:3),m=i.retryDelay??yb,b=typeof m=="function"?m(t,p):m,C=d===!0||typeof d=="number"&&t<d||typeof d=="function"&&d(t,p);if(e||!C){g(p);return}t++,(w=i.onFail)==null||w.call(i,t,p),fb(b).then(()=>l()?void 0:_()).then(()=>{e?g(p):y()})})};return{promise:o,cancel:a,continue:()=>(n==null||n(),o),cancelRetry:s,continueRetry:c,canStart:u,start:()=>(u()?y():_().then(y),o)}}function Sb(){let i=[],e=0,t=s=>{s()},r=s=>{s()},n=s=>setTimeout(s,0);const o=s=>{e?i.push(s):n(()=>{t(s)})},a=()=>{const s=i;i=[],s.length&&n(()=>{r(()=>{s.forEach(c=>{t(c)})})})};return{batch:s=>{let c;e++;try{c=s()}finally{e--,e||a()}return c},batchCalls:s=>(...c)=>{o(()=>{s(...c)})},schedule:o,setNotifyFunction:s=>{t=s},setBatchNotifyFunction:s=>{r=s},setScheduler:s=>{n=s}}}var Ve=Sb(),ur,Pl,Pd=(Pl=class{constructor(){de(this,ur,void 0)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),hb(this.gcTime)&&le(this,ur,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(i){this.gcTime=Math.max(this.gcTime||0,i??(Xs?1/0:5*60*1e3))}clearGcTimeout(){V(this,ur)&&(clearTimeout(V(this,ur)),le(this,ur,void 0))}},ur=new WeakMap,Pl),Fr,Ur,ct,Fe,An,dr,gt,ni,Rl,Cb=(Rl=class extends Pd{constructor(e){super();de(this,gt);de(this,Fr,void 0);de(this,Ur,void 0);de(this,ct,void 0);de(this,Fe,void 0);de(this,An,void 0);de(this,dr,void 0);le(this,dr,!1),le(this,An,e.defaultOptions),this.setOptions(e.options),this.observers=[],le(this,ct,e.cache),this.queryKey=e.queryKey,this.queryHash=e.queryHash,le(this,Fr,kb(this.options)),this.state=e.state??V(this,Fr),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var e;return(e=V(this,Fe))==null?void 0:e.promise}setOptions(e){this.options={...V(this,An),...e},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&V(this,ct).remove(this)}setData(e,t){const r=pb(this.state.data,e,this.options);return Ne(this,gt,ni).call(this,{data:r,type:"success",dataUpdatedAt:t==null?void 0:t.updatedAt,manual:t==null?void 0:t.manual}),r}setState(e,t){Ne(this,gt,ni).call(this,{type:"setState",state:e,setStateOptions:t})}cancel(e){var r,n;const t=(r=V(this,Fe))==null?void 0:r.promise;return(n=V(this,Fe))==null||n.cancel(e),t?t.then(mt).catch(mt):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(V(this,Fr))}isActive(){return this.observers.some(e=>db(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Va||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStale(){return this.state.isInvalidated?!0:this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0}isStaleByTime(e=0){return this.state.isInvalidated||this.state.data===void 0||!ub(this.state.dataUpdatedAt,e)}onFocus(){var t;const e=this.observers.find(r=>r.shouldFetchOnWindowFocus());e==null||e.refetch({cancelRefetch:!1}),(t=V(this,Fe))==null||t.continue()}onOnline(){var t;const e=this.observers.find(r=>r.shouldFetchOnReconnect());e==null||e.refetch({cancelRefetch:!1}),(t=V(this,Fe))==null||t.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),V(this,ct).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(V(this,Fe)&&(V(this,dr)?V(this,Fe).cancel({revert:!0}):V(this,Fe).cancelRetry()),this.scheduleGc()),V(this,ct).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Ne(this,gt,ni).call(this,{type:"invalidate"})}fetch(e,t){var c,l,u;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(t!=null&&t.cancelRefetch))this.cancel({silent:!0});else if(V(this,Fe))return V(this,Fe).continueRetry(),V(this,Fe).promise}if(e&&this.setOptions(e),!this.options.queryFn){const h=this.observers.find(g=>g.options.queryFn);h&&this.setOptions(h.options)}const r=new AbortController,n=h=>{Object.defineProperty(h,"signal",{enumerable:!0,get:()=>(le(this,dr,!0),r.signal)})},o=()=>{const h=Cd(this.options,t),g={queryKey:this.queryKey,meta:this.meta};return n(g),le(this,dr,!1),this.options.persister?this.options.persister(h,g,this):h(g)},a={fetchOptions:t,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:o};n(a),(c=this.options.behavior)==null||c.onFetch(a,this),le(this,Ur,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((l=a.fetchOptions)==null?void 0:l.meta))&&Ne(this,gt,ni).call(this,{type:"fetch",meta:(u=a.fetchOptions)==null?void 0:u.meta});const s=h=>{var g,_,y,v;Co(h)&&h.silent||Ne(this,gt,ni).call(this,{type:"error",error:h}),Co(h)||((_=(g=V(this,ct).config).onError)==null||_.call(g,h,this),(v=(y=V(this,ct).config).onSettled)==null||v.call(y,this.state.data,h,this)),this.scheduleGc()};return le(this,Fe,Ed({initialPromise:t==null?void 0:t.initialPromise,fn:a.fetchFn,abort:r.abort.bind(r),onSuccess:h=>{var g,_,y,v;if(h===void 0){s(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(h)}catch(f){s(f);return}(_=(g=V(this,ct).config).onSuccess)==null||_.call(g,h,this),(v=(y=V(this,ct).config).onSettled)==null||v.call(y,h,this.state.error,this),this.scheduleGc()},onError:s,onFail:(h,g)=>{Ne(this,gt,ni).call(this,{type:"failed",failureCount:h,error:g})},onPause:()=>{Ne(this,gt,ni).call(this,{type:"pause"})},onContinue:()=>{Ne(this,gt,ni).call(this,{type:"continue"})},retry:a.options.retry,retryDelay:a.options.retryDelay,networkMode:a.options.networkMode,canRun:()=>!0})),V(this,Fe).start()}},Fr=new WeakMap,Ur=new WeakMap,ct=new WeakMap,Fe=new WeakMap,An=new WeakMap,dr=new WeakMap,gt=new WeakSet,ni=function(e){const t=r=>{switch(e.type){case"failed":return{...r,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...wb(r.data,this.options),fetchMeta:e.meta??null};case"success":return{...r,data:e.data,dataUpdateCount:r.dataUpdateCount+1,dataUpdatedAt:e.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const n=e.error;return Co(n)&&n.revert&&V(this,Ur)?{...V(this,Ur),fetchStatus:"idle"}:{...r,error:n,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:n,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...e.state}}};this.state=t(this.state),Ve.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),V(this,ct).notify({query:this,type:"updated",action:e})})},Rl);function wb(i,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:kd(e.networkMode)?"fetching":"paused",...i===void 0&&{error:null,status:"pending"}}}function kb(i){const e=typeof i.initialData=="function"?i.initialData():i.initialData,t=e!==void 0,r=t?typeof i.initialDataUpdatedAt=="function"?i.initialDataUpdatedAt():i.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:t?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:t?"success":"pending",fetchStatus:"idle"}}var At,xl,Tb=(xl=class extends Gs{constructor(e={}){super();de(this,At,void 0);this.config=e,le(this,At,new Map)}build(e,t,r){const n=t.queryKey,o=t.queryHash??qa(n,t);let a=this.get(o);return a||(a=new Cb({cache:this,queryKey:n,queryHash:o,options:e.defaultQueryOptions(t),state:r,defaultOptions:e.getQueryDefaults(n)}),this.add(a)),a}add(e){V(this,At).has(e.queryHash)||(V(this,At).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=V(this,At).get(e.queryHash);t&&(e.destroy(),t===e&&V(this,At).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){Ve.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return V(this,At).get(e)}getAll(){return[...V(this,At).values()]}find(e){const t={exact:!0,...e};return this.getAll().find(r=>bl(t,r))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(r=>bl(e,r)):t}notify(e){Ve.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){Ve.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){Ve.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},At=new WeakMap,xl),Lt,We,fr,It,Wi,Ol,Eb=(Ol=class extends Pd{constructor(e){super();de(this,It);de(this,Lt,void 0);de(this,We,void 0);de(this,fr,void 0);this.mutationId=e.mutationId,le(this,We,e.mutationCache),le(this,Lt,[]),this.state=e.state||Pb(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){V(this,Lt).includes(e)||(V(this,Lt).push(e),this.clearGcTimeout(),V(this,We).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){le(this,Lt,V(this,Lt).filter(t=>t!==e)),this.scheduleGc(),V(this,We).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){V(this,Lt).length||(this.state.status==="pending"?this.scheduleGc():V(this,We).remove(this))}continue(){var e;return((e=V(this,fr))==null?void 0:e.continue())??this.execute(this.state.variables)}async execute(e){var n,o,a,s,c,l,u,h,g,_,y,v,f,p,d,m,b,C,w,T;le(this,fr,Ed({fn:()=>this.options.mutationFn?this.options.mutationFn(e):Promise.reject(new Error("No mutationFn found")),onFail:(S,k)=>{Ne(this,It,Wi).call(this,{type:"failed",failureCount:S,error:k})},onPause:()=>{Ne(this,It,Wi).call(this,{type:"pause"})},onContinue:()=>{Ne(this,It,Wi).call(this,{type:"continue"})},retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>V(this,We).canRun(this)}));const t=this.state.status==="pending",r=!V(this,fr).canStart();try{if(!t){Ne(this,It,Wi).call(this,{type:"pending",variables:e,isPaused:r}),await((o=(n=V(this,We).config).onMutate)==null?void 0:o.call(n,e,this));const k=await((s=(a=this.options).onMutate)==null?void 0:s.call(a,e));k!==this.state.context&&Ne(this,It,Wi).call(this,{type:"pending",context:k,variables:e,isPaused:r})}const S=await V(this,fr).start();return await((l=(c=V(this,We).config).onSuccess)==null?void 0:l.call(c,S,e,this.state.context,this)),await((h=(u=this.options).onSuccess)==null?void 0:h.call(u,S,e,this.state.context)),await((_=(g=V(this,We).config).onSettled)==null?void 0:_.call(g,S,null,this.state.variables,this.state.context,this)),await((v=(y=this.options).onSettled)==null?void 0:v.call(y,S,null,e,this.state.context)),Ne(this,It,Wi).call(this,{type:"success",data:S}),S}catch(S){try{throw await((p=(f=V(this,We).config).onError)==null?void 0:p.call(f,S,e,this.state.context,this)),await((m=(d=this.options).onError)==null?void 0:m.call(d,S,e,this.state.context)),await((C=(b=V(this,We).config).onSettled)==null?void 0:C.call(b,void 0,S,this.state.variables,this.state.context,this)),await((T=(w=this.options).onSettled)==null?void 0:T.call(w,void 0,S,e,this.state.context)),S}finally{Ne(this,It,Wi).call(this,{type:"error",error:S})}}finally{V(this,We).runNext(this)}}},Lt=new WeakMap,We=new WeakMap,fr=new WeakMap,It=new WeakSet,Wi=function(e){const t=r=>{switch(e.type){case"failed":return{...r,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...r,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:e.error,failureCount:r.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=t(this.state),Ve.batch(()=>{V(this,Lt).forEach(r=>{r.onMutationUpdate(e)}),V(this,We).notify({mutation:this,type:"updated",action:e})})},Ol);function Pb(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var et,Ln,Dl,Rb=(Dl=class extends Gs{constructor(e={}){super();de(this,et,void 0);de(this,Ln,void 0);this.config=e,le(this,et,new Map),le(this,Ln,Date.now())}build(e,t,r){const n=new Eb({mutationCache:this,mutationId:++jn(this,Ln)._,options:e.defaultMutationOptions(t),state:r});return this.add(n),n}add(e){const t=zn(e),r=V(this,et).get(t)??[];r.push(e),V(this,et).set(t,r),this.notify({type:"added",mutation:e})}remove(e){var r;const t=zn(e);if(V(this,et).has(t)){const n=(r=V(this,et).get(t))==null?void 0:r.filter(o=>o!==e);n&&(n.length===0?V(this,et).delete(t):V(this,et).set(t,n))}this.notify({type:"removed",mutation:e})}canRun(e){var r;const t=(r=V(this,et).get(zn(e)))==null?void 0:r.find(n=>n.state.status==="pending");return!t||t===e}runNext(e){var r;const t=(r=V(this,et).get(zn(e)))==null?void 0:r.find(n=>n!==e&&n.state.isPaused);return(t==null?void 0:t.continue())??Promise.resolve()}clear(){Ve.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}getAll(){return[...V(this,et).values()].flat()}find(e){const t={exact:!0,...e};return this.getAll().find(r=>yl(t,r))}findAll(e={}){return this.getAll().filter(t=>yl(e,t))}notify(e){Ve.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(t=>t.state.isPaused);return Ve.batch(()=>Promise.all(e.map(t=>t.continue().catch(mt))))}},et=new WeakMap,Ln=new WeakMap,Dl);function zn(i){var e;return((e=i.options.scope)==null?void 0:e.id)??String(i.mutationId)}function wl(i){return{onFetch:(e,t)=>{var u,h,g,_,y;const r=e.options,n=(g=(h=(u=e.fetchOptions)==null?void 0:u.meta)==null?void 0:h.fetchMore)==null?void 0:g.direction,o=((_=e.state.data)==null?void 0:_.pages)||[],a=((y=e.state.data)==null?void 0:y.pageParams)||[];let s={pages:[],pageParams:[]},c=0;const l=async()=>{let v=!1;const f=m=>{Object.defineProperty(m,"signal",{enumerable:!0,get:()=>(e.signal.aborted?v=!0:e.signal.addEventListener("abort",()=>{v=!0}),e.signal)})},p=Cd(e.options,e.fetchOptions),d=async(m,b,C)=>{if(v)return Promise.reject();if(b==null&&m.pages.length)return Promise.resolve(m);const w={queryKey:e.queryKey,pageParam:b,direction:C?"backward":"forward",meta:e.options.meta};f(w);const T=await p(w),{maxPages:S}=e.options,k=C?gb:mb;return{pages:k(m.pages,T,S),pageParams:k(m.pageParams,b,S)}};if(n&&o.length){const m=n==="backward",b=m?xb:kl,C={pages:o,pageParams:a},w=b(r,C);s=await d(C,w,m)}else{const m=i??o.length;do{const b=c===0?a[0]??r.initialPageParam:kl(r,s);if(c>0&&b==null)break;s=await d(s,b),c++}while(c<m)}return s};e.options.persister?e.fetchFn=()=>{var v,f;return(f=(v=e.options).persister)==null?void 0:f.call(v,l,{queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},t)}:e.fetchFn=l}}}function kl(i,{pages:e,pageParams:t}){const r=e.length-1;return e.length>0?i.getNextPageParam(e[r],e,t[r],t):void 0}function xb(i,{pages:e,pageParams:t}){var r;return e.length>0?(r=i.getPreviousPageParam)==null?void 0:r.call(i,e[0],e,t[0],t):void 0}var Ce,$i,zi,jr,Hr,Ki,Wr,qr,Al,Ny=(Al=class{constructor(i={}){de(this,Ce,void 0);de(this,$i,void 0);de(this,zi,void 0);de(this,jr,void 0);de(this,Hr,void 0);de(this,Ki,void 0);de(this,Wr,void 0);de(this,qr,void 0);le(this,Ce,i.queryCache||new Tb),le(this,$i,i.mutationCache||new Rb),le(this,zi,i.defaultOptions||{}),le(this,jr,new Map),le(this,Hr,new Map),le(this,Ki,0)}mount(){jn(this,Ki)._++,V(this,Ki)===1&&(le(this,Wr,wd.subscribe(async i=>{i&&(await this.resumePausedMutations(),V(this,Ce).onFocus())})),le(this,qr,Os.subscribe(async i=>{i&&(await this.resumePausedMutations(),V(this,Ce).onOnline())})))}unmount(){var i,e;jn(this,Ki)._--,V(this,Ki)===0&&((i=V(this,Wr))==null||i.call(this),le(this,Wr,void 0),(e=V(this,qr))==null||e.call(this),le(this,qr,void 0))}isFetching(i){return V(this,Ce).findAll({...i,fetchStatus:"fetching"}).length}isMutating(i){return V(this,$i).findAll({...i,status:"pending"}).length}getQueryData(i){var t;const e=this.defaultQueryOptions({queryKey:i});return(t=V(this,Ce).get(e.queryHash))==null?void 0:t.state.data}ensureQueryData(i){const e=this.getQueryData(i.queryKey);if(e===void 0)return this.fetchQuery(i);{const t=this.defaultQueryOptions(i),r=V(this,Ce).build(this,t);return i.revalidateIfStale&&r.isStaleByTime(_l(t.staleTime,r))&&this.prefetchQuery(t),Promise.resolve(e)}}getQueriesData(i){return V(this,Ce).findAll(i).map(({queryKey:e,state:t})=>{const r=t.data;return[e,r]})}setQueryData(i,e,t){const r=this.defaultQueryOptions({queryKey:i}),n=V(this,Ce).get(r.queryHash),o=n==null?void 0:n.state.data,a=lb(e,o);if(a!==void 0)return V(this,Ce).build(this,r).setData(a,{...t,manual:!0})}setQueriesData(i,e,t){return Ve.batch(()=>V(this,Ce).findAll(i).map(({queryKey:r})=>[r,this.setQueryData(r,e,t)]))}getQueryState(i){var t;const e=this.defaultQueryOptions({queryKey:i});return(t=V(this,Ce).get(e.queryHash))==null?void 0:t.state}removeQueries(i){const e=V(this,Ce);Ve.batch(()=>{e.findAll(i).forEach(t=>{e.remove(t)})})}resetQueries(i,e){const t=V(this,Ce),r={type:"active",...i};return Ve.batch(()=>(t.findAll(i).forEach(n=>{n.reset()}),this.refetchQueries(r,e)))}cancelQueries(i={},e={}){const t={revert:!0,...e},r=Ve.batch(()=>V(this,Ce).findAll(i).map(n=>n.cancel(t)));return Promise.all(r).then(mt).catch(mt)}invalidateQueries(i={},e={}){return Ve.batch(()=>{if(V(this,Ce).findAll(i).forEach(r=>{r.invalidate()}),i.refetchType==="none")return Promise.resolve();const t={...i,type:i.refetchType??i.type??"active"};return this.refetchQueries(t,e)})}refetchQueries(i={},e){const t={...e,cancelRefetch:(e==null?void 0:e.cancelRefetch)??!0},r=Ve.batch(()=>V(this,Ce).findAll(i).filter(n=>!n.isDisabled()).map(n=>{let o=n.fetch(void 0,t);return t.throwOnError||(o=o.catch(mt)),n.state.fetchStatus==="paused"?Promise.resolve():o}));return Promise.all(r).then(mt)}fetchQuery(i){const e=this.defaultQueryOptions(i);e.retry===void 0&&(e.retry=!1);const t=V(this,Ce).build(this,e);return t.isStaleByTime(_l(e.staleTime,t))?t.fetch(e):Promise.resolve(t.state.data)}prefetchQuery(i){return this.fetchQuery(i).then(mt).catch(mt)}fetchInfiniteQuery(i){return i.behavior=wl(i.pages),this.fetchQuery(i)}prefetchInfiniteQuery(i){return this.fetchInfiniteQuery(i).then(mt).catch(mt)}ensureInfiniteQueryData(i){return i.behavior=wl(i.pages),this.ensureQueryData(i)}resumePausedMutations(){return Os.isOnline()?V(this,$i).resumePausedMutations():Promise.resolve()}getQueryCache(){return V(this,Ce)}getMutationCache(){return V(this,$i)}getDefaultOptions(){return V(this,zi)}setDefaultOptions(i){le(this,zi,i)}setQueryDefaults(i,e){V(this,jr).set(On(i),{queryKey:i,defaultOptions:e})}getQueryDefaults(i){const e=[...V(this,jr).values()];let t={};return e.forEach(r=>{Dn(i,r.queryKey)&&(t={...t,...r.defaultOptions})}),t}setMutationDefaults(i,e){V(this,Hr).set(On(i),{mutationKey:i,defaultOptions:e})}getMutationDefaults(i){const e=[...V(this,Hr).values()];let t={};return e.forEach(r=>{Dn(i,r.mutationKey)&&(t={...t,...r.defaultOptions})}),t}defaultQueryOptions(i){if(i._defaulted)return i;const e={...V(this,zi).queries,...this.getQueryDefaults(i.queryKey),...i,_defaulted:!0};return e.queryHash||(e.queryHash=qa(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.enabled!==!0&&e.queryFn===Va&&(e.enabled=!1),e}defaultMutationOptions(i){return i!=null&&i._defaulted?i:{...V(this,zi).mutations,...(i==null?void 0:i.mutationKey)&&this.getMutationDefaults(i.mutationKey),...i,_defaulted:!0}}clear(){V(this,Ce).clear(),V(this,$i).clear()}},Ce=new WeakMap,$i=new WeakMap,zi=new WeakMap,jr=new WeakMap,Hr=new WeakMap,Ki=new WeakMap,Wr=new WeakMap,qr=new WeakMap,Al);export{dy as $,by as A,_y as B,fe as C,Yb as D,cy as E,Sy as F,qb as G,yy as H,vy as I,Hb as J,Wb as K,gs as L,us as M,oy as N,qi as O,Jb as P,ms as Q,$ as R,Mb as S,W as T,py as U,Cv as V,$b as W,ey as X,my as Y,ly as Z,uy as _,Qe as a,fy as a0,ay as a1,iy as a2,ry as a3,sy as a4,Qb as a5,ny as a6,wy as a7,Dy as a8,Oy as a9,Ry as aa,Py as ab,gl as ac,xy as ad,Ly as ae,vl as af,Ay as ag,Iy as ah,Qr as ai,My as aj,By as ak,Cy as al,ky as am,Ty as an,Ey as ao,Ny as ap,nt as b,Bb as c,jb as d,$o as e,tv as f,Od as g,zb as h,Fb as i,Sn as j,tu as k,ze as l,Nb as m,Ub as n,ju as o,Vb as p,Xb as q,ev as r,Ab as s,gy as t,ty as u,Kc as v,Zb as w,Kb as x,Gb as y,hy as z};
//# sourceMappingURL=vendor-19b22db8.js.map
